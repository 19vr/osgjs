window.OSG=function(){var e,i,n;return function(t){function r(t,e){return b.call(t,e)}function a(t,e){var r,i,n,a,o,s,u,h,l,c,d=e&&e.split("/"),f=_.map,p=f&&f["*"]||{};if(t&&"."===t.charAt(0))if(e){for(d=d.slice(0,d.length-1),t=d.concat(t.split("/")),h=0;h<t.length;h+=1)if(c=t[h],"."===c)t.splice(h,1),h-=1;else if(".."===c){if(1===h&&(".."===t[2]||".."===t[0]))break;h>0&&(t.splice(h-1,2),h-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((d||p)&&f){for(r=t.split("/"),h=r.length;h>0;h-=1){if(i=r.slice(0,h).join("/"),d)for(l=d.length;l>0;l-=1)if(n=f[d.slice(0,l).join("/")],n&&(n=n[i])){a=n,o=h;break}if(a)break;!s&&p&&p[i]&&(s=p[i],u=h)}!a&&s&&(a=s,o=u),a&&(r.splice(0,o,a),t=r.join("/"))}return t}function o(e,r){return function(){return f.apply(t,x.call(arguments,0).concat([e,r]))}}function s(t){return function(e){return a(e,t)}}function u(t){return function(e){m[t]=e}}function h(e){if(r(v,e)){var i=v[e];delete v[e],y[e]=!0,d.apply(t,i)}if(!r(m,e)&&!r(y,e))throw new Error("No "+e);return m[e]}function l(t){var e,r=t?t.indexOf("!"):-1;return r>-1&&(e=t.substring(0,r),t=t.substring(r+1,t.length)),[e,t]}function c(t){return function(){return _&&_.config&&_.config[t]||{}}}var d,f,p,g,m={},v={},_={},y={},b=Object.prototype.hasOwnProperty,x=[].slice;p=function(t,e){var r,i=l(t),n=i[0];return t=i[1],n&&(n=a(n,e),r=h(n)),n?t=r&&r.normalize?r.normalize(t,s(e)):a(t,e):(t=a(t,e),i=l(t),n=i[0],t=i[1],n&&(r=h(n))),{f:n?n+"!"+t:t,n:t,pr:n,p:r}},g={require:function(t){return o(t)},exports:function(t){var e=m[t];return"undefined"!=typeof e?e:m[t]={}},module:function(t){return{id:t,uri:"",exports:m[t],config:c(t)}}},d=function(e,i,n,a){var s,l,c,d,f,_,b=[],x=typeof n;if(a=a||e,"undefined"===x||"function"===x){for(i=!i.length&&n.length?["require","exports","module"]:i,f=0;f<i.length;f+=1)if(d=p(i[f],a),l=d.f,"require"===l)b[f]=g.require(e);else if("exports"===l)b[f]=g.exports(e),_=!0;else if("module"===l)s=b[f]=g.module(e);else if(r(m,l)||r(v,l)||r(y,l))b[f]=h(l);else{if(!d.p)throw new Error(e+" missing "+l);d.p.load(d.n,o(a,!0),u(l),{}),b[f]=m[l]}c=n?n.apply(m[e],b):void 0,e&&(s&&s.exports!==t&&s.exports!==m[e]?m[e]=s.exports:c===t&&_||(m[e]=c))}else e&&(m[e]=n)},e=i=f=function(e,r,i,n,a){return"string"==typeof e?g[e]?g[e](r):h(p(e,r).f):(e.splice||(_=e,r.splice?(e=r,r=i,i=null):e=t),r=r||function(){},"function"==typeof i&&(i=n,n=a),n?d(t,e,r,i):setTimeout(function(){d(t,e,r,i)},4),f)},f.config=function(t){return _=t,_.deps&&f(_.deps,_.callback),f},e._defined=m,n=function(t,e,i){e.splice||(i=e,e=[]),r(m,t)||r(v,t)||(v[t]=[t,e,i])},n.amd={jQuery:!0}}(),n("../tools/build/almond",function(){}),n("osgUtil/osgPool",[],function(){var t={};return t.memoryPools={},t.OsgObjectMemoryPool=function(t){return{_memPool:[],reset:function(){return this._memPool=[],this},put:function(t){this._memPool.push(t)},get:function(){return this._memPool.length>0?this._memPool.pop():(this.grow(),this.get())},grow:function(e){void 0===e&&(e=this._memPool.length>0?2*this._memPool.length:20);for(var r=this._memPool.length;r++<e;)this._memPool.push(new t);return this}}},t.OsgArrayMemoryPool=function(){return{_mempoolofPools:[],reset:function(){return this._memPoolofPools={},this},put:function(t){this._memPoolofPools[t.length]||(this._memPoolofPools[t.length]=[]),this._memPoolofPools[t.length].push(t)},get:function(t){if(this._memPoolofPools[t]){if(this._memPoolofPools.length>0)return this._memPool.pop()}else this._memPoolofPools[t]=[];return this.grow(t),this.get()},grow:function(t,e){void 0===e&&(e=this._memPool.length>0?2*this._memPool.length:20);for(var r=this._memPool.length;r++<e;)this._memPool.push(new Array(t));return this}}},t}),n("osg/StateGraph",["osgUtil/osgPool"],function(t){var e=function(){this.depth=0,this.children={},this.children.keys=[],this.leafs=[],this.stateset=void 0,this.parent=void 0};return e.prototype={clean:function(){this.leafs.splice(0,this.leafs.length),this.stateset=void 0,this.parent=void 0,this.depth=0;for(var e,r=this.children.keys,i=0,n=r.length;n>i;i++)e=r[i],this.children[e].clean(),t.memoryPools.stateGraph.put(this.children[e]);this.children={},r.splice(0,r.length),this.children.keys=r},getStateSet:function(){return this.stateset},findOrInsert:function(e){var r;return this.children[e.id]?r=this.children[e.id]:(r=t.memoryPools.stateGraph.get(),r.parent=this,r.depth=this.depth+1,r.stateset=e,this.children[e.id]=r,this.children.keys.push(e.id)),r},moveToRootStateGraph:function(t,e){for(;e;)e.stateSet&&t.popStateSet(),e=e._parent},moveStateGraph:function(t,e,r){var i,n;if(r!==e&&void 0!==r)if(void 0!==e){if(e.parent===r.parent)return void 0!==e.stateset&&t.popStateSet(),void 0!==r.stateset&&t.pushStateSet(r.stateset),void 0;for(;e.depth>r.depth;)void 0!==e.stateset&&t.popStateSet(),e=e.parent;for(i=[];r.depth>e.depth;)void 0!==r.stateset&&i.push(r.stateset),r=r.parent;for(;e!==r;)void 0!==e.stateset&&t.popStateSet(),e=e.parent,void 0!==r.stateset&&i.push(r.stateset),r=r.parent;for(i.reverse(),stackLength=i.length,n=0;stackLength>n;++n)t.pushStateSet(i[n])}else{i=[];do void 0!==r.stateset&&i.push(r.stateset),r=r.parent;while(r);for(i.reverse(),n=0,l=i.length;l>n;++n)t.pushStateSet(i[n])}}},e}),n("osg/Utils",["osgUtil/osgPool","osg/StateGraph"],function(t){var e={};return e.init=function(){var e=i("osg/StateGraph");t.memoryPools.stateGraph=new t.OsgObjectMemoryPool(e).grow(50)},e.isArray=function(t){return"[object Array]"===toString.call(t)},e.extend=function(){var t,r,i,n,a=Object.prototype.toString,o=Object.prototype.hasOwnProperty,s=function(t){return"[object Function]"===a.call(t)},u=e.isArray,h=function(t){if(!t||"[object Object]"!==a.call(t)||t.nodeType||t.setInterval)return!1;if(t.constructor&&!o.call(t,"constructor")&&!o.call(t.constructor.prototype,"isPrototypeOf"))return!1;var e;for(e in t);return void 0===e||o.call(t,e)},l=arguments[0]||{},c=1,d=arguments.length,f=!1;for("boolean"==typeof l&&(f=l,l=arguments[1]||{},c=2),"object"==typeof l||s(l)||(l={}),d===c&&(l=this,--c);d>c;c++)if(null!==(t=arguments[c]))for(r in t)if(i=l[r],n=t[r],l!==n)if(f&&n&&(h(n)||u(n))){var p=i&&(h(i)||u(i))?i:u(n)?[]:{};l[r]=e.extend(f,p,n)}else void 0!==n&&(l[r]=n);return l},e.objectInehrit=e.objectInherit=function(t){function r(){}r.prototype=t;for(var i=new r,n=1;n<arguments.length;n++)e.objectMix(i,arguments[n],!1);return i},e.objectMix=function(t,e,r){for(var i in e)r&&t[i]||(t[i]=e[i]);return t},e.objectLibraryClass=function(t,e,r){t.className=function(){return r},t.libraryName=function(){return e};var i=e+"::"+r;return t.libraryClassName=function(){return i},t},e.objectType={},e.objectType.type=0,e.objectType.generate=function(t){var r=e.objectType.type;return e.objectType[r]=t,e.objectType[t]=r,e.objectType.type+=1,r},e.Float32Array="undefined"!=typeof Float32Array?Float32Array:null,e.Int32Array="undefined"!=typeof Int32Array?Int32Array:null,e.Uint16Array="undefined"!=typeof Uint16Array?Uint16Array:null,e.performance={},e.performance.now=function(){if(void 0===window.performance)return function(){return Date.now()};var t=window.performance.now||window.performance.mozNow||window.performance.msNow||window.performance.oNow||window.performance.webkitNow||function(){return Date.now()};return function(){return t.apply(window.performance,arguments)}}(),e}),n("osg/Object",["osg/Utils"],function(t){var e=function(){this._name=void 0,this._userdata=void 0,this._instanceID=e.getInstanceID()};return e.prototype=t.objectLibraryClass({getInstanceID:function(){return this._instanceID},setName:function(t){this._name=t},getName:function(){return this._name},setUserData:function(t){this._userdata=t},getUserData:function(){return this._userdata}},"osg","Object"),function(){var t=0;e.getInstanceID=function(){return t+=1}}(),e}),n("osg/StateAttribute",["osg/Utils","osg/Object"],function(t,e){var r=function(){e.call(this),this._dirty=!0};return r.prototype=t.objectLibraryClass(t.objectInherit(e.prototype,{isDirty:function(){return this._dirty},dirty:function(){this._dirty=!0},setDirty:function(t){this._dirty=t}}),"osg","StateAttribute"),r.OFF=0,r.ON=1,r.OVERRIDE=2,r.PROTECTED=4,r.INHERIT=8,r}),n("osg/Vec4",[],function(){var t={dot:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},copy:function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},sub:function(t,e,r){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r[3]=t[3]-e[3],r},mult:function(t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r},add:function(t,e,r){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r},neg:function(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},lerp:function(t,e,r,i){var n=1-t;return i[0]=e[0]*n+t*r[0],i[1]=e[1]*n+t*r[1],i[2]=e[2]*n+t*r[2],i[3]=e[3]*n+t*r[3],i}};return t}),n("osg/BlendColor",["osg/Utils","osg/StateAttribute","osg/Vec4"],function(t,e,r){var i=function(t){e.call(this),this._constantColor=new Array(4),this._constantColor[0]=this._constantColor[1]=this._constantColor[2]=this._constantColor[3]=1,void 0!==t&&this.setConstantColor(t)};return i.prototype=t.objectLibraryClass(t.objectInehrit(e.prototype,{attributeType:"BlendColor",cloneType:function(){return new i},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setConstantColor:function(t){r.copy(t,this._constantColor)},getConstantColor:function(){return this._constantColor},apply:function(t){var e=t.getGraphicContext();e.blendColor(this._constantColor[0],this._constantColor[1],this._constantColor[2],this._constantColor[3]),this._dirty=!1}}),"osg","BlendColor"),i}),n("osg/BlendFunc",["osg/Utils","osg/StateAttribute"],function(t,e){var r=function(t,i,n,a){e.call(this),this._sourceFactor=r.ONE,this._destinationFactor=r.ZERO,this._sourceFactorAlpha=this._sourceFactor,this._destinationFactorAlpha=this._destinationFactor,this._separate=!1,void 0!==t&&this.setSource(t),void 0!==i&&this.setDestination(i),void 0!==n&&this.setSourceAlpha(n),void 0!==a&&this.setDestinationAlpha(a)};return r.ZERO=0,r.ONE=1,r.SRC_COLOR=768,r.ONE_MINUS_SRC_COLOR=769,r.SRC_ALPHA=770,r.ONE_MINUS_SRC_ALPHA=771,r.DST_ALPHA=772,r.ONE_MINUS_DST_ALPHA=773,r.DST_COLOR=774,r.ONE_MINUS_DST_COLOR=775,r.SRC_ALPHA_SATURATE=776,r.BLEND_DST_RGB=32968,r.BLEND_SRC_RGB=32969,r.BLEND_DST_ALPHA=32970,r.BLEND_SRC_ALPHA=32971,r.CONSTANT_COLOR=32769,r.ONE_MINUS_CONSTANT_COLOR=32770,r.CONSTANT_ALPHA=32771,r.ONE_MINUS_CONSTANT_ALPHA=32772,r.BLEND_COLOR=32773,r.prototype=t.objectLibraryClass(t.objectInehrit(e.prototype,{attributeType:"BlendFunc",cloneType:function(){return new r},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setSource:function(t){this.setSourceRGB(t),this.setSourceAlpha(t)},setDestination:function(t){this.setDestinationRGB(t),this.setDestinationAlpha(t)},checkSeparate:function(){return this._sourceFactor!==this._sourceFactorAlpha||this._destinationFactor!==this._destinationFactorAlpha},setSourceRGB:function(t){this._sourceFactor="string"==typeof t?r[t]:t,this._separate=this.checkSeparate()},setSourceAlpha:function(t){this._sourceFactorAlpha="string"==typeof t?r[t]:t,this._separate=this.checkSeparate()},setDestinationRGB:function(t){this._destinationFactor="string"==typeof t?r[t]:t,this._separate=this.checkSeparate()},setDestinationAlpha:function(t){this._destinationFactorAlpha="string"==typeof t?r[t]:t,this._separate=this.checkSeparate()},apply:function(t){var e=t.getGraphicContext();e.enable(e.BLEND),this._separate?e.blendFuncSeparate(this._sourceFactor,this._destinationFactor,this._sourceFactorAlpha,this._destinationFactorAlpha):e.blendFunc(this._sourceFactor,this._destinationFactor)}}),"osg","BlendFunc"),r}),n("osg/BoundingBox",["osg/Utils"],function(t){var e=function(){this.init()};return e.prototype=t.objectLibraryClass({_cache_radius2_tmp:[0,0,0],init:function(){this._min=[1/0,1/0,1/0],this._max=[-1/0,-1/0,-1/0]},valid:function(){return this._max[0]>=this._min[0]&&this._max[1]>=this._min[1]&&this._max[2]>=this._min[2]},expandBySphere:function(t){if(t.valid()){var e=this._max,r=this._min;r[0]=Math.min(r[0],t._center[0]-t._radius),r[1]=Math.min(r[1],t._center[1]-t._radius),r[2]=Math.min(r[2],t._center[2]-t._radius),e[0]=Math.max(e[0],t._center[0]+t._radius),e[1]=Math.max(e[1],t._center[1]+t._radius),e[2]=Math.max(e[2],t._center[2]+t._radius)}},expandByVec3:function(t){var e=this._min,r=this._max;e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),r[0]=Math.max(r[0],t[0]),r[1]=Math.max(r[1],t[1]),r[2]=Math.max(r[2],t[2])},center:function(){var t=this._min,e=this._max;return[.5*(t[0]+e[0]),.5*(t[1]+e[1]),.5*(t[2]+e[2])]},radius:function(){return Math.sqrt(this.radius2())},radius2:function(){var t=this._min,e=this._max,r=this._cache_radius2_tmp;return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],.25*(r[0]*r[0]+r[1]*r[1]+r[2]*r[2])},corner:function(t){return ret=[0,0,0],ret[0]=1&t?this._max[0]:this._min[0],ret[1]=2&t?this._max[1]:this._min[1],ret[2]=4&t?this._max[2]:this._min[2],ret}},"osg","BoundingBox"),e}),n("osg/Vec3",[],function(){var t={init:function(t){return t[0]=0,t[1]=0,t[2]=0,t},copy:function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},cross:function(t,e,r){var i=t[1]*e[2]-t[2]*e[1],n=t[2]*e[0]-t[0]*e[2],a=t[0]*e[1]-t[1]*e[0];return r[0]=i,r[1]=n,r[2]=a,r},valid:function(t){return isNaN(t[0])?!1:isNaN(t[1])?!1:isNaN(t[2])?!1:!0},mult:function(t,e,r){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r},length2:function(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]},length:function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])},distance:function(t,e){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(r*r+i*i+n*n)},normalize:function(t,e){var r=this.length2(t);if(r>0){var i=1/Math.sqrt(r);e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}else e[0]=t[0],e[1]=t[1],e[2]=t[2];return e},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},sub:function(t,e,r){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r},add:function(t,e,r){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r},neg:function(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},lerp:function(t,e,r,i){return i[0]=e[0]+(r[0]-e[0])*t,i[1]=e[1]+(r[1]-e[1])*t,i[2]=e[2]+(r[2]-e[2])*t,i}};return t}),n("osg/BoundingSphere",["osg/Vec3"],function(t){var e=function(){this._center=[0,0,0],this._radius=-1};return e.prototype={init:function(){this._center=[0,0,0],this._radius=-1},valid:function(){return this._radius>=0},set:function(t,e){this._center=t,this._radius=e},center:function(){return this._center},radius:function(){return this._radius},radius2:function(){return this._radius*this._radius},expandByBox:function(e){if(e.valid()){var r;if(this.valid()){var i=new BoundingBox;i._min[0]=e._min[0],i._min[1]=e._min[1],i._min[2]=e._min[2],i._max[0]=e._max[0],i._max[1]=e._max[1],i._max[2]=e._max[2];for(var n=0;8>n;n++){var a=t.sub(e.corner(r),this._center,[]);t.normalize(a,a),nv[0]*=-this._radius,nv[1]*=-this._radius,nv[2]*=-this._radius,nv[0]+=this._center[0],nv[1]+=this._center[1],nv[2]+=this._center[2],i.expandBy(nv)}r=i.center(),this._center[0]=r[0],this._center[1]=r[1],this._center[2]=r[2],this._radius=i.radius()}else r=e.center(),this._center[0]=r[0],this._center[1]=r[1],this._center[2]=r[2],this._radius=e.radius()}},expandByVec3:function(e){if(this.valid()){var i=t.sub(e,this.center(),[]);r=t.length(i),r>this.radius()&&(dr=.5*(r-this.radius()),this._center[0]+=i[0]*(dr/r),this._center[1]+=i[1]*(dr/r),this._center[2]+=i[2]*(dr/r),this._radius+=dr)}else this._center[0]=e[0],this._center[1]=e[1],this._center[2]=e[2],this._radius=0},expandRadiusBySphere:function(e){if(e.valid())if(this.valid()){var r=t.sub,i=t.length,n=i(r(e._center,this._center,[]))+e._radius;n>this._radius&&(this._radius=n)}else this._center=t.copy(e._center,[]),this._radius=e._radius},expandBy:function(e){if(e.valid()){if(!this.valid())return this._center[0]=e._center[0],this._center[1]=e._center[1],this._center[2]=e._center[2],this._radius=e.radius(),void 0;var r=t.sub(this.center(),e.center(),[]);if(d=t.length(r),!(d+e.radius()<=this.radius())){if(d+this.radius()<=e.radius())return this._center[0]=e._center[0],this._center[1]=e._center[1],this._center[2]=e._center[2],this._radius=e._radius,void 0;new_radius=.5*(this.radius()+d+e.radius()),ratio=(new_radius-this.radius())/d,this._center[0]+=(e._center[0]-this._center[0])*ratio,this._center[1]+=(e._center[1]-this._center[1])*ratio,this._center[2]+=(e._center[2]-this._center[2])*ratio,this._radius=new_radius}}},contains:function(e){var r=t.sub(e,this.center(),[]);return valid()&&t.length2(r)<=radius2()},intersects:function(e){var r=t.length2(t.sub(this.center(),e.center(),[]));return valid()&&e.valid()&&r<=(this.radius()+e.radius())*(this.radius()+e.radius())}},e}),n("osg/Notify",[],function(){function t(t){var e=[];try{throw 1==arguments.length?t:new Error}catch(t){t.stack&&(e=(t.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n"),e.shift())}for(var r=0;r<e.length;++r)""===e[r]&&(e.splice(r,1),--r);return e}var e={};return e.DEBUG=0,e.INFO=1,e.NOTICE=2,e.WARN=3,e.ERROR=4,e.setNotifyLevel=function(r){var i=function(e){void 0!==window.console&&window.console.log(e,t())},n=function(e){void 0!==window.console&&window.console.info(e,t())},a=function(e){void 0!==window.console&&window.console.warn(e,t())},o=function(e){void 0!==window.console&&window.console.error(e,t())},s=function(e){void 0!==window.console&&window.console.debug(e,t())},u=function(){};e.debug=u,e.info=u,e.log=u,e.warn=u,e.error=u,r<=e.DEBUG&&(e.debug=s),r<=e.INFO&&(e.info=n),r<=e.NOTICE&&(e.log=i),r<=e.WARN&&(e.warn=a),r<=e.ERROR&&(e.error=o)},e.setNotifyLevel(e.NOTICE),e.reportWebGLError=!1,e}),n("osg/BufferArray",["osg/Notify","osg/Utils","osg/Object"],function(t,e,r){var i=function(t,n,a){this._instanceID=r.getInstanceID(),this.dirty(),this._itemSize=a,"string"==typeof t&&(t=i[t]),this._type=t,void 0!==n&&(this._elements=this._type===i.ELEMENT_ARRAY_BUFFER?new e.Uint16Array(n):new e.Float32Array(n))};return i.ELEMENT_ARRAY_BUFFER=34963,i.ARRAY_BUFFER=34962,i.prototype={setItemSize:function(t){this._itemSize=t},isValid:function(){return void 0!==this._buffer||void 0!==this._elements?!0:!1},releaseGLObjects:function(t){void 0!==this._buffer&&null!==this._buffer&&t.deleteBuffer(this._buffer),this._buffer=void 0},bind:function(t){var e=this._type,r=this._buffer;return r?(t.bindBuffer(e,r),void 0):(!r&&this._elements.length>0&&(this._buffer=t.createBuffer(),this._numItems=this._elements.length/this._itemSize,t.bindBuffer(e,this._buffer)),void 0)},getItemSize:function(){return this._itemSize},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},compile:function(t){this._dirty&&(t.bufferData(this._type,this._elements,t.STATIC_DRAW),this._dirty=!1)},getElements:function(){return this._elements},setElements:function(t){this._elements=t,this._dirty=!0}},i.create=function(e,r,n){return t.log("BufferArray.create is deprecated, use new BufferArray with same arguments instead"),new i(e,r,n)},i}),n("osg/StateSet",["osg/Utils","osg/StateAttribute","osg/Object"],function(t,e,r){var i=function(){r.call(this),this.id=i.instance++,this.attributeMap={},this.attributeMap.attributeKeys=[],this.textureAttributeMapList=[],this._binName=void 0,this._binNumber=0,this._shaderGenerator=void 0};return i.instance=0,i.AttributePair=function(t,e){this._object=t,this._value=e},i.AttributePair.prototype={getAttribute:function(){return this._object},getUniform:function(){return this._object},getValue:function(){return this._value}},i.prototype=t.objectLibraryClass(t.objectInehrit(r.prototype,{getAttributePair:function(t,e){return new i.AttributePair(t,e)},addUniform:function(t,r){void 0===r&&(r=e.ON),this.uniforms||(this.uniforms={},this.uniforms.uniformKeys=[]);var i=t.name;this.uniforms[i]=this.getAttributePair(t,r),-1===this.uniforms.uniformKeys.indexOf(i)&&this.uniforms.uniformKeys.push(i)},getUniform:function(t){return this.uniforms&&this.uniforms[t]?this.uniforms[t].getAttribute():void 0},getUniformList:function(){return this.uniforms},setTextureAttributeAndMode:function(t,r,i){void 0===i&&(i=e.ON),this._setTextureAttribute(t,this.getAttributePair(r,i))},getNumTextureAttributeLists:function(){return this.textureAttributeMapList.length},getTextureAttribute:function(t,e){return void 0===this.textureAttributeMapList[t]||void 0===this.textureAttributeMapList[t][e]?void 0:this.textureAttributeMapList[t][e].getAttribute()},removeTextureAttribute:function(t,e){if(void 0!==this.textureAttributeMapList[t]&&void 0!==this.textureAttributeMapList[t][e]){delete this.textureAttributeMapList[t][e];var r=this.textureAttributeMapList[t].attributeKeys.indexOf(e);this.textureAttributeMapList[t].attributeKeys.splice(r,1)}},getAttribute:function(t){return void 0===this.attributeMap[t]?void 0:this.attributeMap[t].getAttribute()},setAttributeAndMode:function(t,r){void 0===r&&(r=e.ON),this._setAttribute(this.getAttributePair(t,r))},setAttribute:function(t,r){void 0===r&&(r=e.ON),this._setAttribute(this.getAttributePair(t,r))},removeAttribute:function(t){if(void 0!==this.attributeMap[t]){delete this.attributeMap[t];var e=this.attributeMap.attributeKeys.indexOf(t);this.attributeMap.attributeKeys.splice(e,1)}},setRenderingHint:function(t){"OPAQUE_BIN"===t?this.setRenderBinDetails(0,"RenderBin"):"TRANSPARENT_BIN"===t?this.setRenderBinDetails(10,"DepthSortedBin"):this.setRenderBinDetails(0,"")},setRenderBinDetails:function(t,e){this._binNumber=t,this._binName=e},getAttributeMap:function(){return this.attributeMap},getBinNumber:function(){return this._binNumber},getBinName:function(){return this._binName},setBinNumber:function(t){this._binNumber=t},setBinName:function(t){this._binName=t},getAttributeList:function(){for(var t=this.attributeMap,e=t.attributeKeys,r=e.length,i=new Array(r),n=0;r>n;n++)i[n]=t[e[n]];return i},setShaderGenerator:function(t){this._shaderGenerator=t},getShaderGenerator:function(){return this._shaderGenerator},_getUniformMap:function(){return this.uniforms},_setTextureAttribute:function(t,e){void 0===this.textureAttributeMapList[t]&&(this.textureAttributeMapList[t]={},this.textureAttributeMapList[t].attributeKeys=[]);var r=e.getAttribute().getTypeMember();this.textureAttributeMapList[t][r]=e,-1===this.textureAttributeMapList[t].attributeKeys.indexOf(r)&&this.textureAttributeMapList[t].attributeKeys.push(r)},_setAttribute:function(t){var e=t.getAttribute().getTypeMember();this.attributeMap[e]=t,-1===this.attributeMap.attributeKeys.indexOf(e)&&this.attributeMap.attributeKeys.push(e)}}),"osg","StateSet"),i.prototype.setTextureAttributeAndModes=i.prototype.setTextureAttributeAndMode,i.prototype.setAttributeAndModes=i.prototype.setAttributeAndMode,i}),n("osg/NodeVisitor",[],function(){var t=function(e){this.traversalMask=-1,this.nodeMaskOverride=0,this.traversalMode=e,void 0===e&&(this.traversalMode=t.TRAVERSE_ALL_CHILDREN),this.nodePath=[]};return t.TRAVERSE_PARENTS=1,t.TRAVERSE_ALL_CHILDREN=2,t._traversalFunctions={},t._traversalFunctions[t.TRAVERSE_PARENTS]=function(t){t.ascend(this)},t._traversalFunctions[t.TRAVERSE_ALL_CHILDREN]=function(t){t.traverse(this)},t._pushOntoNodePath={},t._pushOntoNodePath[t.TRAVERSE_PARENTS]=function(t){this.nodePath.unshift(t)},t._pushOntoNodePath[t.TRAVERSE_ALL_CHILDREN]=function(t){this.nodePath.push(t)},t._popFromNodePath={},t._popFromNodePath[t.TRAVERSE_PARENTS]=function(){return this.nodePath.shift()},t._popFromNodePath[t.TRAVERSE_ALL_CHILDREN]=function(){this.nodePath.pop()},t.prototype={setNodeMaskOverride:function(t){this.nodeMaskOverride=t},getNodeMaskOverride:function(){return this.nodeMaskOverride},setTraversalMask:function(t){this.traversalMask=t},getTraversalMask:function(){return this.traversalMask},pushOntoNodePath:function(e){t._pushOntoNodePath[this.traversalMode].call(this,e)},popFromNodePath:function(){t._popFromNodePath[this.traversalMode].call(this)},validNodeMask:function(t){var e=t.getNodeMask();return 0!==(this.traversalMask&(this.nodeMaskOverride|e))},apply:function(t){this.traverse(t)},traverse:function(e){t._traversalFunctions[this.traversalMode].call(this,e)}},t}),n("osg/Quat",[],function(){var t={copy:function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},makeIdentity:function(e){return t.init(e)},zeroRotation:function(e){return t.init(e)},init:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},sub:function(t,e,r){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r[3]=t[3]-e[3],r},add:function(t,e,r){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},length2:function(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]},neg:function(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},makeRotate:function(t,e,r,i,n){var a=1e-7,o=Math.sqrt(e*e+r*r+i*i);if(a>o)return this.init();var s=1/o,u=Math.cos(.5*t),h=Math.sin(.5*t);return void 0===n&&(n=[]),n[0]=e*h*s,n[1]=r*h*s,n[2]=i*h*s,n[3]=u,n},lerp:function(t,e,r,i){return i[0]=e[0]+(r[0]-e[0])*t,i[1]=e[1]+(r[1]-e[1])*t,i[2]=e[2]+(r[2]-e[2])*t,i[3]=e[3]+(r[3]-e[3])*t,i},slerp:function(t,e,r,i){var n=1e-5,a=r,o=this.dot(e,a);0>o&&(o=-o,this.neg(r,a));var s,u,h,l;return 1-o>n?(s=Math.acos(o),u=Math.sin(s),h=Math.sin((1-t)*s)/u,l=Math.sin(t*s)/u):(h=1-t,l=t),i[0]=e[0]*h+a[0]*l,i[1]=e[1]*h+a[1]*l,i[2]=e[2]*h+a[2]*l,i[3]=e[3]*h+a[3]*l,i},normalize:function(t,e){var r=1/this.length2(t);return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},conj:function(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},inverse:function(t,e){var r=1/this.length2(t);return this.conj(t,e),e[0]*=r,e[1]*=r,e[2]*=r,e[3]*=r,e},mult:function(t,e,r){return r[0]=t[0]*e[3]+t[1]*e[2]-t[2]*e[1]+t[3]*e[0],r[1]=-t[0]*e[2]+t[1]*e[3]+t[2]*e[0]+t[3]*e[1],r[2]=t[0]*e[1]-t[1]*e[0]+t[2]*e[3]+t[3]*e[2],r[3]=-t[0]*e[0]-t[1]*e[1]-t[2]*e[2]+t[3]*e[3],r},div:function(t,e,r){var i=1/e;return r[0]=t[0]*i,r[1]=t[1]*i,r[2]=t[2]*i,r[3]=t[3]*i,r},exp:function(t,e){var r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),i=Math.exp(t[3]),n=0;return r>1e-5&&(n=i*Math.sin(r)/r),void 0===e&&(e=[]),e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=i*Math.cos(r),e},ln:function(t,e){var r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=Math.sqrt(r),n=0;return i>1e-5&&(n=Math.atan2(i,t[3])/i),void 0===e&&(e=[]),r+=t[3]*t[3],e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=.5*Math.log(r),e},squad:function(t,e,r,i,n,a){var o=this.slerp(t,e,n),s=this.slerp(t,r,i);return this.slerp(2*t*(1-t),o,s,a)},computeTangent:function(t,e,r,i){var n,a,o=this.inv(e);return this.mult(r,o,n),this.ln(n,n),this.mult(t,o,a),this.ln(a,a),this.add(n,a,n),this.div(n,-4,n),this.exp(n,a),this.mult(a,q1,i)}};return t}),n("osg/Matrix",["osg/Notify","osg/Vec3","osg/Vec4","osg/Quat"],function(t,e,r,i){var n={_tmp0:[],_tmp1:[],valid:function(t){for(var e=0;16>e;e++)if(isNaN(t[e]))return!1;return!0},setRow:function(t,e,r,i,n,a){var o=4*e;t[o+0]=r,t[o+1]=i,t[o+2]=n,t[o+3]=a},innerProduct:function(t,e,r,i){var n=4*r;return t[n+0]*e[0+i]+t[n+1]*e[4+i]+t[n+2]*e[8+i]+t[n+3]*e[12+i]},set:function(t,e,r,i){return t[4*e+r]=i,i},get:function(t,e,r){return t[4*e+r]},makeIdentity:function(e){return void 0===e&&(e=[],t.log("Matrix.makeIdentity without matrix destination is deprecated")),n.setRow(e,0,1,0,0,0),n.setRow(e,1,0,1,0,0),n.setRow(e,2,0,0,1,0),n.setRow(e,3,0,0,0,1),e},makeTranslate:function(t,e,r,i){return void 0===i&&(i=[]),n.setRow(i,0,1,0,0,0),n.setRow(i,1,0,1,0,0),n.setRow(i,2,0,0,1,0),n.setRow(i,3,t,e,r,1),i},setTrans:function(t,e,r,i){return t[12]=e,t[13]=r,t[14]=i,t},getTrans:function(t,e){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},preMult:function(t,e){var r,i,n,a;return r=e[0]*t[0]+e[1]*t[4]+e[2]*t[8]+e[3]*t[12],i=e[4]*t[0]+e[5]*t[4]+e[6]*t[8]+e[7]*t[12],n=e[8]*t[0]+e[9]*t[4]+e[10]*t[8]+e[11]*t[12],a=e[12]*t[0]+e[13]*t[4]+e[14]*t[8]+e[15]*t[12],t[0]=r,t[4]=i,t[8]=n,t[12]=a,r=e[0]*t[1]+e[1]*t[5]+e[2]*t[9]+e[3]*t[13],i=e[4]*t[1]+e[5]*t[5]+e[6]*t[9]+e[7]*t[13],n=e[8]*t[1]+e[9]*t[5]+e[10]*t[9]+e[11]*t[13],a=e[12]*t[1]+e[13]*t[5]+e[14]*t[9]+e[15]*t[13],t[1]=r,t[5]=i,t[9]=n,t[13]=a,r=e[0]*t[2]+e[1]*t[6]+e[2]*t[10]+e[3]*t[14],i=e[4]*t[2]+e[5]*t[6]+e[6]*t[10]+e[7]*t[14],n=e[8]*t[2]+e[9]*t[6]+e[10]*t[10]+e[11]*t[14],a=e[12]*t[2]+e[13]*t[6]+e[14]*t[10]+e[15]*t[14],t[2]=r,t[6]=i,t[10]=n,t[14]=a,r=e[0]*t[3]+e[1]*t[7]+e[2]*t[11]+e[3]*t[15],i=e[4]*t[3]+e[5]*t[7]+e[6]*t[11]+e[7]*t[15],n=e[8]*t[3]+e[9]*t[7]+e[10]*t[11]+e[11]*t[15],a=e[12]*t[3]+e[13]*t[7]+e[14]*t[11]+e[15]*t[15],t[3]=r,t[7]=i,t[11]=n,t[15]=a,t},postMult:function(t,e){return btmp0=e[0]*t[0]+e[1]*t[4]+e[2]*t[8]+e[3]*t[12],btmp1=e[0]*t[1]+e[1]*t[5]+e[2]*t[9]+e[3]*t[13],btmp2=e[0]*t[2]+e[1]*t[6]+e[2]*t[10]+e[3]*t[14],btmp3=e[0]*t[3]+e[1]*t[7]+e[2]*t[11]+e[3]*t[15],e[0]=btmp0,e[1]=btmp1,e[2]=btmp2,e[3]=btmp3,btmp0=e[4]*t[0]+e[5]*t[4]+e[6]*t[8]+e[7]*t[12],btmp1=e[4]*t[1]+e[5]*t[5]+e[6]*t[9]+e[7]*t[13],btmp2=e[4]*t[2]+e[5]*t[6]+e[6]*t[10]+e[7]*t[14],btmp3=e[4]*t[3]+e[5]*t[7]+e[6]*t[11]+e[7]*t[15],e[4]=btmp0,e[5]=btmp1,e[6]=btmp2,e[7]=btmp3,btmp0=e[8]*t[0]+e[9]*t[4]+e[10]*t[8]+e[11]*t[12],btmp1=e[8]*t[1]+e[9]*t[5]+e[10]*t[9]+e[11]*t[13],btmp2=e[8]*t[2]+e[9]*t[6]+e[10]*t[10]+e[11]*t[14],btmp3=e[8]*t[3]+e[9]*t[7]+e[10]*t[11]+e[11]*t[15],e[8]=btmp0,e[9]=btmp1,e[10]=btmp2,e[11]=btmp3,btmp0=e[12]*t[0]+e[13]*t[4]+e[14]*t[8]+e[15]*t[12],btmp1=e[12]*t[1]+e[13]*t[5]+e[14]*t[9]+e[15]*t[13],btmp2=e[12]*t[2]+e[13]*t[6]+e[14]*t[10]+e[15]*t[14],btmp3=e[12]*t[3]+e[13]*t[7]+e[14]*t[11]+e[15]*t[15],e[12]=btmp0,e[13]=btmp1,e[14]=btmp2,e[15]=btmp3,e},multa:function(t,e,r){return r===t?this.preMult(t,e):r===e?this.postMult(t,e):(void 0===r&&(r=[]),r[0]=e[0]*t[0]+e[1]*t[4]+e[2]*t[8]+e[3]*t[12],r[1]=e[0]*t[1]+e[1]*t[5]+e[2]*t[9]+e[3]*t[13],r[2]=e[0]*t[2]+e[1]*t[6]+e[2]*t[10]+e[3]*t[14],r[3]=e[0]*t[3]+e[1]*t[7]+e[2]*t[11]+e[3]*t[15],r[4]=e[4]*t[0]+e[5]*t[4]+e[6]*t[8]+e[7]*t[12],r[5]=e[4]*t[1]+e[5]*t[5]+e[6]*t[9]+e[7]*t[13],r[6]=e[4]*t[2]+e[5]*t[6]+e[6]*t[10]+e[7]*t[14],r[7]=e[4]*t[3]+e[5]*t[7]+e[6]*t[11]+e[7]*t[15],r[8]=e[8]*t[0]+e[9]*t[4]+e[10]*t[8]+e[11]*t[12],r[9]=e[8]*t[1]+e[9]*t[5]+e[10]*t[9]+e[11]*t[13],r[10]=e[8]*t[2]+e[9]*t[6]+e[10]*t[10]+e[11]*t[14],r[11]=e[8]*t[3]+e[9]*t[7]+e[10]*t[11]+e[11]*t[15],r[12]=e[12]*t[0]+e[13]*t[4]+e[14]*t[8]+e[15]*t[12],r[13]=e[12]*t[1]+e[13]*t[5]+e[14]*t[9]+e[15]*t[13],r[14]=e[12]*t[2]+e[13]*t[6]+e[14]*t[10]+e[15]*t[14],r[15]=e[12]*t[3]+e[13]*t[7]+e[14]*t[11]+e[15]*t[15],r)},mult:function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],h=e[6],l=e[7],c=e[8],d=e[9],f=e[10],p=e[11],g=e[12],m=e[13],v=e[14],_=e[15],y=t[0],b=t[1],x=t[2],S=t[3],M=t[4],A=t[5],T=t[6],w=t[7],C=t[8],E=t[9],F=t[10],R=t[11],L=t[12],I=t[13],N=t[14],P=t[15];return r[0]=i*y+n*M+a*C+o*L,r[1]=i*b+n*A+a*E+o*I,r[2]=i*x+n*T+a*F+o*N,r[3]=i*S+n*w+a*R+o*P,r[4]=s*y+u*M+h*C+l*L,r[5]=s*b+u*A+h*E+l*I,r[6]=s*x+u*T+h*F+l*N,r[7]=s*S+u*w+h*R+l*P,r[8]=c*y+d*M+f*C+p*L,r[9]=c*b+d*A+f*E+p*I,r[10]=c*x+d*T+f*F+p*N,r[11]=c*S+d*w+f*R+p*P,r[12]=g*y+m*M+v*C+_*L,r[13]=g*b+m*A+v*E+_*I,r[14]=g*x+m*T+v*F+_*N,r[15]=g*S+m*w+v*R+_*P,r},multOrig:function(t,e,r){var i;if(r===t){i=[];for(var a=0;4>a;a++)i[0]=n.innerProduct(e,t,0,a),i[1]=n.innerProduct(e,t,1,a),i[2]=n.innerProduct(e,t,2,a),i[3]=n.innerProduct(e,t,3,a),t[0+a]=i[0],t[4+a]=i[1],t[8+a]=i[2],t[12+a]=i[3];return t}if(r===e){i=[];for(var o=0;4>o;o++)i[0]=n.innerProduct(e,t,o,0),i[1]=n.innerProduct(e,t,o,1),i[2]=n.innerProduct(e,t,o,2),i[3]=n.innerProduct(e,t,o,3),this.setRow(e,o,i[0],i[1],i[2],i[3]);return e}void 0===r&&(r=[]);var s=e[0],u=e[1],h=e[2],l=e[3],c=e[4],d=e[5],f=e[6],p=e[7],g=e[8],m=e[9],v=e[10],_=e[11],y=e[12],b=e[13],x=e[14],S=e[15],M=t[0],A=t[1],T=t[2],w=t[3],C=t[4],E=t[5],F=t[6],R=t[7],L=t[8],I=t[9],N=t[10],P=t[11],k=t[12],O=t[13],D=t[14],U=t[15];return r[0]=s*M+u*C+h*L+l*k,r[1]=s*A+u*E+h*I+l*O,r[2]=s*T+u*F+h*N+l*D,r[3]=s*w+u*R+h*P+l*U,r[4]=c*M+d*C+f*L+p*k,r[5]=c*A+d*E+f*I+p*O,r[6]=c*T+d*F+f*N+p*D,r[7]=c*w+d*R+f*P+p*U,r[8]=g*M+m*C+v*L+_*k,r[9]=g*A+m*E+v*I+_*O,r[10]=g*T+m*F+v*N+_*D,r[11]=g*w+m*R+v*P+_*U,r[12]=y*M+b*C+x*L+S*k,r[13]=y*A+b*E+x*I+S*O,r[14]=y*T+b*F+x*N+S*D,r[15]=y*w+b*R+x*P+S*U,r
},makeLookAt:function(t,r,i,a){void 0===a&&(a=[]);var o=e.sub(r,t,[]);e.normalize(o,o);var s=e.cross(o,i,[]);e.normalize(s,s);var u=e.cross(s,o,[]);return e.normalize(u,u),a[0]=s[0],a[1]=u[0],a[2]=-o[0],a[3]=0,a[4]=s[1],a[5]=u[1],a[6]=-o[1],a[7]=0,a[8]=s[2],a[9]=u[2],a[10]=-o[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,n.multTranslate(a,e.neg(t,[]),a),a},makeOrtho:function(t,e,r,i,a,o,s){void 0===s&&(s=[]);var u=-(e+t)/(e-t),h=-(i+r)/(i-r),l=-(o+a)/(o-a),c=n.setRow;return c(s,0,2/(e-t),0,0,0),c(s,1,0,2/(i-r),0,0),c(s,2,0,0,-2/(o-a),0),c(s,3,u,h,l,1),s},getLookAt:function(t,r,i,a,o){void 0===o&&(o=1);var s=[],u=n.inverse(t,s);u||n.makeIdentity(s),n.transformVec3(s,[0,0,0],r),n.transform3x3(t,[0,1,0],a),n.transform3x3(t,[0,0,-1],i),e.normalize(i,i),e.add(e.mult(i,o,[]),r,i)},getRotate:function(t,e){void 0===e&&(e=[]);var r,i,n,a=[],o=t[0],s=t[5],u=t[10];for(a[0]=1+o+s+u,a[1]=1+o-s-u,a[2]=1-o+s-u,a[3]=1-o-s+u,n=0,i=1;4>i;i++)n=a[i]>a[n]?i:n;return 0===n?(e[3]=a[0],e[0]=t[6]-t[9],e[1]=t[8]-t[2],e[2]=t[1]-t[4]):1==n?(e[3]=t[6]-t[9],e[0]=a[1],e[1]=t[1]+t[4],e[2]=t[8]+t[2]):2==n?(e[3]=t[8]-t[2],e[0]=t[1]+t[4],e[1]=a[2],e[2]=t[6]+t[9]):(e[3]=t[1]-t[4],e[0]=t[8]+t[2],e[1]=t[6]+t[9],e[2]=a[3]),r=Math.sqrt(.25/a[n]),e[3]*=r,e[0]*=r,e[1]*=r,e[2]*=r,e},preMultTranslate:function(t,e){return 0!==e[0]&&(val=e[0],t[12]+=val*t[0],t[13]+=val*t[1],t[14]+=val*t[2],t[15]+=val*t[3]),0!==e[1]&&(val=e[1],t[12]+=val*t[4],t[13]+=val*t[5],t[14]+=val*t[6],t[15]+=val*t[7]),0!==e[2]&&(val=e[2],t[12]+=val*t[8],t[13]+=val*t[9],t[14]+=val*t[10],t[15]+=val*t[11]),t},multTranslate:function(t,e,r){void 0===r&&(r=[]),r!==t&&n.copy(t,r);var i;return 0!==e[0]&&(i=e[0],r[12]+=i*t[0],r[13]+=i*t[1],r[14]+=i*t[2],r[15]+=i*t[3]),0!==e[1]&&(i=e[1],r[12]+=i*t[4],r[13]+=i*t[5],r[14]+=i*t[6],r[15]+=i*t[7]),0!==e[2]&&(i=e[2],r[12]+=i*t[8],r[13]+=i*t[9],r[14]+=i*t[10],r[15]+=i*t[11]),r},makeRotate:function(e,r,i,a,o){void 0===o&&(t.log("makeRotate without given matrix destination is deprecated"),o=[]);var s=Math.sqrt(r*r+i*i+a*a),u=Math.sin(e),h=Math.cos(e);if(s>0){var l,c,d,f,p,g,m,v,_,y;return s=1/s,r*=s,i*=s,a*=s,l=r*r,c=i*i,d=a*a,f=r*i,p=i*a,g=a*r,m=r*u,v=i*u,_=a*u,y=1-h,o[0]=y*l+h,o[1]=y*f-_,o[2]=y*g+v,o[3]=0,o[4]=y*f+_,o[5]=y*c+h,o[6]=y*p-m,o[7]=0,o[8]=y*g-v,o[9]=y*p+m,o[10]=y*d+h,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}return n.makeIdentity(o)},transform3x3:function(t,e,r){return void 0===r&&(r=[]),r[0]=t[0]*e[0]+t[1]*e[1]+t[2]*e[2],r[1]=t[4]*e[0]+t[5]*e[1]+t[6]*e[2],r[2]=t[8]*e[0]+t[9]*e[1]+t[10]*e[2],r},transformVec3:function(r,i,n){var a=1/(r[3]*i[0]+r[7]*i[1]+r[11]*i[2]+r[15]);void 0===n&&(t.warn("deprecated, Matrix.transformVec3 needs a third parameter as result"),n=[]);var o;return o=n===i?[]:n,o[0]=(r[0]*i[0]+r[4]*i[1]+r[8]*i[2]+r[12])*a,o[1]=(r[1]*i[0]+r[5]*i[1]+r[9]*i[2]+r[13])*a,o[2]=(r[2]*i[0]+r[6]*i[1]+r[10]*i[2]+r[14])*a,n===i&&e.copy(o,n),n},transformVec4:function(t,e,i){void 0===i&&(i=[]);var n;return n=i===e?[]:i,n[0]=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3],n[1]=t[4]*e[0]+t[5]*e[1]+t[6]*e[2]+t[7]*e[3],n[2]=t[8]*e[0]+t[9]*e[1]+t[10]*e[2]+t[11]*e[3],n[3]=t[12]*e[0]+t[13]*e[1]+t[14]*e[2]+t[15]*e[3],i===e&&r.copy(n,i),i},copy:function(t,e){return void 0===e&&(e=[]),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},inverse:function(t,e){return e===t&&(n.copy(t,n._tmp1),t=n._tmp1),0===t[3]&&0===t[7]&&0===t[11]&&1===t[15]?this.inverse4x3(t,e):this.inverse4x4(t,e)},inverse4x4:function(e,r){var i=e[10]*e[15],n=e[14]*e[11],a=e[6]*e[15],o=e[14]*e[7],s=e[6]*e[11],u=e[10]*e[7],h=e[2]*e[15],l=e[14]*e[3],c=e[2]*e[11],d=e[10]*e[3],f=e[2]*e[7],p=e[6]*e[3],g=e[8]*e[13],m=e[12]*e[9],v=e[4]*e[13],_=e[12]*e[5],y=e[4]*e[9],b=e[8]*e[5],x=e[0]*e[13],S=e[12]*e[1],M=e[0]*e[9],A=e[8]*e[1],T=e[0]*e[5],w=e[4]*e[1],C=i*e[5]+o*e[9]+s*e[13]-(n*e[5]+a*e[9]+u*e[13]),E=n*e[1]+h*e[9]+d*e[13]-(i*e[1]+l*e[9]+c*e[13]),F=a*e[1]+l*e[5]+f*e[13]-(o*e[1]+h*e[5]+p*e[13]),R=u*e[1]+c*e[5]+p*e[9]-(s*e[1]+d*e[5]+f*e[9]),L=e[0]*C+e[4]*E+e[8]*F+e[12]*R;if(Math.abs(L)<1e-5)return t.log("Warning can't inverse matrix "+e),!1;var I=1/L,N=I*C,P=I*E,k=I*F,O=I*R,D=I*(n*e[4]+a*e[8]+u*e[12]-(i*e[4]+o*e[8]+s*e[12])),U=I*(i*e[0]+l*e[8]+c*e[12]-(n*e[0]+h*e[8]+d*e[12])),V=I*(o*e[0]+h*e[4]+p*e[12]-(a*e[0]+l*e[4]+f*e[12])),B=I*(s*e[0]+d*e[4]+f*e[8]-(u*e[0]+c*e[4]+p*e[8])),j=I*(g*e[7]+_*e[11]+y*e[15]-(m*e[7]+v*e[11]+b*e[15])),G=I*(m*e[3]+x*e[11]+A*e[15]-(g*e[3]+S*e[11]+M*e[15])),z=I*(v*e[3]+S*e[7]+T*e[15]-(_*e[3]+x*e[7]+w*e[15])),H=I*(b*e[3]+M*e[7]+w*e[11]-(y*e[3]+A*e[7]+T*e[11])),K=I*(v*e[10]+b*e[14]+m*e[6]-(y*e[14]+g*e[6]+_*e[10])),W=I*(M*e[14]+g*e[2]+S*e[10]-(x*e[10]+A*e[14]+m*e[2])),q=I*(x*e[6]+w*e[14]+_*e[2]-(T*e[14]+v*e[2]+S*e[6])),X=I*(T*e[10]+y*e[2]+A*e[6]-(M*e[6]+w*e[10]+b*e[2]));return r[0]=N,r[1]=P,r[2]=k,r[3]=O,r[4]=D,r[5]=U,r[6]=V,r[7]=B,r[8]=j,r[9]=G,r[10]=z,r[11]=H,r[12]=K,r[13]=W,r[14]=q,r[15]=X,!0},inverse4x3:function(t,e){var r=t[0],i=t[1],a=t[2],o=t[4],s=t[5],u=t[6],h=t[8],l=t[9],c=t[10];e[0]=s*c-u*l,e[1]=a*l-i*c,e[2]=i*u-a*s;var d=1/(r*e[0]+o*e[1]+h*e[2]);r*=d,o*=d,h*=d,e[0]*=d,e[1]*=d,e[2]*=d,e[3]=0,e[4]=u*h-o*c,e[5]=r*c-a*h,e[6]=a*o-r*u,e[7]=0,e[8]=o*l-s*h,e[9]=i*h-r*l,e[10]=r*s-i*o,e[11]=0,e[15]=1;var f,p,g,m=t[15],v=m-1;if(v*v>1e-6){var _=n._tmp0;e[12]=e[13]=e[14]=0;var y=t[3],b=t[7],x=t[11],S=e[0]*y+e[1]*b+e[2]*x,M=e[4]*y+e[5]*b+e[6]*x,A=e[8]*y+e[9]*b+e[10]*x;f=t[12],p=t[13],g=t[14];var T=1/(m-(f*S+p*M+g*A));f*=T,p*=T,g*=T,_[0]=f*S+1,_[1]=p*S,_[2]=g*S,_[3]=-S*T,_[4]=f*M,_[5]=p*M+1,_[6]=g*M,_[7]=-M*T,_[8]=f*A,_[9]=p*A,_[10]=g*A+1,_[11]=-A*T,_[12]=-f,_[13]=-p,_[14]=-g,_[15]=T,n.preMult(e,_)}else f=t[12],p=t[13],g=t[14],e[12]=-(f*e[0]+p*e[4]+g*e[8]),e[13]=-(f*e[1]+p*e[5]+g*e[9]),e[14]=-(f*e[2]+p*e[6]+g*e[10]);return!0},transpose:function(t,e){if(t===e){var r=t[1],i=t[2],n=t[3],a=t[6],o=t[7],s=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=r,t[6]=t[9],t[7]=t[13],t[8]=i,t[9]=a,t[11]=t[14],t[12]=n,t[13]=o,t[14]=s,t}return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e},makePerspective:function(t,e,r,i,a){void 0===a&&(a=[]);var o=r*Math.tan(t*Math.PI/360),s=-o,u=s*e,h=o*e;return n.makeFrustum(u,h,s,o,r,i,a)},getFrustum:function(t,e){var r=0,i=0,n=0,a=0;if(0!==t[3]||0!==t[7]||-1!==t[11]||0!==t[15])return!1;var o=t[14]/(t[10]-1),s=t[14]/(1+t[10]);return i=o*(t[8]-1)/t[0],r=o*(1+t[8])/t[0],n=o*(1+t[9])/t[5],a=o*(t[9]-1)/t[5],zNear=o,zFar=s,e.left=i,e.right=r,e.top=n,e.bottom=a,e.zNear=zNear,e.zFar=zFar,!0},getPerspective:function(t,e){var r={right:0,left:0,top:0,bottom:0,zNear:0,zFar:0},i=this.getFrustum(t,r);return i&&(e.fovy=180/Math.PI*(Math.atan(r.top/r.zNear)-Math.atan(r.bottom/r.zNear)),e.aspectRatio=(r.right-r.left)/(r.top-r.bottom)),e.zNear=r.zNear,e.zFar=r.zFar,e},makeScale:function(t,e,r,i){return void 0===i&&(i=[]),this.setRow(i,0,t,0,0,0),this.setRow(i,1,0,e,0,0),this.setRow(i,2,0,0,r,0),this.setRow(i,3,0,0,0,1),i},computeFrustrumCornersVectors:function(t,e){t[14]/(t[10]-1),t[14]/(t[10]+1);var r=1/t[0],i=1/t[5];return e[0]=[-r,i,1],e[1]=[-r,-i,1],e[2]=[r,-i,1],e[3]=[r,i,1],e},makeFrustum:function(t,e,r,i,n,a,o){void 0===o&&(o=[]);var s=2*n/(e-t),u=2*n/(i-r),h=(e+t)/(e-t),l=(i+r)/(i-r),c=-(a+n)/(a-n),d=-2*a*n/(a-n);return this.setRow(o,0,s,0,0,0),this.setRow(o,1,0,u,0,0),this.setRow(o,2,h,l,c,-1),this.setRow(o,3,0,0,d,0),o},makeRotateFromQuat:function(t,e){return this.makeIdentity(e),this.setRotateFromQuat(e,t)},setRotateFromQuat:function(t,e){var r=i.length2(e);if(Math.abs(r)<=Number.MIN_VALUE)t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[8]=0,t[9]=0,t[10]=0;else{var n;n=1!==r?2/r:2;var a,o,s,u,h,l,c,d,f,p,g,m;p=n*e[0],g=n*e[1],m=n*e[2],u=e[0]*p,c=e[0]*g,d=e[0]*m,h=e[1]*g,l=e[1]*m,f=e[2]*m,a=e[3]*p,o=e[3]*g,s=e[3]*m,t[0]=1-(h+f),t[4]=c-s,t[8]=d+o,t[1]=c+s,t[5]=1-(u+f),t[9]=l-a,t[2]=d-o,t[6]=l+a,t[10]=1-(u+h)}return t}};return n}),n("osg/TransformEnums",[],function(){return{RELATIVE_RF:0,ABSOLUTE_RF:1}}),n("osg/ComputeMatrixFromNodePath",["osg/Matrix","osg/TransformEnums"],function(t,e){return computeLocalToWorld=function(r,i){var n=i;void 0===n&&(n=!0);var a=t.makeIdentity([]),o=0;if(n)for(o=r.length-1;o>0;o--){var s=r[o];if(1===s.objectType&&(s.getReferenceFrame!==e.RELATIVE_RF||0===s.getParents().length))break}for(var u=o,h=r.length;h>u;u++){var l=r[u];l.computeLocalToWorldMatrix&&l.computeLocalToWorldMatrix(a)}return a},{computeLocalToWorld:computeLocalToWorld}}),n("osg/Node",["osg/Utils","osg/Object","osg/BoundingBox","osg/BoundingSphere","osg/StateSet","osg/NodeVisitor","osg/Matrix","osg/ComputeMatrixFromNodePath","osg/TransformEnums"],function(t,e,r,i,n,a,o,s,u){var h=function(){e.call(this),this.children=[],this.parents=[],this.nodeMask=-1,this.boundingSphere=new i,this.boundingSphereComputed=!1,this._updateCallbacks=[],this._cullCallback=void 0};return h.prototype=t.objectLibraryClass(t.objectInehrit(e.prototype,{getOrCreateStateSet:function(){return void 0===this.stateset&&(this.stateset=new n),this.stateset},getStateSet:function(){return this.stateset},accept:function(t){t.validNodeMask(this)&&(t.pushOntoNodePath(this),t.apply(this),t.popFromNodePath())},dirtyBound:function(){if(this.boundingSphereComputed===!0){this.boundingSphereComputed=!1;for(var t=0,e=this.parents.length;e>t;t++)this.parents[t].dirtyBound()}},setNodeMask:function(t){this.nodeMask=t},getNodeMask:function(){return this.nodeMask},setStateSet:function(t){this.stateset=t},setUpdateCallback:function(t){this._updateCallbacks[0]=t},getUpdateCallback:function(){return this._updateCallbacks[0]},addUpdateCallback:function(t){this._updateCallbacks.push(t)},removeUpdateCallback:function(t){var e=this._updateCallbacks.indexOf(t);-1!==e&&this._updateCallbacks.splice(e,1)},getUpdateCallbackList:function(){return this._updateCallbacks},setCullCallback:function(t){this._cullCallback=t},getCullCallback:function(){return this._cullCallback},hasChild:function(t){for(var e=0,r=this.children.length;r>e;e++)if(this.children[e]===t)return!0;return!1},addChild:function(t){var e=this.children.push(t);return t.addParent(this),this.dirtyBound(),e},getChildren:function(){return this.children},getParents:function(){return this.parents},addParent:function(t){this.parents.push(t)},removeParent:function(t){for(var e=0,r=this.parents.length,i=this.parents;r>e;e++)if(i[e]===t)return i.splice(e,1),void 0},removeChildren:function(){var t=this.children;if(0!==t.length){for(var e=0,r=t.length;r>e;e++)t[e].removeParent(this);this.children.splice(0,this.children.length),this.dirtyBound()}},removeChild:function(t){for(var e=0,r=this.children.length;r>e;e++)this.children[e]===t&&(t.removeParent(this),this.children.splice(e,1),this.dirtyBound())},traverse:function(t){for(var e=0,r=this.children.length;r>e;e++){var i=this.children[e];i.accept(t)}},ascend:function(t){for(var e=0,r=this.parents.length;r>e;e++){var i=this.parents[e];i.accept(t)}},getBound:function(){return this.boundingSphereComputed||(this.computeBound(this.boundingSphere),this.boundingSphereComputed=!0),this.boundingSphere},computeBound:function(t){var e=new r;e.init(),t.init();for(var i=0,n=this.children.length;n>i;i++){var a=this.children[i];(void 0===a.referenceFrame||a.referenceFrame===u.RELATIVE_RF)&&e.expandBySphere(a.getBound())}if(!e.valid())return t;t._center=e.center(),t._radius=0;for(var o=0,s=this.children.length;s>o;o++){var h=this.children[o];(void 0===h.referenceFrame||h.referenceFrame===u.RELATIVE_RF)&&t.expandRadiusBySphere(h.getBound())}return t},getWorldMatrices:function(e){var r=function(t){this.nodePaths=[],this.halt=t,a.call(this,a.TRAVERSE_PARENTS)};r.prototype=t.objectInehrit(a.prototype,{apply:function(t){0===t.parents.length||t===this.halt?this.nodePaths.push(this.nodePath.slice(0)):this.traverse(t)}});var i=new r(e);this.accept(i);for(var n=[],u=0,h=i.nodePaths.length;h>u;u++){var l=i.nodePaths[u];0===l.length?n.push(o.makeIdentity([])):n.push(s.computeLocalToWorld(l))}return n}}),"osg","Node"),h.prototype.objectType=t.objectType.generate("Node"),h}),n("osg/Transform",["osg/Utils","osg/Node","osg/Matrix","osg/Vec3","osg/TransformEnums"],function(t,e,r,i,n){var a=function(){e.call(this),this.referenceFrame=n.RELATIVE_RF};return a.prototype=t.objectInehrit(e.prototype,{setReferenceFrame:function(t){this.referenceFrame=t},getReferenceFrame:function(){return this.referenceFrame},computeBound:function(t){if(e.prototype.computeBound.call(this,t),!t.valid())return t;var n=r.makeIdentity([]);this.computeLocalToWorldMatrix(n);var a=i.copy(t._center,[]);a[0]+=t._radius,r.transformVec3(n,a,a);var o=i.copy(t._center,[]);o[1]+=t._radius,r.transformVec3(n,o,o);var s=i.copy(t._center,[]);s[2]+=t._radius,r.transformVec3(n,s,s),r.transformVec3(n,t._center,t._center),i.sub(a,t._center,a);var u=i.length(a);i.sub(o,t._center,o);var h=i.length(o);i.sub(s,t._center,s);var l=i.length(s);return t._radius=u,t._radius<h&&(t._radius=h),t._radius<l&&(t._radius=l),t}}),a}),n("osg/CullSettings",[],function(){var t=function(){this._computeNearFar=!0,this._nearFarRatio=.005;var t=[0,0,-1];this.bbCornerFar=(t[0]>=0?1:0)|(t[1]>=0?2:0)|(t[2]>=0?4:0),this.bbCornerNear=7&~this.bbCornerFar};return t.prototype={setCullSettings:function(t){this._computeNearFar=t._computeNearFar,this._nearFarRatio=t._nearFarRatio},setNearFarRatio:function(t){this._nearFarRatio=t},getNearFarRatio:function(){return this._nearFarRatio},setComputeNearFar:function(t){this._computeNearFar=t},getComputeNearFar:function(){return this._computeNearFar}},t}),n("osg/Camera",["osg/Utils","osg/Transform","osg/CullSettings","osg/Matrix","osg/TransformEnums"],function(t,e,r,i,n){var a=function(){e.call(this),r.call(this),this.viewport=void 0,this.setClearColor([0,0,0,1]),this.setClearDepth(1),this.setClearMask(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),this.setViewMatrix(i.makeIdentity([])),this.setProjectionMatrix(i.makeIdentity([])),this.renderOrder=a.NESTED_RENDER,this.renderOrderNum=0};return a.PRE_RENDER=0,a.NESTED_RENDER=1,a.POST_RENDER=2,a.COLOR_BUFFER_BIT=16384,a.DEPTH_BUFFER_BIT=256,a.STENCIL_BUFFER_BIT=1024,a.prototype=t.objectLibraryClass(t.objectInehrit(r.prototype,t.objectInehrit(e.prototype,{setClearDepth:function(t){this.clearDepth=t},getClearDepth:function(){return this.clearDepth},setClearMask:function(t){this.clearMask=t},getClearMask:function(){return this.clearMask},setClearColor:function(t){this.clearColor=t},getClearColor:function(){return this.clearColor},setViewport:function(t){this.viewport=t,this.getOrCreateStateSet().setAttributeAndMode(t)},getViewport:function(){return this.viewport},setViewMatrix:function(t){this.modelviewMatrix=t},setProjectionMatrix:function(t){this.projectionMatrix=t},setProjectionMatrixAsOrtho:function(t,e,r,n,a,o){i.makeOrtho(t,e,r,n,a,o,this.getProjectionMatrix())},getViewMatrix:function(){return this.modelviewMatrix},getProjectionMatrix:function(){return this.projectionMatrix},getRenderOrder:function(){return this.renderOrder},setRenderOrder:function(t,e){this.renderOrder=t,this.renderOrderNum=e},attachTexture:function(t,e,r){this.frameBufferObject&&this.frameBufferObject.dirty(),void 0===r&&(r=0),void 0===this.attachments&&(this.attachments={}),this.attachments[t]={texture:e,level:r}},attachRenderBuffer:function(t,e){this.frameBufferObject&&this.frameBufferObject.dirty(),void 0===this.attachments&&(this.attachments={}),this.attachments[t]={format:e}},computeLocalToWorldMatrix:function(t){return this.referenceFrame===n.RELATIVE_RF?i.preMult(t,this.modelviewMatrix):t=this.modelviewMatrix,!0},computeWorldToLocalMatrix:function(t){var e=[];return i.inverse(this.modelviewMatrix,e),this.referenceFrame===n.RELATIVE_RF?i.postMult(e,t):t=e,!0}})),"osg","Camera"),a.prototype.objectType=t.objectType.generate("Camera"),a}),n("osg/CullFace",["osg/Utils","osg/StateAttribute"],function(t,e){var r=function(t){e.call(this),void 0===t&&(t=r.BACK),this.setMode(t)};return r.DISABLE=0,r.FRONT=1028,r.BACK=1029,r.FRONT_AND_BACK=1032,r.prototype=t.objectLibraryClass(t.objectInehrit(e.prototype,{attributeType:"CullFace",cloneType:function(){return new r},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setMode:function(t){"string"==typeof t&&(t=r[t]),this._mode=t},getMode:function(){return this._mode},apply:function(t){var e=t.getGraphicContext();this._mode===r.DISABLE?e.disable(e.CULL_FACE):(e.enable(e.CULL_FACE),e.cullFace(this._mode)),this._dirty=!1}}),"osg","CullFace"),r}),n("osg/CullStack",[],function(){var t=function(){this._modelviewMatrixStack=[],this._projectionMatrixStack=[],this._viewportStack=[],this._bbCornerFar=0,this._bbCornerNear=0};return t.prototype={getProjectionMatrixStack:function(){return this._projectionMatrixStack},getModelviewMatrixStack:function(){return this._modelviewMatrixStack},getCurrentProjectionMatrix:function(){return this._projectionMatrixStack[this._projectionMatrixStack.length-1]},getCurrentModelviewMatrix:function(){return this._modelviewMatrixStack[this._modelviewMatrixStack.length-1]},getViewport:function(){return 0===this._viewportStack.length?void 0:this._viewportStack[this._viewportStack.length-1]},getLookVectorLocal:function(){var t=this._modelviewMatrixStack[this._modelviewMatrixStack.length-1];return[-t[2],-t[6],-t[10]]},pushViewport:function(t){this._viewportStack.push(t)},popViewport:function(){this._viewportStack.pop()},pushModelviewMatrix:function(t){this._modelviewMatrixStack.push(t);var e=this.getLookVectorLocal();this._bbCornerFar=(e[0]>=0?1:0)|(e[1]>=0?2:0)|(e[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar},popModelviewMatrix:function(){this._modelviewMatrixStack.pop();var t;t=0!==this._modelviewMatrixStack.length?this.getLookVectorLocal():[0,0,-1],this._bbCornerFar=(t[0]>=0?1:0)|(t[1]>=0?2:0)|(t[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar},pushProjectionMatrix:function(t){this._projectionMatrixStack.push(t)},popProjectionMatrix:function(){this._projectionMatrixStack.pop()}},t}),n("osg/MatrixTransform",["osg/Utils","osg/Matrix","osg/Transform","osg/TransformEnums"],function(t,e,r,i){var n=function(){r.call(this),this.matrix=e.makeIdentity([])};return n.prototype=t.objectLibraryClass(t.objectInehrit(r.prototype,{getMatrix:function(){return this.matrix},setMatrix:function(t){this.matrix=t},computeLocalToWorldMatrix:function(t){return this.referenceFrame===i.RELATIVE_RF?e.preMult(t,this.matrix):t=this.matrix,!0},computeWorldToLocalMatrix:function(t){var r=[];return e.inverse(this.matrix,r),this.referenceFrame===i.RELATIVE_RF?e.postMult(r,t):t=inverse,!0}}),"osg","MatrixTransform"),n.prototype.objectType=t.objectType.generate("MatrixTransform"),n}),n("osg/Projection",["osg/Utils","osg/Node","osg/Matrix"],function(t,e,r){var i=function(){e.call(this),this.projection=r.makeIdentity([])};return i.prototype=t.objectInehrit(e.prototype,{getProjectionMatrix:function(){return this.projection},setProjectionMatrix:function(t){this.projection=t}}),i.prototype.objectType=t.objectType.generate("Projection"),i}),n("osg/LightSource",["osg/Utils","osg/Node"],function(t,e){var r=function(){e.call(this),this._light=void 0};return r.prototype=t.objectLibraryClass(t.objectInehrit(e.prototype,{getLight:function(){return this._light},setLight:function(t){this._light=t}}),"osg","LightSource"),r.prototype.objectType=t.objectType.generate("LightSource"),r}),n("osg/Geometry",["osg/Utils","osg/Node","osg/BoundingBox"],function(t,e,r){var i=function(){e.call(this),this.primitives=[],this.attributes={},this.boundingBox=new r,this.boundingBoxComputed=!1,this.cacheAttributeList={}};return i.prototype=t.objectLibraryClass(t.objectInehrit(e.prototype,{releaseGLObjects:function(t){var e;for(e in this.attributes)this.attributes[e].releaseGLObjects(t);for(var r=0,i=this.primitives.length;i>r;r++){var n=this.primitives[r];void 0!==n.getIndices&&void 0!==n.getIndices()&&null!==n.getIndices()&&n.indices.releaseGLObjects(t)}},dirtyBound:function(){this.boundingBoxComputed===!0&&(this.boundingBoxComputed=!1),e.prototype.dirtyBound.call(this)},dirty:function(){this.cacheAttributeList={}},getPrimitives:function(){return this.primitives},getAttributes:function(){return this.attributes},getVertexAttributeList:function(){return this.attributes},getPrimitiveSetList:function(){return this.primitives},drawImplementation:function(t){var e=t.getLastProgramApplied(),r=e.getInstanceID();if(void 0===this.cacheAttributeList[r]){var i,n=e.attributesCache,a=[],o="//generated by Geometry::implementation\n";o+="state.lazyDisablingOfVertexAttributes();\n",o+="var attr;\n";for(var s=0,u=n.attributeKeys.length;u>s;s++){var h=n.attributeKeys[s];i=n[h];var l=this.attributes[h];void 0!==l&&(a.push(i),o+="attr = this.attributes['"+h+"'];\n",o+="if (!attr.isValid()) { return; }\n",o+="state.setVertexAttribArray("+i+", attr, false);\n")}o+="state.applyDisablingOfVertexAttributes();\n";var c=this.primitives;o+="var primitives = this.primitives;\n";for(var d=0,f=c.length;f>d;++d)o+="primitives["+d+"].draw(state);\n";this.cacheAttributeList[r]=new Function("state",o)}this.cacheAttributeList[r].call(this,t)},drawImplementationDummy:function(t){var e=t.getLastProgramApplied();e.attributesCache;for(var r=this.primitives,i=0,n=r.length;n>i;++i);},getBoundingBox:function(){return this.boundingBoxComputed||(this.computeBoundingBox(this.boundingBox),this.boundingBoxComputed=!0),this.boundingBox},computeBoundingBox:function(t){var e=this.getAttributes().Vertex;if(void 0!==e&&void 0!==e.getElements()&&e.getItemSize()>2){var r=[0,0,0];vertexes=e.getElements();for(var i=0,n=vertexes.length;n>i;i+=3)r[0]=vertexes[i],r[1]=vertexes[i+1],r[2]=vertexes[i+2],t.expandByVec3(r)}return t},computeBound:function(t){t.init();var e=this.getBoundingBox();return t.expandByBox(e),t}}),"osg","Geometry"),i.prototype.objectType=t.objectType.generate("Geometry"),i}),n("osg/RenderBin",["osg/Notify","osg/StateGraph","osg/Matrix"],function(t,e,r){var i=function(){this._leafs=[],this.positionedAttribute=[],this._renderStage=void 0,this._bins={},this.stateGraphList=[],this._parent=void 0,this._binNum=0,this._sorted=!1,this._sortMode=i.SORT_BY_STATE};return i.SORT_BY_STATE=0,i.SORT_BACK_TO_FRONT=1,i.BinPrototypes={RenderBin:function(){return new i},DepthSortedBin:function(){var t=new i;return t._sortMode=i.SORT_BACK_TO_FRONT,t}},i.prototype={_createRenderBin:function(t){return void 0===t||void 0===i.BinPrototypes[t]?i.BinPrototypes.RenderBin():i.BinPrototypes[t]()},getStateGraphList:function(){return this.stateGraphList},copyLeavesFromStateGraphListToRenderLeafList:function(){this._leafs.splice(0,this._leafs.length);for(var e=!1,r=0,i=this.stateGraphList.length;i>r;r++)for(var n=this.stateGraphList[r].leafs,a=0,o=n.length;o>a;a++){var s=n[a];isNaN(s.depth)?e=!0:this._leafs.push(s)}e&&t.debug("warning: RenderBin::copyLeavesFromStateGraphListToRenderLeafList() detected NaN depth values, database may be corrupted."),this.stateGraphList.splice(0,this.stateGraphList.length)},sortBackToFront:function(){this.copyLeavesFromStateGraphListToRenderLeafList();var t=function(t,e){return e.depth-t.depth};this._leafs.sort(t)},sortImplementation:function(){var t=i;switch(this._sortMode){case t.SORT_BACK_TO_FRONT:this.sortBackToFront();break;case t.SORT_BY_STATE:}},sort:function(){if(!this._sorted){for(var t=this._bins,e=window.Object.keys(t),r=0,i=e.length;i>r;r++)t[e[r]].sort();this.sortImplementation(),_sorted=!0}},setParent:function(t){this._parent=t},getParent:function(){return this._parent},getBinNumber:function(){return this._binNum},findOrInsert:function(t,e){var r=this._bins[t];return void 0===r&&(r=this._createRenderBin(e),r._parent=this,r._binNum=t,r._renderStage=this._renderStage,this._bins[t]=r),r},getStage:function(){return this._renderStage},addStateGraph:function(t){this.stateGraphList.push(t)},reset:function(){this.stateGraphList.length=0,this._bins={},this.positionedAttribute.length=0,this._leafs.length=0,this._sorted=!1},applyPositionedAttribute:function(t,e){for(var r=0,i=e.length;i>r;r++){var n=e[r],a=n[1],o=n[0];t.setGlobalDefaultValue(a),a.apply(t),a.applyPositionedUniform(o,t),t.haveAppliedAttribute(a)}},drawImplementation:function(t,e){for(var r=e,i=window.Object.keys(this._bins),n=this._bins,a=[],o=0,s=i.length;s>o;o++){var u=i[o];a.push(n[u])}var h=function(t,e){return t._binNum-e._binNum};a.sort(h);for(var l,c=0,d=a.length;d>c&&(l=a[c],!(l.getBinNumber()>0));c++)r=l.drawImplementation(t,r);for(r=this.drawLeafs(t,r);d>c;c++)l=a[c],r=l.drawImplementation(t,r);return r},drawLeafs:function(t,i){var n,a,o,s,u=this.stateGraphList,h=this._leafs,l=i,c=[];l&&e.prototype.moveToRootStateGraph(t,i.parent);for(var d,f,p,g,m,v=0,_=h.length;_>v;v++)d=h[v],f=!1,void 0!==l?(p=l.parent,g=p.parent,m=d.parent,g!==m.parent?(m.moveStateGraph(t,g,m.parent),t.pushStateSet(m.stateset),f=!0):m!==p&&(t.pushStateSet(m.stateset),f=!0)):(d.parent.moveStateGraph(t,void 0,d.parent.parent),t.pushStateSet(d.parent.stateset),f=!0),f===!0&&(t.apply(),s=t.getLastProgramApplied(),a=s.uniformsCache[t.modelViewMatrix.name],o=s.uniformsCache[t.projectionMatrix.name],n=s.uniformsCache[t.normalMatrix.name]),void 0!==a&&(t.modelViewMatrix.set(d.modelview),t.modelViewMatrix.apply(a)),void 0!==o&&(t.projectionMatrix.set(d.projection),t.projectionMatrix.apply(o)),void 0!==n&&(r.copy(d.modelview,c),c[12]=0,c[13]=0,c[14]=0,r.inverse(c,c),r.transpose(c,c),t.normalMatrix.set(c),t.normalMatrix.apply(n)),d.geometry.drawImplementation(t),f===!0&&(t.popGeneratedProgram(),t.popStateSet()),l=d;for(var y=0,b=u.length;b>y;y++)for(var x=u[y],S=0,M=x.leafs.length;M>S;S++)d=x.leafs[S],f=!1,void 0!==l?(p=l.parent,g=p.parent,m=d.parent,g!==m.parent?(m.moveStateGraph(t,g,m.parent),t.pushStateSet(m.stateset),f=!0):m!==p&&(t.pushStateSet(m.stateset),f=!0)):(d.parent.moveStateGraph(t,void 0,d.parent.parent),t.pushStateSet(d.parent.stateset),f=!0),f===!0&&(t.apply(),s=t.getLastProgramApplied(),a=s.uniformsCache[t.modelViewMatrix.name],o=s.uniformsCache[t.projectionMatrix.name],n=s.uniformsCache[t.normalMatrix.name]),void 0!==a&&(t.modelViewMatrix.set(d.modelview),t.modelViewMatrix.apply(a)),void 0!==o&&(t.projectionMatrix.set(d.projection),t.projectionMatrix.apply(o)),void 0!==n&&(r.copy(d.modelview,c),c[12]=0,c[13]=0,c[14]=0,r.inverse(c,c),r.transpose(c,c),t.normalMatrix.set(c),t.normalMatrix.apply(n)),d.geometry.drawImplementation(t),f===!0&&(t.popGeneratedProgram(),t.popStateSet()),l=d;return l}},i}),n("osg/FrameBufferObject",["osg/Notify","osg/Utils","osg/StateAttribute"],function(t,e,r){var i=function(){r.call(this),this.fbo=void 0,this.attachments=[],this.dirty()};return i.COLOR_ATTACHMENT0=36064,i.DEPTH_ATTACHMENT=36096,i.DEPTH_COMPONENT16=33189,i.prototype=e.objectInehrit(r.prototype,{attributeType:"FrameBufferObject",cloneType:function(){return new i},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setAttachment:function(t){this.attachments.push(t)},_reportFrameBufferError:function(e){switch(e){case 36054:t.debug("FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case 36055:t.debug("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case 36057:t.debug("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case 36061:Notifiy.debug("FRAMEBUFFER_UNSUPPORTED");break;default:t.debug("FRAMEBUFFER unknown error "+e.toString(16))}},apply:function(e){var r,i=e.getGraphicContext();if(this.attachments.length>0)if(this.isDirty()){this.fbo||(this.fbo=i.createFramebuffer()),i.bindFramebuffer(i.FRAMEBUFFER,this.fbo);for(var n=!1,a=0,o=this.attachments.length;o>a;++a)if(void 0===this.attachments[a].texture){var s=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,s),i.renderbufferStorage(i.RENDERBUFFER,this.attachments[a].format,this.attachments[a].width,this.attachments[a].height),i.framebufferRenderbuffer(i.FRAMEBUFFER,this.attachments[a].attachment,i.RENDERBUFFER,s),n=!0}else{var u=this.attachments[a].texture;e.applyTextureAttribute(0,u),i.framebufferTexture2D(i.FRAMEBUFFER,this.attachments[a].attachment,u.getTextureTarget(),u.getTextureObject(),this.attachments[a].level)}r=i.checkFramebufferStatus(i.FRAMEBUFFER),36053!==r&&this._reportFrameBufferError(r),n&&i.bindRenderbuffer(i.RENDERBUFFER,null),this.setDirty(!1)}else i.bindFramebuffer(i.FRAMEBUFFER,this.fbo),t.reportWebGLError===!0&&(r=i.checkFramebufferStatus(i.FRAMEBUFFER),36053!==r&&this._reportFrameBufferError(r));else i.bindFramebuffer(i.FRAMEBUFFER,null)}}),i}),n("osg/RenderStage",["osg/Notify","osg/Utils","osg/RenderBin","osg/Camera","osg/FrameBufferObject"],function(t,e,r,i,n){var a=function(){r.call(this),this.positionedAttribute=[],this.clearDepth=1,this.clearColor=[0,0,0,1],this.clearMask=i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT,this.camera=void 0,this.viewport=void 0,this.preRenderList=[],this.postRenderList=[],this._renderStage=this};return a.prototype=e.objectInehrit(r.prototype,{reset:function(){r.prototype.reset.call(this),this.preRenderList.length=0,this.postRenderList.length=0},setClearDepth:function(t){this.clearDepth=t},getClearDepth:function(){return this.clearDepth},setClearColor:function(t){this.clearColor=t},getClearColor:function(){return this.clearColor},setClearMask:function(t){this.clearMask=t},getClearMask:function(){return this.clearMask},setViewport:function(t){this.viewport=t},getViewport:function(){return this.viewport},setCamera:function(t){this.camera=t},addPreRenderStage:function(t,e){for(var r=0,i=this.preRenderList.length;i>r;r++){var n=this.preRenderList[r];if(e<n.order)break}r<this.preRenderList.length?this.preRenderList=this.preRenderList.splice(r,0,{order:e,renderStage:t}):this.preRenderList.push({order:e,renderStage:t})},addPostRenderStage:function(t,e){for(var r=0,i=this.postRenderList.length;i>r;r++){var n=this.postRenderList[r];if(e<n.order)break}r<this.postRenderList.length?this.postRenderList=this.postRenderList.splice(r,0,{order:e,renderStage:t}):this.postRenderList.push({order:e,renderStage:t})},drawPreRenderStages:function(t,e){for(var r=e,i=0,n=this.preRenderList.length;n>i;++i){var a=this.preRenderList[i].renderStage;r=a.draw(t,r)}return r},draw:function(t,e){var r=this.drawPreRenderStages(t,e);return r=this.drawImplementation(t,r),r=this.drawPostRenderStages(t,r)},sort:function(){for(var t=0,e=this.preRenderList.length;e>t;++t)this.preRenderList[t].renderStage.sort();for(r.prototype.sort.call(this),this.postRenderList.length;e>t;++t)this.postRenderList[t].renderStage.sort()},drawPostRenderStages:function(t,e){for(var r=e,i=0,n=this.postRenderList.length;n>i;++i){var a=this.postRenderList[i].renderStage;r=a.draw(t,r)}return r},applyCamera:function(t){var e=t.getGraphicContext();if(void 0===this.camera)return e.bindFramebuffer(e.FRAMEBUFFER,null),void 0;var r=this.camera.getViewport(),i=this.camera.frameBufferObject;if(i||(i=new n,this.camera.frameBufferObject=i),i.isDirty()&&void 0!==this.camera.attachments)for(var a in this.camera.attachments){var o,s=this.camera.attachments[a];void 0===s.texture?o={attachment:a,format:s.format,width:r.width(),height:r.height()}:void 0!==s.texture&&(o={attachment:a,texture:s.texture,level:s.level},s.format&&(o.format=s.format)),i.setAttachment(o)}i.apply(t)},drawImplementation:function(e,i){var n=e.getGraphicContext();this.applyCamera(e),void 0===this.viewport&&t.log("RenderStage does not have a valid viewport"),e.applyAttribute(this.viewport),this.clearMask&n.COLOR_BUFFER_BIT&&n.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),this.clearMask&n.DEPTH_BUFFER_BIT&&(n.depthMask(!0),n.clearDepth(this.clearDepth)),n.clear(this.clearMask),this.positionedAttribute&&this.applyPositionedAttribute(e,this.positionedAttribute);var a=r.prototype.drawImplementation.call(this,e,i);return a}}),a}),n("osg/CullVisitor",["osg/Notify","osg/Utils","osg/NodeVisitor","osg/CullSettings","osg/CullStack","osg/Matrix","osg/MatrixTransform","osg/Projection","osg/LightSource","osg/Geometry","osg/RenderStage","osg/Node","osg/Camera","osg/TransformEnums"],function(t,e,r,i,n,a,o,s,u,h,l,c,d,f){var p=function(){r.call(this),i.call(this),n.call(this),this._rootStateGraph=void 0,this._currentStateGraph=void 0,this._currentRenderBin=void 0,this._currentRenderStage=void 0,this._rootRenderStage=void 0,this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY;
var t=[0,0,-1];this._bbCornerFar=(t[0]>=0?1:0)|(t[1]>=0?2:0)|(t[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar,this._reserveMatrixStack=[[]],this._reserveMatrixStack.current=0,this._reserveLeafStack=[{}],this._reserveLeafStack.current=0,this._renderBinStack=[]};return p.prototype=e.objectInehrit(n.prototype,e.objectInehrit(i.prototype,e.objectInehrit(r.prototype,{distance:function(t,e){return-(t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+e[14])},handleCullCallbacksAndTraverse:function(t){var e=t.getCullCallback();(!e||e.cull(t,this))&&this.traverse(t)},updateCalculatedNearFar:function(t,e){var r,i,n=e.getBoundingBox();if(r=this.distance(n.corner(this._bbCornerNear),t),i=this.distance(n.corner(this._bbCornerFar),t),r>i){var a=r;r=i,i=a}return 0>i?!1:(r<this._computedNear&&(this._computedNear=r),i>this._computedFar&&(this._computedFar=i),!0)},clampProjectionMatrix:function(e,r,i,n,o){var s=1e-6;if(r-s>i)return t.log("clampProjectionMatrix not applied, invalid depth range, znear = "+r+"  zfar = "+i),!1;var u,h;if(r+s>i){var l=.5*(r+i);r=l-s,i=l+s}if(Math.abs(a.get(e,0,3))<s&&Math.abs(a.get(e,1,3))<s&&Math.abs(a.get(e,2,3))<s){var c=.02*(i-r);1>c&&(c=1),u=r-c,h=i+c,r=u,i=h,a.set(e,2,2,-2/(h-u)),a.set(e,3,2,-(h+u)/(h-u))}else{var d=1.02,f=.98;u=r*f,h=i*d;var p=i*n;p>u&&(u=p),r=u,i=h;var g=a.get(e,2,2),m=a.get(e,3,2),v=a.get(e,2,3),_=a.get(e,3,3),y=(-u*g+m)/(-u*v+_),b=(-h*g+m)/(-h*v+_),x=Math.abs(2/(y-b)),S=-(y+b)/2,M=[1,0,0,0,0,1,0,0,0,0,x,0,0,0,S*x,1];a.postMult(M,e)}return void 0!==o&&(o[0]=r,o[1]=i),!0},setStateGraph:function(t){this._rootStateGraph=t,this._currentStateGraph=t},setRenderStage:function(t){this._rootRenderStage=t,this._currentRenderBin=t},reset:function(){this._modelviewMatrixStack.splice(0,this._modelviewMatrixStack.length),this._projectionMatrixStack.splice(0,this._projectionMatrixStack.length),this._reserveMatrixStack.current=0,this._reserveLeafStack.current=0,this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY},getCurrentRenderBin:function(){return this._currentRenderBin},setCurrentRenderBin:function(t){this._currentRenderBin=t},addPositionedAttribute:function(t){var e=this._modelviewMatrixStack[this._modelviewMatrixStack.length-1];this._currentRenderBin.getStage().positionedAttribute.push([e,t])},pushStateSet:function(t){if(this._currentStateGraph=this._currentStateGraph.findOrInsert(t),void 0!==t.getBinName()){var e=this._renderBinStack,r=this._currentRenderBin;e.push(r),this._currentRenderBin=r.getStage().findOrInsert(t.getBinNumber(),t.getBinName())}},popStateSet:function(){var t=this._currentStateGraph,e=t.getStateSet();if(this._currentStateGraph=t.parent,void 0!==e.getBinName()){var r=this._renderBinStack;this._currentRenderBin=0===r.length?this._currentRenderBin.getStage():r.pop()}},popProjectionMatrix:function(){if(this._computeNearFar===!0&&this._computedFar>=this._computedNear){var t=this._projectionMatrixStack[this._projectionMatrixStack.length-1];this.clampProjectionMatrix(t,this._computedNear,this._computedFar,this._nearFarRatio)}n.prototype.popProjectionMatrix.call(this)},apply:function(t){this[t.objectType].call(this,t)},_getReservedMatrix:function(){var t=this._reserveMatrixStack[this._reserveMatrixStack.current++];return this._reserveMatrixStack.current===this._reserveMatrixStack.length&&this._reserveMatrixStack.push(a.makeIdentity([])),t},_getReservedLeaf:function(){var t=this._reserveLeafStack[this._reserveLeafStack.current++];return this._reserveLeafStack.current===this._reserveLeafStack.length&&this._reserveLeafStack.push({}),t}}))),p.prototype[d.prototype.objectType]=function(t){var e=t.getStateSet();e&&this.pushStateSet(e),t.light&&this.addPositionedAttribute(t.light),this._modelviewMatrixStack[this._modelviewMatrixStack.length-1];var r=this._getReservedMatrix(),n=this._getReservedMatrix();if(t.getReferenceFrame()===f.RELATIVE_RF){var o=this._projectionMatrixStack[this._projectionMatrixStack.length-1];a.mult(o,t.getProjectionMatrix(),n);var s=this._modelviewMatrixStack[this._modelviewMatrixStack.length-1];a.mult(s,t.getViewMatrix(),r)}else a.copy(t.getViewMatrix(),r),a.copy(t.getProjectionMatrix(),n);this.pushProjectionMatrix(n),this.pushModelviewMatrix(r),t.getViewport()&&this.pushViewport(t.getViewport());var u=this._computedNear,h=this._computedFar,c=new i;if(c.setCullSettings(this),this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY,this.setCullSettings(t),t.getRenderOrder()===d.NESTED_RENDER)this.handleCullCallbacksAndTraverse(t);else{var p=this.getCurrentRenderBin().getStage(),g=new l;g.setCamera(t),g.setClearDepth(t.getClearDepth()),g.setClearColor(t.getClearColor()),g.setClearMask(t.getClearMask());var m;m=void 0===t.getViewport()?p.getViewport():t.getViewport(),g.setViewport(m);var v=this.getCurrentRenderBin();this.setCurrentRenderBin(g),this.handleCullCallbacksAndTraverse(t),this.setCurrentRenderBin(v),t.getRenderOrder()===d.PRE_RENDER?this.getCurrentRenderBin().getStage().addPreRenderStage(g,t.renderOrderNum):this.getCurrentRenderBin().getStage().addPostRenderStage(g,t.renderOrderNum)}this.popModelviewMatrix(),this.popProjectionMatrix(),t.getViewport()&&this.popViewport(),this.setCullSettings(c),this._computedNear=u,this._computedFar=h,e&&this.popStateSet()},p.prototype[o.prototype.objectType]=function(t){var e=this._getReservedMatrix();if(t.getReferenceFrame()===f.RELATIVE_RF){var r=this._modelviewMatrixStack[this._modelviewMatrixStack.length-1];a.mult(r,t.getMatrix(),e)}else a.copy(t.getMatrix(),e);this.pushModelviewMatrix(e);var i=t.getStateSet();i&&this.pushStateSet(i),t.light&&this.addPositionedAttribute(t.light),this.handleCullCallbacksAndTraverse(t),i&&this.popStateSet(),this.popModelviewMatrix()},p.prototype[s.prototype.objectType]=function(t){lastMatrixStack=this._projectionMatrixStack[this._projectionMatrixStack.length-1];var e=this._getReservedMatrix();a.mult(lastMatrixStack,t.getProjectionMatrix(),e),this.pushProjectionMatrix(e);var r=t.getStateSet();r&&this.pushStateSet(r),this.handleCullCallbacksAndTraverse(t),r&&this.popStateSet(),this.popProjectionMatrix()},p.prototype[c.prototype.objectType]=function(t){var e=t.getStateSet();e&&this.pushStateSet(e),t.light&&this.addPositionedAttribute(t.light),this.handleCullCallbacksAndTraverse(t),e&&this.popStateSet()},p.prototype[u.prototype.objectType]=function(t){var e=t.getStateSet();e&&this.pushStateSet(e);var r=t.getLight();r&&this.addPositionedAttribute(r),this.handleCullCallbacksAndTraverse(t),e&&this.popStateSet()},p.prototype[h.prototype.objectType]=function(e){var r=this._modelviewMatrixStack[this._modelviewMatrixStack.length-1],i=e.getBoundingBox();if(!this._computeNearFar||!i.valid()||this.updateCalculatedNearFar(r,e)){var n=e.getStateSet();n&&this.pushStateSet(n),this.handleCullCallbacksAndTraverse(e);var a=this._currentStateGraph.leafs;0===a.length&&this._currentRenderBin.addStateGraph(this._currentStateGraph);var o=this._getReservedLeaf(),s=0;i.valid()&&(s=this.distance(i.center(),r)),isNaN(s)?t.warn("warning geometry has a NaN depth, "+r+" center "+i.center()):(o.parent=this._currentStateGraph,o.projection=this._projectionMatrixStack[this._projectionMatrixStack.length-1],o.geometry=e,o.modelview=r,o.depth=s,a.push(o)),n&&this.popStateSet()}},p}),n("osg/Depth",["osg/Utils","osg/StateAttribute"],function(t,e){var r=function(t,i,n,a){e.call(this),this._func=r.LESS,this._near=0,this._far=1,this._writeMask=!0,void 0!==t&&(this._func="string"==typeof t?r[t]:t),void 0!==i&&(this._near=i),void 0!==n&&(this._far=n),void 0!==a&&(this._writeMask=a)};return r.DISABLE=0,r.NEVER=512,r.LESS=513,r.EQUAL=514,r.LEQUAL=515,r.GREATE=516,r.NOTEQU=517,r.GEQUAL=518,r.ALWAYS=519,r.prototype=t.objectLibraryClass(t.objectInehrit(e.prototype,{attributeType:"Depth",cloneType:function(){return new r},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setRange:function(t,e){this._near=t,this._far=e},setWriteMask:function(t){this._writeMask=t},apply:function(t){var e=t.getGraphicContext();0===this._func?e.disable(e.DEPTH_TEST):(e.enable(e.DEPTH_TEST),e.depthFunc(this._func),e.depthMask(this._writeMask),e.depthRange(this._near,this._far))}}),"osg","Depth"),r}),n("osg/DrawArrayLengths",[],function(){var t=function(t,e,r){this._mode=t,this._first=e,this._arrayLengths=r.slice(0)};return t.prototype={draw:function(t){for(var e=t.getGraphicContext(),r=this._mode,i=this._first,n=this._arrayLengths,a=0,o=n.length;o>a;a++){var s=n[a];e.drawArrays(r,i,s),i+=s}},getMode:function(){return this._mode},getNumIndices:function(){for(var t=0,e=this._arrayLengths,r=0,i=e.length;i>r;r++)t+=e[r];return t},getArrayLengths:function(){return this._arrayLengths},getFirst:function(){return this._first},setFirst:function(t){this._first=t}},t}),n("osg/DrawArrays",["osg/Notify"],function(t){var e=function(t,e,r){this.mode=t,this.first=e,this.count=r};return e.prototype={draw:function(t){var e=t.getGraphicContext();e.drawArrays(this.mode,this.first,this.count)},getMode:function(){return this.mode},getCount:function(){return this.count},getFirst:function(){return this.first}},e.create=function(r,i,n){t.log("DrawArrays.create is deprecated, use new DrawArrays with same arguments");var a=new e(r,i,n);return a},e}),n("osg/PrimitiveSet",[],function(){var t={};return t.POINTS=0,t.LINES=1,t.LINE_LOOP=2,t.LINE_STRIP=3,t.TRIANGLES=4,t.TRIANGLE_STRIP=5,t.TRIANGLE_FAN=6,t}),n("osg/DrawElements",["osg/Notify","osg/PrimitiveSet"],function(t,e){var r=function(t,r){this.mode=e.POINTS,void 0!==t&&(this.mode=t),this.count=0,this.offset=0,this.indices=r,void 0!==r&&this.setIndices(r)};return r.prototype={getMode:function(){return this.mode},draw:function(t){t.setIndexArray(this.indices);var e=t.getGraphicContext();e.drawElements(this.mode,this.count,e.UNSIGNED_SHORT,this.offset)},setIndices:function(t){this.indices=t,this.count=t.getElements().length},getIndices:function(){return this.indices},setFirst:function(t){this.offset=t},getFirst:function(){return this.offset},setCount:function(t){this.count=t},getCount:function(){return this.count}},r.create=function(e,i){return t.log("DrawElements.create is deprecated, use new DrawElements with same arguments"),new r(e,i)},r}),n("osg/EllipsoidModel",["osg/Notify","osg/Matrix","osg/Vec3"],function(t,e,r){var i=function(){this._radiusEquator=i.WGS_84_RADIUS_EQUATOR,this._radiusPolar=i.WGS_84_RADIUS_POLAR,this.computeCoefficients()};return i.WGS_84_RADIUS_EQUATOR=6378137,i.WGS_84_RADIUS_POLAR=6356752.3142,i.prototype={setRadiusEquator:function(t){this._radiusEquator=t,this.computeCoefficients()},getRadiusEquator:function(){return this._radiusEquator},setRadiusPolar:function(t){this._radiusPolar=t,this.computeCoefficients()},getRadiusPolar:function(){return this._radiusPolar},convertLatLongHeightToXYZ:function(e,r,i,n){void 0===n&&(t.warn("deprecated, use this signature convertLatLongHeightToXYZ( latitude, longitude, height, result )"),n=[]);var a=Math.sin(e),o=Math.cos(e),s=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*a*a),u=(s+i)*o*Math.cos(r),h=(s+i)*o*Math.sin(r),l=(s*(1-this._eccentricitySquared)+i)*a;return n[0]=u,n[1]=h,n[2]=l,n},convertXYZToLatLongHeight:function(e,r,i,n){void 0===n&&(t.warn("deprecated, use this signature convertXYZToLatLongHeight( X,  Y,  Z , result)"),n=[]);var a=Math.sqrt(e*e+r*r),o=Math.atan2(i*this._radiusEquator,a*this._radiusPolar),s=(this._radiusEquator*this._radiusEquator-this._radiusPolar*this._radiusPolar)/(this._radiusPolar*this._radiusPolar),u=Math.sin(o),h=Math.cos(o);latitude=Math.atan((i+s*this._radiusPolar*u*u*u)/(a-this._eccentricitySquared*this._radiusEquator*h*h*h)),longitude=Math.atan2(r,e);var l=Math.sin(latitude),c=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*l*l);return height=a/Math.cos(latitude)-c,n[0]=latitude,n[1]=longitude,n[2]=height,n},computeLocalUpVector:function(t,e,r){var i,n,a,o=this.convertXYZToLatLongHeight(t,e,r,i,n,a);return i=o[0],n=o[1],a=o[2],[Math.cos(n)*Math.cos(i),Math.sin(n)*Math.cos(i),Math.sin(i)]},isWGS84:function(){return this._radiusEquator==i.WGS_84_RADIUS_EQUATOR&&this._radiusPolar==i.WGS_84_RADIUS_POLAR},computeCoefficients:function(){var t=(this._radiusEquator-this._radiusPolar)/this._radiusEquator;this._eccentricitySquared=2*t-t*t},computeLocalToWorldTransformFromLatLongHeight:function(r,i,n,a){void 0===a&&(t.warn("deprecated, use this signature computeLocalToWorldTransformFromLatLongHeight(latitude, longitude, height, result)"),a=new Array(16));var o=this.convertLatLongHeightToXYZ(r,i,n,a);return e.makeTranslate(o[0],o[1],o[2],a),this.computeCoordinateFrame(r,i,a),a},computeLocalToWorldTransformFromXYZ:function(t,r,i){var n=this.convertXYZToLatLongHeight(t,r,i),a=e.makeTranslate(t,r,i);return this.computeCoordinateFrame(n[0],n[1],a),a},computeCoordinateFrame:function(t,i,n){var a=[Math.cos(i)*Math.cos(t),Math.sin(i)*Math.cos(t),Math.sin(t)],o=[-Math.sin(i),Math.cos(i),0],s=r.cross(a,o,[]);e.set(n,0,0,o[0]),e.set(n,0,1,o[1]),e.set(n,0,2,o[2]),e.set(n,1,0,s[0]),e.set(n,1,1,s[1]),e.set(n,1,2,s[2]),e.set(n,2,0,a[0]),e.set(n,2,1,a[1]),e.set(n,2,2,a[2])}},i}),n("osg/FrameStamp",[],function(){var t=function(){var t=0,e=0,r=0;this.setReferenceTime=function(t){e=t},this.setSimulationTime=function(t){r=t},this.getReferenceTime=function(){return e},this.getSimulationTime=function(){return r},this.setFrameNumber=function(e){t=e},this.getFrameNumber=function(){return t}};return t}),n("osg/Image",["osg/Utils","osg/Object"],function(t,e){var r=function(t){e.call(this),this._imageObject=void 0,this._url=void 0,this._width=void 0,this._height=void 0,t&&this.setImage(t),this._isGreyscale=void 0};return r.prototype=t.objectLibraryClass(t.objectInherit(e.prototype,{dirty:function(){this._isGreyscale=void 0},getImage:function(){return this._imageObject},getURL:function(){return this._url},setURL:function(t){this._url=t},setImage:function(t){!this._url&&t&&t.src&&(this._url=t.src),this._imageObject=t,this.dirty()},isCanvas:function(){return this._imageObject instanceof HTMLCanvasElement},isImage:function(){return this._imageObject instanceof window.Image},isTypedArray:function(){return this._imageObject instanceof Uint8Array},setWidth:function(t){this._width=t},setHeight:function(t){this._height=t},getWidth:function(){return this.isImage()?this._imageObject.naturalWidth:this.isCanvas()?this._imageObject.width:this._width},getHeight:function(){return this.isImage()?this._imageObject.naturalHeight:this.isCanvas()?this._imageObject.height:this._height},isGreyscale:function(){if(void 0!==this._isGreyscale)return this._isGreyscale;if(void 0!==this._imageObject&&this.isReady()&&void 0===this._isGreyscale){var t=this._imageObject;this.isCanvas()||(t=document.createElement("canvas"));var e=t.getContext("2d");t.width=img.width,t.height=img.height,e.drawImage(img,0,0);var r=e.getImageData(0,0,1,1).data,i=r[0]==r[1]&&r[1]==r[2];this._isGreyscale=i}return this._isGreyscale},isReady:function(){if(this.isCanvas()||this.isTypedArray())return!0;if(this.isImage()){var t=this._imageObject;if(t.complete)return void 0!==t.naturalWidth&&0===t.naturalWidth?!1:!0}return!1}}),"osg","Image"),r.prototype.objectType=t.objectType.generate("Image"),r}),n("osg/Uniform",["osg/Utils"],function(t){var e=function(){this.transpose=!1,this._dirty=!0,this.name="",this.type=void 0};return e.isUniform=function(t){return t.prototype===e.prototype?!0:!1},e.prototype={getName:function(){return this.name},getType:function(){return this.type},get:function(){return this.data},set:function(t){this.data=t,this.dirty()},dirty:function(){this._dirty=!0},apply:function(t){this._dirty&&(this.update.call(this.glData,this.data),this._dirty=!1),this.glCall(t,this.glData)},applyMatrix:function(t){this._dirty&&(this.update.call(this.glData,this.data),this._dirty=!1),this.glCall(t,this.transpose,this.glData)},update:function(t){for(var e=0,r=t.length;r>e;++e)this[e]=t[e]},_updateArray:function(t){for(var e=0,r=t.length;r>e;++e)this[e]=t[e]},_updateFloat1:function(t){this[0]=t[0]},_updateFloat2:function(t){this[0]=t[0],this[1]=t[1]},_updateFloat3:function(t){this[0]=t[0],this[1]=t[1],this[2]=t[2]},_updateFloat4:function(t){this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3]},_updateFloat9:function(t){this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8]},_updateFloat16:function(t){this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15]}},e.createFloat1=function(r,i){var n=r,a=i;void 0===a&&(a=n,n=[0]);var o=new e;return o.data=[n],o.glCall=function(t,e){gl.uniform1fv(t,e)},o.glData=new t.Float32Array(o.data),o.update=e.prototype._updateFloat1,o.set=function(t){"number"==typeof t?this.data[0]=t:this.data=t,this.dirty()},o.name=a,o.type="float",o},e.createFloat=e.createFloat1,e["float"]=e.createFloat1,e.createFloatArray=function(t,r){var i=e.createFloat.call(this,t,r);return i.update=e.prototype._updateArray,i},e.createFloat2=function(r,i){var n=r,a=i;void 0===a&&(a=n,n=[0,0]);var o=new e;return o.data=n,o.glCall=function(t,e){gl.uniform2fv(t,e)},o.glData=new t.Float32Array(o.data),o.update=e.prototype._updateFloat2,o.name=a,o.type="vec2",o},e.vec2=e.createFloat2,e.createFloat2Array=function(t,r){var i=e.createFloat2.call(this,t,r);return i.update=e.prototype._updateArray,i},e.createFloat3=function(r,i){var n=r,a=i;void 0===a&&(a=n,n=[0,0,0]);var o=new e;return o.data=n,o.glCall=function(t,e){gl.uniform3fv(t,e)},o.glData=new t.Float32Array(o.data),o.update=e.prototype._updateFloat3,o.name=a,o.type="vec3",o},e.vec3=e.createFloat3,e.createFloat3Array=function(t,r){var i=e.createFloat3.call(this,t,r);return i.update=e.prototype._updateArray,i},e.createFloat4=function(r,i){var n=r,a=i;void 0===a&&(a=n,n=[0,0,0,0]);var o=new e;return o.data=n,o.glCall=function(t,e){gl.uniform4fv(t,e)},o.glData=new t.Float32Array(o.data),o.update=e.prototype._updateFloat4,o.name=a,o.type="vec4",o},e.vec4=e.createFloat4,e.createFloat4Array=function(t,r){var i=e.createFloat4.call(this,t,r);return i.update=e.prototype._updateArray,i},e.createInt1=function(r,i){var n=r,a=i;void 0===a&&(a=n,n=[0]);var o=new e;return o.data=[n],o.glCall=function(t,e){gl.uniform1iv(t,e)},o.set=function(t){"number"==typeof t?this.data[0]=t:this.data=t,this.dirty()},o.glData=new t.Int32Array(o.data),o.name=a,o.type="int",o},e["int"]=e.createInt1,e.createInt=e.createInt1,e.createIntArray=function(t,r){var i=e.createInt.call(this,t,r);return i.update=e.prototype._updateArray,i},e.createInt2=function(r,i){var n=r,a=i;void 0===a&&(a=n,n=[0,0]);var o=new e;return o.data=n,o.glCall=function(t,e){gl.uniform2iv(t,e)},o.glData=new t.Int32Array(o.data),o.name=a,o.type="vec2i",o},e.vec2i=e.createInt2,e.createInt2Array=function(t,r){var i=e.createInt2.call(this,t,r);return i.update=e.prototype._updateArray,i},e.createInt3=function(r,i){var n=r,a=i;void 0===a&&(a=n,n=[0,0,0]);var o=new e;return o.data=n,o.glCall=function(t,e){gl.uniform3iv(t,e)},o.glData=new t.Int32Array(o.data),o.name=a,o.type="vec3i",o},e.vec3i=e.createInt3,e.createInt3Array=function(t,r){var i=e.createInt3.call(this,t,r);return i.update=e.prototype._updateArray,i},e.createInt4=function(r,i){var n=r,a=i;void 0===a&&(a=n,n=[0,0,0,0]);var o=new e;return o.data=n,o.glCall=function(t,e){gl.uniform4iv(t,e)},o.glData=new t.Int32Array(o.data),o.name=a,o.type="vec4i",o},e.vec4i=e.createInt4,e.createInt4Array=function(t,r){var i=e.createInt4.call(this,t,r);return i.update=e.prototype._updateArray,i},e.createMatrix2=function(r,i){var n=r,a=i;void 0===a&&(a=n,n=[1,0,0,1]);var o=new e;return o.data=n,o.glCall=function(t,e,r){gl.uniformMatrix2fv(t,e,r)},o.apply=o.applyMatrix,o.transpose=!1,o.glData=new t.Float32Array(o.data),o.update=e.prototype._updateFloat4,o.name=a,o.type="mat2",o},e.createMat2=e.createMatrix2,e.mat2=e.createMat2,e.createMatrix3=function(r,i){var n=r,a=i;void 0===a&&(a=n,n=[1,0,0,0,1,0,0,0,1]);var o=new e;return o.data=n,o.glCall=function(t,e,r){gl.uniformMatrix3fv(t,e,r)},o.apply=o.applyMatrix,o.transpose=!1,o.glData=new t.Float32Array(o.data),o.update=e.prototype._updateFloat9,o.name=a,o.type="mat3",o},e.createMat3=e.createMatrix3,e.mat3=e.createMatrix3,e.createMatrix4=function(r,i){var n=r,a=i;void 0===a&&(a=n,n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);var o=new e;return o.data=n,o.glCall=function(t,e,r){gl.uniformMatrix4fv(t,e,r)},o.apply=o.applyMatrix,o.transpose=!1,o.glData=new t.Float32Array(o.data),o.update=e.prototype._updateFloat16,o.name=a,o.type="mat4",o},e.createMat4=e.createMatrix4,e.mat4=e.createMatrix4,e}),n("osg/Program",["osg/Notify","osg/Utils","osg/StateAttribute"],function(t,e,r){var i=function(t,e){r.call(this),this.program=null,this.setVertexShader(t),this.setFragmentShader(e),this.dirty=!0};return i.prototype=e.objectLibraryClass(e.objectInehrit(r.prototype,{attributeType:"Program",cloneType:function(){var t=new i;return t.default_program=!0,t},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setVertexShader:function(t){this.vertex=t},setFragmentShader:function(t){this.fragment=t},getVertexShader:function(){return this.vertex},getFragmentShader:function(){return this.fragment},apply:function(){if(!this.program||this.isDirty()){if(this.default_program===!0)return;if(this.vertex.shader||this.vertex.compile(),this.fragment.shader||this.fragment.compile(),this.program=gl.createProgram(),gl.attachShader(this.program,this.vertex.shader),gl.attachShader(this.program,this.fragment.shader),gl.linkProgram(this.program),gl.validateProgram(this.program),!gl.getProgramParameter(this.program,gl.LINK_STATUS)&&!gl.isContextLost())return t.log("can't link program\nvertex shader:\n"+this.vertex.text+"\n fragment shader:\n"+this.fragment.text),t.log(gl.getProgramInfoLog(this.program)),this.setDirty(!1),null;this.uniformsCache={},this.uniformsCache.uniformKeys=[],this.attributesCache={},this.attributesCache.attributeKeys=[],this.cacheUniformList(this.vertex.text),this.cacheUniformList(this.fragment.text),this.cacheAttributeList(this.vertex.text),this.setDirty(!1)}gl.useProgram(this.program)},cacheUniformList:function(t){var e=t.match(/uniform\s+\w+\s+\w+/g);if(null!==e)for(var r=0,i=e.length;i>r;r++){var n=e[r].match(/uniform\s+\w+\s+(\w+)/)[1],a=gl.getUniformLocation(this.program,n);void 0!==a&&null!==a&&void 0===this.uniformsCache[n]&&(this.uniformsCache[n]=a,this.uniformsCache.uniformKeys.push(n))}},cacheAttributeList:function(t){var e=t.match(/attribute\s+\w+\s+\w+/g);if(null!==e)for(var r=0,i=e.length;i>r;r++){var n=e[r].match(/attribute\s+\w+\s+(\w+)/)[1],a=gl.getAttribLocation(this.program,n);-1!==a&&void 0!==a&&void 0===this.attributesCache[n]&&(this.attributesCache[n]=a,this.attributesCache.attributeKeys.push(n))}}}),"osg","Program"),i.create=function(t,e){console.log("Program.create is deprecated use new Program(vertex, fragment) instead");var r=new i(t,e);return r},i}),n("osg/Shader",["osg/Notify"],function(t){var e=function(t,r){var i=t;"string"==typeof t&&(i=e[t]),this.type=i,this.setText(r)};return e.VERTEX_SHADER=35633,e.FRAGMENT_SHADER=35632,e.prototype={setText:function(t){this.text=t},getText:function(){return this.text},compile:function(){if(this.shader=gl.createShader(this.type),gl.shaderSource(this.shader,this.text),gl.compileShader(this.shader),!gl.getShaderParameter(this.shader,gl.COMPILE_STATUS)&&!gl.isContextLost()){t.log("can't compile shader:\n"+this.text+"\n");for(var e="\n"+this.text,r=e.split("\n"),i="\n",n=0,a=r.length;a>n;++n)i+=n+" "+r[n]+"\n";t.log(i),t.log(gl.getShaderInfoLog(this.shader))}}},e.create=function(r,i){return t.log("Shader.create is deprecated, use new Shader with the same arguments instead"),new e(r,i)},e}),n("osg/ShaderGenerator",["osg/Notify","osg/Program","osg/Shader"],function(t,e,r){var i=function(){this.cache=[]};return i.Type={VertexInit:0,VertexFunction:1,VertexMain:2,VertexEnd:3,FragmentInit:5,FragmentFunction:6,FragmentMain:7,FragmentEnd:8},i.prototype={getActiveTypeMember:function(t){for(var e=[],r=0,i=t.attributeMap.attributeKeys.length;i>r;r++){var n=t.attributeMap.attributeKeys[r],a=t.attributeMap[n];(0!==a.length||void 0!==a.globalDefault.applyPositionedUniform)&&(void 0!==a.globalDefault.getOrCreateUniforms||void 0!==a.globalDefault.writeToShader)&&e.push(n)}for(var o=0,s=t.textureAttributeMapList.length;s>o;o++){var u=t.textureAttributeMapList[o];if(void 0!==u)for(var h=0,l=u.attributeKeys.length;l>h;h++){var c=u.attributeKeys[h],d=u[c];0!==d.length&&(void 0!==d.globalDefault.getOrCreateUniforms||void 0!==d.globalDefault.writeToShader)&&e.push(c+o)}}return e},getActiveAttributeMapKeys:function(t){for(var e=[],r=0,i=t.attributeMap.attributeKeys.length;i>r;r++){var n=t.attributeMap.attributeKeys[r],a=t.attributeMap[n];(0!==a.length||void 0!==a.globalDefault.applyPositionedUniform)&&(void 0!==a.globalDefault.getOrCreateUniforms||void 0!==a.globalDefault.writeToShader)&&e.push(n)}return e},getActiveTextureAttributeMapKeys:function(t){for(var e=[],r=0,i=t.textureAttributeMapList.length;i>r;r++){var n=t.textureAttributeMapList[r];if(void 0!==n){e[r]=[];for(var a=0,o=n.attributeKeys.length;o>a;a++){var s=n.attributeKeys[a],u=n[s];0!==u.length&&(void 0!==u.globalDefault.getOrCreateUniforms||void 0!==u.globalDefault.writeToShader)&&e[r].push(s)}}}return e},getActiveUniforms:function(t,e,r){for(var i={},n=0,a=e.length;a>n;n++){var o=e[n];if(void 0!==t.attributeMap[o].globalDefault.getOrCreateUniforms)for(var s=t.attributeMap[o].globalDefault.getOrCreateUniforms(),u=0,h=s.uniformKeys.length;h>u;u++){var l=s.uniformKeys[u],c=s[l];i[c.name]=c}}for(var d=0,f=r.length;f>d;d++){var p=r[d];if(void 0!==p)for(var g=0,m=p.length;m>g;g++){var v=p[g],_=t.textureAttributeMapList[d][v].globalDefault;if(void 0!==_.getOrCreateUniforms)for(var y=_.getOrCreateUniforms(d),b=0,x=y.uniformKeys.length;x>b;b++){var S=y.uniformKeys[b],M=y[S];i[M.name]=M}}}var A=[];for(var T in i)A.push(T);return i.uniformKeys=A,i},getOrCreateProgram:function(i){for(var n=this.getActiveTypeMember(i),a=0,o=this.cache.length;o>a;++a)if(0===this.compareAttributeMap(n,this.cache[a].flattenKeys))return this.cache[a];var s=this.getActiveAttributeMapKeys(i),u=this.getActiveTextureAttributeMapKeys(i),h=this.getOrCreateVertexShader(i,s,u),l=this.getOrCreateFragmentShader(i,s,u),c=new e(new r(gl.VERTEX_SHADER,h),new r(gl.FRAGMENT_SHADER,l));return c.flattenKeys=n,c.activeAttributeKeys=s,c.activeTextureAttributeKeys=u,c.activeUniforms=this.getActiveUniforms(i,s,u),c.generated=!0,t.log(c.vertex.text),t.log(c.fragment.text),this.cache.push(c),c},compareAttributeMap:function(t,e){for(var r,i=0,n=t.length;n>i;i++)if(r=t[i],-1===e.indexOf(r))return 1;return e.length!==t.length?-1:0},fillTextureShader:function(t,e,r){for(var i="",n={},a=0,o=e.length;o>a;a++){var s=e[a];if(void 0!==s)for(var u=t[a],h=0,l=s.length;l>h;h++){var c=s[h],d=u[c].globalDefault;void 0!==d.generateShaderCommon&&void 0===n[c]&&(i+=d.generateShaderCommon(a,r),n[c]=!0),d.generateShader&&(i+=d.generateShader(a,r))}}return i},fillShader:function(t,e,r){for(var i="",n={},a=0,o=e.length;o>a;a++){var s=e[a],u=t[s].globalDefault,h=u.getType();void 0!==u.generateShaderCommon&&void 0===n[h]&&(i+=u.generateShaderCommon(r),n[h]=!0),u.generateShader&&(i+=u.generateShader(r))}return i},getOrCreateVertexShader:function(t,e,r){var n=i.Type,a=["","#ifdef GL_ES","precision highp float;","#endif","attribute vec3 Vertex;","attribute vec4 Color;","attribute vec3 Normal;","uniform float ArrayColorEnabled;","uniform mat4 ModelViewMatrix;","uniform mat4 ProjectionMatrix;","uniform mat4 NormalMatrix;","varying vec4 VertexColor;",""].join("\n");a+=this._writeShaderFromMode(t,e,r,n.VertexInit);var o=["","vec4 ftransform() {","  return ProjectionMatrix * ModelViewMatrix * vec4(Vertex, 1.0);","}"].join("\n");a+=o,a+=this._writeShaderFromMode(t,e,r,n.VertexFunction);var s=["","void main(void) {","  gl_Position = ftransform();","  if (ArrayColorEnabled == 1.0)","    VertexColor = Color;","  else","    VertexColor = vec4(1.0,1.0,1.0,1.0);","  gl_PointSize = 1.0;",""].join("\n");return a+=s,a+=this._writeShaderFromMode(t,e,r,n.VertexMain),a+=["}",""].join("\n")},_writeShaderFromMode:function(t,e,r,i){var n="";return n+=this.fillTextureShader(t.textureAttributeMapList,r,i),n+=this.fillShader(t.attributeMap,e,i)},getOrCreateFragmentShader:function(t,e,r){var n=["","#ifdef GL_ES","precision highp float;","#endif","varying vec4 VertexColor;","uniform float ArrayColorEnabled;","vec4 fragColor;",""].join("\n"),a=i.Type;return n+=this._writeShaderFromMode(t,e,r,a.FragmentInit),n+=this._writeShaderFromMode(t,e,r,a.FragmentFunction),n+=["void main(void) {","  fragColor = VertexColor;",""].join("\n"),n+=this._writeShaderFromMode(t,e,r,a.FragmentMain),n+=this._writeShaderFromMode(t,e,r,a.FragmentEnd),n+=["","  gl_FragColor = fragColor;","}"].join("\n")}},i}),n("osg/Light",["osg/Utils","osg/StateAttribute","osg/Uniform","osg/Matrix","osg/Vec4","osg/ShaderGenerator"],function(t,e,r,i,n,a){var o=function(t){e.call(this),void 0===t&&(t=0),this._ambient=[.2,.2,.2,1],this._diffuse=[.8,.8,.8,1],this._specular=[.2,.2,.2,1],this._position=[0,0,1,0],this._direction=[0,0,-1],this._spotCutoff=180,this._spotBlend=.01,this._constantAttenuation=1,this._linearAttenuation=0,this._quadraticAttenuation=0,this._lightUnit=t,this._enabled=0,this.dirty()};return o.uniforms={},o.prototype=t.objectLibraryClass(t.objectInehrit(e.prototype,{attributeType:"Light",cloneType:function(){return new o(this._lightUnit)},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType+this._lightUnit},getOrCreateUniforms:function(){var t=o.uniforms,e=this.getTypeMember();if(void 0===t[e]){var n=r;t[e]={ambient:n.createFloat4([.2,.2,.2,1],this.getUniformName("ambient")),diffuse:n.createFloat4([.8,.8,.8,1],this.getUniformName("diffuse")),specular:n.createFloat4([.2,.2,.2,1],this.getUniformName("specular")),position:n.createFloat4([0,0,1,0],this.getUniformName("position")),direction:n.createFloat3([0,0,1],this.getUniformName("direction")),spotCutoff:n.createFloat1(180,this.getUniformName("spotCutoff")),spotBlend:n.createFloat1(.01,this.getUniformName("spotBlend")),constantAttenuation:n.createFloat1(0,this.getUniformName("constantAttenuation")),linearAttenuation:n.createFloat1(0,this.getUniformName("linearAttenuation")),quadraticAttenuation:n.createFloat1(0,this.getUniformName("quadraticAttenuation")),enable:n.createInt1(0,this.getUniformName("enable")),matrix:n.createMatrix4(i.makeIdentity([]),this.getUniformName("matrix")),invMatrix:n.createMatrix4(i.makeIdentity([]),this.getUniformName("invMatrix"))},t[e].uniformKeys=window.Object.keys(t[e])}return t[e]},setPosition:function(t){n.copy(t,this._position)},getPosition:function(){return this._position},setAmbient:function(t){this._ambient=t,this.dirty()},setSpecular:function(t){this._specular=t,this.dirty()},setDiffuse:function(t){this._diffuse=t,this.dirty()},setSpotCutoff:function(t){this._spotCutoff=t,this.dirty()},getSpotCutoff:function(){return this._spotCutoff},setSpotBlend:function(t){this._spotBlend=t,this.dirty()},getSpotBlend:function(){return this._spotBlend},setConstantAttenuation:function(t){this._constantAttenuation=t,this.dirty()},setLinearAttenuation:function(t){this._linearAttenuation=t,this.dirty()},setQuadraticAttenuation:function(t){this._quadraticAttenuation=t,this.dirty()},setDirection:function(t){this._direction=t,this.dirty()},getDirection:function(){return this._direction},setLightNumber:function(t){this._lightUnit=t,this.dirty()},getLightNumber:function(){return this._lightUnit},getPrefix:function(){return this.getType()+this._lightUnit},getParameterName:function(t){return this.getPrefix()+"_"+t},getUniformName:function(t){return this.getPrefix()+"_uniform_"+t},applyPositionedUniform:function(t){var e=this.getOrCreateUniforms();i.copy(t,e.matrix.get()),e.matrix.dirty(),i.copy(t,e.invMatrix.get()),e.invMatrix.get()[12]=0,e.invMatrix.get()[13]=0,e.invMatrix.get()[14]=0,i.inverse(e.invMatrix.get(),e.invMatrix.get()),i.transpose(e.invMatrix.get(),e.invMatrix.get()),e.invMatrix.dirty()
},apply:function(){var t=this.getOrCreateUniforms();t.ambient.set(this._ambient),t.diffuse.set(this._diffuse),t.specular.set(this._specular),t.position.set(this._position),t.direction.set(this._direction);var e=Math.cos(this._spotCutoff*Math.PI/180);t.spotCutoff.get()[0]=e,t.spotCutoff.dirty(),t.spotBlend.get()[0]=(1-e)*this._spotBlend,t.spotBlend.dirty(),t.constantAttenuation.get()[0]=this._constantAttenuation,t.constantAttenuation.dirty(),t.linearAttenuation.get()[0]=this._linearAttenuation,t.linearAttenuation.dirty(),t.quadraticAttenuation.get()[0]=this._quadraticAttenuation,t.quadraticAttenuation.dirty(),this.setDirty(!1)},_replace:function(t,e,r,i){for(var n=0,a=e.length;a>n;n++){var o=new RegExp(t+e[n],"g");r=r.replace(o,i.call(this,e[n]))}return r},_shader:{},_shaderCommon:{},generateShader:function(t){return this._shader[t]?this._shader[t].call(this):""},generateShaderCommon:function(t){return this._shaderCommon[t]?this._shaderCommon[t].call(this):""}}),"osg","Light"),o.prototype._shaderCommon[a.Type.VertexInit]=function(){return["","varying vec3 FragNormal;","varying vec3 FragEyeVector;","",""].join("\n")},o.prototype._shaderCommon[a.Type.VertexFunction]=function(){return["","vec3 computeNormal() {","   return vec3(NormalMatrix * vec4(Normal, 0.0));","}","","vec3 computeEyeVertex() {","   return vec3(ModelViewMatrix * vec4(Vertex,1.0));","}","",""].join("\n")},o.prototype._shaderCommon[a.Type.VertexMain]=function(){return["","  FragEyeVector = computeEyeVertex();","  FragNormal = computeNormal();",""].join("\n")},o.prototype._shaderCommon[a.Type.FragmentInit]=function(){return["varying vec3 FragNormal;","varying vec3 FragEyeVector;",""].join("\n")},o.prototype._shaderCommon[a.Type.FragmentFunction]=function(){return["","float getLightAttenuation(vec3 lightDir, float constant, float linear, float quadratic) {","    ","    float d = length(lightDir);","    float att = 1.0 / ( constant + linear*d + quadratic*d*d);","    return att;","}","vec4 computeLightContribution(vec4 materialAmbient,","                              vec4 materialDiffuse,","                              vec4 materialSpecular,","                              float materialShininess,","                              vec4 lightAmbient,","                              vec4 lightDiffuse,","                              vec4 lightSpecular,","                              vec3 normal,","                              vec3 eye,","                              vec3 lightDirection,","                              vec3 lightSpotDirection,","                              float lightCosSpotCutoff,","                              float lightSpotBlend,","                              float lightAttenuation)","{","    vec3 L = lightDirection;","    vec3 N = normal;","    float NdotL = max(dot(L, N), 0.0);","    float halfTerm = NdotL;","    vec4 ambient = lightAmbient;","    vec4 diffuse = vec4(0.0);","    vec4 specular = vec4(0.0);","    float spot = 0.0;","","    if (NdotL > 0.0) {","        vec3 E = eye;","        vec3 R = reflect(-L, N);","        float RdotE = max(dot(R, E), 0.0);","        if ( RdotE > 0.0) {","           RdotE = pow( RdotE, materialShininess );","        }","        vec3 D = lightSpotDirection;","        spot = 1.0;","        if (lightCosSpotCutoff > 0.0) {","          float cosCurAngle = dot(-L, D);","          if (cosCurAngle < lightCosSpotCutoff) {","             spot = 0.0;","          } else {","             if (lightSpotBlend > 0.0)","               spot = cosCurAngle * smoothstep(0.0, 1.0, (cosCurAngle-lightCosSpotCutoff)/(lightSpotBlend));","          }","        }","        diffuse = lightDiffuse * ((halfTerm));","        specular = lightSpecular * RdotE;","    }","","    return (materialAmbient*ambient + (materialDiffuse*diffuse + materialSpecular*specular) * spot) * lightAttenuation;","}","float linearrgb_to_srgb1(const in float c)","{","  float v = 0.0;","  if(c < 0.0031308) {","    if ( c > 0.0)","      v = c * 12.92;","  } else {","    v = 1.055 * pow(c, 1.0/2.4) - 0.055;","  }","  return v;","}","vec4 linearrgb_to_srgb(const in vec4 col_from)","{","  vec4 col_to;","  col_to.r = linearrgb_to_srgb1(col_from.r);","  col_to.g = linearrgb_to_srgb1(col_from.g);","  col_to.b = linearrgb_to_srgb1(col_from.b);","  col_to.a = col_from.a;","  return col_to;","}","float srgb_to_linearrgb1(const in float c)","{","  float v = 0.0;","  if(c < 0.04045) {","    if (c >= 0.0)","      v = c * (1.0/12.92);","  } else {","    v = pow((c + 0.055)*(1.0/1.055), 2.4);","  }"," return v;","}","vec4 srgb2linear(const in vec4 col_from)","{","  vec4 col_to;","  col_to.r = srgb_to_linearrgb1(col_from.r);","  col_to.g = srgb_to_linearrgb1(col_from.g);","  col_to.b = srgb_to_linearrgb1(col_from.b);","  col_to.a = col_from.a;","  return col_to;","}",""].join("\n")},o.prototype._shaderCommon[a.Type.FragmentMain]=function(){return["","  vec3 normal = normalize(FragNormal);","  vec3 eyeVector = normalize(-FragEyeVector);","  vec4 lightColor = MaterialEmission;",""].join("\n")},o.prototype._shaderCommon[a.Type.FragmentEnd]=function(){return["","  fragColor *= lightColor;",""].join("\n")},o.prototype._shader[a.Type.FragmentInit]=function(){var t=["","uniform vec4 Light_position;","uniform vec3 Light_direction;","uniform mat4 Light_matrix;","uniform mat4 Light_invMatrix;","uniform float Light_constantAttenuation;","uniform float Light_linearAttenuation;","uniform float Light_quadraticAttenuation;","uniform vec4 Light_ambient;","uniform vec4 Light_diffuse;","uniform vec4 Light_specular;","uniform float Light_spotCutoff;","uniform float Light_spotBlend;",""].join("\n");return uniforms=window.Object.keys(this.getOrCreateUniforms()),t=this._replace("Light_",uniforms,t,this.getUniformName)},o.prototype._shader[a.Type.FragmentMain]=function(){var t=["","  vec3 lightEye = vec3(Light_matrix * Light_position);","  vec3 lightDir;","  if (Light_position[3] == 1.0) {","    lightDir = lightEye - FragEyeVector;","  } else {","    lightDir = lightEye;","  }","  vec3 spotDirection = normalize(mat3(vec3(Light_invMatrix[0]), vec3(Light_invMatrix[1]), vec3(Light_invMatrix[2]))*Light_direction);","  float attenuation = getLightAttenuation(lightDir, Light_constantAttenuation, Light_linearAttenuation, Light_quadraticAttenuation);","  lightDir = normalize(lightDir);","  lightColor += computeLightContribution(MaterialAmbient,","                                         MaterialDiffuse, ","                                         MaterialSpecular,","                                         MaterialShininess,","                                         Light_ambient,","                                         Light_diffuse,","                                         Light_specular,","                                         normal,","                                         eyeVector,","                                         lightDir,","                                         spotDirection,","                                         Light_spotCutoff,","                                         Light_spotBlend,","                                         attenuation);",""].join("\n"),e=["lightEye","lightDir","spotDirection","attenuation"];return t=this._replace("",e,t,this.getParameterName),uniforms=window.Object.keys(this.getOrCreateUniforms()),t=this._replace("Light_",uniforms,t,this.getUniformName)},o}),n("osg/LineWidth",["osg/Utils","osg/StateAttribute"],function(t,e){var r=function(t){e.call(this),this.lineWidth=1,void 0!==t&&(this.lineWidth=t)};return r.prototype=t.objectLibraryClass(t.objectInehrit(e.prototype,{attributeType:"LineWidth",cloneType:function(){return new r},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},apply:function(t){t.getGraphicContext().lineWidth(this.lineWidth)}}),"osg","LineWidth"),r}),n("osg/Material",["osg/Utils","osg/StateAttribute","osg/Vec4","osg/Uniform","osg/ShaderGenerator"],function(t,e,r,i,n){var a=function(){e.call(this),this.ambient=[.2,.2,.2,1],this.diffuse=[.8,.8,.8,1],this.specular=[0,0,0,1],this.emission=[0,0,0,1],this.shininess=12.5};return a.prototype=t.objectLibraryClass(t.objectInehrit(e.prototype,{setEmission:function(t){r.copy(t,this.emission),this._dirty=!0},setAmbient:function(t){r.copy(t,this.ambient),this._dirty=!0},setSpecular:function(t){r.copy(t,this.specular),this._dirty=!0},setDiffuse:function(t){r.copy(t,this.diffuse),this._dirty=!0},setShininess:function(t){this.shininess=t,this._dirty=!0},getEmission:function(){return this.emission},getAmbient:function(){return this.ambient},getSpecular:function(){return this.specular},getDiffuse:function(){return this.diffuse},getShininess:function(){return this.shininess},attributeType:"Material",cloneType:function(){return new a},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},getOrCreateUniforms:function(){if(void 0===a.uniforms){a.uniforms={ambient:i.createFloat4([0,0,0,0],"MaterialAmbient"),diffuse:i.createFloat4([0,0,0,0],"MaterialDiffuse"),specular:i.createFloat4([0,0,0,0],"MaterialSpecular"),emission:i.createFloat4([0,0,0,0],"MaterialEmission"),shininess:i.createFloat1([0],"MaterialShininess")};var t=[];for(var e in a.uniforms)t.push(e);a.uniforms.uniformKeys=t}return a.uniforms},apply:function(){var t=this.getOrCreateUniforms();t.ambient.set(this.ambient),t.diffuse.set(this.diffuse),t.specular.set(this.specular),t.emission.set(this.emission),t.shininess.set([this.shininess]),this._dirty=!1},_shader:{},_shaderCommon:{},generateShader:function(t){return this._shader[t]?this._shader[t].call(this):""}}),"osg","Material"),a.prototype._shader[n.Type.VertexInit]=function(){var t=["uniform vec4 MaterialAmbient;","uniform vec4 MaterialDiffuse;","uniform vec4 MaterialSpecular;","uniform vec4 MaterialEmission;","uniform float MaterialShininess;",""].join("\n");return t},a.prototype._shader[n.Type.FragmentInit]=function(){var t=["uniform vec4 MaterialAmbient;","uniform vec4 MaterialDiffuse;","uniform vec4 MaterialSpecular;","uniform vec4 MaterialEmission;","uniform float MaterialShininess;",""].join("\n");return t},a}),n("osg/Math",[],function(){var t=function(t,e,r){return Math.min(r,Math.max(e,t))},e=function(e,r,i){var n=t((i-e)/(r-e),0,1);return n*n*(3-2*n)};return{clamp:t,smoothStep:e}}),n("osg/Shape",["osg/Notify","osg/StateAttribute","osg/Vec3","osg/Uniform","osg/BufferArray","osg/Geometry","osg/PrimitiveSet","osg/DrawArrays","osg/DrawElements","osg/Program","osg/Shader"],function(t,e,r,i,n,a,o,s,u,h,l){var c=function(t,e,r,i,s,h){var l,c,d,f=new a;l=i/2,c=s/2,d=h/2;var p=[],g=[],m=[];p[0]=t-l,p[1]=e-c,p[2]=r+d,m[0]=0,m[1]=-1,m[2]=0,g[0]=0,g[1]=1,p[3]=t-l,p[4]=e-c,p[5]=r-d,m[3]=0,m[4]=-1,m[5]=0,g[2]=0,g[3]=0,p[6]=t+l,p[7]=e-c,p[8]=r-d,m[6]=0,m[7]=-1,m[8]=0,g[4]=1,g[5]=0,p[9]=t+l,p[10]=e-c,p[11]=r+d,m[9]=0,m[10]=-1,m[11]=0,g[6]=1,g[7]=1,p[12]=t+l,p[13]=e+c,p[14]=r+d,m[12]=0,m[13]=1,m[14]=0,g[8]=0,g[9]=1,p[15]=t+l,p[16]=e+c,p[17]=r-d,m[15]=0,m[16]=1,m[17]=0,g[10]=0,g[11]=0,p[18]=t-l,p[19]=e+c,p[20]=r-d,m[18]=0,m[19]=1,m[20]=0,g[12]=1,g[13]=0,p[21]=t-l,p[22]=e+c,p[23]=r+d,m[21]=0,m[22]=1,m[23]=0,g[14]=1,g[15]=1,p[24]=t+l,p[25]=e-c,p[26]=r+d,m[24]=1,m[25]=0,m[26]=0,g[16]=0,g[17]=1,p[27]=t+l,p[28]=e-c,p[29]=r-d,m[27]=1,m[28]=0,m[29]=0,g[18]=0,g[19]=0,p[30]=t+l,p[31]=e+c,p[32]=r-d,m[30]=1,m[31]=0,m[32]=0,g[20]=1,g[21]=0,p[33]=t+l,p[34]=e+c,p[35]=r+d,m[33]=1,m[34]=0,m[35]=0,g[22]=1,g[23]=1,p[36]=t-l,p[37]=e+c,p[38]=r+d,m[36]=-1,m[37]=0,m[38]=0,g[24]=0,g[25]=1,p[39]=t-l,p[40]=e+c,p[41]=r-d,m[39]=-1,m[40]=0,m[41]=0,g[26]=0,g[27]=0,p[42]=t-l,p[43]=e-c,p[44]=r-d,m[42]=-1,m[43]=0,m[44]=0,g[28]=1,g[29]=0,p[45]=t-l,p[46]=e-c,p[47]=r+d,m[45]=-1,m[46]=0,m[47]=0,g[30]=1,g[31]=1,p[48]=t-l,p[49]=e+c,p[50]=r+d,m[48]=0,m[49]=0,m[50]=1,g[32]=0,g[33]=1,p[51]=t-l,p[52]=e-c,p[53]=r+d,m[51]=0,m[52]=0,m[53]=1,g[34]=0,g[35]=0,p[54]=t+l,p[55]=e-c,p[56]=r+d,m[54]=0,m[55]=0,m[56]=1,g[36]=1,g[37]=0,p[57]=t+l,p[58]=e+c,p[59]=r+d,m[57]=0,m[58]=0,m[59]=1,g[38]=1,g[39]=1,p[60]=t+l,p[61]=e+c,p[62]=r-d,m[60]=0,m[61]=0,m[62]=-1,g[40]=0,g[41]=1,p[63]=t+l,p[64]=e-c,p[65]=r-d,m[63]=0,m[64]=0,m[65]=-1,g[42]=0,g[43]=0,p[66]=t-l,p[67]=e-c,p[68]=r-d,m[66]=0,m[67]=0,m[68]=-1,g[44]=1,g[45]=0,p[69]=t-l,p[70]=e+c,p[71]=r-d,m[69]=0,m[70]=0,m[71]=-1,g[46]=1,g[47]=1;var v=[];v[0]=0,v[1]=1,v[2]=2,v[3]=0,v[4]=2,v[5]=3,v[6]=4,v[7]=5,v[8]=6,v[9]=4,v[10]=6,v[11]=7,v[12]=8,v[13]=9,v[14]=10,v[15]=8,v[16]=10,v[17]=11,v[18]=12,v[19]=13,v[20]=14,v[21]=12,v[22]=14,v[23]=15,v[24]=16,v[25]=17,v[26]=18,v[27]=16,v[28]=18,v[29]=19,v[30]=20,v[31]=21,v[32]=22,v[33]=20,v[34]=22,v[35]=23,f.getAttributes().Vertex=new n(n.ARRAY_BUFFER,p,3),f.getAttributes().Normal=new n(n.ARRAY_BUFFER,m,3),f.getAttributes().TexCoord0=new n(n.ARRAY_BUFFER,g,2);var _=new u(o.TRIANGLES,new n(n.ELEMENT_ARRAY_BUFFER,v,1));return f.getPrimitives().push(_),f},d=function(t,e,i,s,h,l,c,d,f,p,g,m,v){void 0===m&&void 0===v&&(m=p,v=g,p=0,g=0);var _=new a,y=[];y[0]=t+c,y[1]=e+d,y[2]=i+f,y[3]=t,y[4]=e,y[5]=i,y[6]=t+s,y[7]=e+h,y[8]=i+l,y[9]=t+s+c,y[10]=e+h+d,y[11]=i+l+f,void 0===m&&(m=1),void 0===v&&(v=1);var b=[];b[0]=p,b[1]=v,b[2]=p,b[3]=g,b[4]=m,b[5]=g,b[6]=m,b[7]=v;var x=r.cross([s,h,l],[c,d,f],[]),S=[];S[0]=x[0],S[1]=x[1],S[2]=x[2],S[3]=x[0],S[4]=x[1],S[5]=x[2],S[6]=x[0],S[7]=x[1],S[8]=x[2],S[9]=x[0],S[10]=x[1],S[11]=x[2];var M=[];M[0]=0,M[1]=1,M[2]=2,M[3]=0,M[4]=2,M[5]=3,_.getAttributes().Vertex=new n(n.ARRAY_BUFFER,y,3),_.getAttributes().Normal=new n(n.ARRAY_BUFFER,S,3),_.getAttributes().TexCoord0=new n(n.ARRAY_BUFFER,b,2);var A=new u(o.TRIANGLES,new n(n.ELEMENT_ARRAY_BUFFER,M,1));return _.getPrimitives().push(A),_},f=function(e,r,i,n,a,o){return t.log("createTexturedBox is deprecated use instead createTexturedBoxGeometry"),c(e,r,i,n,a,o)},p=function(e,r,i,n,a,o,s,u,h,l,c,f,p){return t.log("createTexturedQuad is deprecated use instead createTexturedQuadGeometry"),d(e,r,i,n,a,o,s,u,h,l,c,f,p)},g=function(t){void 0===t&&(t=5),void 0===g.getShader&&(g.getShader=function(){if(void 0===g.getShader.program){var t=["#ifdef GL_ES","precision highp float;","#endif","attribute vec3 Vertex;","attribute vec4 Color;","uniform mat4 ModelViewMatrix;","uniform mat4 ProjectionMatrix;","","varying vec4 FragColor;","","vec4 ftransform() {","return ProjectionMatrix * ModelViewMatrix * vec4(Vertex, 1.0);","}","","void main(void) {","gl_Position = ftransform();","FragColor = Color;","}"].join("\n"),e=["#ifdef GL_ES","precision highp float;","#endif","varying vec4 FragColor;","void main(void) {","gl_FragColor = FragColor;","}"].join("\n"),r=new h(new l(gl.VERTEX_SHADER,t),new l(gl.FRAGMENT_SHADER,e));g.getShader.program=r}return g.getShader.program});var e=new a,r=[];r.push(0,0,0),r.push(t,0,0),r.push(0,0,0),r.push(0,t,0),r.push(0,0,0),r.push(0,0,t);var i=[];i.push(1,0,0,1),i.push(1,0,0,1),i.push(0,1,0,1),i.push(0,1,0,1),i.push(0,0,1,1),i.push(0,0,1,1),e.getAttributes().Vertex=new n(n.ARRAY_BUFFER,r,3),e.getAttributes().Color=new n(n.ARRAY_BUFFER,i,4);var u=new s(o.LINES,0,6);return e.getPrimitives().push(u),e.getOrCreateStateSet().setAttributeAndMode(g.getShader()),e},m=function(t,e,i,o,s,h,l){t=t||50,o=void 0!==o?o:0,s=void 0!==s?s:2*Math.PI,h=void 0!==h?h:0,l=void 0!==l?l:Math.PI;var c,d,f=Math.max(3,Math.floor(e)||8),p=Math.max(2,Math.floor(i)||6),g=[],m=[],v=[],_=[];for(d=0;p>=d;d++){var y=[],b=[];for(c=0;f>=c;c++){var x=c/f,S=d/p,M={};M.x=-t*Math.cos(o+x*s)*Math.sin(h+S*l),M.y=t*Math.cos(h+S*l),M.z=t*Math.sin(o+x*s)*Math.sin(h+S*l),v.push(M),y.push(v.length-1),b.push({u:x,v:1-S})}g.push(y),m.push(b)}var A=[],T=[],w=[],C=0;for(d=0;p>d;d++)for(c=0;f>c;c++){var E={},F={},R={},L={},E=g[d][c+1],F=g[d][c],R=g[d+1][c],L=g[d+1][c+1],I=v[E],N=v[F],P=v[R],k=v[L];A.push(I.x),A.push(I.y),A.push(I.z),A.push(N.x),A.push(N.y),A.push(N.z),A.push(P.x),A.push(P.y),A.push(P.z),A.push(k.x),A.push(k.y),A.push(k.z),C+=4;var O=C-4;_.push(O),_.push(O+1),_.push(O+2),_.push(O),_.push(O+2),_.push(O+3);var D=r.normalize([I.x,I.y,I.z],[]),U=r.normalize([N.x,N.y,N.z],[]),V=r.normalize([P.x,P.y,P.z],[]),B=r.normalize([k.x,k.y,k.z],[]);T.push(D[0]),T.push(D[1]),T.push(D[2]),T.push(U[0]),T.push(U[1]),T.push(U[2]),T.push(V[0]),T.push(V[1]),T.push(V[2]),T.push(B[0]),T.push(B[1]),T.push(B[2]);var j=m[d][c+1],G=m[d][c],z=m[d+1][c],H=m[d+1][c+1];w.push(j.u),w.push(j.v),w.push(G.u),w.push(G.v),w.push(z.u),w.push(z.v),w.push(H.u),w.push(H.v)}var K=new a;K.getAttributes().Vertex=new n(gl.ARRAY_BUFFER,A,3),K.getAttributes().Normal=new n(gl.ARRAY_BUFFER,T,3),K.getAttributes().TexCoord0=new n(gl.ARRAY_BUFFER,w,2);var W=new u(gl.TRIANGLES,new n(gl.ELEMENT_ARRAY_BUFFER,_,1));return K.getPrimitives().push(W),K};return{createTexturedBoxGeometry:c,createTexturedQuadGeometry:d,createTexturedBox:f,createTexturedQuad:p,createAxisGeometry:g,createTexturedSphere:m}}),n("osg/Stack",[],function(){var t=function(){};return t.create=function(){var t=[];return t.globalDefault=void 0,t.lastApplied=void 0,t.back=function(){return this[this.length-1]},t},t}),n("osg/State",["osg/StateAttribute","osg/Stack","osg/Uniform","osg/Matrix","osg/ShaderGenerator"],function(t,e,r,i,n){var a=function(){this._graphicContext=void 0,this.currentVBO=null,this.vertexAttribList=[],this.programs=e.create(),this.stateSets=e.create(),this.uniforms={},this.uniforms.uniformKeys=[],this.textureAttributeMapList=[],this.attributeMap={},this.attributeMap.attributeKeys=[],this.modeMap={},this.shaderGenerator=new n,this.modelViewMatrix=r.createMatrix4(i.makeIdentity([]),"ModelViewMatrix"),this.projectionMatrix=r.createMatrix4(i.makeIdentity([]),"ProjectionMatrix"),this.normalMatrix=r.createMatrix4(i.makeIdentity([]),"NormalMatrix"),this.uniforms.ArrayColorEnabled=e.create(),this.uniforms.ArrayColorEnabled.globalDefault=r.createFloat1(0,"ArrayColorEnabled"),this.uniforms.ArrayColorEnabled.uniformKeys=[],this.uniforms.ArrayColorEnabled.uniformKeys.push("ArrayColorEnabled"),this.vertexAttribMap={},this.vertexAttribMap._disable=[],this.vertexAttribMap._keys=[]};return a.prototype={setGraphicContext:function(t){this._graphicContext=t},getGraphicContext:function(){return this._graphicContext},pushStateSet:function(t){if(this.stateSets.push(t),t.attributeMap&&this.pushAttributeMap(this.attributeMap,t.attributeMap),t.textureAttributeMapList)for(var e=t.textureAttributeMapList,r=0,i=e.length;i>r;r++)void 0!==e[r]&&(this.textureAttributeMapList[r]||(this.textureAttributeMapList[r]={},this.textureAttributeMapList[r].attributeKeys=[]),this.pushAttributeMap(this.textureAttributeMapList[r],e[r]));t.uniforms&&this.pushUniformsList(this.uniforms,t.uniforms)},applyStateSet:function(t){this.pushStateSet(t),this.apply(),this.popStateSet()},popAllStateSets:function(){for(;this.stateSets.length;)this.popStateSet()},popStateSet:function(){var t=this.stateSets.pop();if(t.program&&this.programs.pop(),t.attributeMap&&this.popAttributeMap(this.attributeMap,t.attributeMap),t.textureAttributeMapList)for(var e=t.textureAttributeMapList,r=0,i=e.length;i>r;r++)void 0!==e[r]&&this.popAttributeMap(this.textureAttributeMapList[r],e[r]);t.uniforms&&this.popUniformsList(this.uniforms,t.uniforms)},haveAppliedAttribute:function(t){var e=t.getTypeMember(),r=this.attributeMap[e];r.lastApplied=t,r.asChanged=!0},applyAttribute:function(t){var r=t.getTypeMember(),i=this.attributeMap[r];void 0===i&&(i=e.create(),this.attributeMap[r]=i,this.attributeMap[r].globalDefault=t.cloneType(),this.attributeMap.attributeKeys.push(r)),i.lastApplied!==t&&(t.apply&&t.apply(this),i.lastApplied=t,i.asChanged=!0)},applyTextureAttribute:function(t,r){var i=this.getGraphicContext();i.activeTexture(i.TEXTURE0+t);var n=r.getTypeMember();this.textureAttributeMapList[t]||(this.textureAttributeMapList[t]={},this.textureAttributeMapList[t].attributeKeys=[]);var a=this.textureAttributeMapList[t][n];void 0===a&&(a=e.create(),this.textureAttributeMapList[t][n]=a,a.globalDefault=r.cloneType(),this.textureAttributeMapList[t].attributeKeys.push(n)),a.lastApplied!==r&&(r.apply&&r.apply(this),a.lastApplied=r,a.asChanged=!0)},getLastProgramApplied:function(){return this.programs.lastApplied},pushGeneratedProgram:function(){var e;if(void 0!==this.attributeMap.Program&&0!==this.attributeMap.Program.length&&(e=this.attributeMap.Program.back().object,value=this.attributeMap.Program.back().value,void 0!==e&&value!==t.OFF))return this.programs.push(this.getObjectPair(e,value)),e;var r={textureAttributeMapList:this.textureAttributeMapList,attributeMap:this.attributeMap},i=this.stateSets.back().getShaderGenerator();return void 0===i&&(i=this.shaderGenerator),e=i.getOrCreateProgram(r),this.programs.push(this.getObjectPair(e,t.ON)),e},popGeneratedProgram:function(){this.programs.pop()},applyWithoutProgram:function(){this.applyAttributeMap(this.attributeMap),this.applyTextureAttributeMapList(this.textureAttributeMapList)},apply:function(){var t=this._graphicContext;this.applyAttributeMap(this.attributeMap),this.applyTextureAttributeMapList(this.textureAttributeMapList),this.pushGeneratedProgram();var e=this.programs.back().object;this.programs.lastApplied!==e&&(e.apply(this),this.programs.lastApplied=e);var r,i,n,a,o,s=this;if(e.generated===!0){r=e.uniformsCache,i=e.activeUniforms;o=this.uniforms,function(){var t=e.uniformsCache,r=e.activeUniforms,i=e.foreignUniforms;i||(!function(){i=[];for(var n=0,a=t.uniformKeys.length;a>n;n++){var o=t.uniformKeys[n],u=t[o];void 0!==u&&void 0===r[o]&&o!==s.modelViewMatrix.name&&o!==s.projectionMatrix.name&&o!==s.normalMatrix.name&&"ArrayColorEnabled"!==o&&i.push(o)}e.foreignUniforms=i}(),function(){for(var e=0,i=r.uniformKeys.length;i>e;e++){var n=r.uniformKeys[e],a=t[n];(void 0===a||null===a)&&delete r[n]}for(var o=window.Object.keys(r),s=0,u=o.length;u>s;s++)if("uniformKeys"===o[s]){o.splice(s,1);break}r.uniformKeys=o}()),function(){for(var e=0,i=r.uniformKeys.length;i>e;e++){var n=r.uniformKeys[e],a=t[n];r[n].apply(a)}}(),function(){for(var e=0,r=i.length;r>e;e++){var n,a=i[e],s=o[a],u=t[a];void 0!==s&&(n=0===s.length?s.globalDefault:s.back().object,n.apply(u))}}()}()}else{var u,h,c,d=e.program;r=e.uniformsCache,o=this.uniforms,i=[];var f,p,g,m=e.trackAttributes,v=e.trackUniforms;if(void 0!==m&&void 0===v){var _=e.trackAttributes.attributeKeys;if(void 0!==_)for(n=0,l=_.length;l>n;n++)if(a=_[n],attributeStack=this.attributeMap[a],void 0!==attributeStack&&(f=attributeStack.globalDefault,void 0!==f.getOrCreateUniforms))for(p=f.getOrCreateUniforms(),g=0,b=p.uniformKeys.length;b>g;g++)i.push(p[p.uniformKeys[g]]);var y=e.trackAttributes.textureAttributeKeys;if(void 0!==y)for(n=0,l=y.length;l>n;n++){var x=y[n];if(void 0!==x)for(var S=0,M=x.length;M>S;S++){a=x[S];var A=this.textureAttributeMapList[n];if(void 0!==A&&(attributeStack=A[a],void 0!==attributeStack&&(f=attributeStack.globalDefault,void 0!==f.getOrCreateUniforms)))for(p=f.getOrCreateUniforms(n),g=0,b=p.uniformKeys.length;b>g;g++)i.push(p[p.uniformKeys[g]])}}var T={};for(n=0,l=i.length;l>n;n++){var w=i[n],C=t.getUniformLocation(d,w.name);void 0!==C&&null!==C&&(T[w.name]=i[n])}e.trackUniforms=T}for(n=0,l=r.uniformKeys.length;l>n;n++){var E=r.uniformKeys[n];u=r[E],h=o[E],void 0===h?void 0!==e.trackUniforms&&(c=e.trackUniforms[E],void 0!==c&&c.apply(u)):(c=0===h.length?h.globalDefault:h.back().object,c.apply(u))}}},applyUniformList:function(t,e){var r=this.getLastProgramApplied();r.program;for(var i,n,a,o=r.uniformsCache,s=0,u=o.uniformKeys.length;u>s;s++){var h=o.uniformKeys[s];if(i=o[h],a=e[h],void 0===a){if(n=t[h],void 0===n)continue;a=0===n.length?n.globalDefault:n.back().object}a.apply(i)}},applyAttributeMap:function(t){for(var e,r=0,i=t.attributeKeys.length;i>r;r++){var n=t.attributeKeys[r];if(e=t[n],void 0!==e){var a;a=0===e.length?e.globalDefault:e.back().object,e.asChanged&&(e.lastApplied!==a&&(a.apply&&a.apply(this),e.lastApplied=a),e.asChanged=!1)}}},getObjectPair:function(t,e){return{object:t,value:e}},pushUniformsList:function(r,i){for(var n,a,o=0,s=i.uniformKeys.length;s>o;o++){var u=i.uniformKeys[o];uniformPair=i[u],a=uniformPair.getUniform(),n=a.name,void 0===r[n]&&(r[n]=e.create(),r[n].globalDefault=a,r.uniformKeys.push(n));var h=uniformPair.getValue(),l=r[n];0===l.length?l.push(this.getObjectPair(a,h)):l[l.length-1].value&t.OVERRIDE&&!(h&t.PROTECTED)?l.push(l[l.length-1]):l.push(this.getObjectPair(a,h))}},popUniformsList:function(t,e){for(var r=0,i=e.uniformKeys.length;i>r;r++){var n=e.uniformKeys[r];t[n].pop()}},applyTextureAttributeMapList:function(t){for(var e,r=this._graphicContext,i=0,n=t.length;n>i;i++)if(e=t[i],void 0!==e)for(var a=0,o=e.attributeKeys.length;o>a;a++){var s=e.attributeKeys[a],u=e[s];if(void 0!==u){var h;h=0===u.length?u.globalDefault:u.back().object,u.asChanged&&(r.activeTexture(r.TEXTURE0+i),h.apply(this,i),u.lastApplied=h,u.asChanged=!1)}}},setGlobalDefaultValue:function(t){var r=t.getTypeMember();this.attributeMap[r]?this.attributeMap[r].globalDefault=t:(this.attributeMap[r]=e.create(),this.attributeMap[r].globalDefault=t,this.attributeMap.attributeKeys.push(r))},pushAttributeMap:function(r,i){for(var n,a=0,o=i.attributeKeys.length;o>a;a++){var s=i.attributeKeys[a],u=i[s],h=u.getAttribute();void 0===r[s]&&(r[s]=e.create(),r[s].globalDefault=h.cloneType(),r.attributeKeys.push(s));var l=u.getValue();n=r[s],0===n.length?n.push(this.getObjectPair(h,l)):n[n.length-1].value&t.OVERRIDE&&!(l&t.PROTECTED)?n.push(n[n.length-1]):n.push(this.getObjectPair(h,l)),n.asChanged=!0}},popAttributeMap:function(t,e){for(var r,i=0,n=e.attributeKeys.length;n>i;i++)type=e.attributeKeys[i],r=t[type],r.pop(),r.asChanged=!0},setIndexArray:function(t){var e=this._graphicContext;this.currentIndexVBO!==t&&(t.bind(e),this.currentIndexVBO=t),t.isDirty()&&t.compile(e)},lazyDisablingOfVertexAttributes:function(){for(var t=this.vertexAttribMap._keys,e=0,r=t.length;r>e;e++){var i=t[e];this.vertexAttribMap[i]&&(this.vertexAttribMap._disable[i]=!0)}},applyDisablingOfVertexAttributes:function(){for(var t=this.vertexAttribMap._keys,e=0,r=t.length;r>e;e++)if(this.vertexAttribMap._disable[t[e]]===!0){var i=t[e];this._graphicContext.disableVertexAttribArray(i),this.vertexAttribMap._disable[i]=!1,this.vertexAttribMap[i]=!1}var n=this.programs.lastApplied;if(void 0!==n){var a=!1,o=!1;void 0!==n.attributesCache.Color&&(o=this.vertexAttribMap[n.attributesCache.Color]);var s=this.uniforms.ArrayColorEnabled.globalDefault;this.previousHasColorAttrib!==o&&(a=!0),this.previousHasColorAttrib=o,a&&(s.get()[0]=o?1:0,s.dirty()),s.apply(n.uniformsCache.ArrayColorEnabled)}},setVertexAttribArray:function(t,e,r){var i=this.vertexAttribMap;i._disable[t]=!1;var n=this._graphicContext,a=!1;e.isDirty()&&(e.bind(n),e.compile(n),a=!0),i[t]!==e&&(a||e.bind(n),i[t]||(n.enableVertexAttribArray(t),void 0===i[t]&&i._keys.push(t)),i[t]=e,n.vertexAttribPointer(t,e._itemSize,n.FLOAT,r,0,0))}},a}),n("vendors/Q",[],function(){return window.Q}),n("osgDB/Input",["require","osgDB/ReaderParser","osg/Utils","osg/Notify","vendors/Q","osg/Image","osg/BufferArray","osg/DrawArrays","osg/DrawArrayLengths","osg/DrawElements","osg/PrimitiveSet"],function(t,e,r,i,n,a,s,u,h,l,c){var d=function(t,e){this._json=t;var r=e;void 0===r&&(r={}),this._identifierMap=r,this._objectRegistry={},this._progressXHRCallback=void 0,this._prefixURL="",this.setImageLoadingOptions({promise:!0,onload:void 0})};return d.imageFallback||(d.imageFallback=function(){var t=new window.Image;return t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2P8DwQACgAD/il4QJ8AAAAASUVORK5CYII=",t}()),d.prototype={setImageLoadingOptions:function(t){this._defaultImageOptions=t},getImageLoadingOptions:function(){return this._defaultImageOptions},setProgressXHRCallback:function(t){this._progressXHRCallback=t},registerObject:function(t,e){this._objectRegistry[t]=e},getJSON:function(){return this._json},setJSON:function(t){return this._json=t,this},setPrefixURL:function(t){this._prefixURL=t},getPrefixURL:function(){return this._prefixURL},computeURL:function(t){return void 0===this._prefixURL?t:this._prefixURL+t},getObjectWrapper:function(t){if(void 0!==this._objectRegistry[t])return new this._objectRegistry[t];for(var e=window,r=t.split("."),i=0,n=r.length;n>i;i++){var a=e[r[i]];if(void 0===a)return void 0;e=a}return new e},fetchImage:function(t,e,r,n){var a="data:image/",o=e.substring(0,a.length)===a,s=new window.Image;return s.onerror=function(){i.warn("warning use white texture as fallback instead of "+e),t.setImage(d.imageFallback),n&&n.resolve(t)},!o&&r.crossOrigin&&(s.crossOrigin=r.crossOrigin),s.onload=function(){n?(r.onload&&r.onload.call(t),n.resolve(t)):r.onload&&r.onload.call(t)},t.setURL(e),t.setImage(s),s.src=e,t},readImageURL:function(t,e){"data:image"!==t.substr(0,10)&&(t=this.computeURL(t)),void 0===e&&(e=this._defaultImageOptions);var r=new a;return e.promise!==!0?this.fetchImage(r,t,e):(defer=n.defer(),this.fetchImage(r,t,e,defer),defer.promise)},readNodeURL:function(e,r){e=this.computeURL(e);var a=n.defer();r=r||{};var o={progressXHRCallback:r.progressXHRCallback,prefixURL:r.prefixURL,defaultImageOptions:r.defaultImageOptions};if(void 0===o.prefixURL){var s=this.getPrefixURL(),u=e.lastIndexOf("/");-1!==u&&(s=e.substring(0,u+1)),o.prefixURL=s}var h=new XMLHttpRequest;return h.open("GET",e,!0),h.onreadystatechange=function(){if(4==h.readyState)if(200==h.status){var r=t("osgDB/ReaderParser");n.when(r.parseSceneGraph(JSON.parse(h.responseText),o),function(t){a.resolve(t),i.log("loaded "+e)}).fail(function(t){a.reject(t)})}else a.reject(h.status)},h.send(null),a.promise},readBinaryArrayURL:function(t){if(t=this.computeURL(t),void 0!==this._identifierMap[t])return this._identifierMap[t];var e=n.defer(),r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",this._progressXHRCallback&&r.addEventListener("progress",this._progressXHRCallback,!1),r.addEventListener("error",function(){e.reject()},!1);var i=this;return r.addEventListener("load",function(){var n=r.response;n?(i._identifierMap[t]=n,e.resolve(n)):e.reject()},!1),r.send(null),this._identifierMap[t]=e.promise,e.promise},readBufferArray:function(){var t,e=this.getJSON(),a=e.UniqueID;if(void 0!==a&&(t=this._identifierMap[a],void 0!==t))return t;var u=function(t){return void 0===t.Elements&&void 0===t.Array||void 0===t.ItemSize||!t.Type?!1:!0};if(u(e)){var h,l;if(void 0!==e.Elements)h=new s(s[e.Type],e.Elements,e.ItemSize);else if(void 0!==e.Array){var c=new s(s[e.Type]);c.setItemSize(e.ItemSize);var d,f;if(void 0!==e.Array.Float32Array?(d=e.Array.Float32Array,f="Float32Array"):void 0!==e.Array.Uint16Array?(d=e.Array.Uint16Array,f="Uint16Array"):(i.warn("Typed Array "+window.Object.keys(o.Array)[0]),f="Float32Array"),void 0!==d)if(void 0!==d.File){var p=d.File;l=n.defer(),n.when(this.readBinaryArrayURL(p)).then(function(t){var e,n;!function(){var t=new Uint8Array([18,52]),e=new Uint16Array(t.buffer);n="1234"===e[0].toString(16)}();var a=0;void 0!==d.Offset&&(a=d.Offset);var o=r[f].BYTES_PER_ELEMENT,s=d.Size,u=c.getItemSize(),h=s*o*u;if(n){i.log("big endian detected");var p=r[f],m=new p(s*u),v=new DataView(t,a,h),_=0,y=m.length;if("Uint16Array"===f)for(;y>_;_++)tempArray[_]=v.getUint16(_*o,!0);else if("Float32Array"===f)for(;y>_;_++)tempArray[_]=v.getFloat32(_*o,!0);e=tempArray,v=null}else e=new r[f](t,a,u*s);g=b=null,c.setElements(e),l.resolve(c)})}else if(void 0!==d.Elements){var g=new r[f](d.Elements);c.setElements(g)}h=c}return void 0!==a&&(this._identifierMap[a]=h),void 0!==l?l.promise:h}},readUserDataContainer:function(){var t,e=this.getJSON(),r=e.UniqueID;return void 0!==r&&(t=this._identifierMap[r],void 0!==t)?t.Values:(this._identifierMap[r]=e,e.Values)},readPrimitiveSet:function(){var t,e,r,i,a=this.getJSON(),o=a.DrawElementUShort||a.DrawElementUByte||a.DrawElementUInt||a.DrawElementsUShort||a.DrawElementsUByte||a.DrawElementsUInt||void 0;if(o){if(t=o.UniqueID,void 0!==t&&(e=this._identifierMap[t],void 0!==e))return e;i=n.defer();var s=o.Indices,d=a;mode=o.Mode,mode=mode?c[mode]:c.TRIANGLES,r=new l(mode),this.setJSON(s),n.when(this.readBufferArray()).then(function(t){r.setIndices(t),i.resolve(r)}),this.setJSON(d)}var f=a.DrawArray||a.DrawArrays;
if(f){if(t=f.UniqueID,void 0!==t&&(e=this._identifierMap[t],void 0!==e))return e;mode=f.Mode||f.mode,first=void 0!==f.First?f.First:f.first,count=void 0!==f.Count?f.Count:f.count;var p=new u(c[mode],first,count);r=p}var g=a.DrawArrayLengths||void 0;if(g){if(t=g.UniqueID,void 0!==t&&(e=this._identifierMap[t],void 0!==e))return e;mode=g.Mode,first=g.First;var m=g.ArrayLengths,v=new h(c[mode],first,m);r=v}return void 0!==t&&(this._identifierMap[t]=r),i?i.promise:r},readObject:function(){var e=this.getJSON(),r=window.Object.keys(e)[0];if(!r)return i.warn("can't find property for object "+e),void 0;var n,a=e[r].UniqueID;if(void 0!==a&&(n=this._identifierMap[a],void 0!==n))return n;var o=this.getObjectWrapper(r);if(!o)return i.warn("can't instanciate object "+r),void 0;for(var s=t("osgDB/ReaderParser"),u=s.ObjectWrapper.serializers,h=r.split("."),l=0,c=h.length;c>l;l++){var d=u[h[l]];if(void 0===d)return i.warn("can't find function to read object "+r+" - undefined"),void 0;u=d}var f=u(this.setJSON(e[r]),o);return void 0!==a&&(this._identifierMap[a]=o,o._uniqueID=a),f}},d}),n("osgDB/ReaderParser",["require","osgDB/Input","osg/Notify","osg/Utils","vendors/Q","osg/Texture","osg/Uniform","osg/BlendFunc","osg/Material","osg/Geometry","osg/BufferArray","osg/PrimitiveSet","osg/DrawArrays","osg/DrawElements","osg/StateSet","osg/Node","osg/Matrix","osg/MatrixTransform","osg/Projection"],function(t,e,r,i,n,a,o,s,u,h,l,c,d,f,p,g,m,v,_){var y={};return y.ObjectWrapper={},y.ObjectWrapper.serializers={},y.readImage=function(t,e){return y.registry().readImageURL(t,e)},y.readImageURL=y.readImage,y.readNodeURL=function(t,e){return y.registry().readNodeURL(t,e)},y.registry=function(){var e=t("osgDB/Input");return void 0===y.registry._input&&(y.registry._input=new e),y.registry._input},y.parseSceneGraph=function(e,i){if(!(void 0!==e.Version&&e.Version>0))return y.parseSceneGraph_deprecated(e);var n=function(t){for(var e=window.Object.keys(t),r=0,i=e.length;i>r;r++)if("Generator"!==e[r]&&"Version"!==e[r])return e[r];return void 0},a=n(e);if(a){var o={};o[a]=e[a];var s=t("osgDB/Input"),u=new s(o);return u.setImageLoadingOptions(y.registry().getImageLoadingOptions()),void 0!==i&&(u.setProgressXHRCallback(i.progressXHRCallback),u.setPrefixURL(i.prefixURL)),u.readObject()}r.log("can't parse scenegraph "+e)},y.parseSceneGraph_deprecated=function(e){var a,b=function(t,e){var r=e[t];return void 0===r&&(r=e[t.toLowerCase()]),r},x=function(t,e){var r=b("Name",e);r&&void 0!==t.setName&&t.setName(r)},S=function(t,e){x(t,e),t.setAmbient(b("Ambient",e)),t.setDiffuse(b("Diffuse",e)),t.setEmission(b("Emission",e)),t.setSpecular(b("Specular",e)),t.setShininess(b("Shininess",e))},M=function(t,e){x(t,e),t.setSourceRGB(e.SourceRGB),t.setSourceAlpha(e.SourceAlpha),t.setDestinationRGB(e.DestinationRGB),t.setDestinationAlpha(e.DestinationAlpha)},A=function(t,e){var r=e.MagFilter||e.mag_filter||void 0;r&&t.setMagFilter(r);var i=e.MinFilter||e.min_filter||void 0;i&&t.setMinFilter(i);var a=e.WrapT||e.wrap_t||void 0;a&&t.setWrapT(a);var o=e.WrapS||e.wrap_s||void 0;o&&t.setWrapS(o);var s=b("File",e);n.when(y.readImage(s)).then(function(e){t.setImage(e)})},T=function(e,i){x(e,i);var n=b("Textures",i)||b("TextureAttributeList",i)||void 0;if(n)for(var a=0,h=n.length;h>a;a++){var l=b("File",n[a]);if(l){var c=t("osg/Texture"),d=new c;A(d,n[a]),e.setTextureAttributeAndMode(a,d),e.addUniform(o.createInt1(a,"Texture"+a))}else r.log("no texture on unit "+a+" skip it")}var f=b("BlendFunc",i);if(f){var p=new s;M(p,f),e.setAttributeAndMode(p)}var g=b("Material",i);if(g){var m=new u;S(m,g),e.setAttributeAndMode(m)}},w=e.children,C=e.primitives||e.Primitives||void 0,E=e.attributes||e.Attributes||void 0;if(C||E){a=new h,x(a,e),i.extend(a,e),e=a,e.primitives=C,e.attributes=E;for(var F=0,R=C.length;R>F;F++){var L=C[F].mode;if(C[F].indices){var I=C[F].indices;I=new l(l[I.type],I.elements,I.itemSize),L=L?c[L]:gl.TRIANGLES,C[F]=new f(L,I)}else{L=gl[L];var N=C[F].first,P=C[F].count;C[F]=new d(L,N,P)}}for(var k in E)if(E.hasOwnProperty(k)){var O=E[k];E[k]=new l(gl[O.type],O.elements,O.itemSize)}}var D=b("StateSet",e);if(D){var U=new p;T(U,D),e.stateset=U}var V=e.matrix||e.Matrix||void 0;V&&(a=new v,x(a,e),i.extend(a,e),a.setMatrix(m.copy(V)),e=a);var B=e.projection||e.Projection||void 0;if(B&&(a=new _,x(a,e),i.extend(a,e),a.setProjectionMatrix(m.copy(B)),e=a),void 0===e.objectType&&(a=new g,x(a,e),i.extend(a,e),e=a),w){e.children=[];for(var j=0,G=w.length;G>j;j++)e.addChild(y.parseSceneGraph_deprecated(w[j]))}return e},y}),n("osg/Texture",["osg/Notify","osg/Utils","osg/StateAttribute","osg/Uniform","osg/Image","osg/ShaderGenerator","osgDB/ReaderParser","vendors/Q"],function(t,e,r,i,n,a,o,s){var u=function(){r.call(this),this.setDefaultParameters(),this._applyTexImage2DCallbacks=[]};return u.DEPTH_COMPONENT=6402,u.ALPHA=6406,u.RGB=6407,u.RGBA=6408,u.LUMINANCE=6409,u.LUMINANCE_ALPHA=6410,u.LINEAR=9729,u.NEAREST=9728,u.NEAREST_MIPMAP_NEAREST=9984,u.LINEAR_MIPMAP_NEAREST=9985,u.NEAREST_MIPMAP_LINEAR=9986,u.LINEAR_MIPMAP_LINEAR=9987,u.CLAMP_TO_EDGE=33071,u.REPEAT=10497,u.MIRRORED_REPEAT=33648,u.TEXTURE_2D=3553,u.TEXTURE_CUBE_MAP=34067,u.TEXTURE_BINDING_CUBE_MAP=34068,u.TEXTURE_CUBE_MAP_POSITIVE_X=34069,u.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,u.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,u.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,u.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,u.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,u.MAX_CUBE_MAP_TEXTURE_SIZE=34076,u.UNSIGNED_BYTE=5121,u.FLOAT=5126,u.prototype=e.objectLibraryClass(e.objectInehrit(r.prototype,{attributeType:"Texture",cloneType:function(){var t=new u;return t.default_type=!0,t},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},getOrCreateUniforms:function(t){if(void 0===u.uniforms&&(u.uniforms=[]),void 0===u.uniforms[t]){var e=this.getType()+t,r={};r.texture=i.createInt1(t,e),r.uniformKeys=window.Object.keys(r),u.uniforms[t]=r}return u.uniforms[t]},setDefaultParameters:function(){this._image=void 0,this._magFilter=u.LINEAR,this._minFilter=u.LINEAR,this._wrapS=u.CLAMP_TO_EDGE,this._wrapT=u.CLAMP_TO_EDGE,this._textureWidth=0,this._textureHeight=0,this._unrefImageDataAfterApply=!1,this.setInternalFormat(u.RGBA),this._textureTarget=u.TEXTURE_2D,this._type=u.UNSIGNED_BYTE},getTextureTarget:function(){return this._textureTarget},getTextureObject:function(){return this._textureObject},setTextureSize:function(t,e){this._textureWidth=t,this._textureHeight=e},init:function(t){this._textureObject||(this._textureObject=t.createTexture(),this.dirty())},addApplyTexImage2DCallback:function(t){var e=this._applyTexImage2DCallbacks.indexOf(t);0>e&&this._applyTexImage2DCallbacks.push(t)},removeApplyTexImage2DCallback:function(t){var e=this._applyTexImage2DCallbacks.indexOf(t);e>=0&&this._applyTexImage2DCallbacks.splice(e,1)},getWidth:function(){return this._textureWidth},getHeight:function(){return this._textureHeight},releaseGLObjects:function(t){void 0!==this._textureObject&&null!==this._textureObject&&(t.deleteTexture(this._textureObject),this._textureObject=null,this._image=void 0)},setWrapS:function(t){this._wrapS="string"==typeof t?u[t]:t},setWrapT:function(t){this._wrapT="string"==typeof t?u[t]:t},getWrapT:function(){return this._wrapT},getWrapS:function(){return this._wrapS},getMinFilter:function(){return this._minFilter},getMagFilter:function(){return this._magFilter},setMinFilter:function(t){this._minFilter="string"==typeof t?u[t]:t},setMagFilter:function(t){this._magFilter="string"==typeof t?u[t]:t},setImage:function(t,e){var r=t;(t instanceof window.Image||t instanceof HTMLCanvasElement||t instanceof Uint8Array)&&(r=new n(t)),this._image=r,this.setImageFormat(e),this.dirty()},getImage:function(){return this._image},setImageFormat:function(t){t?("string"==typeof t&&(t=u[t]),this._imageFormat=t):this._imageFormat=u.RGBA,this.setInternalFormat(this._imageFormat)},setType:function(t){this._type="string"==typeof t?u[t]:t},setUnrefImageDataAfterApply:function(t){this._unrefImageDataAfterApply=t},setInternalFormat:function(t){this._internalFormat=t},getInternalFormat:function(){return this._internalFormat},applyFilterParameter:function(t,e){var r=function(t){return 0!==t&&(t&~t+1)===t},i=r(this._textureWidth)&&r(this._textureHeight);i||(this.setWrapT(u.CLAMP_TO_EDGE),this.setWrapS(u.CLAMP_TO_EDGE),(this._minFilter===u.LINEAR_MIPMAP_LINEAR||this._minFilter===u.LINEAR_MIPMAP_NEAREST)&&this.setMinFilter(u.LINEAR)),t.texParameteri(e,t.TEXTURE_MAG_FILTER,this._magFilter),t.texParameteri(e,t.TEXTURE_MIN_FILTER,this._minFilter),t.texParameteri(e,t.TEXTURE_WRAP_S,this._wrapS),t.texParameteri(e,t.TEXTURE_WRAP_T,this._wrapT)},generateMipmap:function(t,e){(this._minFilter===t.NEAREST_MIPMAP_NEAREST||this._minFilter===t.LINEAR_MIPMAP_NEAREST||this._minFilter===t.NEAREST_MIPMAP_LINEAR||this._minFilter===t.LINEAR_MIPMAP_LINEAR)&&t.generateMipmap(e)},applyTexImage2D:function(t){var t=arguments[0],e=Array.prototype.slice.call(arguments,1);t.texImage2D.apply(t,e);var r=this._applyTexImage2DCallbacks.length;if(r>0)for(var i=0,n=r;n>i;i++)this._applyTexImage2DCallbacks[i].call(this)},apply:function(t){var e=t.getGraphicContext();if(void 0===this._textureObject||this.isDirty())if(this.default_type)e.bindTexture(this._textureTarget,null);else{var r=this._image;if(void 0!==r)if(r.isReady()){this._textureObject||this.init(e),this.setDirty(!1),e.bindTexture(this._textureTarget,this._textureObject);var i=r.getWidth()||this._textureWidth,n=r.getHeight()||this._textureHeight;this.setTextureSize(i,n),r.isTypedArray()?this.applyTexImage2D(e,this._textureTarget,0,this._internalFormat,this._textureWidth,this._textureHeight,0,this._internalFormat,this._type,this._image.getImage()):this.applyTexImage2D(e,this._textureTarget,0,this._internalFormat,this._imageFormat,this._type,r.getImage()),this.applyFilterParameter(e,this._textureTarget),this.generateMipmap(e,this._textureTarget),this._unrefImageDataAfterApply&&(this._image=void 0)}else e.bindTexture(this._textureTarget,null);else 0!==this._textureHeight&&0!==this._textureWidth&&(this._textureObject||this.init(e),e.bindTexture(this._textureTarget,this._textureObject),this.applyTexImage2D(e,this._textureTarget,0,this._internalFormat,this._textureWidth,this._textureHeight,0,this._internalFormat,this._type,null),this.applyFilterParameter(e,this._textureTarget),this.generateMipmap(e,this._textureTarget),this.setDirty(!1))}else e.bindTexture(this._textureTarget,this._textureObject)},setShaderGeneratorFunction:function(t,e){this[e]=t},generateShader:function(t,e){return this[e]?this[e].call(this,t):""}}),"osg","Texture"),u.prototype[a.Type.VertexInit]=function(t){var e="attribute vec2 TexCoord"+t+";\n";return e+="varying vec2 FragTexCoord"+t+";\n"},u.prototype[a.Type.VertexMain]=function(t){return"FragTexCoord"+t+" = TexCoord"+t+";\n"},u.prototype[a.Type.FragmentInit]=function(t){var e="varying vec2 FragTexCoord"+t+";\n";return e+="uniform sampler2D Texture"+t+";\n",e+="vec4 texColor"+t+";\n"},u.prototype[a.Type.FragmentMain]=function(t){var e="texColor"+t+" = texture2D( Texture"+t+", FragTexCoord"+t+".xy );\n";return e+="fragColor = fragColor * texColor"+t+";\n"},u.createFromURL=function(t,e){var r=new u;return s.when(o.readImage(t)).then(function(t){r.setImage(t,e)}),r},u.createFromImage=function(t,e){var r=new u;return r.setImage(t,e),r},u.createFromCanvas=function(t,e){return u.createFromImage(t,e)},u.create=function(e){return t.log("Texture.create is deprecated, use Texture.createFromURL instead"),u.createFromURL(e)},u}),n("osg/TextureCubeMap",["osg/Utils","osg/Texture","osg/Image"],function(t,e,r){var i=function(){e.call(this),this._images={}};return i.prototype=t.objectLibraryClass(t.objectInehrit(e.prototype,{setDefaultParameters:function(){e.prototype.setDefaultParameters.call(this),this._textureTarget=e.TEXTURE_CUBE_MAP},cloneType:function(){var t=new i;return t.default_type=!0,t},setImage:function(t,i,n){"string"==typeof t&&(t=e[t]),void 0===this._images[t]&&(this._images[t]={}),"string"==typeof n&&(n=e[n]),void 0===n&&(n=e.RGBA);var a=i;a instanceof r==!1&&(a=new r(i)),this._images[t].image=a,this._images[t].format=n,this._images[t].dirty=!0,this.dirty()},getImage:function(t){return this._images[t].image},applyTexImage2D_load:function(t,e,r,i,n,a,o){return o?o.isReady()?(this.setTextureSize(o.getWidth(),o.getHeight()),t.texImage2D(e,0,i,n,a,o.getImage()),!0):!1:!1},_applyImageTarget:function(t,e,r){var i=this._images[r];return i?i.dirty?this.applyTexImage2D_load(t,r,0,e,i.format,t.UNSIGNED_BYTE,i.image)?(i.dirty=!1,this._unrefImageDataAfterApply&&delete this._images[r],1):0:1:0},apply:function(t){var e=t.getGraphicContext();if(void 0===this._textureObject||this.isDirty())if(this.default_type)e.bindTexture(this._textureTarget,null);else{this._images,this._textureObject||this.init(e),e.bindTexture(this._textureTarget,this._textureObject);var r=this._internalFormat,i=0;i+=this._applyImageTarget(e,r,e.TEXTURE_CUBE_MAP_POSITIVE_X),i+=this._applyImageTarget(e,r,e.TEXTURE_CUBE_MAP_NEGATIVE_X),i+=this._applyImageTarget(e,r,e.TEXTURE_CUBE_MAP_POSITIVE_Y),i+=this._applyImageTarget(e,r,e.TEXTURE_CUBE_MAP_NEGATIVE_Y),i+=this._applyImageTarget(e,r,e.TEXTURE_CUBE_MAP_POSITIVE_Z),i+=this._applyImageTarget(e,r,e.TEXTURE_CUBE_MAP_NEGATIVE_Z),6===i&&(this.setDirty(!1),this.applyFilterParameter(e,this._textureTarget),this.generateMipmap(e,this._textureTarget))}else e.bindTexture(this._textureTarget,this._textureObject)}}),"osg","TextureCubeMap"),i}),n("osg/UpdateVisitor",["osg/Utils","osg/NodeVisitor","osg/FrameStamp"],function(t,e,r){var i=function(){e.call(this);var t=new r;this.getFrameStamp=function(){return t},this.setFrameStamp=function(e){t=e}};return i.prototype=t.objectInehrit(e.prototype,{apply:function(t){for(var e=t.getUpdateCallbackList(),r=0;r<e.length;r++)if(!e[r].update(t,this))return;this.traverse(t)}}),i}),n("osg/Vec2",[],function(){var t={copy:function(t,e){return e[0]=t[0],e[1]=t[1],e},valid:function(t){return isNaN(t[0])?!1:isNaN(t[1])?!1:!0},mult:function(t,e,r){return r[0]=t[0]*e,r[1]=t[1]*e,r},length2:function(t){return t[0]*t[0]+t[1]*t[1]},length:function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])},distance:function(t,e){var r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)},normalize:function(t,e){var r=this.length2(t);if(r>0){var i=1/Math.sqrt(r);e[0]=t[0]*i,e[1]=t[1]*i}else e[0]=t[0],e[1]=t[1];return e},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]},sub:function(t,e,r){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r},add:function(t,e,r){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r},neg:function(t,e){return e[0]=-t[0],e[1]=-t[1],e},lerp:function(t,e,r,i){var n=1-t;return i[0]=e[0]*n+t*r[0],i[1]=e[1]*n+t*r[1],i}};return t}),n("osg/Viewport",["osg/Utils","osg/StateAttribute","osg/Matrix","osg/Viewport"],function(t,e,r,i){var i=function(t,r,i,n){e.call(this),void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=800),void 0===n&&(n=600),this._x=t,this._y=r,this._width=i,this._height=n,this._dirty=!0};return i.prototype=t.objectLibraryClass(t.objectInehrit(e.prototype,{attributeType:"Viewport",cloneType:function(){return new i},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},apply:function(t){var e=t.getGraphicContext();e.viewport(this._x,this._y,this._width,this._height),this._dirty=!1},setViewport:function(t,e,r,i){this._x=t,this._y=e,this._width=r,this._height=i,this.dirty()},x:function(){return this._x},y:function(){return this._y},width:function(){return this._width},height:function(){return this._height},computeWindowMatrix:function(){var t=r.makeTranslate(1,1,1),e=r.makeScale(.5*this._width,.5*this._height,.5),i=r.makeTranslate(this._x,this._y,0);return r.preMult(i,r.preMult(e,t))}}),"osg","Viewport"),i}),n("osg/osg",["osg/BlendColor","osg/BlendFunc","osg/BoundingBox","osg/BoundingSphere","osg/BufferArray","osg/Camera","osg/ComputeMatrixFromNodePath","osg/CullFace","osg/CullSettings","osg/CullStack","osg/CullVisitor","osg/Depth","osg/DrawArrayLengths","osg/DrawArrays","osg/DrawElements","osg/EllipsoidModel","osg/FrameBufferObject","osg/FrameStamp","osg/Geometry","osg/Image","osg/Light","osg/LightSource","osg/LineWidth","osg/Material","osg/Math","osg/Matrix","osg/MatrixTransform","osg/Node","osg/NodeVisitor","osg/Notify","osg/Object","osg/PrimitiveSet","osg/Program","osg/Projection","osg/Quat","osg/RenderBin","osg/RenderStage","osg/Shader","osg/ShaderGenerator","osg/Shape","osg/Stack","osg/State","osg/StateAttribute","osg/StateGraph","osg/StateSet","osg/Texture","osg/TextureCubeMap","osg/Transform","osg/Uniform","osg/UpdateVisitor","osg/Utils","osg/Vec2","osg/Vec3","osg/Vec4","osg/Viewport","osgUtil/osgPool","osg/TransformEnums"],function(t,e,r,i,n,a,o,s,u,h,l,c,d,f,p,g,m,v,_,y,b,x,S,M,A,T,w,C,E,F,R,L,I,N,P,k,O,D,U,V,B,j,G,z,H,K,W,q,X,Q,Y,J,Z,$,te,ee,re){var ie={};return ie.BlendColor=t,ie.BlendFunc=e,ie.BoundingBox=r,ie.BoundingSphere=i,ie.BufferArray=n,ie.Camera=a,Y.objectMix(ie,o),ie.CullFace=s,ie.CullSettings=u,ie.CullStack=h,ie.CullVisitor=l,ie.Depth=c,ie.DrawArrayLengths=d,ie.DrawArrays=f,ie.DrawElements=p,ie.EllipsoidModel=g,ie.WGS_84_RADIUS_EQUATOR=g.WGS_84_RADIUS_EQUATOR,ie.WGS_84_RADIUS_POLAR=g.WGS_84_RADIUS_POLAR,ie.FrameBufferObject=m,ie.FrameStamp=v,ie.Geometry=_,ie.Image=y,ie.Light=b,ie.LightSource=x,ie.LineWidth=S,ie.Material=M,Y.objectMix(ie,A),ie.Matrix=T,ie.MatrixTransform=w,ie.Node=C,ie.NodeVisitor=E,Y.objectMix(ie,F),ie.Object=R,ie.PrimitiveSet=L,ie.Program=I,ie.Projection=N,ie.Quat=P,ie.RenderBin=k,ie.RenderStage=O,ie.Shader=D,ie.ShaderGenerator=U,ie.ShaderGeneratorType=U.Type,Y.objectMix(ie,V),ie.Stack=B,ie.State=j,ie.StateAttribute=G,ie.StateGraph=z,ie.StateSet=H,ie.Texture=K,ie.TextureCubeMap=W,ie.Transform=q,ie.Uniform=X,ie.UpdateVisitor=Q,Y.objectMix(ie,Y),ie.Vec2=J,ie.Vec3=Z,ie.Vec4=$,ie.Viewport=te,ie.memoryPools=ee.memoryPools,ie.Transform.RELATIVE_RF=re.RELATIVE_RF,ie.Transform.ABSOLUTE_RF=re.ABSOLUTE_RF,ie}),n("osgAnimation/Animation",["osg/Utils","osg/Object"],function(t,e){var r=function(){e.call(this),this._channels=[]};return r.prototype=t.objectInehrit(e.prototype,{getChannels:function(){return this._channels},getDuration:function(){for(var t=1e5,e=-1e5,r=0,i=this._channels.length;i>r;r++){var n=this._channels[r];t=Math.min(t,n.getStartTime()),e=Math.max(e,n.getEndTime())}return e-t}}),r}),n("osgAnimation/AnimationUpdateCallback",["osg/Notify","osg/Utils","osg/Object"],function(t,e,r){var i=function(){};return i.prototype=e.objectInehrit(r.prototype,{linkChannel:function(){},linkAnimation:function(e){var r=this.getName();if(0===r.length)return t.log("no name on an update callback, discard"),0;for(var i=0,n=e.getChannels(),a=0,o=n.length;o>a;a++){var s=n[a];s.getTargetName()===r&&(this.linkChannel(s),i++)}return i}}),i}),n("osgAnimation/BasicAnimationManager",["osg/Notify","osg/Utils","osg/Object"],function(t,e,r){var i=function(){r.call(this),this._animations={},this._actives={},this._actives._keys=[],this._lastUpdate=void 0,this._targets=[]};return i.prototype=e.objectInehrit(r.prototype,{_updateAnimation:function(t,e,r){var i=t.duration,n=t.weight,a=t.anim,o=t.start,s=t.loop;if(s>0){var u=e-o;if(u>=s*i)return!0}e=(e-o)%i;var h=t.callback;h&&h(e);for(var l=a.getChannels(),c=0,d=l.length;d>c;c++){var f=l[c];f.update(e,n,r)}return!1},update:function(t,e){var r=e.getFrameStamp().getSimulationTime();return this.updateManager(r),!0},updateManager:function(t){for(var e=this._targets,r=0,i=e.length;i>r;r++)e[r].reset();if(this._actives._keys.length>0)for(var n=this._actives._keys.length-1;n>=0;){for(var a=this._actives[n],o=this._actives[n]._keys,s=[],u=0,h=o.length;h>u;u++){var l=o[u],c=a[l];void 0===c.start&&(c.start=t);var d=this._updateAnimation(c,t,n);d&&s.push(u)}for(var f=s.length-1;f>=0;f--){var p=o[f];o.splice(f,1),delete a[p]}n--}},stopAll:function(){},isPlaying:function(t){if(this._actives._keys.length>0)for(var e=this._actives._keys.length-1;e>=0;){if(this._actives[e][t])return!0;e--}return!1},stopAnimation:function(t){if(this._actives._keys.length>0)for(var e=this._actives._keys.length-1,r=function(t){return"_keys"!==t};e>=0;){if(this._actives[e][t])return delete this._actives[e][t],this._actives[e]._keys=window.Object.keys(this._actives[e]).filter(r),void 0;e--}},playAnimationObject:function(e){if(void 0!==e.name){var r=this._animations[e.name];return void 0===r?(t.log("no animation "+e.name+" found"),void 0):(this.isPlaying(e.name)||(void 0===e.priority&&(e.priority=0),void 0===e.weight&&(e.weight=1),void 0===e.timeFactor&&(e.timeFactor=1),void 0===e.loop&&(e.loop=0),void 0===this._actives[e.priority]&&(this._actives[e.priority]={},this._actives[e.priority]._keys=[],this._actives._keys.push(e.priority)),e.start=void 0,e.duration=r.getDuration(),e.anim=r,this._actives[e.priority][e.name]=e,this._actives[e.priority]._keys.push(e.name)),void 0)}},playAnimation:function(t,e,r){var i=t;if("object"==typeof t){if(void 0===t.getName)return this.playAnimationObject(t);i=t.getName()}var n={name:i,priority:e,weight:r};return this.playAnimationObject(n)},registerAnimation:function(t){this._animations[t.getName()]=t,this.buildTargetList()},getAnimationMap:function(){return this._animations},buildTargetList:function(){this._targets.length=0;for(var t=window.Object.keys(this._animations),e=0,r=t.length;r>e;e++)for(var i=this._animations[t[e]],n=i.getChannels(),a=0,o=n.length;o>a;a++){var s=n[a];this._targets.push(s.getTarget())}}}),i}),n("osgAnimation/Channel",["osg/Utils","osg/Object"],function(t,e){var r=function(t,r){e.call(this),this._sampler=t,this._target=r,this._targetName=void 0,this._data={value:void 0,key:0}};return r.prototype=t.objectInehrit(e.prototype,{getKeyframes:function(){return this._sampler.getKeyframes()},setKeyframes:function(t){this._sampler.setKeyframes(t)},getStartTime:function(){return this._sampler.getStartTime()},getEndTime:function(){return this._sampler.getEndTime()},getSampler:function(){return this._sampler},setSampler:function(t){this._sampler=t},getTarget:function(){return this._target},setTarget:function(t){this._target=t},setTargetName:function(t){this._targetName=t},getTargetName:function(){return this._targetName},update:function(t,e,r){if(e=e||1,r=r||0,!(1e-4>e)){var i=this._data;this._sampler.getValueAt(t,i),this._target.update.call(this._target,e,i.value,r)}},reset:function(){this._target.reset()}}),r}),n("osgAnimation/Easing",[],function(){var t=function(t){return-(t*(t-2))},e=function(t){return t*t},r=function(t){return t-=1,t*t*t+1},i=function(t){return t*t*t},n=function(t){return t-=1,-(t*t*t*t-1)},a=function(t){return t*t*t*t},o=function(t){return Math.pow(2,-10*t)*Math.sin((t-.075)*2*Math.PI/.3)+1},s=function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375};return{easeOutQuad:t,easeInQuad:e,easeOutCubic:r,easeInCubic:i,easeOutQuart:n,easeInQuart:a,easeOutElastic:o,easeOutBounce:s,EaseOutQuad:t,EaseInQuad:e,EaseOutCubic:r,EaseInCubic:i,EaseOutQuart:n,EaseInQuart:a,EaseOutElastic:o,EaseOutBounce:s}}),n("osgAnimation/Sampler",[],function(){var t=function(t,e){t||(t=[]),this._keys=t,this._interpolator=e};return t.prototype={getKeyframes:function(){return this._keys},setKeyframes:function(t){this._keys=t},setInterpolator:function(t){this._interpolator=t},getInterpolator:function(){return this._interpolator},getStartTime:function(){return 0===this._keys.length?void 0:this._keys[0].t},getEndTime:function(){return 0===this._keys.length?void 0:this._keys[this._keys.length-1].t},getValueAt:function(t,e){this._keys[e.key].t>t&&(e.key=0),this._interpolator(this._keys,t,e)}},t}),n("osgAnimation/Interpolator",["osg/Quat"],function(t){var e=function(t,e,r){var i,n,a=t[t.length-1],o=a.t;if(e>=o)return r.key=0,r.value[0]=a[0],r.value[1]=a[1],r.value[2]=a[2],void 0;if(i=t[0],n=i.t,n>=e)return r.key=0,r.value[0]=i[0],r.value[1]=i[1],r.value[2]=i[2],void 0;for(var s=r.key;t[s+1].t<e;)s++;var u=s+1,h=t[s].t,l=t[s][0],c=t[s][1],d=t[s][2],f=t[u].t,p=t[u][0],g=t[u][1],m=t[u][2],v=(e-h)/(f-h);r.value[0]=l+(p-l)*v,r.value[1]=c+(g-c)*v,r.value[2]=d+(m-d)*v,r.key=s},r=function(t,e,r){var i,n,a=t[t.length-1],o=a.t;if(e>=o)return r.key=0,r.value[0]=a[0],r.value[1]=a[1],r.value[2]=a[2],r.value[3]=a[3],void 0;if(i=t[0],n=i.t,n>=e)return r.key=0,r.value[0]=i[0],r.value[1]=i[1],r.value[2]=i[2],r.value[3]=i[3],void 0;for(var s=r.key;t[s+1].t<e;)s++;var u=s+1,h=t[s].t,l=t[s][0],c=t[s][1],d=t[s][2],f=t[s][3],p=t[u].t,g=t[u][0],m=t[u][1],v=t[u][2],_=t[u][3],y=(e-h)/(p-h);r.value[0]=l+(g-l)*y,r.value[1]=c+(m-c)*y,r.value[2]=d+(v-d)*y,r.value[3]=f+(_-f)*y,r.key=s},i=function(e,r,i){var n,a,o=e[e.length-1],s=o.t;if(r>=s)return i.key=0,i.value[0]=o[0],i.value[1]=o[1],i.value[2]=o[2],i.value[3]=o[3],void 0;if(n=e[0],a=n.t,a>=r)return i.key=0,i.value[0]=n[0],i.value[1]=n[1],i.value[2]=n[2],i.value[3]=n[3],void 0;for(var u=i.key;e[u+1].t<r;)u++;var h=u+1,l=e[u].t,c=e[h].t,d=(r-l)/(c-l);t.slerp(d,e[u],e[h],i.value),i.key=u},n=function(t,e,r){var i,n,a=t[t.length-1],o=a.t;if(e>=o)return r.key=0,r.value=a[0],void 0;if(i=t[0],n=i.t,n>=e)return r.key=0,r.value=i[0],void 0;for(var s=r.key;t[s+1].t<e;)s++;var u=s+1,h=t[s].t,l=t[s][0],c=t[u].t,d=t[u][0],f=(e-h)/(c-h);r.value=l+(d-l)*f,r.key=s},a=function(t,e,r){var i,n,a=t[t.length-1],o=a.t;if(e>=o)return r.key=0,r.value=a[0],void 0;if(i=t[0],n=i.t,n>=e)return r.key=0,r.value=i[0],void 0;for(var s=r.key;t[s+1].t<e;)s++;t[s].t;var u=t[s][0];r.value=u,r.key=s};return{Vec3LerpInterpolator:e,QuatLerpInterpolator:r,QuatSlerpInterpolator:i,FloatLerpInterpolator:n,FloatStepInterpolator:a}}),n("osgAnimation/Target",[],function(){var t=function(){this._weight=0,this._priorityWeight=0,this._count=0,this._lastPriority=0,this._target=void 0};return t.prototype={reset:function(){this._weight=0,this._priorityWeight=0},getValue:function(){return this._target}},t}),n("osgAnimation/FloatTarget",["osg/Utils","osgAnimation/Target"],function(e,r){var i=function(t){r.call(this),this._target=[t]};return i.prototype=e.objectInehrit(r.prototype,{update:function(e,r,i){this._weight||this._priorityWeight?(this._lastPriority!=i&&(this._weight+=this._priorityWeight*(1-this._weight),this._priorityWeight=0,this._lastPriority=i),this._priorityWeight+=e,t=(1-this._weight)*e/this._priorityWeight,this._target+=(r-this._target)*t):(this._priorityWeight=e,this._lastPriority=i,this._target=r)}}),i}),n("osgAnimation/FloatLerpChannel",["osgAnimation/Channel","osgAnimation/Sampler","osgAnimation/Interpolator","osgAnimation/FloatTarget"],function(t,e,r,i){var n=function(n,a){var o=new e;n||(n=[]),a||(a=new i),t.call(this,o,a),o.setInterpolator(r.FloatLerpInterpolator),this.setKeyframes(n),this._data.value=a.getValue()};return n.prototype=t.prototype,n}),n("osgAnimation/Keyframe",[],function(){var t=function(t,e){var r=e.slice(0);return r.t=t,r},e=function(t,e){var r=e.slice(0);return r.t=t,r},r=function(t,e){var r=[e];return r.t=t,r};return{createVec3Keyframe:t,createQuatKeyframe:e,createFloatKeyframe:r}}),n("osgAnimation/LinkVisitor",["osg/Notify","osg/Utils","osg/NodeVisitor","osg/Object","osgAnimation/AnimationUpdateCallback"],function(t,e,r,i,n){var a=function(){r.call(this),this._animations=void 0,this._nbLinkTarget=0};return a.prototype=e.objectInehrit(r.prototype,{setAnimationMap:function(t){this._animations=t,this._animationKeys=window.Object.keys(t)},apply:function(t){for(var e=t.getUpdateCallbackList(),r=0,i=e.length;i>r;r++){var a=e[r];a instanceof n&&this.link(a)}this.traverse(t)},link:function(e){for(var r=0,i=this._animations,n=this._animationKeys,a=0,o=n.length;o>a;a++){var s=n[a],u=i[s];r+=e.linkAnimation(u)}this._nbLinkedTarget+=r,t.log("linked "+r+' for "'+e.getName()+'"')}}),a}),n("osgAnimation/QuatTarget",["osg/Utils","osgAnimation/Target","osg/Quat"],function(e,r,i){var n=function(){r.call(this),this._target=[],i.makeIdentity(this._target)};return n.prototype=e.objectInehrit(r.prototype,{update:function(e,r,n){this._weight||this._priorityWeight?(this._lastPriority!=n&&(this._weight+=this._priorityWeight*(1-this._weight),this._priorityWeight=0,this._lastPriority=n),this._priorityWeight+=e,t=(1-this._weight)*e/this._priorityWeight,i.lerp(t,this._target,r,this._target),i.normalize(this._target,this._target)):(this._priorityWeight=e,this._lastPriority=n,i.copy(r,this._target))}}),n}),n("osgAnimation/QuatLerpChannel",["osgAnimation/Channel","osgAnimation/Sampler","osgAnimation/Interpolator","osgAnimation/QuatTarget","osg/Quat"],function(t,e,r,i,n){var a=function(a,o){var s=new e;a||(a=[]),o||(o=new i),t.call(this,s,o),s.setInterpolator(r.QuatLerpInterpolator),this.setKeyframes(a),this._data.value=n.copy(o.getValue(),[])};return a.prototype=t.prototype,a}),n("osgAnimation/QuatSlerpChannel",["osgAnimation/Channel","osgAnimation/QuatLerpChannel","osgAnimation/Interpolator"],function(t,e,r){var i=function(t,i){e.call(this,t,i),this.getSampler().setInterpolator(r.QuatSlerpInterpolator)};return i.prototype=t.prototype,i}),n("osgAnimation/StackedQuaternion",["osg/Utils","osg/Object","osg/Matrix","osgAnimation/QuatTarget","osg/Quat"],function(t,e,r,i,n){var a=function(t,i){e.call(this),i||(i=[0,0,0,1]),this._quaternion=i,this._target=void 0,this._matrixTmp=[],r.makeIdentity(this._matrixTmp),this.setName(t)};return a.prototype=t.objectInehrit(e.prototype,{setQuaternion:function(t){n.copy(t,this._quaternion)},setTarget:function(t){this._target=t},getTarget:function(){return this._target},update:function(){void 0!==this._target&&n.copy(this._target.getValue(),this._quaternion)},getOrCreateTarget:function(){return this._target||(this._target=new i(this._quaternion)),this._target},applyToMatrix:function(t){var e=this._matrixTmp;r.setRotateFromQuat(e,this._quaternion),r.preMult(t,e)}}),a}),n("osgAnimation/Vec3Target",["osg/Utils","osgAnimation/Target","osg/Vec3"],function(e,r,i){var n=function(){r.call(this),this._target=[0,0,0]};return n.prototype=e.objectInehrit(r.prototype,{update:function(e,r,n){this._weight||this._priorityWeight?(this._lastPriority!=n&&(this._weight+=this._priorityWeight*(1-this._weight),this._priorityWeight=0,this._lastPriority=n),this._priorityWeight+=e,t=(1-this._weight)*e/this._priorityWeight,i.lerp(t,this._target,r,this._target)):(this._priorityWeight=e,this._lastPriority=n,i.copy(r,this._target))}}),n}),n("osgAnimation/StackedRotateAxis",["osg/Utils","osg/Object","osg/Matrix","osgAnimation/Vec3Target","osgAnimation/FloatTarget","osg/Vec3","osg/Quat"],function(t,e,r,i,n,a,o){var s=function(t,i,n){e.call(this),i||(i=[1,0,0]),n||(n=0),this._axis=i,this._angle=n,this._target=void 0,this.setName(t),this._matrixTmp=[],r.makeIdentity(this._matrixTmp),this._quatTmp=[],o.makeIdentity(this._quatTmp)};return s.prototype=t.objectInehrit(e.prototype,{setAxis:function(t){a.copy(t,this._axis)},setAngle:function(t){this._angle=t},setTarget:function(t){this._target=t},getTarget:function(){return this._target},update:function(){void 0!==this._target&&(this._angle=this._target.getValue())},getOrCreateTarget:function(){return this._target||(this._target=new n(this._angle)),this._target},applyToMatrix:function(t){var e=this._axis,i=this._quatTmp,n=this._matrixTmp;o.makeRotate(this._angle,e[0],e[1],e[2],i),r.setRotateFromQuat(n,i),r.preMult(t,n)}}),s}),n("osgAnimation/StackedTranslate",["osg/Utils","osg/Object","osg/Matrix","osgAnimation/Vec3Target","osg/Vec3"],function(t,e,r,i,n){var a=function(t,r){e.call(this),r||(r=[0,0,0]),this._translate=r,this._target=void 0,this.setName(t)};return a.prototype=t.objectInehrit(e.prototype,{setTranslate:function(t){n.copy(t,this._translate)},setTarget:function(t){this._target=t},getTarget:function(){return this._target},update:function(){void 0!==this._target&&n.copy(this._target.getValue(),this._translate)},getOrCreateTarget:function(){return this._target||(this._target=new i(this._translate)),this._target},applyToMatrix:function(t){r.preMultTranslate(t,this._translate)}}),a}),n("osgAnimation/UpdateMatrixTransform",["osg/Notify","osg/Utils","osgAnimation/AnimationUpdateCallback"],function(t,e,r){var i=function(){r.call(this),this._stackedTransforms=[]
};return i.prototype=e.objectInehrit(r.prototype,{getStackedTransforms:function(){return this._stackedTransforms},update:function(t){var e=t.getMatrix();Matrix.makeIdentity(e);for(var r=this._stackedTransforms,i=0,n=r.length;n>i;i++){var a=r[i];a.update(),a.applyToMatrix(e)}return!0},linkChannel:function(e){for(var r=e.getName(),i=this._stackedTransforms,n=0,a=i.length;a>n;n++){var o=i[n],s=o.getName();if(r.length>0&&s===r){var u=o.getOrCreateTarget();if(u)return e.setTarget(u),!0}}t.log("can't link channel "+r+", does not contain a symbolic name that can be linked to TransformElements")}}),i}),n("osgAnimation/Vec3LerpChannel",["osgAnimation/Channel","osgAnimation/Sampler","osgAnimation/Interpolator","osgAnimation/Vec3Target","osg/Vec3"],function(t,e,r,i,n){var a=function(a,o){var s=new e;a||(a=[]),o||(o=new i),t.call(this,s,o),s.setInterpolator(r.Vec3LerpInterpolator),this.setKeyframes(a),this._data.value=n.copy(o.getValue(),[])};return a.prototype=t.prototype,a}),n("osgAnimation/osgAnimation",["osg/Utils","osgAnimation/Animation","osgAnimation/AnimationUpdateCallback","osgAnimation/BasicAnimationManager","osgAnimation/Channel","osgAnimation/Easing","osgAnimation/FloatLerpChannel","osgAnimation/FloatTarget","osgAnimation/Interpolator","osgAnimation/Keyframe","osgAnimation/LinkVisitor","osgAnimation/QuatLerpChannel","osgAnimation/QuatSlerpChannel","osgAnimation/QuatTarget","osgAnimation/Sampler","osgAnimation/StackedQuaternion","osgAnimation/StackedRotateAxis","osgAnimation/StackedTranslate","osgAnimation/Target","osgAnimation/UpdateMatrixTransform","osgAnimation/Vec3LerpChannel","osgAnimation/Vec3Target"],function(t,e,r,i,n,a,o,s,u,h,l,c,d,f,p,g,m,v,_,y,b,x){var S={};return S.Animation=e,S.AnimationUpdateCallback=r,S.BasicAnimationManager=i,S.Channel=n,t.objectMix(S,a),S.FloatLerpChannel=o,S.FloatTarget=s,t.objectMix(S,u),t.objectMix(S,h),S.LinkVisitor=l,S.QuatLerpChannel=c,S.QuatSlerpChannel=d,S.QuatTarget=f,S.Sampler=p,S.StackedQuaternion=g,S.StackedRotateAxis=m,S.StackedTranslate=v,S.Target=_,S.UpdateMatrixTransform=y,S.Vec3LerpChannel=b,S.Vec3Target=x,S}),n("osgWrappers/serializers/osg",["vendors/Q"],function(t){var e={};return e.Object=function(t,e){var r=t.getJSON(),i=function(){return!0};if(i(r)){if(r.Name&&e.setName(r.Name),r.UserDataContainer){var n=t.setJSON(r.UserDataContainer).readUserDataContainer();void 0!==n&&e.setUserData(n)}return e}},e.Node=function(r,i){var n=r.getJSON(),a=function(){return!0};if(a(n)){e.Object(r,i);var o=[],s=function(e){var n=r.setJSON(e).readObject(),a=t.defer();o.push(a.promise),t.when(n).then(function(t){t&&i.addUpdateCallback(t),a.resolve()})};if(n.UpdateCallbacks)for(var u=0,h=n.UpdateCallbacks.length;h>u;u++)s(n.UpdateCallbacks[u]);if(n.StateSet){var l=r.setJSON(n.StateSet).readObject(),c=t.defer();o.push(c.promise),t.when(l).then(function(t){i.setStateSet(t),c.resolve()})}var d=function(e){var n=r.setJSON(e).readObject(),a=t.defer();o.push(a.promise),t.when(n).then(function(t){t&&i.addChild(t),a.resolve(t)})};if(n.Children)for(var f=0,p=n.Children.length;p>f;f++)d(n.Children[f]);var g=t.defer();return t.all(o).then(function(){g.resolve(i)}),g.promise}},e.StateSet=function(r,i){var n=r.getJSON(),a=function(){return!0};if(a(n)){e.Object(r,i),void 0!==n.RenderingHint&&i.setRenderingHint(n.RenderingHint);var o=function(e){var n=r.setJSON(e).readObject(),a=t.defer();s.push(a.promise),t.when(n).then(function(t){void 0!==t&&i.setAttributeAndMode(t),a.resolve()})},s=[];if(void 0!==n.AttributeList)for(var u=0,h=n.AttributeList.length;h>u;u++)o(n.AttributeList[u]);var l=function(e,n){var a=r.setJSON(n).readObject(),o=t.defer();s.push(o.promise),t.when(a).then(function(t){t&&i.setTextureAttributeAndMode(e,t),o.resolve()})};if(n.TextureAttributeList)for(var c=n.TextureAttributeList,d=0,f=c.length;f>d;d++)for(var p=c[d],g=0,m=p.length;m>g;g++)l(d,p[g]);var v=t.defer();return t.all(s).then(function(){v.resolve(i)}),v.promise}},e.Material=function(t,r){var i=t.getJSON(),n=function(t){return void 0!==t.Diffuse&&void 0!==t.Emission&&void 0!==t.Specular&&void 0!==t.Shininess?!0:!1};return n(i)?(e.Object(t,r),r.setAmbient(i.Ambient),r.setDiffuse(i.Diffuse),r.setEmission(i.Emission),r.setSpecular(i.Specular),r.setShininess(i.Shininess),r):void 0},e.BlendFunc=function(t,r){var i=t.getJSON(),n=function(t){return t.SourceRGB&&t.SourceAlpha&&t.DestinationRGB&&t.DestinationAlpha?!0:!1};return n(i)?(e.Object(t,r),r.setSourceRGB(i.SourceRGB),r.setSourceAlpha(i.SourceAlpha),r.setDestinationRGB(i.DestinationRGB),r.setDestinationAlpha(i.DestinationAlpha),r):void 0},e.CullFace=function(t,r){var i=t.getJSON(),n=function(t){return void 0!==t.Mode?!0:!1};return n(i)?(e.Object(t,r),r.setMode(i.Mode),r):void 0},e.BlendColor=function(t,r){var i=t.getJSON(),n=function(t){return void 0!==t.ConstantColor?!0:!1};return n(i)?(e.Object(t,r),r.setConstantColor(i.ConstantColor),r):void 0},e.Light=function(t,r){var i=t.getJSON(),n=function(t){return void 0!==t.LightNum&&void 0!==t.Ambient&&void 0!==t.Diffuse&&void 0!==t.Direction&&void 0!==t.Position&&void 0!==t.Specular&&void 0!==t.SpotCutoff&&void 0!==t.LinearAttenuation&&void 0!==t.ConstantAttenuation&&void 0!==t.QuadraticAttenuation?!0:!1};return n(i)?(e.Object(t,r),r.setAmbient(i.Ambient),r.setConstantAttenuation(i.ConstantAttenuation),r.setDiffuse(i.Diffuse),r.setDirection(i.Direction),r.setLightNumber(i.LightNum),r.setLinearAttenuation(i.LinearAttenuation),r.setPosition(i.Position),r.setQuadraticAttenuation(i.QuadraticAttenuation),r.setSpecular(i.Specular),r.setSpotCutoff(i.SpotCutoff),r.setSpotBlend(.01),void 0!==i.SpotExponent&&r.setSpotBlend(i.SpotExponent/128),r):void 0},e.Texture=function(r,i){var n=r.getJSON(),a=function(){return!0};if(a(n)){e.Object(r,i),void 0!==n.MinFilter&&i.setMinFilter(n.MinFilter),void 0!==n.MagFilter&&i.setMagFilter(n.MagFilter),void 0!==n.WrapT&&i.setWrapT(n.WrapT),void 0!==n.WrapS&&i.setWrapS(n.WrapS);var o=n.File;void 0===o&&(o="no-image-provided");var s=t.defer();return t.when(r.readImageURL(o)).then(function(t){i.setImage(t),s.resolve(i)}),s.promise}},e.Projection=function(t,r){var i=t.getJSON(),n=function(t){return void 0!==t.Matrix?!0:!1};if(n(i)){var a=e.Node(t,r);return void 0!==i.Matrix&&r.setMatrix(i.Matrix),a}},e.MatrixTransform=function(t,r){var i=t.getJSON(),n=function(t){return t.Matrix?!0:!1};if(n(i)){var a=e.Node(t,r);return void 0!==i.Matrix&&r.setMatrix(i.Matrix),a}},e.LightSource=function(r,i){var n=r.getJSON(),a=function(t){return void 0!==t.Light?!0:!1};if(a(n)){var o=t.defer(),s=e.Node(r,i);return t.all([r.setJSON(n.Light).readObject(),s]).then(function(t){var e=t[0];t[1],i.setLight(e),o.resolve(i)}),o.promise}},e.Geometry=function(r,i){var n=r.getJSON(),a=function(t){return void 0!==t.PrimitiveSetList&&void 0!==t.VertexAttributeList?!0:!1};if(a(n)){var o=[];o.push(e.Node(r,i));for(var s=function(e){var n=t.defer();o.push(n.promise);var a=r.setJSON(e).readPrimitiveSet();t.when(a).then(function(t){void 0!==t&&i.getPrimitives().push(t),n.resolve(t)})},u=0,h=n.PrimitiveSetList.length;h>u;u++){var l=n.PrimitiveSetList[u];s(l)}var c=function(e,n){var a=t.defer();o.push(a.promise);var s=r.setJSON(n).readBufferArray();t.when(s).then(function(t){void 0!==t&&(i.getVertexAttributeList()[e]=t),a.resolve(t)})};for(var d in n.VertexAttributeList)n.VertexAttributeList.hasOwnProperty(d)&&c(d,n.VertexAttributeList[d]);var f=t.defer();return t.all(o).then(function(){f.resolve(i)}),f.promise}},e}),n("osgWrappers/serializers/osgAnimation",["osg/Notify","vendors/Q","osgWrappers/serializers/osg"],function(t,e,r){var i={};return i.Animation=function(t,i){var n=t.getJSON(),a=function(t){return t.Name&&t.Channels&&t.Channels.length>0?!0:t.Name?!1:(osg.log("animation has field Name, error"),!1)};if(a(n)&&r.Object(t,i)){for(var o=0,s=n.Channels.length;s>o;o++)e.when(t.setJSON(n.Channels[o]).readObject()).then(function(t){t&&i.getChannels().push(t)});return i}},i.Vec3LerpChannel=function(t,e){var i=t.getJSON(),n=function(t){return t.KeyFrames&&t.TargetName&&t.Name?!0:!1};if(n(i)&&r.Object(t,e)){e.setTargetName(i.TargetName);for(var a=e.getSampler().getKeyframes(),o=0,s=i.KeyFrames.length;s>o;o++){var u=i.KeyFrames[o],h=u.slice(1);h.t=u[0],a.push(h)}return e}},i.QuatLerpChannel=function(t,e){return i.Vec3LerpChannel(t,e)},i.QuatSlerpChannel=function(t,e){return i.Vec3LerpChannel(t,e)},i.FloatLerpChannel=function(t,e){var i=t.getJSON(),n=function(t){return t.KeyFrames&&t.TargetName&&t.Name?!0:!1};if(n(i)&&r.Object(t,e)){e.setTargetName(i.TargetName);for(var a=e.getSampler().getKeyframes(),o=0,s=i.KeyFrames.length;s>o;o++){var u=i.KeyFrames[o],h=u.slice(1);h.t=u[0],a.push(h)}return e}},i.BasicAnimationManager=function(t,e){var r=t.getJSON(),i=function(t){return t.Animations?!0:!1};if(i(r)){for(var n=0,a=r.Animations.length;a>n;n++){var o=r.Animations[n],s=t.setJSON(o).readObject();s&&e.registerAnimation(s)}return e}},i.UpdateMatrixTransform=function(t,e){var i=t.getJSON(),n=function(t){return t.Name&&t.StackedTransforms?!0:!1};if(n(i)&&void 0!==r.Object(t,e)){for(var a=0,o=i.StackedTransforms.length;o>a;a++){var s=i.StackedTransforms[a],u=t.setJSON(s).readObject();u&&e.getStackedTransforms().push(u)}return e}},i.StackedTranslate=function(t,e){var i=t.getJSON(),n=function(t){return t.Name?!0:!1};return n(i)&&r.Object(t,e)?(i.Translate&&e.setTranslate(i.Translate),e):void 0},i.StackedQuaternion=function(t,e){var i=t.getJSON(),n=function(t){return t.Name?!0:!1};return n(i)&&r.Object(t,e)?(i.Quaternion&&e.setQuaternion(i.Quaternion),e):void 0},i.StackedRotateAxis=function(t,e){var i=t.getJSON(),n=function(t){return t.Axis?!0:!1};return n(i)&&r.Object(t,e)?(i.Angle&&e.setAngle(i.Angle),e.setAxis(i.Axis),e):void 0},i}),n("osgDB/osgDB",["osg/Utils","vendors/Q","osgDB/Input","osgDB/ReaderParser","osgWrappers/serializers/osg","osgWrappers/serializers/osgAnimation"],function(t,e,r,i,n,a){var o={};return o.Promise=e,o.Input=r,t.objectMix(o,i),o.ObjectWrapper.serializers.osg=n,o.ObjectWrapper.serializers.osgAnimation=a,o}),n("osgGA/Manipulator",["osg/Matrix"],function(t){var e=function(){this._controllerList={},this._inverseMatrix=new Array(16),t.makeIdentity(this._inverseMatrix)};return e.prototype={update:function(){},getInverseMatrix:function(){return this._inverseMatrix},getControllerList:function(){return this._controllerList}},e}),n("osgGA/OrbitManipulatorLeapMotionController",["osg/Notify","osg/Vec3"],function(t,e){var r=function(t){this._manipulator=t,this.init()},i={rotate:{dtx:-1.44,dty:-1.08,dtz:-.1,delay:.05,method:"getRotateInterpolator"},pan:{dtx:-1.44,dty:-1.08,delay:.05,method:"getPanInterpolator"},zoom:{dtx:0,dty:-.5,delay:.05,method:"getZoomInterpolator"},"zoom-twohands":{dtx:-.05,dty:0,delay:.05,method:"getZoomInterpolator"}};return r.prototype={init:function(){this._virtualCursor=[0,0],this._targetPosition=[0,0],this._previousFrame=void 0,this._displacement=[0,0],this._top=[0,1,0],this._motion=[0,0],this._delay=.05,this._threshold=.08,this._direction_dot_threshold=.5,this._mode="rotate"},update:function(r){if(this._previousFrame||(this._previousFrame=r),0!==r.fingers.length){var n=this._previousFrame.translation(r);if(this._previousFrame=r,0!==r.hands.length&&!(Math.abs(n[0])<this._threshold&&Math.abs(n[1])<this._threshold)){var a=this._mode,o=0;if(r.gestures.length>0)for(var s=0;s<r.gestures.length;s++){var u=r.gestures[s];if("circle"===u.type)return this._manipulator.computeHomePosition(),void 0}if(1===r.hands.length)r.hands[0].fingers.length>=3?(a="zoom",o=r.hands[0].palmPosition[1]/10,o=Math.max(o-4,.01)):a=r.hands[0].fingers.length>1?"pan":"rotate";else if(2===r.hands.length){var h=Math.abs(e.dot(r.hands[0].palmNormal,this._top)),l=Math.abs(e.dot(r.hands[1].palmNormal,this._top));h<this._direction_dot_threshold&&l<this._direction_dot_threshold?a="zoom-twohands":(a=void 0,this.hands_distance_old=void 0)}var c=this._manipulator.getZoomInterpolator();if(void 0!==a){if(a!==this._mode)return t.info("Switch to mode "+a),this._motion[0]=0,this._motion[1]=0,this._mode=a,("zoom"===a||"zoom-twohands"===a)&&c.isReset()&&(c._start=1,c.set(0)),void 0;var d,f,p;d=i[a].dtx,f=i[a].dty,p=i[a].dtz,this._motion[0]+=n[0]*d,this._motion[1]+=n[1]*f;var g=i[a].delay,m=i[a].method;if(this._manipulator[m]().setDelay(g),"zoom"===a)t.log(o),c.setTarget(o);else if("zoom-twohands"===a){var v=e.distance(r.hands[0].palmPosition,r.hands[1].palmPosition);if(void 0!==this.hands_distance_old){var _=d*(v-this.hands_distance_old);o=c._target,o[0]+=_}this.hands_distance_old=v}else"rotate"===a&&(o=c._target[0],o+=n[2]*p,o=Math.max(o,.01),c.setTarget(o)),this._manipulator[m]().addTarget(this._motion[0],this._motion[1]);this._motion[1]=this._motion[0]=0}}}}},r}),n("osgGA/OrbitManipulatorEnums",[],function(){return{ROTATE:0,PAN:1,ZOOM:2}}),n("osgGA/OrbitManipulatorMouseKeyboardController",["osgGA/OrbitManipulatorEnums"],function(t){var e=function(t){this._manipulator=t,this.init()};return e.prototype={init:function(){this.releaseButton(),this._rotateKey=65,this._zoomKey=83,this._panKey=68,this._mode=void 0,this._delay=.15},getMode:function(){return this._mode},setMode:function(t){this._mode=t},setEventProxy:function(t){this._eventProxy=t},setManipulator:function(t){this._manipulator=t},mousemove:function(e){if(this._buttonup!==!0){var r=this._eventProxy.getPositionRelativeToCanvas(e),i=this._manipulator;if(isNaN(r[0])===!1&&isNaN(r[1])===!1){var n=this.getMode();if(n===t.ROTATE)i.getRotateInterpolator().setDelay(this._delay),i.getRotateInterpolator().setTarget(r[0],r[1]);else if(n===t.PAN)i.getPanInterpolator().setTarget(r[0],r[1]);else if(n===t.ZOOM){var a=i.getZoomInterpolator();a.isReset()&&(a._start=r[1],a.set(0));var o=r[1]-a._start;a._start=r[1];var s=a.getTarget()[0];a.setTarget(s-o/20)}}e.preventDefault()}},mousedown:function(e){var r=this._manipulator,i=this.getMode();void 0===i&&(0===e.button?e.shiftKey?this.setMode(t.PAN):e.ctrlKey?this.setMode(t.ZOOM):this.setMode(t.ROTATE):this.setMode(t.PAN)),this.pushButton();var n=this._eventProxy.getPositionRelativeToCanvas(e);i=this.getMode(),i===t.ROTATE?(r.getRotateInterpolator().reset(),r.getRotateInterpolator().set(n[0],n[1])):i===t.PAN?(r.getPanInterpolator().reset(),r.getPanInterpolator().set(n[0],n[1])):i===t.ZOOM&&(r.getZoomInterpolator()._start=n[1],r.getZoomInterpolator().set(0)),e.preventDefault()},mouseup:function(){this.releaseButton(),this.setMode(void 0)},mousewheel:function(t,e){var r=this._manipulator;t.preventDefault();var i=r.getZoomInterpolator().getTarget()[0]-e;r.getZoomInterpolator().setTarget(i)},pushButton:function(){this._buttonup=!1},releaseButton:function(){this._buttonup=!0},keydown:function(e){32===e.keyCode?this._manipulator.computeHomePosition():e.keyCode===this._panKey&&this.getMode()!==t.PAN?(this.setMode(t.PAN),this._manipulator.getPanInterpolator().reset(),this.pushButton(),e.preventDefault()):e.keyCode===this._zoomKey&&this.getMode()!==t.ZOOM?(this.setMode(t.ZOOM),this._manipulator.getZoomInterpolator().reset(),this.pushButton(),e.preventDefault()):e.keyCode===this._rotateKey&&this.getMode()!==t.ROTATE&&(this.setMode(t.ROTATE),this._manipulator.getRotateInterpolator().reset(),this.pushButton(),e.preventDefault())},keyup:function(t){t.keyCode===this._panKey?this.mouseup(t):t.keyCode===this._rotateKey?this.mouseup(t):t.keyCode===this._rotateKey&&this.mouseup(t),this.setMode(void 0)}},e}),n("osgGA/OrbitManipulatorHammerController",["osg/Notify"],function(t){var e=function(t){this._manipulator=t,this.init()};return e.prototype={init:function(){this._panFactorX=.5,this._panFactorY=-this._panFactorX,this._rotateFactorX=.6,this._rotateFactorY=-this._rotateFactorX,this._zoomFactor=5,this._pan=!1,this._delay=.15},setEventProxy:function(e){if(void 0!==e&&(void 0===e||e!==this._eventProxy)){this._eventProxy=e;var r=this,i=e,n=function(t){return void 0!==t.touches?t.touches.length:1},a=function(t){return"touches "+n(t)+" distance "+t.distance+" x "+t.deltaX+" y "+t.deltaY};i.on("dragstart",function(e){var i=r._manipulator;if(i&&!r._transformStarted){var o=e.gesture;2===n(o)&&(r._pan=!0),r._dragStarted=!0,r._pan?(i.getPanInterpolator().reset(),i.getPanInterpolator().set(o.center.pageX*r._panFactorX,o.center.pageY*r._panFactorY)):(i.getRotateInterpolator().reset(),i.getRotateInterpolator().set(o.center.pageX*r._rotateFactorX,o.center.pageY*r._rotateFactorY)),t.debug("drag start, "+a(o))}}),i.on("drag",function(e){var i=r._manipulator;if(i&&r._dragStarted){if(r._transformStarted)return r._dragStarted=!1,void 0;var o=e.gesture;if(r._pan){if(2!==n(o))return;i.getPanInterpolator().setTarget(o.center.pageX*r._panFactorX,o.center.pageY*r._panFactorY),t.debug("pad, "+a(o))}else i.getRotateInterpolator().setDelay(r._delay),i.getRotateInterpolator().setTarget(o.center.pageX*r._rotateFactorX,o.center.pageY*r._rotateFactorY),t.debug("rotate, "+a(o))}}),i.on("dragend",function(e){var i=r._manipulator;if(i&&r._dragStarted){r._dragStarted=!1;var n=e.gesture;r._pan=!1,t.debug("drag end, "+a(n))}});var o;i.on("transformstart",function(e){var n=r._manipulator;if(n){r._transformStarted=!0;var a=e.gesture;o=a.scale;var s=a.scale;n.getZoomInterpolator().reset(),n.getZoomInterpolator().set(a.scale),t.debug("transform start "+a.scale+" "+s),e.preventDefault(),i.options.drag=!1}}),i.on("transformend",function(e){r._transformStarted=!1,t.debug("transform end "+e.gesture.scale),i.options.drag=!0}),i.on("transform",function(e){var i=r._manipulator;if(i&&r._transformStarted){var n=e.gesture,a=(n.scale-o)*r._zoomFactor;o=n.scale;var s=i.getZoomInterpolator().getTarget()[0];i.getZoomInterpolator().setTarget(s-a),t.debug("transform "+n.scale+" "+(s-a))}})}},setManipulator:function(t){this._manipulator=t}},e}),n("osgGA/OrbitManipulatorGamePadController",[],function(){var t=function(t){this._manipulator=t,this.init()};return t.prototype={init:function(){this._delay=.15,this._threshold=.08,this._mode=0,this._padFactor=10,this._zoomFactor=.5,this._rotateFactor=5},addPan:function(t,e,r){t.setDelay(this._delay),t.addTarget(e*this._padFactor,r*this._padFactor)},addZoom:function(t,e){t.setDelay(this._delay),t.addTarget(e*this._zoomFactor)},addRotate:function(t,e,r){t.setDelay(this._delay),rotateTarget=t.getTarget(),t.addTarget(e*this._rotateFactor,r*this._rotateFactor)},gamepadaxes:function(t){var e=.005,r=this._manipulator.getRotateInterpolator(),i=this._manipulator.getZoomInterpolator(),n=this._manipulator.getPanInterpolator();4==t.length?((Math.abs(t[0])>e||Math.abs(t[1])>e)&&this.addRotate(r,-t[0],t[1]),Math.abs(t[3])>e&&this.addZoom(i,-t[3])):t.length>=5&&((Math.abs(t[0])>e||Math.abs(t[1])>e)&&this.addPan(n,-t[0],t[1]),Math.abs(t[2])>e&&this.addZoom(i,-t[2]),(Math.abs(t[3])>e||Math.abs(t[4])>e)&&this.addRotate(r,t[4],t[3]))},gamepadbuttondown:function(t){if(t.button>=12&&t.button<=15){var e=this._manipulator.getPanInterpolator(),r=e.getTarget(),i={12:[0,-1],13:[0,1],14:[-1,0],15:[1,0]}[t.button];e.setDelay(this._delay),e.setTarget(r[0]-10*i[0],r[1]+10*i[1])}},update:function(t){if(t){var e=t.getGamePad(),r=e.axes,i=e.buttons;this.gamepadaxes(r);for(var n=function(){},a=0;a<i.length;a++)i[a]&&this.gamepadbuttondown({preventDefault:n,gamepad:e,button:a},!!i[a])}}},t}),n("osgGA/OrbitManipulator",["osg/Utils","osg/Vec3","osg/Matrix","osgGA/Manipulator","osgGA/OrbitManipulatorLeapMotionController","osgGA/OrbitManipulatorMouseKeyboardController","osgGA/OrbitManipulatorHammerController","osgGA/OrbitManipulatorGamePadController"],function(t,e,r,i,n,a,o,s){var u=function(){i.call(this),this._tmpInverse=r.makeIdentity([]),this._tmpHomePosition=e.init([]),this.init()};return u.Interpolator=function(t,e){this._current=new Array(t),this._target=new Array(t),this._delta=new Array(t),this._delay=void 0!==e?e:.15,this._reset=!1,this.reset()},u.Interpolator.prototype={setDelay:function(t){this._delay=t},reset:function(){for(var t=0,e=this._current.length;e>t;t++)this._current[t]=this._target[t]=0;this._reset=!0},update:function(){for(var t=0,e=this._current.length;e>t;t++){var r=(this._target[t]-this._current[t])*this._delay;this._delta[t]=r,this._current[t]+=r}return this._delta},set:function(){for(var t=0,e=this._current.length;e>t;t++)this._current[t]=this._target[t]=arguments[t];this._reset=!1},isReset:function(){return this._reset},getCurrent:function(){return this._current},setTarget:function(){for(var t=0,e=this._target.length;e>t;t++)this._target[t]=this._reset?this._current[t]=arguments[t]:arguments[t];this._reset=!1},addTarget:function(){for(var t=0;t<arguments.length;t++)this._target[t]+=arguments[t]},getTarget:function(){return this._target},getDelta:function(){return this._delta}},u.AvailableControllerList=["StandardMouseKeyboard","LeapMotion","GamePad","Hammer"],u.ControllerList=["StandardMouseKeyboard","LeapMotion","GamePad","Hammer"],u.prototype=t.objectInehrit(i.prototype,{init:function(){this._distance=25,this._target=new Array(3),e.init(this._target),this._rotation=r.mult(r.makeRotate(Math.PI,0,0,1,[]),r.makeRotate(-Math.PI/10,1,0,0,[]),[]),this._time=0,this._rotate=new u.Interpolator(2),this._pan=new u.Interpolator(2),this._zoom=new u.Interpolator(1),this._zoom.reset=function(){u.Interpolator.prototype.reset.call(this),this._start=0},this._buttonup=!0,this._scale=10,this._maxDistance=0,this._minDistance=0,this._scaleMouseMotion=1,this._inverseMatrix=new Array(16),this._rotateKey=65,this._zoomKey=83,this._panKey=68;var t=this;u.ControllerList.forEach(function(e){void 0!==u[e]&&(t._controllerList[e]=new u[e](t))})},reset:function(){this.init()},setNode:function(t){this._node=t},setTarget:function(t){e.copy(t,this._target);var r=new Array(3);this.getEyePosition(r),this._distance=e.distance(r,t)},setEyePosition:function(t){var r=this._rotation,i=this._target,n=[0,0,1],a=e.sub(t,i,[]);e.normalize(a,a);var o=e.cross(a,n,[]);e.normalize(o,o);var s=e.cross(o,a,[]);e.normalize(s,s),r[0]=o[0],r[1]=a[0],r[2]=s[0],r[3]=0,r[4]=o[1],r[5]=a[1],r[6]=s[1],r[7]=0,r[8]=o[2],r[9]=a[2],r[10]=s[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this._distance=e.distance(t,i)},computeHomePosition:function(){if(void 0!==this._node){var t=this._node.getBound();this.setDistance(1.5*t.radius()),this.setTarget(t.center())}},getHomePosition:function(){var t=this._tmpHomePosition;if(void 0!==this._node){var e=this._node.getBound(),r=1.5*e.radius(),i=e.center();this.computeEyePosition(i,r,t)}return t},setMaxDistance:function(t){this._maxDistance=t},setMinDistance:function(t){this._minDistance=t},setDistance:function(t){this._distance=t},getDistance:function(){return this._distance},computePan:function(t,i){i*=this._distance,t*=this._distance;var n=new Array(16),a=new Array(3),o=new Array(3);r.inverse(this._rotation,n),a[0]=r.get(n,0,0),a[1]=r.get(n,0,1),a[2]=r.get(n,0,2),e.normalize(a,a),o[0]=r.get(n,2,0),o[1]=r.get(n,2,1),o[2]=r.get(n,2,2),e.normalize(o,o),e.mult(a,-t,a),e.mult(o,i,o),e.add(this._target,a,this._target),e.add(this._target,o,this._target)},computeRotation:function(t,i){var n=r.makeRotate(t/10,0,0,1,[]),a=r.mult(this._rotation,n,[]);n=r.makeRotate(i/10,1,0,0,[]);var o=r.mult(n,a,[]),s=[];r.inverse(o,s);var u=r.transformVec3(s,[0,this._distance,0],new Array(3)),h=e.neg(u,[]);e.normalize(h,h);var l=e.dot(h,[0,0,1]);return Math.abs(l)>.95?(this._rotation=a,void 0):(this._rotation=o,void 0)},computeZoom:function(t){this.zoom(t)},zoom:function(t){var e=this._distance*t;this._minDistance>0&&e<this._minDistance&&(e=this._minDistance),this._maxDistance>0&&e>this._maxDistance&&(e=this._maxDistance),this._distance=e},getRotateInterpolator:function(){return this._rotate},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getTarget:function(t){return e.copy(this._target,t),t},getEyePosition:function(t){this.computeEyePosition(this._target,this._distance,t)},computeEyePosition:function(t,i,n){var a=this._tmpInverse;r.inverse(this._rotation,this._tmpInverse),r.transformVec3(a,[0,i,0],n),e.add(t,n,n)},update:function(t){var i=t.getFrameStamp().getSimulationTime();void 0===this._lastUpdate&&(this._lastUpdate=i),i-this._lastUpdate,this._lastUpdate=i;var n,a=.1;n=this._rotate.update(),this.computeRotation(-n[0]*a*this._scaleMouseMotion,-n[1]*a*this._scaleMouseMotion);var o=.002;n=this._pan.update(),this.computePan(-n[0]*o,-n[1]*o),n=this._zoom.update(),this.computeZoom(1+n[0]/10);var s=this._target,u=this._distance,h=new Array(3);r.inverse(this._rotation,this._inverseMatrix),r.transformVec3(this._inverseMatrix,[0,u,0],h),r.makeLookAt(e.add(s,h,h),s,[0,0,1],this._inverseMatrix)},getInverseMatrix:function(){return this._inverseMatrix}}),function(t){t.LeapMotion=n}(u),function(t){t.StandardMouseKeyboard=a}(u),function(t){t.Hammer=o}(u),function(t){t.GamePad=s}(u),u}),n("osgGA/FirstPersonManipulatorMouseKeyboardController",[],function(){var t=function(t){this._manipulator=t,this.init()};return t.prototype={init:function(){this.releaseButton(),this._delay=.15,this._stepFactor=1},setEventProxy:function(t){this._eventProxy=t},setManipulator:function(t){this._manipulator=t,this._manipulator.setStepFactor(this._stepFactor)},pushButton:function(){this._buttonup=!1},releaseButton:function(){this._buttonup=!0},mousedown:function(t){var e=this._eventProxy.getPositionRelativeToCanvas(t),r=this._manipulator;r.getLookPositionInterpolator().set(e[0],e[1]),this.pushButton()},mouseup:function(){this.releaseButton()},mousemove:function(t){if(this._buttonup!==!0){var e=this._eventProxy.getPositionRelativeToCanvas(t);this._manipulator.getLookPositionInterpolator().setDelay(this._delay),this._manipulator.getLookPositionInterpolator().setTarget(e[0],e[1])}},mousewheel:function(t,e){t.preventDefault(),this._stepFactor=Math.min(Math.max(.001,this._stepFactor+.01*e),4),this._manipulator.setStepFactor(this._stepFactor)},keydown:function(t){var e=this._manipulator;if(32===t.keyCode)e.computeHomePosition();else{if(87===t.keyCode||90===t.keyCode||38===t.keyCode)return e.getFowardInterpolator().setDelay(this._delay),e.getFowardInterpolator().setTarget(1),!1;if(83===t.keyCode||40===t.keyCode)return e.getFowardInterpolator().setDelay(this._delay),e.getFowardInterpolator().setTarget(-1),!1;if(68===t.keyCode||39===t.keyCode)return e.getSideInterpolator().setDelay(this._delay),e.getSideInterpolator().setTarget(1),!1;if(65===t.keyCode||81===t.keyCode||37===t.keyCode)return e.getSideInterpolator().setDelay(this._delay),e.getSideInterpolator().setTarget(-1),!1}},keyup:function(t){var e=this._manipulator;return 87===t.keyCode||90===t.keyCode||38===t.keyCode||83==t.keyCode||40===t.keyCode?(e.getFowardInterpolator().setDelay(this._delay),e.getFowardInterpolator().setTarget(0),!1):68==t.keyCode||39===t.keyCode||65===t.keyCode||81===t.keyCode||37===t.keyCode?(e.getSideInterpolator().setDelay(this._delay),e.getSideInterpolator().setTarget(0),!1):void 0}},t}),n("osgGA/FirstPersonManipulator",["osg/Utils","osgGA/Manipulator","osgGA/OrbitManipulator","osg/Matrix","osg/Vec2","osg/Vec3","osgGA/FirstPersonManipulatorMouseKeyboardController"],function(t,e,r,i,n,a,o){var s=function(){e.call(this),this.init()};return s.AvailableControllerList=["StandardMouseKeyboard"],s.ControllerList=["StandardMouseKeyboard"],s.prototype=t.objectInehrit(e.prototype,{setNode:function(t){this._node=t,this.computeHomePosition()},computeHomePosition:function(){if(void 0!==this._node){var t=this._node.getBound();this._radius=t.radius(),this._eye=[0,1.5*-t.radius(),0]}},init:function(){this._direction=[0,1,0],this._eye=[0,25,10],this._up=[0,0,1],this._radius=1,this._forward=new r.Interpolator(1),this._side=new r.Interpolator(1),this._lookPosition=new r.Interpolator(2),this._stepFactor=1,this._target=new Array(3),a.init(this._target),this._angleVertical=0,this._angleHorizontal=0,this._tmpComputeRotation1=i.makeIdentity([]),this._tmpComputeRotation2=i.makeIdentity([]),this._tmpComputeRotation3=i.makeIdentity([]),this._tmpGetTargetDir=a.init([]);var t=this;this._controllerList={},s.ControllerList.forEach(function(e){void 0!==s[e]&&(t._controllerList[e]=new s[e](t))})},getEyePosition:function(t){return t[0]=this._eye[0],t[1]=this._eye[1],t[2]=this._eye[2],t},setEyePosition:function(t){return this._eye[0]=t[0],this._eye[1]=t[1],this._eye[2]=t[2],this},getTarget:function(t,e){void 0===e&&(e=25);var r=a.mult(this._direction,e,this._tmpGetTargetDir);a.add(this._eye,r,t)},setTarget:function(t){this._target[0]=t[0],this._target[1]=t[1],this._target[2]=t[2];var e=this._tmpGetTargetDir;a.sub(t,this._eye,e),e[2]=0,a.normalize(e,e),this._angleHorizontal=Math.acos(e[1]),e[0]<0&&(this._angleHorizontal=-this._angleHorizontal),a.sub(t,this._eye,e),a.normalize(e,e),this._angleVertical=-Math.asin(e[2]),a.copy(e,this._direction)},getLookPositionInterpolator:function(){return this._lookPosition},getSideInterpolator:function(){return this._side},getFowardInterpolator:function(){return this._forward},computeRotation:function(t,e){this._angleVertical+=.01*e,this._angleHorizontal-=.01*t;var r=this._tmpComputeRotation1,n=this._tmpComputeRotation2,o=this._tmpComputeRotation3;i.makeRotate(this._angleVertical,1,0,0,r),i.makeRotate(this._angleHorizontal,0,0,1,n),i.mult(n,r,o),this._direction=i.transformVec3(o,[0,1,0],this._direction),a.normalize(this._direction,this._direction),this._up=i.transformVec3(o,[0,0,1],this._up)},reset:function(){this.init()},setStepFactor:function(t){this._stepFactor=t},update:function(t){var e=t.getFrameStamp().getSimulationTime();void 0===this._lastUpdate&&(this._lastUpdate=e);var r=e-this._lastUpdate;this._lastUpdate=e,this._forward.update(),this._side.update();var o=this._lookPosition.update();this.computeRotation(.5*-o[0],.5*-o[1]);var s=new Array(2);s[0]=this._forward.getCurrent()[0],s[1]=this._side.getCurrent()[0],n.length(s)>1&&n.normalize(s,s);var u=this._radius;this._radius<.001&&(u=1),this.moveForward(s[0]*u*this._stepFactor*r),this.strafe(s[1]*u*this._stepFactor*r);var h=a.add(this._eye,this._direction,[]);this._target=h,i.makeLookAt(this._eye,h,this._up,this._inverseMatrix)},getInverseMatrix:function(){return this._inverseMatrix},moveForward:function(t){var e=a.mult(a.normalize(this._direction,[]),t,[]);this._eye=a.add(this._eye,e,[])},strafe:function(t){var e=a.cross(this._direction,this._up,[]),r=a.mult(a.normalize(e,e),t,[]);this._eye=a.add(this._eye,r,[])}}),function(t){t.StandardMouseKeyboard=o}(s),s}),n("osgGA/SwitchManipulator",["osg/Notify"],function(t){var e=function(){this._manipulatorList=[],this._currentManipulator=void 0};return e.prototype={update:function(t){var e=this.getCurrentManipulator();return void 0!==e?e.update(t):void 0},setNode:function(e){var r=this.getCurrentManipulator();return void 0===r.setNode?(t.log("manipulator has not setNode method"),void 0):(r.setNode(e),void 0)},getControllerList:function(){return this.getCurrentManipulator().getControllerList()},getNumManipulator:function(){return this._manipulatorList.length},addManipulator:function(t){this._manipulatorList.push(t),void 0===this._currentManipulator&&this.setManipulatorIndex(0)},getManipulatorList:function(){return this._manipulatorList},setManipulatorIndex:function(t){this._currentManipulator=t},getCurrentManipulatorIndex:function(){return this._currentManipulator},getCurrentManipulator:function(){var t=this._manipulatorList[this._currentManipulator];return t},reset:function(){this.getCurrentManipulator().reset()},computeHomePosition:function(){var t=this.getCurrentManipulator();void 0!==t&&t.computeHomePosition()},getInverseMatrix:function(){var t=this.getCurrentManipulator();return void 0!==t?t.getInverseMatrix():void 0}},e}),n("osgGA/osgGA",["osgGA/FirstPersonManipulator","osgGA/FirstPersonManipulatorMouseKeyboardController","osgGA/Manipulator","osgGA/OrbitManipulator","osgGA/OrbitManipulatorGamePadController","osgGA/OrbitManipulatorHammerController","osgGA/OrbitManipulatorLeapMotionController","osgGA/OrbitManipulatorMouseKeyboardController","osgGA/SwitchManipulator","osgGA/OrbitManipulatorEnums"],function(t,e,r,i,n,a,o,s,u,h){var l={};return l.FirstPersonManipulator=t,l.getFirstPersonStandardMouseKeyboardControllerClass=function(){return e},l.Manipulator=r,l.OrbitManipulator=i,l.getOrbitManipulatorGamePadController=function(){return n
},l.getOrbitManipulatorHammerController=function(){return a},l.getOrbitManipulatorLeapMotionController=function(){return o},l.getOrbitManipulatorMouseKeyboardController=function(){return s},l.SwitchManipulator=u,l.OrbitManipulator.Rotate=h.ROTATE,l.OrbitManipulator.Pan=h.PAN,l.OrbitManipulator.Zoom=h.ZOOM,l}),n("osgUtil/Composer",["osg/Notify","osg/Utils","osg/Node","osg/Depth","osg/Texture","osg/Camera","osg/FrameBufferObject","osg/Viewport","osg/Matrix","osg/Uniform","osg/StateSet","osg/Program","osg/Shader","osg/Texture","osg/Shape","osg/TransformEnums"],function(t,e,r,i,n,a,o,s,u,h,l,c,d,n,f,p){var g=function(){r.call(this),this._stack=[],this._renderToScreen=!1,this._dirty=!1;var t=function(){};t.prototype={update:function(t){t.isDirty()&&t.build()}},this.setUpdateCallback(new t),this.getOrCreateStateSet().setAttributeAndModes(new i("DISABLE"))};return g.prototype=e.objectInehrit(r.prototype,{dirty:function(){for(var t=0,e=this._stack.length;e>t;t++)this._stack[t].filter.dirty()},addPass:function(t,e,r){e instanceof n?this._stack.push({filter:t,texture:e}):void 0!==e&&void 0!==r?this._stack.push({filter:t,width:Math.floor(e),height:Math.floor(r)}):this._stack.push({filter:t})},renderToScreen:function(t,e){this._renderToScreen=!0,this._renderToScreenWidth=t,this._renderToScreenHeight=e},isDirty:function(){for(var t=0,e=this._stack.length;e>t;t++)if(this._stack[t].filter.isDirty())return!0;return!1},build:function(){var e=this;this.removeChildren();var r,i=this;this._stack.forEach(function(l,c,d){l.filter.isDirty()&&l.filter.build();var g,m,v=l.filter.getStateSet();if(void 0!==l.texture)g=l.texture.getWidth(),m=l.texture.getHeight();else if(void 0!==l.width&&void 0!==l.height)g=l.width,m=l.height;else{var _=v.getTextureAttribute(0,"Texture");void 0===_&&t.warn("Composer can't find any information to setup texture output size"),g=_.getWidth(),m=_.getHeight()}var y=c===d.length-1&&i._renderToScreen===!0;if(!y&&void 0===v.getAttribute("Program"))return d[c+1].filter.getStateSet().setTextureAttributeAndModes(0,v.getTextureAttribute(0,"Texture")),void 0;var b=new a;b.setClearMask(0);var x,S;y===!0?(g=i._renderToScreenWidth,m=i._renderToScreenHeight):(b.setRenderOrder(a.PRE_RENDER,0),x=l.texture,void 0===x&&(x=new n,x.setTextureSize(g,m)),b.attachTexture(o.COLOR_ATTACHMENT0,x,0));var M=new s(0,0,g,m),A=u.makeOrtho(-g/2,g/2,-m/2,m/2,-5,5,[]);b.setReferenceFrame(p.ABSOLUTE_RF),b.setViewport(M),b.setProjectionMatrix(A),b.setStateSet(l.filter.getStateSet()),S=f.createTexturedQuadGeometry(-g/2,-m/2,0,g,0,0,0,m,0),void 0!==l.filter.buildGeometry&&(S=l.filter.buildGeometry(S)),S.setName("composer layer"),r=x,c+1<d.length&&d[c+1].filter.getStateSet().setTextureAttributeAndModes(0,r),b.addChild(S),l.filter.getStateSet().addUniform(h.createFloat2([g,m],"RenderSize")),b.setName("Composer Pass"+c),e.addChild(b)}),this._resultTexture=r}}),g.Filter=function(){this._stateSet=new l,this._dirty=!0},g.Filter.prototype={getStateSet:function(){return this._stateSet},getOrCreateStateSet:function(){return this._stateSet},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty}},g.Filter.defaultVertexShader=["#ifdef GL_ES","precision highp float;","#endif","attribute vec3 Vertex;","attribute vec2 TexCoord0;","varying vec2 FragTexCoord0;","uniform mat4 ModelViewMatrix;","uniform mat4 ProjectionMatrix;","void main(void) {","  gl_Position = ProjectionMatrix * ModelViewMatrix * vec4(Vertex,1.0);","  FragTexCoord0 = TexCoord0;","}",""].join("\n"),g.Filter.defaultFragmentShaderHeader=["#ifdef GL_ES","precision highp float;","#endif","varying vec2 FragTexCoord0;","uniform vec2 RenderSize;","uniform sampler2D Texture0;",""].join("\n"),g.Filter.shaderUtils=["vec4 packFloatTo4x8(in float v) {","vec4 enc = vec4(1.0, 255.0, 65025.0, 160581375.0) * v;","enc = fract(enc);","enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);","return enc;","}"," ","vec4 pack2FloatTo4x8(in vec2 val) {"," const vec2 bitSh = vec2(256.0, 1.0);"," const vec2 bitMsk = vec2(0.0, 1.0/256.0);"," vec2 res1 = fract(val.x * bitSh);"," res1 -= res1.xx * bitMsk;"," vec2 res2 = fract(val.y * bitSh);"," res2 -= res2.xx * bitMsk;"," return vec4(res1.x,res1.y,res2.x,res2.y);","}"," ","float unpack4x8ToFloat( vec4 rgba ) {"," return dot( rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/160581375.0) );","}"," ","vec2 unpack4x8To2Float(in vec4 val) {"," const vec2 unshift = vec2(1.0/256.0, 1.0);"," return vec2(dot(val.xy, unshift), dot(val.zw, unshift));","}","vec2 encodeNormal (vec3 n)","{","    float f = sqrt(8.0*n.z+8.0);","    return n.xy / f + 0.5;","}","vec3 decodeNormal (vec2 enc)","{","    vec2 fenc = enc*4.0-2.0;","    float f = dot(fenc,fenc);","    float g = sqrt(1.0-f/4.0);","    vec3 n;","    n.xy = fenc*g;","    n.z = 1.0-f/2.0;","    return n;","}",""].join("\n"),g.Filter.Helper={getOrCreatePascalCoefficients:function(){var t=g.Filter.Helper.getOrCreatePascalCoefficients.cache;return void 0!==t?t:(t=function(t){for(var e=[[1]],r=0;t-1>r;r++){Math.pow(2,r);var i=e[r],n=i.length,a=n+1,o=new Array(n);o[0]=1,o[a-1]=1;for(var s=1,u=0;n-1>u;u++){var h=i[u]+i[u+1];o[s++]=h}e.push(o)}return function(){for(var t=0;t<e.length;t++)for(var r=e[t],i=Math.pow(2,t),n=0;n<r.length;n++)r[n]=r[n]/i}(),e}(20),g.Filter.Helper.getOrCreatePascalCoefficients.cache=t,t)}},g.Filter.Custom=function(t,e){g.Filter.call(this),this._fragmentShader=t,this._uniforms=e,this._vertexShader=g.Filter.defaultVertexShader},g.Filter.Custom.prototype=e.objectInehrit(g.Filter.prototype,{build:function(){var t=new c(new d("VERTEX_SHADER",this._vertexShader),new d("FRAGMENT_SHADER",this._fragmentShader));if(this._uniforms){var e=0,r=this._fragmentShader.match(/uniform\s+\w+\s+\w+/g);if(null!==r)for(var i=0,n=r.length;n>i;i++){var a,o=r[i].match(/uniform\s+(\w+)\s+(\w+)/),s=o[1],u=o[2];void 0!==this._uniforms[u]&&(uniform_value=this._uniforms[u],-1!==s.search("sampler")?(this._stateSet.setTextureAttributeAndModes(e,uniform_value),a=h.createInt1(e,u),e++,this._stateSet.addUniform(a)):(a=h.isUniform(uniform_value)?uniform_value:h[s](this._uniforms[u],u),this._stateSet.addUniform(a)))}}this._stateSet.setAttributeAndModes(t),this._dirty=!1}}),g.Filter.AverageHBlur=function(t){g.Filter.call(this),void 0===t?this.setBlurSize(5):this.setBlurSize(t),this._pixelSize=1},g.Filter.AverageHBlur.prototype=e.objectInehrit(g.Filter.prototype,{setBlurSize:function(t){1!==t%2&&(t+=1),this._nbSamples=t,this.dirty()},setPixelSize:function(t){this._pixelSize=t,this.dirty()},getUVOffset:function(t){return"vec2(float("+t+"), 0.0)/RenderSize[0];"},getShaderBlurKernel:function(){var t=this._nbSamples,e=[];e.push(" pixel = texture2D(Texture0, FragTexCoord0 );"),e.push(" if (pixel.w == 0.0) { gl_FragColor = pixel; return; }"),e.push(" vec2 offset;");for(var r=1;r<Math.ceil(t/2);r++)e.push(" offset = "+this.getUVOffset(r*this._pixelSize)),e.push(" pixel += texture2D(Texture0, FragTexCoord0 + offset);"),e.push(" pixel += texture2D(Texture0, FragTexCoord0 - offset);");return e.push(" pixel /= float("+t+");"),e},build:function(){this._nbSamples;var t=g.Filter.defaultVertexShader,e=[g.Filter.defaultFragmentShaderHeader,"uniform float width;","void main (void)","{","  vec4 pixel;",this.getShaderBlurKernel().join("\n"),"  gl_FragColor = vec4(pixel);","}",""].join("\n"),r=new c(new d("VERTEX_SHADER",t),new d("FRAGMENT_SHADER",e));void 0===this._stateSet.getUniform("Texture0")&&this._stateSet.addUniform(h.createInt1(0,"Texture0")),this._stateSet.setAttributeAndModes(r),this._dirty=!1}}),g.Filter.AverageVBlur=function(t){g.Filter.AverageHBlur.call(this,t)},g.Filter.AverageVBlur.prototype=e.objectInehrit(g.Filter.AverageHBlur.prototype,{getUVOffset:function(t){return"vec2(0.0, float("+t+"))/RenderSize[1];"}}),g.Filter.BilateralHBlur=function(t){g.Filter.call(this),void 0===t&&(t={});var e=t.nbSamples,r=t.depthTexture,i=t.radius;void 0===e?this.setBlurSize(5):this.setBlurSize(e),this._depthTexture=r,this._radius=h.createFloat(1,"radius"),this._pixelSize=h.createFloat(1,"pixelSize"),this.setRadius(i)},g.Filter.BilateralHBlur.prototype=e.objectInehrit(g.Filter.prototype,{setBlurSize:function(t){1!==t%2&&(t+=1),this._nbSamples=t,this.dirty()},setPixelSize:function(t){this._pixelSize.get()[0]=t,this._pixelSize.dirty()},setRadius:function(t){this._radius.get()[0]=t,this._radius.dirty()},getUVOffset:function(t){return"vec2(0.0, float("+t+") * pixelSize )/RenderSize[1];"},getShaderBlurKernel:function(){var t=this._nbSamples,e=[];e.push(" pixel = texture2D(Texture0, FragTexCoord0 );"),e.push(" if (pixel.w <= 0.0001) { gl_FragColor = vec4(1.0); return; }"),e.push(" vec2 offset, tmpUV;"),e.push(" depth = getDepthValue(texture2D(Texture1, FragTexCoord0 ));");for(var r=1;r<Math.ceil(t/2);r++)e.push(" offset = "+this.getUVOffset(r)),e.push(" tmpUV =  FragTexCoord0 + offset;"),e.push(" tmpDepth = getDepthValue(texture2D(Texture1, tmpUV ));"),e.push(" if ( abs(depth-tmpDepth) < radius) {"),e.push("   pixel += texture2D(Texture0, tmpUV);"),e.push("   nbHits += 1.0;"),e.push(" }"),e.push(" tmpUV =  FragTexCoord0 - offset;"),e.push(" tmpDepth = getDepthValue(texture2D(Texture1, tmpUV ));"),e.push(" if ( abs(depth-tmpDepth) < radius) {"),e.push("   pixel += texture2D(Texture0, tmpUV);"),e.push("   nbHits += 1.0;"),e.push(" }");return e.push(" pixel /= nbHits;"),e},build:function(){this._nbSamples;var t=g.Filter.defaultVertexShader,e=[g.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform float width;","uniform mat4 projection;","uniform float radius;","uniform float pixelSize;","float znear,zfar,zrange;","",g.Filter.shaderUtils,"","float getDepthValue(vec4 v) {","  float depth = unpack4x8ToFloat(v);","  depth = depth*zrange+znear;","  return -depth;","}","void main (void)","{","  vec4 pixel;","  float depth, tmpDepth;","  znear = projection[3][2] / (projection[2][2]-1.0);","  zfar = projection[3][2] / (projection[2][2]+1.0);","  zrange = zfar-znear;","  float nbHits = 1.0;",this.getShaderBlurKernel().join("\n"),"  gl_FragColor = vec4(pixel);","}",""].join("\n"),r=new c(new d("VERTEX_SHADER",t),new d("FRAGMENT_SHADER",e));void 0===this._stateSet.getUniform("Texture0")&&this._stateSet.addUniform(h.createInt1(0,"Texture0")),void 0===this._stateSet.getUniform("Texture1")&&this._stateSet.addUniform(h.createInt1(1,"Texture1")),this._stateSet.addUniform(this._radius),this._stateSet.addUniform(this._pixelSize),this._stateSet.setTextureAttributeAndModes(1,this._depthTexture),this._stateSet.setAttributeAndModes(r),this._dirty=!1}}),g.Filter.BilateralVBlur=function(t){g.Filter.BilateralHBlur.call(this,t)},g.Filter.BilateralVBlur.prototype=e.objectInehrit(g.Filter.BilateralHBlur.prototype,{getUVOffset:function(t){return"vec2(float("+t+")*pixelSize,0.0)/RenderSize[0];"}}),g.Filter.InputTexture=function(t){g.Filter.call(this),this._stateSet.setTextureAttributeAndModes(0,t)},g.Filter.InputTexture.prototype=e.objectInehrit(g.Filter.prototype,{build:function(){this._dirty=!1}}),g.Filter.HBlur=function(t){g.Filter.call(this),void 0===t?this.setBlurSize(5):this.setBlurSize(t)},g.Filter.HBlur.prototype=e.objectInehrit(g.Filter.prototype,{setBlurSize:function(t){1!==t%2&&(t+=1),this._nbSamples=t,this.dirty()},getUVOffset:function(t){return"vec2(float("+t+"), 0.0)/RenderSize[0];"},build:function(){var t=this._nbSamples,e=g.Filter.defaultVertexShader,r=g.Filter.Helper.getOrCreatePascalCoefficients(),i=r[t-1],n=Math.floor(t/2),a=[];a.push(" pixel += float("+i[n]+")*texture2D(Texture0, FragTexCoord0 ).rgb;");var o=1;a.push(" vec2 offset;");for(var s=n+1;t>s;s++){var u=i[s];a.push(" offset = "+this.getUVOffset(s)),o++,a.push(" pixel += "+u+"*texture2D(Texture0, FragTexCoord0 + offset).rgb;"),a.push(" pixel += "+u+"*texture2D(Texture0, FragTexCoord0 - offset).rgb;")}var l=[g.Filter.defaultFragmentShaderHeader,"uniform float width;","void main (void)","{","  vec3 pixel;",a.join("\n"),"  gl_FragColor = vec4(pixel,1.0);","}",""].join("\n"),f=new c(new d("VERTEX_SHADER",e),new d("FRAGMENT_SHADER",l));void 0===this._stateSet.getUniform("Texture0")&&this._stateSet.addUniform(h.createInt1(0,"Texture0")),this._stateSet.setAttributeAndModes(f),this._dirty=!1}}),g.Filter.VBlur=function(){g.Filter.HBlur.call(this)},g.Filter.VBlur.prototype=e.objectInehrit(g.Filter.HBlur.prototype,{getUVOffset:function(t){return"vec2(0.0, float("+t+"))/RenderSize[1];"}}),g.Filter.SobelFilter=function(){g.Filter.call(this),this._color=h.createFloat3([1,1,1],"color"),this._factor=h.createFloat(1,"factor")},g.Filter.SobelFilter.prototype=e.objectInehrit(g.Filter.prototype,{setColor:function(t){this._color.get()[0]=t[0],this._color.get()[1]=t[1],this._color.get()[2]=t[2],this._color.dirty()},setFactor:function(t){this._factor.get()[0]=t,this._factor.dirty()},build:function(){var t=this._stateSet,e=g.Filter.defaultVertexShader,r=["",g.Filter.defaultFragmentShaderHeader,"uniform vec3 color;","uniform float factor;","void main (void)","{","  float fac0 = 2.0;","  float fac1 = 1.0;","  float offsetx = 1.0/RenderSize[0];","  float offsety = 1.0/RenderSize[1];","  vec4 texel0 = texture2D(Texture0, FragTexCoord0 + vec2(offsetx, offsety));","  vec4 texel1 = texture2D(Texture0, FragTexCoord0 + vec2(offsetx, 0.0));","  vec4 texel2 = texture2D(Texture0, FragTexCoord0 + vec2(offsetx, -offsety));","  vec4 texel3 = texture2D(Texture0, FragTexCoord0 + vec2(0.0, -offsety));","  vec4 texel4 = texture2D(Texture0, FragTexCoord0 + vec2(-offsetx, -offsety));","  vec4 texel5 = texture2D(Texture0, FragTexCoord0 + vec2(-offsetx, 0.0));","  vec4 texel6 = texture2D(Texture0, FragTexCoord0 + vec2(-offsetx, offsety));","  vec4 texel7 = texture2D(Texture0, FragTexCoord0 + vec2(0.0, offsety));","  vec4 rowx = -fac0*texel5 + fac0*texel1 +  -fac1*texel6 + fac1*texel0 + -fac1*texel4 + fac1*texel2;","  vec4 rowy = -fac0*texel3 + fac0*texel7 +  -fac1*texel4 + fac1*texel6 + -fac1*texel2 + fac1*texel0;","  float mag = sqrt(dot(rowy,rowy)+dot(rowx,rowx));","  if (mag < 1.0/255.0) { discard; return; }","  mag *= factor;","  mag = min(1.0, mag);","  gl_FragColor = vec4(color*mag,mag);","}",""].join("\n"),i=new c(new d("VERTEX_SHADER",e),new d("FRAGMENT_SHADER",r));t.setAttributeAndModes(i),t.addUniform(this._color),t.addUniform(this._factor),t.addUniform(h.createInt1(0,"Texture0")),this._dirty=!1}}),g.Filter.BlendMix=function(){g.Filter.call(this);var t,e,r,i=0,n=1,a=this._stateSet;3===arguments.length?(t=arguments[0],e=arguments[1],r=arguments[2],i=1,n=2,a.setTextureAttributeAndModes(i,t)):2===arguments.length?(e=arguments[0],r=arguments[1]):1===arguments.length&&(e=arguments[0],r=.5),a.setTextureAttributeAndModes(n,e),a.addUniform(h.createInt1(i,"Texture0")),a.addUniform(h.createInt1(n,"Texture1")),this._mixValueUniform=h.createFloat1(r,"MixValue"),a.addUniform(mixValueUniform)},g.Filter.BlendMix=e.objectInehrit(g.Filter.prototype,{getBlendFactorUniform:function(){return this._mixValueUniform},build:function(){var t=this._stateSet,e=g.Filter.defaultVertexShader,r=["",g.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform float MixValue;","void main (void)","{","  gl_FragColor = mix(texture2D(Texture0,FragTexCoord0), texture2D(Texture1,FragTexCoord0),MixValue);","}",""].join("\n"),i=new c(new d("VERTEX_SHADER",e),new d("FRAGMENT_SHADER",r));t.setAttributeAndModes(i),this._dirty=!1}}),g.Filter.BlendMultiply=function(){g.Filter.call(this);var t,e,r=this._stateSet,i=0,n=1;2===arguments.length?(t=arguments[0],e=arguments[1],i=1,i=2,r.setTextureAttributeAndModes(i,t)):1===arguments.length&&(e=arguments[0]),r.setTextureAttributeAndModes(n,e),r.addUniform(h.createInt1(i,"Texture0")),r.addUniform(h.createInt1(n,"Texture1"))},g.Filter.BlendMultiply.prototype=e.objectInehrit(g.Filter.prototype,{build:function(){var t=g.Filter.defaultVertexShader,e=["",g.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform float MixValue;","void main (void)","{","  gl_FragColor = texture2D(Texture0,FragTexCoord0)*texture2D(Texture1,FragTexCoord0);","}",""].join("\n"),r=new c(new d("VERTEX_SHADER",t),new d("FRAGMENT_SHADER",e));this._stateSet.setAttributeAndModes(r),this._dirty=!1}}),g.Filter.SSAO=function(t){g.Filter.call(this);var e=this._stateSet,r=16,i=.05;void 0!==t&&(void 0!==t.nbSamples&&(r=t.nbSamples),void 0!==t.radius&&(i=t.radius));var n=t.normal,a=t.position;this._radius=i,this._nbSamples=r,this._noiseTextureSize=16,this._sceneRadius=2,e.addUniform(h.createFloat1(1,"Power")),e.addUniform(h.createFloat1(i,"Radius")),e.addUniform(h.createInt1(0,"Texture0")),e.addUniform(h.createInt1(1,"Texture1")),e.addUniform(h.createInt1(2,"Texture2")),e.addUniform(h.createFloat1(.1,"AngleLimit"));var o=n.getWidth(),s=n.getHeight();this._size=[o,s],e.setTextureAttributeAndModes(0,n),e.setTextureAttributeAndModes(1,a),this.initNoise()},g.Filter.SSAO.prototype=e.objectInehrit(g.Filter.prototype,{initNoise:function(){var t=this._noiseTextureSize,e=new Array(3*t*t);!function(e){for(var r=0;t*t>r;r++){var i,n,a;i=2*(Math.random()-.5),n=2*(Math.random()-.5),a=0;var o=Vec3.normalize([i,n,a],[]);e[3*r+0]=255*(.5*o[0]+.5),e[3*r+1]=255*(.5*o[1]+.5),e[3*r+2]=255*(.5*o[2]+.5)}}(e);var r=new n;r.setWrapS("REPEAT"),r.setWrapT("REPEAT"),r.setMinFilter("NEAREST"),r.setMagFilter("NEAREST"),r.setTextureSize(t,t),r.setImage(new Uint8Array(e),"RGB"),this._noiseTexture=r},setSceneRadius:function(t){this._sceneRadius=t,this.dirty()},setAngleLimit:function(t){var e=this._stateSet.getUniform("AngleLimit");e.get()[0]=t,e.dirty()},setNbSamples:function(t){t!==this._nbSamples&&(this._nbSamples=Math.floor(t),this.dirty())},setRadius:function(t){var e=this._stateSet.getUniform("Radius");e.get()[0]=t,e.dirty()},setPower:function(t){var e=this._stateSet.getUniform("Power");e.get()[0]=t,e.dirty()},build:function(){var t=this._stateSet,e=this._nbSamples,r=new Array(4*e);!function(t){for(var r=0;e>r;r++){var i,n,a;i=2*(Math.random()-.5),n=2*(Math.random()-.5),a=Math.random();var o=Vec3.normalize([i,n,a],[]),s=Math.max(r/e,.1);s=.1+.9*s*s,t[3*r+0]=o[0],t[3*r+1]=o[1],t[3*r+2]=o[2],t[3*r+3]=s}}(r),t.setTextureAttributeAndModes(2,this._noiseTexture);var i=t.getUniform("noiseSampling");void 0===i?(i=h.createFloat2([this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize],"noiseSampling"),t.addUniform(i)):(i.set([this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize]),i.dirty());for(var n=["","#ifdef GL_ES","precision highp float;","#endif","attribute vec3 Vertex;","attribute vec2 TexCoord0;","varying vec2 FragTexCoord0;","uniform mat4 ModelViewMatrix;","uniform mat4 ProjectionMatrix;","void main(void) {","  gl_Position = ProjectionMatrix * ModelViewMatrix * vec4(Vertex,1.0);","  FragTexCoord0 = TexCoord0;","}",""].join("\n"),a=[],o=0;e>o;o++)a.push("kernel["+o+"] = vec4("+r[3*o]+","+r[3*o+1]+", "+r[3*o+2]+", "+r[3*o+3]+");");a=a.join("\n"),.002*this._sceneRadius,.05*this._sceneRadius;var s=["",g.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform sampler2D Texture2;","uniform mat4 projection;","uniform vec2 noiseSampling;","uniform float Power;","uniform float Radius;","uniform float AngleLimit;","#define NB_SAMPLES "+this._nbSamples,"float depth;","vec3 normal;","vec4 position;","vec4 kernel["+e+"];","mat3 computeBasis()","{","  vec2 uvrand = FragTexCoord0*noiseSampling;","  vec3 rvec = texture2D(Texture2, uvrand*2.0).xyz*2.0-vec3(1.0);","  vec3 tangent = normalize(rvec - normal * dot(rvec, normal));","  vec3 bitangent = cross(normal, tangent);","  mat3 tbn = mat3(tangent, bitangent, normal);","  return tbn;","}","void main (void)","{",a,"  position = texture2D(Texture1, FragTexCoord0);","  vec4 p = texture2D(Texture0, FragTexCoord0);","  depth = p.w;","  normal = vec3(p);","  if ( position.w == 0.0) {","     gl_FragColor = vec4(1.0,1.0,1.0,0.0);","     return;","  }",""," mat3 tbn = computeBasis();"," float occlusion = 0.0;"," for (int i = 0; i < NB_SAMPLES; i++) {","    vec3 vecKernel = vec3(kernel[i]);","    vecKernel[2] = max(AngleLimit,vecKernel[2]);","    vec3 sample = tbn * vecKernel;","    vec3 dir = sample;","    float w = dot(dir, normal);","    float dist = 1.0-kernel[i].w;","    w *= dist*dist*Power;","    sample = dir * float(Radius) + position.xyz;","    vec4 offset = projection * vec4(sample,1.0);","    offset.xy /= offset.w;","    offset.xy = offset.xy * 0.5 + 0.5;","    float sample_depth = texture2D(Texture1, offset.xy).z;","    float range_check = abs(sample.z - sample_depth) < float(Radius) ? 1.0 : 0.0;","    occlusion += (sample_depth > sample.z ? 1.0 : 0.0) * range_check*w;"," }"," occlusion = 1.0 - (occlusion / float(NB_SAMPLES));"," gl_FragColor = vec4(vec3(occlusion),1.0);","}",""].join("\n"),u=new c(new d("VERTEX_SHADER",n),new d("FRAGMENT_SHADER",s));t.setAttributeAndModes(u),this._dirty=!1}}),g.Filter.SSAO8=function(t){g.Filter.SSAO.call(this,t)},g.Filter.SSAO8.prototype=e.objectInehrit(g.Filter.SSAO.prototype,{buildGeometry:function(t){return t.getAttributes().TexCoord1=this._texCoord1,t},build:function(){var t=this._stateSet,e=this._nbSamples,r=new Array(4*e);this._angleLimit,function(t){for(var r=0;e>r;r++){var i,n,a;i=2*(Math.random()-.5),n=2*(Math.random()-.5),a=Math.random();var o=Vec3.normalize([i,n,a],[]),s=Math.max(r/e,.1);s=.1+.9*s*s,t[3*r+0]=o[0],t[3*r+1]=o[1],t[3*r+2]=o[2],t[3*r+3]=s}}(r),this._noiseTextureSize,t.setTextureAttributeAndModes(2,this._noiseTexture);var i=t.getUniform("noiseSampling");void 0===i?(i=h.createFloat2([this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize],"noiseSampling"),t.addUniform(i)):(i.set([this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize]),i.dirty());for(var n=["","#ifdef GL_ES","precision highp float;","#endif","attribute vec3 Vertex;","attribute vec2 TexCoord0;","attribute vec3 TexCoord1;","varying vec2 FragTexCoord0;","varying vec3 FragTexCoord1;","uniform mat4 ModelViewMatrix;","uniform mat4 ProjectionMatrix;","void main(void) {","  gl_Position = ProjectionMatrix * ModelViewMatrix * vec4(Vertex,1.0);","  FragTexCoord0 = TexCoord0;","  FragTexCoord1 = TexCoord1;","}",""].join("\n"),a=[],o=0;e>o;o++)a.push("kernel["+o+"] = vec4("+r[3*o]+","+r[3*o+1]+", "+r[3*o+2]+", "+r[3*o+3]+");");a=a.join("\n"),.002*this._sceneRadius,.05*this._sceneRadius;var s=["",g.Filter.defaultFragmentShaderHeader,"varying vec3 FragTexCoord1;","uniform sampler2D Texture1;","uniform sampler2D Texture2;","uniform mat4 projection;","uniform vec2 noiseSampling;","uniform float Power;","uniform float Radius;","uniform float AngleLimit;","#define NB_SAMPLES "+this._nbSamples,"float depth;","float znear, zfar, zrange;","vec3 normal;","vec3 position;","vec4 kernel["+e+"];",g.Filter.shaderUtils,"mat3 computeBasis()","{","  vec2 uvrand = FragTexCoord0*noiseSampling;","  //uvrand = rand(gl_FragCoord.xy);","  vec3 rvec = texture2D(Texture2, uvrand*2.0).xyz*2.0-vec3(1.0);","  //vec3 rvec = normalize(vec3(uvrand,0.0));","  vec3 tangent = normalize(rvec - normal * dot(rvec, normal));","  vec3 bitangent = cross(normal, tangent);","  mat3 tbn = mat3(tangent, bitangent, normal);","  return tbn;","}","float getDepthValue(vec4 v) {","  float depth = unpack4x8ToFloat(v);","  depth = depth*zrange+znear;","  //depth = depth*zrange;","  return -depth;","}","void main (void)","{",a,"  vec4 p = texture2D(Texture0, FragTexCoord0);","  if (dot(p,p) < 0.001) { ","     gl_FragColor = vec4(1.0,1.0,1.0,0.0);","     return;","  }","  znear = projection[3][2] / (projection[2][2]-1.0);","  zfar = projection[3][2] / (projection[2][2]+1.0);","  zrange = zfar-znear;","  depth = getDepthValue(texture2D(Texture1, FragTexCoord0));","  if ( -depth < znear) {","     gl_FragColor = vec4(1.0,1.0,1.0,0.0);","     return;","  }","  normal = decodeNormal(unpack4x8To2Float(p));","  position = -FragTexCoord1*depth;","  position.z = -position.z;",""," mat3 tbn = computeBasis();"," float occlusion = 0.0;"," for (int i = 0; i < NB_SAMPLES; i++) {","    vec3 vecKernel = vec3(kernel[i]);","    vecKernel[2] = max(AngleLimit,vecKernel[2]);","    vec3 sample = tbn * vec3(vecKernel);","    vec3 dir = sample;","    float w = dot(dir, normal);","    float dist = 1.0-kernel[i].w;","    w *= dist*dist*Power;","    sample = dir * float(Radius) + position.xyz;","    vec4 offset = projection * vec4(sample,1.0);","    offset.xy /= offset.w;","    offset.xy = offset.xy * 0.5 + 0.5;","    float sample_depth = getDepthValue(texture2D(Texture1, offset.xy));","    float range_check = abs(sample.z - sample_depth) < float(Radius) ? 1.0 : 0.0;","    occlusion += (sample_depth > sample.z ? 1.0 : 0.0) * range_check*w;"," }"," occlusion = 1.0 - (occlusion / float(NB_SAMPLES));"," gl_FragColor = vec4(vec3(occlusion),1.0);","}",""].join("\n"),u=new c(new d("VERTEX_SHADER",n),new d("FRAGMENT_SHADER",s));t.setAttributeAndModes(u),this._dirty=!1}}),g}),n("osgUtil/TriangleIntersect",["osg/Notify","osg/Vec3"],function(t,e){var r=function(t,e,r,i,n,a,o,s){this.index=t,this.normal=e,this.r1=r,this.v1=i,this.r2=n,this.v2=a,this.r3=o,this.v3=s};return TriangleIntersect=function(){this.hits=[],this.nodePath=[]},TriangleIntersect.prototype={setNodePath:function(t){this.nodePath=t},set:function(t,r){this.start=t,this.end=r,this.dir=e.sub(r,t,[]),this.length=e.length(this.dir);var i=1/this.length;e.mult(this.dir,i,this.dir)},applyDrawElementsTriangles:function(t,e,r){for(var i,n,a,o=[],s=[],u=[],h=0;t>h;h+=3)i=3*r[h],o[0]=e[i],o[1]=e[i+1],o[2]=e[i+2],n=3*r[h+1],s[0]=e[n],s[1]=e[n+1],s[2]=e[n+2],a=3*r[h+2],u[0]=e[a],u[1]=e[a+1],u[2]=e[a+2],this.intersect(o,s,u)},applyDrawElementsTriangleStrip:function(t,e,r){for(var i,n,a,o=[],s=[],u=[],h=2,l=0;t>h;h++,l++)h%2?(i=3*r[l],n=3*r[l+2],a=3*r[l+1]):(i=3*r[l],n=3*r[l+1],a=3*r[l+2]),o[0]=e[i],o[1]=e[i+1],o[2]=e[i+2],s[0]=e[n],s[1]=e[n+1],s[2]=e[n+2],u[0]=e[a],u[1]=e[a+1],u[2]=e[a+2],this.intersect(o,s,u)},applyDrawElementsTriangleFan:function(t,e,r){var i=[],n=[],a=[],o=3*r[0];i[0]=e[o],i[1]=e[o+1],i[2]=e[o+2];for(var s,u,h=2,l=1;t>h;h++,l++)s=3*r[l],u=3*r[l+1],n[0]=e[s],n[1]=e[s+1],n[2]=e[s+2],a[0]=e[u],a[1]=e[u+1],a[2]=e[u+2],this.intersect(i,n,a)},applyDrawArraysTriangles:function(t,e,r){for(var i=[],n=[],a=[],o=t;e>o;o+=9)i[0]=r[o],i[1]=r[o+1],i[2]=r[o+2],n[0]=r[o+3],n[1]=r[o+4],n[2]=r[o+5],a[0]=r[o+6],a[1]=r[o+7],a[2]=r[o+8],this.intersect(i,n,a)},applyDrawArraysTriangleStrip:function(t,e,r){for(var i,n,a,o=[],s=[],u=[],h=2,l=t;e>h;h++,l++)h%2?(i=3*l,n=3*(l+2),a=3*(l+1)):(i=3*l,n=3*(l+1),a=3*(l+2)),o[0]=r[i],o[1]=r[i+1],o[2]=r[i+2],s[0]=r[n],s[1]=r[n+1],s[2]=r[n+2],u[0]=r[a],u[1]=r[a+1],u[2]=r[a+2],this.intersect(o,s,u)},applyDrawArraysTriangleFan:function(t,e,r){var i=[],n=[],a=[],o=3*t;i[0]=r[o],i[1]=r[o+1],i[2]=r[o+2];for(var s,u,h=2,l=t+1;e>h;h++,l++)s=3*l,u=3*(l+1),n[0]=r[s],n[1]=r[s+1],n[2]=r[s+2],a[0]=r[u],a[1]=r[u+1],a[2]=r[u+2],this.intersect(i,n,a)},apply:function(t){if(t.getAttributes().Vertex){var e,r=t.getAttributes().Vertex.getElements();this.index=0;for(var i=0,n=t.primitives.length;n>i;i++)if(e=t.primitives[i],void 0!==e.getIndices){var a=e.indices.getElements();switch(e.getMode()){case gl.TRIANGLES:this.applyDrawElementsTriangles(e.getCount(),r,a);break;case gl.TRIANGLE_STRIP:this.applyDrawElementsTriangleStrip(e.getCount(),r,a);break;case gl.TRIANGLE_FAN:this.applyDrawElementsTriangleFan(e.getCount(),r,a)}}else switch(e.getMode()){case gl.TRIANGLES:this.applyDrawArraysTriangles(e.getFirst(),e.getCount(),r);break;case gl.TRIANGLE_STRIP:this.applyDrawArraysTriangleStrip(e.getFirst(),e.getCount(),r);break;case gl.TRIANGLE_FAN:this.applyDrawArraysTriangleFan(e.getFirst(),e.getCount(),r)}}},intersect:function(i,n,a){if(this.index++,i!=n&&n!=a&&i!=a){var o=e.sub(n,i,[]),s=e.cross(o,this.dir,[]),u=e.dot(e.sub(this.start,i,[]),s),h=e.dot(e.sub(a,i,[]),s);if(h>=0){if(0>u)return;if(u>h)return}else{if(u>0)return;if(h>u)return}var l=e.sub(a,n,[]),c=e.cross(l,this.dir,[]),d=e.dot(e.sub(this.start,n,[]),c),f=e.dot(e.sub(i,n,[]),c);if(f>=0){if(0>d)return;if(d>f)return}else{if(d>0)return;if(f>d)return}var p=e.sub(i,a,[]),g=e.cross(p,this.dir,[]),m=e.dot(e.sub(this.start,a,[]),g),v=e.dot(e.sub(n,a,[]),g);if(v>=0){if(0>m)return;if(m>v)return}else{if(m>0)return;if(v>m)return}var _;if(0===u)_=0;else{if(0===h)return;_=u/h}var y;if(0===d)y=0;else{if(0===f)return;y=d/f}var b;if(0===m)b=0;else{if(0===v)return;b=m/v}var x=y+b+_;if(1!==x){if(0===x)return;var S=1/x;y*=S,b*=S,_*=S}var M=[];if(e.add(e.mult(i,y,[]),e.mult(n,b,[]),M),e.add(e.mult(a,_,[]),M,M),!e.valid(M))return t.log("Warning: TriangleIntersect "),t.log("hit:     "+M),t.log("         "+i),t.log("         "+n),t.log("         "+a),void 0;var A=e.dot(e.sub(M,this.start,[]),this.dir);if(!(0>A||A>this.length)){var T=e.cross(o,l,[]);e.normalize(T,T);var w=A/this.length,C=[];C[0]=this.start[0]*(1-w)+this.end[0]*w,C[1]=this.start[1]*(1-w)+this.end[1]*w,C[2]=this.start[2]*(1-w)+this.end[2]*w,this.hits.push({ratio:w,nodepath:this.nodePath.slice(0),triangleHit:new r(this.index-1,T,y,i,b,n,_,a),point:C}),this.hit=!0}}}},TriangleIntersect}),n("osgUtil/IntersectVisitor",["osg/Utils","osg/NodeVisitor","osg/Matrix","osg/Vec3","osgUtil/TriangleIntersect"],function(t,e,r,i,n){var a=function(){e.call(this),this.matrix=[],this.hits=[],this.nodePath=[]};return a.prototype=t.objectInehrit(e.prototype,{addLineSegment:function(t,e){this.start=t,this.end=e},intersectSegmentWithSphere:function(t,e,r){var n=i.sub(t,r.center),a=i.length2(n)-r.radius*r.radius;if(0>a)return!0;var o=i.sub(e,t),s=i.length2(o),u=2*i.dot(n,o),h=u*u-4*s*a;if(0>h)return!1;h=Math.sqrt(h);var l=.5*s,c=(-u-h)*l,d=(-u+h)*l;return 0>=c&&0>=d?!1:c>=1&&d>=1?!1:!0},pushModelMatrix:function(t){if(this.matrix.length>0){var e=r.copy(this.matrix[this.matrix.length-1]);r.preMult(e,t),this.matrix.push(e)}else this.matrix.push(t)},getModelMatrix:function(){return 0===this.matrix.length?r.makeIdentity([]):this.matrix[this.matrix.length-1]},popModelMatrix:function(){return this.matrix.pop()},getWindowMatrix:function(){return this.windowMatrix},getProjectionMatrix:function(){return this.projectionMatrix},getViewMatrix:function(){return this.viewMatrix},intersectSegmentWithGeometry:function(t,e,r){ti=new n,ti.setNodePath(this.nodePath),ti.set(t,e),ti.apply(r);var i=ti.hits.length;if(i>0){for(var a=0;i>a;a++)this.hits.push(ti.hits[a]);return!0}return!1},pushCamera:function(t){this.projectionMatrix=t.getProjectionMatrix(),this.viewMatrix=t.getViewMatrix();var e=t.getViewport();void 0!==e&&(this.windowMatrix=e.computeWindowMatrix())},applyCamera:function(t){this.pushCamera(t),this.traverse(t)},applyNode:function(t){if(t.getMatrix&&this.pushModelMatrix(t.getMatrix()),t.primitives){var e=[];r.copy(this.getWindowMatrix(),e),r.preMult(e,this.getProjectionMatrix()),r.preMult(e,this.getViewMatrix()),r.preMult(e,this.getModelMatrix());var i=[],n=r.inverse(e,i);if(!n)return;var a=r.transformVec3(i,this.start,new Array(3)),o=r.transformVec3(i,this.end,new Array(3));this.intersectSegmentWithGeometry(a,o,t)}t.traverse&&this.traverse(t),t.getMatrix&&this.popModelMatrix()},apply:function(t){this.enterNode(t)!==!1&&(t.getViewMatrix?this.applyCamera(t):this.applyNode(t))},enterNode:function(t){var e=t.boundingSphere;return void 0===e||this.intersectSegmentWithSphere?!0:!1}}),a}),n("osgUtil/ParameterVisitor",["osg/Notify","osg/Utils","osg/Uniform","osg/NodeVisitor"],function(t,e,r,i){var n=function(t){void 0!==t&&(void 0!==t.object&&void 0!==t.field&&this.createInternalSlider(param),this._uniform=this.createInternalSliderUniform(param))};n.prototype={setTargetHTML:function(t){this.parent=t},addToDom:function(t){var e=document.createElement("div");e.innerHTML=t,this.parent.appendChild(e)},getValue:function(t){if(window.localStorage){var e=window.localStorage.getItem(t);return e}return null},setValue:function(t,e){window.localStorage&&window.localStorage.setItem(t,e)},createHTMLSlider:function(t,e,r,i){var n='<div>NAME [ MIN - MAX ] <input type="range" min="MIN" max="MAX" value="VALUE" step="STEP" onchange="ONCHANGE" /><span id="UPDATE"></span></div>',a=t.min,o=t.max,s=t.step,u=r,h=i,l=h+"(this.value)";return n=n.replace(/MIN/g,a),n=n.replace(/MAX/g,o+s),n=n.replace("STEP",s),n=n.replace("VALUE",e),n=n.replace(/NAME/g,u),n=n.replace(/UPDATE/g,h),n=n.replace("ONCHANGE",l)
},createUniformFunction:function(e,r,i,n,a){return self=this,function(){var o=r,s=i,u=n,h=a,l=function(r){u.get()[s]=r,u.dirty(),t.debug(o+" value "+r),document.getElementById(a).innerHTML=Number(r).toFixed(4),self.setValue(h,r),void 0!==e.onchange&&e.onchange(u.get())};return l}()},createFunction:function(e,r,i,n,a,o){return self=this,function(){var s=r,u=a,h=o,l=n,c=function(r){"string"==typeof r&&(r=parseFloat(r)),"number"==typeof n[u]?l[u]=r:l[u][i]=r,t.debug(s+" value "+r),document.getElementById(o).innerHTML=Number(r).toFixed(4),self.setValue(h,r),void 0!==e.onchange&&e.onchange(l[u])};return c}()},getCallbackName:function(t,e){return"change_"+e+"_"+t},copyDefaultValue:function(t){var e=t.value;return e=Array.isArray(t.value)?t.value.slice():[e]},createInternalSliderUniform:function(e){var i=e.value,n=e.uniform;if(void 0===n){var a=e.type;a=a.charAt(0).toUpperCase()+a.slice(1),n=r["create"+a](i,e.name)}for(var o=this.getCallbackName(e.name,e.id),s=i.length,u=0;s>u;u++){var h=u.toString(),l=e.name+h,c=o+h,d=i[u],f=this.getValue(c);null!==f?d=f:e.uniform&&void 0!==e.uniform.get()[u]&&(d=e.uniform.get()[u]);var p=this.createHTMLSlider(e,d,l,c);this.addToDom(p),window[c]=this.createUniformFunction(e,l,u,n,c),t.log(l+" "+d),window[c](d)}return this.uniform=n,n},createInternalSlider:function(e){for(var r=e.value,i=e.name,n=e.id,a=r.length,o=this.getCallbackName(i,n),s=e.object,u=e.field,h=0;a>h;h++){var l=h.toString(),c=i+l,d=o+l,f=r[h],p=this.getValue(d);f=null!==p?p:"number"==typeof s[u]?s[u]:s[u][h];var g=this.createHTMLSlider(e,f,c,d);this.addToDom(g),window[d]=this.createFunction(e,c,h,s,u,d),t.log(c+" "+f),window[d](f)}},createSlider:function(t){return void 0!==t.html&&this.setTargetHTML(t.html),void 0===t.id&&(t.id=t.name),t.value=this.copyDefaultValue(t),void 0!==t.type?this.createInternalSliderUniform(t):(void 0===t.object&&(t.object={data:t.value},t.field="data"),this.createInternalSlider(t))}};var a=function(){i.call(this),this.arraySlider=new n,this.setTargetHTML(document.body)};return a.createSlider=function(t){(new n).createSlider(t)},a.prototype=e.objectInehrit(i.prototype,{setTargetHTML:function(t){this.targetHTML=t,this.arraySlider.setTargetHTML(this.targetHTML)},getUniformList:function(t,e){var r="(uniform)",i=".*?",n="((?:[a-z][a-z]+))",a=".*?",o="((?:[a-z][a-z]+))",s=".*?",u=".",h=".*?",l=".",c=".*?",d="(.)",f="(.)",p=".*?",g="(\\{.*?\\})",m=new RegExp(r+i+n+a+o+s+u+h+l+c+d+f+p+g,["g"]),v=t.match(m),_=e;if(null!==v)for(var y=new RegExp(r+i+n+a+o+s+u+h+l+c+d+f+p+g,["i"]),b=0,x=v.length;x>b;b++){var S=v[b].match(y);if(null!==S){S[1];var M=S[2],A=S[3];S[4],S[5];var T=S[6],w=JSON.parse(T);w.type=M,w.name=A;var C=w.value;w.value=function(){return C},_[A]=w}}return _},getUniformFromStateSet:function(t,e){var r=t.getUniformList();if(r)for(var i=window.Object.keys(e),n=0,a=i.length;a>n;n++){var o=i[n];void 0!==r[o]&&void 0===e[o].uniform&&(e[o].uniform=r[o].object)}},findExistingUniform:function(t,r){var n=function(){i.call(this,i.TRAVERSE_PARENTS)};n.prototype=e.objectInehrit(i.prototype,{setUniformMap:function(t){this.uniformMap=t},apply:function(t){var e=t.getStateSet();e&&a.prototype.getUniformFromStateSet(e,this.uniformMap),this.traverse(t)}});var o=new n;o.setUniformMap(r),t.accept(o)},applyProgram:function(e,r){var i=r.getAttribute("Program"),n=i.getName();i.getVertexShader().getText();var a={};this.getUniformList(i.getVertexShader().getText(),a),this.getUniformList(i.getFragmentShader().getText(),a);var o=window.Object.keys(a);if(void 0===n){var s=function(t){var e=0,r=0;if(0===t.length)return e;for(l=0;l<t.length;l++)r=t.charCodeAt(l),e=(e<<5)-e+r,e&=e;return 0>e&&(e=-e),e},u=o.join("");n=s(u).toString()}this.findExistingUniform(e,a);for(var h=!1,l=0;l<o.length;l++){{var c=o[l],d=a[c];d.type,d.name}d.id=n;var f=this.arraySlider.createSlider(d);void 0===d.uniform&&f&&r.addUniform(f),h=!0}if(h){var p=document.createElement("div");p.innerHTML="<p> </p>",this.targetHTML.appendChild(p)}t.log(a)},applyStateSet:function(t,e){void 0!==e.getAttribute("Program")&&this.applyProgram(t,e)},apply:function(t){var e=this.targetHTML;if(void 0!==e&&null!==e){var r=t.getStateSet();void 0!==r&&this.applyStateSet(t,r),this.traverse(t)}}}),a}),n("osgUtil/osgUtil",["osgUtil/Composer","osgUtil/IntersectVisitor","osgUtil/ParameterVisitor","osgUtil/TriangleIntersect"],function(t,e,r,i){var n={};return n.Composer=t,n.IntersectVisitor=e,n.ParameterVisitor=r,n.TriangleIntersect=i,n}),n("osgViewer/View",["osg/Camera","osg/Node","osg/FrameStamp","osg/Material","osg/Depth","osg/BlendFunc","osg/CullFace","osg/Viewport","osg/Matrix","osg/Light","osgUtil/IntersectVisitor"],function(t,e,r,i,n,a,o,s,u,h,l){var c=function(){this._graphicContext=void 0,this._camera=new t,this._scene=new e,this._sceneData=void 0,this._frameStamp=new r,this._lightingMode=void 0,this._manipulator=void 0,this.setLightingMode(c.LightingMode.HEADLIGHT),this._scene.getOrCreateStateSet().setAttributeAndMode(new i),this._scene.getOrCreateStateSet().setAttributeAndMode(new n),this._scene.getOrCreateStateSet().setAttributeAndMode(new a),this._scene.getOrCreateStateSet().setAttributeAndMode(new o)};return c.LightingMode={NO_LIGHT:0,HEADLIGHT:1,SKY_LIGHT:2},c.prototype={setGraphicContext:function(t){this._graphicContext=t},getGraphicContext:function(){return this._graphicContext},setUpView:function(t){var e=0!==t.width?t.width:800,r=0!==t.height?t.height:600,i=e/r;this._camera.setViewport(new s(0,0,e,r)),u.makeLookAt([0,0,-10],[0,0,0],[0,1,0],this._camera.getViewMatrix()),u.makePerspective(55,i,1,1e3,this._camera.getProjectionMatrix())},computeIntersections:function(t,e,r){void 0===r&&(r=-1);var i=new l;return i.setTraversalMask(r),i.addLineSegment([t,e,0],[t,e,1]),i.pushCamera(this._camera),this._sceneData.accept(i),i.hits},setFrameStamp:function(t){this._frameStamp=t},getFrameStamp:function(){return this._frameStamp},setCamera:function(t){this._camera=t},getCamera:function(){return this._camera},setSceneData:function(t){this._scene.removeChildren(),this._scene.addChild(t),this._sceneData=t},getSceneData:function(){return this._sceneData},getScene:function(){return this._scene},getManipulator:function(){return this._manipulator},setManipulator:function(t){this._manipulator=t},getLight:function(){return this._light},setLight:function(t){this._light=t,this._lightingMode!==c.LightingMode.NO_LIGHT&&this._scene.getOrCreateStateSet().setAttributeAndMode(this._light)},getLightingMode:function(){return this._lightingMode},setLightingMode:function(t){this._lightingMode!==t&&(this._lightingMode=t,this._lightingMode!==c.LightingMode.NO_LIGHT?this._light||(this._light=new h,this._light.setAmbient([.2,.2,.2,1]),this._light.setDiffuse([.8,.8,.8,1]),this._light.setSpecular([.5,.5,.5,1])):this._light=void 0)}},c}),n("osgViewer/eventProxy/GamePad",["osg/Notify"],function(t){var e=function(t){this._viewer=t,this._type="GamePad",this._enable=!0};return e.prototype={init:function(){var t=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads;!t},isValid:function(){if(!this._enable)return!1;var t=this._viewer.getManipulator();if(!t)return!1;var e=t.getControllerList();return e[this._type]?!0:!1},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},webkitGamepadPoll:function(){var t=navigator.webkitGetGamepads&&navigator.webkitGetGamepads()||navigator.webkitGamepads;t&&(t[0]?(this._gamepad||this.onGamepadConnect({gamepad:t[0]}),this._gamepad=t[0]):this._gamepad&&this.onGamepadDisconnect({gamepad:this._gamepad}))},onGamepadConnect:function(e){this._gamepad=e.gamepad,t.log("Detected new gamepad!",this._gamepad)},onGamepadDisconnect:function(){this._gamepad=!1,t.log("Gamepad disconnected",this._gamepad)},getGamePad:function(){return this._gamepad},update:function(){if(this.webkitGamepadPoll(),this._gamepad){var t=this.getManipulatorController();t.update&&t.update(this)}}},e}),n("vendors/Hammer",[],function(){return window.Hammer}),n("osgViewer/eventProxy/Hammer",["vendors/Hammer"],function(){var t=function(t){this._enable=!0,this._viewer=t,this._type="Hammer",this._eventNode=void 0};return t.prototype={init:function(t){var e={prevent_default:!0,drag_max_touches:2,transform_min_scale:.08,transform_min_rotation:180,transform_always_block:!0,hold:!1,release:!1,swipe:!1,tap:!1};this._eventNode=t.eventNode,this._eventNode&&(this._hammer=new Hammer(this._eventNode,e))},isValid:function(){return this._enable&&this._viewer.getManipulator()&&this._viewer.getManipulator().getControllerList()[this._type]?!0:!1},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},update:function(){this.isValid()&&this.getManipulatorController().setEventProxy(this._hammer)}},t}),n("osgViewer/eventProxy/LeapMotion",["osg/Notify"],function(){var t=function(t){this._viewer=t,this._type="LeapMotion",this._enable=!0};return t.prototype={init:function(t){document.getElementById(t.id)},isValid:function(){if(!this._enable)return!1;var t=this._viewer.getManipulator();if(!t)return!1;var e=t.getControllerList();return e[this._type]?!0:!1},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},_update:function(t){if(t.valid&&this.isValid()){var e=this.getManipulatorController();e.update&&e.update(t)}}},t}),n("osgViewer/eventProxy/StandardMouseKeyboard",[],function(){var t=function(t){this._enable=!0,this._viewer=t,this._type="StandardMouseKeyboard",this._mouseEventNode=void 0,this._wheelEventNode=void 0,this._keyboardEventNode=void 0,this._eventList=["mousedown","mouseup","mousemove","dblclick"],this._mousePosition=[0,0]};return t.prototype={init:function(t){this.removeEventListeners(this._mouseEventNode,this._wheelEventNode,this._keyboardEventNode);var e=t.mouseEventNode,r=t.wheelEventNode||e,i=t.keyboardEventNode||e;this.addEventListeners(e,r,i),this._mouseEventNode=e,this._wheelEventNode=r,this._keyboardEventNode=i},addEventListeners:function(t,e,r){if(t)for(var i=0,n=this._eventList.length;n>i;i++){var a=this._eventList[i];this[a]&&t.addEventListener(a,this[a].bind(this),!1)}e&&(e.addEventListener("DOMMouseScroll",this.mousewheel.bind(this),!1),e.addEventListener("mousewheel",this.mousewheel.bind(this),!1)),r&&(r.addEventListener("keydown",this.keydown.bind(this),!1),r.addEventListener("keyup",this.keyup.bind(this),!1))},removeEventListeners:function(t,e,r){if(t)for(var i=0,n=this._eventList.length;n>i;i++){var a=this._eventList[i];this[a]&&t.removeEventListener(a,this[a])}e&&(e.removeEventListener("DOMMouseScroll",this.mousewheel),e.removeEventListener("mousewheel",this.mousewheel)),r&&(r.removeEventListener("keydown",this.keydown),r.removeEventListener("keyup",this.keyup))},isValid:function(){return this._enable&&this._viewer.getManipulator()&&this._viewer.getManipulator().getControllerList()[this._type]?!0:!1},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},keyup:function(t){return this.isValid()?this.getManipulatorController().keyup?this.getManipulatorController().keyup(t):void 0:void 0},keydown:function(t){return this.isValid()?this.getManipulatorController().keydown?this.getManipulatorController().keydown(t):void 0:void 0},mousedown:function(t){return this.isValid()?this.getManipulatorController().mousedown?this.getManipulatorController().mousedown(t):void 0:void 0},mouseup:function(t){return this.isValid()?this.getManipulatorController().mouseup?this.getManipulatorController().mouseup(t):void 0:void 0},mousemove:function(t){return this.isValid()?this.getManipulatorController().mousemove?this.getManipulatorController().mousemove(t):void 0:void 0},dblclick:function(t){return this.isValid()?this.getManipulatorController().dblclick?this.getManipulatorController().dblclick(t):void 0:void 0},mousewheel:function(t){if(this.isValid()){var e=this.getManipulatorController();if(e.mousewheel){var r=t||window.event,i=[].slice.call(arguments,1),n=0,a=0,o=0;return t.type="mousewheel",t.wheelDelta&&(n=t.wheelDelta/120),t.detail&&(n=-t.detail/3),o=n,void 0!==r.axis&&r.axis===r.HORIZONTAL_AXIS&&(o=0,a=-1*n),void 0!==r.wheelDeltaY&&(o=r.wheelDeltaY/120),void 0!==r.wheelDeltaX&&(a=-1*r.wheelDeltaX/120),i.unshift(t,n,a,o),this.getManipulatorController().mousewheel.apply(e,i)}}},divGlobalOffset:function(t){var e=0,r=0;e=t.offsetLeft,r=t.offsetTop;for(var i=document.getElementsByTagName("body")[0];t.offsetParent&&t!=i;)e+=t.offsetParent.offsetLeft,r+=t.offsetParent.offsetTop,t=t.offsetParent;return this._mousePosition[0]=e,this._mousePosition[1]=r,this._mousePosition},getPositionRelativeToCanvas:function(t,e){var r,i,n=t.target;t.pageX||t.pageY?(r=t.pageX,i=t.pageY):(t.clientX||t.clientY)&&(r=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=t.clientY+document.body.scrollTop+document.documentElement.scrollTop);var a=this.divGlobalOffset(n);return r-=a[0],i=n.height-(i-a[1]),isNaN(r)||isNaN(i),void 0===e&&(e=this._mousePosition),e[0]=r,e[1]=i,e},update:function(){this.isValid()&&this.getManipulatorController().setEventProxy(this)}},t}),n("osgViewer/eventProxy/EventProxy",["osgViewer/eventProxy/GamePad","osgViewer/eventProxy/Hammer","osgViewer/eventProxy/LeapMotion","osgViewer/eventProxy/StandardMouseKeyboard"],function(t,e,r,i){return{GamePad:t,Hammer:e,LeapMotion:r,StandardMouseKeyboard:i}}),n("osgViewer/webgl-utils",[],function(){return WebGLUtils=function(){var t=function(t){return'<div style="margin: auto; width:500px;z-index:10000;margin-top:20em;text-align:center;">'+t+"</div>"},e='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',r='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org">Click here for more information.</a>',i=function(i,a,o){function s(i){var n=document.getElementsByTagName("body")[0];if(n){var a=window.WebGLRenderingContext?r:e;i&&(a+="<br/><br/>Status: "+i),n.innerHTML=t(a)}}o=o||s,i.addEventListener&&i.addEventListener("webglcontextcreationerror",function(t){o(t.statusMessage)},!1);var u=n(i,a);return u||(window.WebGLRenderingContext?o(""):o("")),u},n=function(t,e){for(var r=["webgl","experimental-webgl","webkit-3d","moz-webgl"],i=null,n=0;n<r.length;++n){try{i=t.getContext(r[n],e)}catch(a){}if(i)break}return i};return{create3DContext:n,setupWebGL:i}}(),window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}()),window.cancelRequestAnimFrame||(window.cancelRequestAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}()),Date.now||(Date.now=function(){return(new Date).getTime()}),WebGLUtils}),n("osgViewer/webgl-debug",[],function(){return WebGLDebugUtils=function(){function t(t){if(null===c){c={};for(var e in t)"number"==typeof t[e]&&(c[t[e]]=e)}}function e(){if(null===c)throw"WebGLDebugUtils.init(ctx) not called"}function r(t){return e(),void 0!==c[t]}function i(t){e();var r=c[t];return void 0!==r?r:"*UNKNOWN WebGL ENUM (0x"+t.toString(16)+")"}function n(t,e,r){var n=l[t];return void 0!==n&&n[e]?i(r):r.toString()}function a(t,e,r){t.__defineGetter__(r,function(){return e[r]}),t.__defineSetter__(r,function(t){e[r]=t})}function o(e,r){function o(t,e){return function(){var i=t[e].apply(t,arguments),n=t.getError();return 0!==n&&(s[n]=!0,r(n,e,arguments)),i}}t(e),r=r||function(t,e,r){for(var a="",o=0;o<r.length;++o)a+=(0===o?"":", ")+n(e,o,r[o]);h("WebGL error "+i(t)+" in "+e+"("+a+")")};var s={},u={};for(var l in e)"function"==typeof e[l]?u[l]=o(e,l):a(u,e,l);return u.getError=function(){for(var t in s)if(s[t])return s[t]=!1,t;return e.NO_ERROR},u}function s(t){var e=t.getParameter(t.MAX_VERTEX_ATTRIBS),r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r);var i;for(i=0;e>i;++i)t.disableVertexAttribArray(i),t.vertexAttribPointer(i,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(i,0);t.deleteBuffer(r);var n=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);for(i=0;n>i;++i)t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null);for(t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),t.colorMask(!0,!0,!0,!0),t.cullFace(t.BACK),t.depthFunc(t.LESS),t.depthMask(!0),t.depthRange(0,1),t.frontFace(t.CCW),t.hint(t.GENERATE_MIPMAP_HINT,t.DONT_CARE),t.lineWidth(1),t.pixelStorei(t.PACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.UNPACK_COLORSPACE_CONVERSION_WEBGL&&t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.BROWSER_DEFAULT_WEBGL),t.polygonOffset(0,0),t.sampleCoverage(1,!1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilMask(4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT);t.getError(););}function u(t){function e(t){return"function"==typeof t?t:function(e){t.handleEvent(e)}}function r(t){var e=t.addEventListener;t.addEventListener=function(r,i){switch(r){case"webglcontextlost":M(i);break;case"webglcontextrestored":A(i);break;default:e.apply(t,arguments)}}}function i(){for(var t=Object.keys(S),e=0;e<t.length;++e)delete S[t]}function n(){++y,m||_==y&&t.loseContext()}function o(t,e){var r=t[e];return function(){if(n(),!m){var e=r.apply(t,arguments);return e}}}function u(){for(var t=0;t<v.length;++t){var e=v[t];e instanceof WebGLBuffer?c.deleteBuffer(e):e instanceof WebGLFramebuffer?c.deleteFramebuffer(e):e instanceof WebGLProgram?c.deleteProgram(e):e instanceof WebGLRenderbuffer?c.deleteRenderbuffer(e):e instanceof WebGLShader?c.deleteShader(e):e instanceof WebGLTexture&&c.deleteTexture(e)}}function h(t){return{statusMessage:t,preventDefault:function(){b=!0}}}function l(t){for(var e in t)"function"==typeof t[e]?p[e]=o(t,e):a(p,t,e);p.getError=function(){n();var t;if(!m)for(;t=c.getError();)S[t]=!0;for(t in S)if(S[t])return delete S[t],t;return p.NO_ERROR};var r,i,s=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"];for(i=0;i<s.length;++i)r=s[i],p[r]=function(e){return function(){if(n(),m)return null;var r=e.apply(t,arguments);return r.__webglDebugContextLostId__=g,v.push(r),r}}(t[r]);var u=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(i=0;i<u.length;++i)r=u[i],p[r]=function(e){return function(){return n(),m?null:e.apply(t,arguments)}}(p[r]);var h=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(i=0;i<h.length;++i)r=h[i],p[r]=function(e){return function(){return n(),m?!1:e.apply(t,arguments)}}(p[r]);return p.checkFramebufferStatus=function(e){return function(){return n(),m?p.FRAMEBUFFER_UNSUPPORTED:e.apply(t,arguments)}}(p.checkFramebufferStatus),p.getAttribLocation=function(e){return function(){return n(),m?-1:e.apply(t,arguments)}}(p.getAttribLocation),p.getVertexAttribOffset=function(e){return function(){return n(),m?0:e.apply(t,arguments)}}(p.getVertexAttribOffset),p.isContextLost=function(){return m},p}var c,d=[],f=[],p={},g=1,m=!1,v=[],_=0,y=0,b=!1,x=0,S={};t.getContext=function(e){return function(){var r=e.apply(t,arguments);if(r instanceof WebGLRenderingContext){if(r!=c){if(c)throw"got different context";c=r,p=l(c)}return p}return r}}(t.getContext);var M=function(t){d.push(e(t))},A=function(t){f.push(e(t))};return r(t),t.loseContext=function(){if(!m){for(m=!0,_=0,++g;c.getError(););i(),S[c.CONTEXT_LOST_WEBGL]=!0;var e=h("context lost"),r=d.slice();setTimeout(function(){for(var i=0;i<r.length;++i)r[i](e);x>=0&&setTimeout(function(){t.restoreContext()},x)},0)}},t.restoreContext=function(){m&&f.length&&setTimeout(function(){if(!b)throw"can not restore. webglcontestlost listener did not call event.preventDefault";u(),s(c),m=!1,y=0,b=!1;for(var t=f.slice(),e=h("context restored"),r=0;r<t.length;++r)t[r](e)},0)},t.loseContextInNCalls=function(t){if(m)throw"You can not ask a lost contet to be lost";_=y+t},t.getNumCalls=function(){return y},t.setRestoreTimeout=function(t){x=t},t}var h=function(t){window.console&&window.console.log&&window.console.log(t)},l={enable:{0:!0},disable:{0:!0},getParameter:{0:!0},drawArrays:{0:!0},drawElements:{0:!0,2:!0},createShader:{0:!0},getShaderParameter:{1:!0},getProgramParameter:{1:!0},getVertexAttrib:{1:!0},vertexAttribPointer:{2:!0},bindTexture:{0:!0},activeTexture:{0:!0},getTexParameter:{0:!0,1:!0},texParameterf:{0:!0,1:!0},texParameteri:{0:!0,1:!0,2:!0},texImage2D:{0:!0,2:!0,6:!0,7:!0},texSubImage2D:{0:!0,6:!0,7:!0},copyTexImage2D:{0:!0,2:!0},copyTexSubImage2D:{0:!0},generateMipmap:{0:!0},bindBuffer:{0:!0},bufferData:{0:!0,2:!0},bufferSubData:{0:!0},getBufferParameter:{0:!0,1:!0},pixelStorei:{0:!0,1:!0},readPixels:{4:!0,5:!0},bindRenderbuffer:{0:!0},bindFramebuffer:{0:!0},checkFramebufferStatus:{0:!0},framebufferRenderbuffer:{0:!0,1:!0,2:!0},framebufferTexture2D:{0:!0,1:!0,2:!0},getFramebufferAttachmentParameter:{0:!0,1:!0,2:!0},getRenderbufferParameter:{0:!0,1:!0},renderbufferStorage:{0:!0,1:!0},clear:{0:!0},depthFunc:{0:!0},blendFunc:{0:!0,1:!0},blendFuncSeparate:{0:!0,1:!0,2:!0,3:!0},blendEquation:{0:!0},blendEquationSeparate:{0:!0,1:!0},stencilFunc:{0:!0},stencilFuncSeparate:{0:!0,1:!0},stencilMaskSeparate:{0:!0},stencilOp:{0:!0,1:!0,2:!0},stencilOpSeparate:{0:!0,1:!0,2:!0,3:!0},cullFace:{0:!0},frontFace:{0:!0}},c=null;return{init:t,mightBeEnum:r,glEnumToString:i,glFunctionArgToString:n,makeDebugContext:o,makeLostContextSimulatingCanvas:u,resetToInitialState:s}}()}),n("osgViewer/stats",["osg/Utils"],function(t){var e={};return e.Stats=function(t,e){this.layers=[],this.last_update=void 0,this.canvas=t,this.text_canvas=e,this.numberUpdate=0},e.Stats.prototype={addLayer:function(t,e,r,i){void 0===t&&(t="rgb(255,255,255)"),this.layers.push({previous:0,color:t,getValue:r,getText:i,average:0,max:e})},update:function(){var e,r,i,n,a,o,s,u,h,l=t.performance.now();for(void 0===this.last_update&&(this.last_update=l),this.numberUpdate++,r=0,i=this.layers.length;i>r;r++)n=this.layers[r],a=n.getValue(l),n.average+=a;if(r=.12,e=(l-this.last_update)*r,e>=1)for(l-=(e-Math.floor(e))/r,e=Math.floor(e),o=this.canvas,s=o.getContext("2d"),h=s.getImageData(e,0,o.width-e,o.height),s.putImageData(h,0,0),s.clearRect(o.width-e,0,e,o.height),r=0,i=this.layers.length;i>r;r++)n=this.layers[r],a=n.getValue(l),a*=o.height/n.max,a>o.height&&(a=o.height),s.lineWidth=1,s.strokeStyle=n.color,s.beginPath(),s.moveTo(o.width-e,o.height-n.previous),s.lineTo(o.width,o.height-a),s.stroke(),n.previous=a;if(0===this.numberUpdate%60){for(o=this.text_canvas,s=o.getContext("2d"),s.font="14px Sans",u=17,e=u,s.clearRect(0,0,o.width,o.height),r=0,i=this.layers.length;i>r;r++)n=this.layers[r],a=n.getText(n.average/this.numberUpdate),n.average=0,s.fillStyle=n.color,s.fillText(a,0,e),e+=u;this.numberUpdate=0}this.last_update=l}},e}),n("osgViewer/Viewer",["osg/Notify","osg/Utils","osg/UpdateVisitor","osg/CullVisitor","osgUtil/osgUtil","osgViewer/View","osg/RenderStage","osg/StateGraph","osg/Matrix","osg/State","osgGA/OrbitManipulator","osgViewer/eventProxy/EventProxy","osgViewer/webgl-utils","osgViewer/webgl-debug","osgViewer/stats"],function(t,e,r,i,n,a,o,s,u,h,l,c,d,f,p){return function(){var e=function(){for(var t,e=[],r=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),i=0;i<r.length;i++){t=r[i].split("=");var n=t[0].toLowerCase();e.push(n);var a=t[1];void 0===a&&(a="1"),e[n]=a.toLowerCase()}return e},r=e();if(void 0!==r.log){var i=r.log.toLowerCase();switch(i){case"debug":t.setNotifyLevel(t.DEBUG);break;case"info":t.setNotifyLevel(t.INFO);break;case"notice":t.setNotifyLevel(t.NOTICE);break;case"warn":t.setNotifyLevel(t.WARN);break;case"error":t.setNotifyLevel(t.ERROR);break;case"html":!function(){var t=[],e=document.createElement("div"),r=document.createElement("pre");document.addEventListener("DOMContentLoaded",function(){document.body.appendChild(e),e.appendChild(r)});var i=function(e){t.unshift(e),r.innerHTML=t.join("\n")};e.style.overflow="hidden",e.style.position="absolute",e.style.zIndex="10000",e.style.height="100%",e.style.maxWidth="600px",r.style.overflow="scroll",r.style.width="105%",r.style.height="100%",r.style.fontSize="10px",["log","error","warn","info","debug"].forEach(function(t){window.console[t]=i})}()}}}(),Viewer=function(o,s,u){a.call(this),void 0===s&&(s={antialias:!0}),this._options=s,s.SimulateWebGLLostContext&&(o=f.makeLostContextSimulatingCanvas(o),o.loseContextInNCalls(s.SimulateWebGLLostContext)),gl=d.setupWebGL(o,s,u);var h=this;if(o.addEventListener("webglcontextlost",function(t){h.contextLost(),t.preventDefault()},!1),o.addEventListener("webglcontextrestored",function(){h.contextRestored()},!1),(t.reportWebGLError||s.reportWebGLError)&&(gl=f.makeDebugContext(gl)),!gl)throw"No WebGL implementation found";this.setGraphicContext(gl),e.init(),this._canvas=o,this._frameRate=60,n.UpdateVisitor=r,n.CullVisitor=i,this._urlOptions=!0;var l=this._options.EventBackend||{};this._options.EventBackend=l,l.StandardMouseKeyboard=this._options.EventBackend.StandardMouseKeyboard||{};var c=l.StandardMouseKeyboard.mouseEventNode||s.mouseEventNode||o;l.StandardMouseKeyboard.mouseEventNode=c,l.StandardMouseKeyboard.keyboardEventNode=l.StandardMouseKeyboard.keyboardEventNode||document,l.Hammer=l.Hammer||{},l.Hammer.eventNode=l.Hammer.eventNode||s.mouseEventNode||o,l.GamePad=l.GamePad||{},this.setUpView(o)},Viewer.prototype=e.objectInehrit(a.prototype,{contextLost:function(){t.log("webgl context lost"),window.cancelRequestAnimFrame(this._requestID)},contextRestored:function(){t.log("webgl context restored, but not supported - reload the page")},init:function(){this._done=!1,this._state=new h;var t=this.getGraphicContext();this._state.setGraphicContext(t),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),this._updateVisitor=new n.UpdateVisitor,this._cullVisitor=new n.CullVisitor,this._renderStage=new o,this._stateGraph=new s,this._urlOptions&&this.parseOptions(),this.getCamera().setClearColor([0,0,0,0]),this._eventProxy=this.initEventProxy(this._options)},getState:function(){return this._state},parseOptions:function(){var t=function(){for(var t,e=[],r=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),i=0;i<r.length;i++){t=r[i].split("=");var n=t[0].toLowerCase();e.push(n);var a=t[1];void 0===a&&(a="1"),e[n]=a.toLowerCase()}return e},e=t();"1"===e.stats&&this.initStats(e);var r=this.getGraphicContext();"0"===e.depth_test&&this.getGraphicContext().disable(r.DEPTH_TEST),"0"===e.blend&&this.getGraphicContext().disable(r.BLEND),"0"===e.cull_face&&this.getGraphicContext().disable(r.CULL_FACE),"0"===e.light&&this.setLightingMode(a.LightingMode.NO_LIGHT)},initStats:function(t){var e=35,r=5;void 0!==t.statsMaxMS&&(e=parseInt(t.statsMaxMS,10)),void 0!==t.statsStepMS&&(r=parseInt(t.statsStepMS,10));var i=function(t){var i,n=['<div id="StatsDiv" style="top: 0; position: absolute; width: 300px; height: 150px; z-index: 10;">','<div id="StatsCanvasDiv" style="position: relative;">','<canvas id="StatsCanvasGrid" width="300" height="150" style="z-index:-1; position: absolute; background: rgba(14,14,14,0.8); " ></canvas>','<canvas id="StatsCanvas" width="300" height="150" style="z-index:8; position: absolute;" ></canvas>','<canvas id="StatsCanvasText" width="300" height="150" style="z-index:9; position: absolute;" ></canvas>',"</div>","</div>"].join("\n");i=void 0===t?document.body:document.getElementById(t);var a=document.createElement("div");a.innerHTML=n,i.appendChild(a);var o=document.getElementById("StatsCanvasGrid"),s=o.getContext("2d");s.clearRect(0,0,o.width,o.height);var u=Math.floor(e/r).toFixed(0),h=o.height/u;s.strokeStyle="rgb(70,70,70)";for(var l=0,c=u;c>l;l++)s.beginPath(),s.moveTo(0,l*h),s.lineTo(o.width,l*h),s.stroke();return{graph:document.getElementById("StatsCanvas"),text:document.getElementById("StatsCanvasText")}};if(void 0===this._canvasStats||null===this._canvasStats){var n=i();this._canvasStats=n.graph,this._canvasStatsText=n.text}this._stats=new p.Stats(this._canvasStats,this._canvasStatsText);var a=this;this._frameRate=1,this._frameTime=0,this._updateTime=0,this._cullTime=0,this._drawTime=0,this._stats.addLayer("#ff0fff",120,function(){return 1e3/a._frameRate},function(t){return"FrameRate: "+t.toFixed(0)+" fps"}),this._stats.addLayer("#ffff00",e,function(){return a._frameTime},function(t){return"FrameTime: "+t.toFixed(2)+" ms"}),this._stats.addLayer("#d07b1f",e,function(){return a._updateTime},function(t){return"UpdateTime: "+t.toFixed(2)+" ms"}),this._stats.addLayer("#73e0ff",e,function(){return a._cullTime},function(t){return"CullTime: "+t.toFixed(2)+" ms"}),this._stats.addLayer("#ff0000",e,function(){return a._drawTime},function(t){return"DrawTime: "+t.toFixed(2)+" ms"}),window.performance&&window.performance.memory&&window.performance.memory.totalJSHeapSize&&this._stats.addLayer("#00ff00",2*window.performance.memory.totalJSHeapSize,function(){return a._memSize},function(t){return"Memory : "+t.toFixed(0)+" b"})},update:function(){this.getScene().accept(this._updateVisitor)},cull:function(){this._stateGraph.clean(),this._renderStage.reset(),this._cullVisitor.reset(),this._cullVisitor.setStateGraph(this._stateGraph),this._cullVisitor.setRenderStage(this._renderStage);var t=this.getCamera();this._cullVisitor.pushStateSet(t.getStateSet()),this._cullVisitor.pushProjectionMatrix(t.getProjectionMatrix()),t.getBound();var e=u.makeIdentity([]);this._cullVisitor.pushModelviewMatrix(e),this._light&&this._cullVisitor.addPositionedAttribute(this._light),this._cullVisitor.pushModelviewMatrix(t.getViewMatrix()),this._cullVisitor.pushViewport(t.getViewport()),this._cullVisitor.setCullSettings(t),this._renderStage.setClearDepth(t.getClearDepth()),this._renderStage.setClearColor(t.getClearColor()),this._renderStage.setClearMask(t.getClearMask()),this._renderStage.setViewport(t.getViewport()),this.getScene().accept(this._cullVisitor),this._cullVisitor.popModelviewMatrix(),this._cullVisitor.popProjectionMatrix(),this._cullVisitor.popViewport(),this._cullVisitor.popStateSet(),this._renderStage.sort()},draw:function(){var t=this.getState();this._renderStage.draw(t),t.popAllStateSets(),t.applyWithoutProgram()},frame:function(){var t,r;t=e.performance.now(),void 0===this._lastFrameTime&&(this._lastFrameTime=0),this._frameRate=t-this._lastFrameTime,this._lastFrameTime=t,r=t;var i=this.getFrameStamp();0===i.getFrameNumber()&&(i.setReferenceTime(t/1e3),this._numberFrame=0),i.setSimulationTime(t/1e3-i.getReferenceTime()),this._updateVisitor.setFrameStamp(i),this.updateEventProxy(this._eventProxy,i),this.getManipulator()&&(this.getManipulator().update(this._updateVisitor),u.copy(this.getManipulator().getInverseMatrix(),this.getCamera().getViewMatrix())),void 0===this._stats?(this.update(),this.cull(),this.draw(),i.setFrameNumber(i.getFrameNumber()+1),this._numberFrame++,this._frameTime=e.performance.now()-r):(this._updateTime=e.performance.now(),this.update(),this._updateTime=e.performance.now()-this._updateTime,this._cullTime=e.performance.now(),this.cull(),this._cullTime=e.performance.now()-this._cullTime,this._drawTime=e.performance.now(),this.draw(),this._drawTime=e.performance.now()-this._drawTime,i.setFrameNumber(i.getFrameNumber()+1),this._numberFrame++,this._frameTime=e.performance.now()-r,window.performance&&window.performance.memory&&window.performance.memory.usedJSHeapSize&&(this._memSize=window.performance.memory.usedJSHeapSize),this._stats.update())
},setDone:function(t){this._done=t},done:function(){return this._done},run:function(){var t=this,e=function(){t.done()||(t._requestID=window.requestAnimationFrame(e,t.canvas),t.frame())};e()},setupManipulator:function(e){void 0===e&&(e=new l),void 0!==e.setNode?e.setNode(this.getSceneData()):e.view=this,this.setManipulator(e);var r=this,i=function(){var e=window.innerWidth,i=window.innerHeight,n=r.getCamera(),a=n.getViewport(),o=a.width(),s=a.height();r._canvas.width=e,r._canvas.height=i,r._canvas.style.width=e,r._canvas.style.height=i,t.debug("window resize "+o+"x"+s+" to "+e+"x"+i);var h=e/o,l=i/s,c=h/l;a.setViewport(a.x()*h,a.y()*l,a.width()*h,a.height()*l),1!==c&&u.preMult(n.getProjectionMatrix(),u.makeScale(1/c,1,1,[]))};window.onresize=i},initEventProxy:function(t){for(var e=t||{},r={},i=c,n=e.EventBackend,a=window.Object.keys(i),o=0,s=a.length;s>o;o++){var u=a[o],h=!0,l={};if(n&&void 0!==n[u]&&(h=n[u].enable||!0,l=n[u]),h){var d=new i[u](this);d.init(l),r[u]=d}}return r},updateEventProxy:function(t,e){var r=window.Object.keys(t);r.forEach(function(r){var i=t[r];i.update&&i.update(e)})}}),Viewer}),n("osgViewer/osgViewer",["osgViewer/View","osgViewer/Viewer","osgViewer/eventProxy/EventProxy"],function(t,e,r){var i={};return i.View=t,i.Viewer=e,i.EventProxy=r,i}),n("OSG",["osg/osg","osgAnimation/osgAnimation","osgDB/osgDB","osgGA/osgGA","osgUtil/osgUtil","osgViewer/osgViewer"],function(t,e,r,i,n,a){var o={};return o.version="0.0.5",o.copyright="Cedric Pinson - cedric.pinson@plopbyte.com",o.osg=t,o.osgAnimation=e,o.osgDB=r,o.osgGA=i,o.osgUtil=n,o.osgViewer=a,o}),i(["OSG"]),i("OSG")}();