function ReadJSON() {}
  ReadJSON.create = function()
  {
  return {
  "children": [ {
      "children": [ {
          "children": [ {
              "name": "Lamp.005"
            }
          ],
          "matrix": [ 0.87356, 0, -0.48672, 0, 0, 1, 0, 0, 0.48672, 0, 0.87356, 0, 4.35791, 0, 0, 1 ],
          "name": "Lamp.005"
        },
{
          "children": [ {
              "name": "Lamp.004"
            }
          ],
          "matrix": [ 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 4.2323, 1.87315, 1 ],
          "name": "Lamp.004"
        },
{
          "children": [ {
              "children": [ {
                  "attributes": {
                    "Normal": {
                      "elements": [ -0.57735, -0.57735, -0.57735, -0.40825, -0.40825, 0.81649, -0.66665, 0.66665, 0.33332, -0.66665, 0.66665, 0.33332, -0.57735, 0.57735, -0.57735, 0.81649, -0.40825, -0.40825, 0.40825, -0.81649, 0.40825, -0.57735, -0.57735, -0.57735, 0.40825, -0.81649, 0.40825, 0.33332, 0.66665, -0.66665, 0.66665, 0.33332, 0.66665, 0.81649, -0.40825, -0.40825, 0.66665, 0.33332, 0.66665, -0.40825, -0.40825, 0.81649, 0.40825, -0.81649, 0.40825, 0.81649, -0.40825, -0.40825, -0.57735, -0.57735, -0.57735 ],
                      "itemSize": 3,
                      "type": "ARRAY_BUFFER"
                    },
                    "TexCoord0": {
                      "elements": [ 0, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0 ],
                      "itemSize": 2,
                      "type": "ARRAY_BUFFER"
                    },
                    "Vertex": {
                      "elements": [ -1, -1, -1, -1, -1, 1, -1, 1, 1, -1, 1, 1, -1, 1, -1, 1, -1, -1, 1, -1, 1, -1, -1, -1, 1, -1, 1, 1, 1, -1, 1, 1, 1, 1, -1, -1, 1, 1, 1, -1, -1, 1, 1, -1, 1, 1, -1, -1, -1, -1, -1 ],
                      "itemSize": 3,
                      "type": "ARRAY_BUFFER"
                    }
                  },
                  "name": "CubeMultiMat",
                  "primitives": [ {
                      "indices": {
                        "elements": [ 0, 1, 2, 0, 3, 4, 5, 6, 7, 8, 1, 7, 9, 10, 11, 12, 6, 11, 12, 3, 13, 12, 1, 14, 9, 15, 7, 9, 16, 4 ],
                        "itemSize": 1,
                        "type": "ELEMENT_ARRAY_BUFFER"
                      },
                      "mode": "TRIANGLES"
                    }
                  ],
                  "stateset": {
                    "material": {
                      "ambient": [ 0.35913, 0.10205, 0.10205, 1, ],
                      "diffuse": [ 0.43095, 0.12246, 0.12246, 1, ],
                      "emission": [ 0, 0, 0, 1, ],
                      "name": "red",
                      "shininess": 12.5,
                      "specular": [ 0, 0, 0, 1, ]
                    }
                  }
                },
{
                  "attributes": {
                    "Normal": {
                      "elements": [ 0.66665, 0.33332, 0.66665, 0.33332, 0.66665, -0.66665, -0.66665, 0.66665, 0.33332, -0.57735, 0.57735, -0.57735 ],
                      "itemSize": 3,
                      "type": "ARRAY_BUFFER"
                    },
                    "TexCoord0": {
                      "elements": [ 1, 0, 1, 1, 0, 0, 0, 1 ],
                      "itemSize": 2,
                      "type": "ARRAY_BUFFER"
                    },
                    "Vertex": {
                      "elements": [ 1, 1, 1, 1, 1, -1, -1, 1, 1, -1, 1, -1 ],
                      "itemSize": 3,
                      "type": "ARRAY_BUFFER"
                    }
                  },
                  "name": "CubeMultiMat",
                  "primitives": [ {
                      "indices": {
                        "elements": [ 0, 1, 2, 1, 3, 2 ],
                        "itemSize": 1,
                        "type": "ELEMENT_ARRAY_BUFFER"
                      },
                      "mode": "TRIANGLES"
                    }
                  ],
                  "stateset": {
                    "material": {
                      "ambient": [ 0.44444, 0.06106, 0.06106, 1, ],
                      "diffuse": [ 0.71111, 0.0977, 0.0977, 1, ],
                      "emission": [ 0, 0, 0, 1, ],
                      "name": "Material.002",
                      "shininess": 12.5,
                      "specular": [ 0.5, 0.5, 0.5, 1, ]
                    },
                    "textures": [ {
                        "file": "textures/One.png",
                        "mag_filter": "LINEAR",
                        "min_filter": "LINEAR_MIPMAP_LINEAR"
                      }
                    ]
                  }
                }
              ],
              "name": "GeodeCubeMultiMat"
            }
          ],
          "matrix": [ 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 11.2931, 0, 1 ],
          "name": "CubeMultiMat"
        },
{
          "children": [ {
              "children": [ {
                  "attributes": {
                    "Normal": {
                      "elements": [ 0.66665, 0.33332, 0.66665, 0.33332, 0.66665, -0.66665, -0.66665, 0.66665, 0.33332, -0.57735, 0.57735, -0.57735, -0.57735, -0.57735, -0.57735, -0.40825, -0.40825, 0.81649, 0.81649, -0.40825, -0.40825, 0.40825, -0.81649, 0.40825 ],
                      "itemSize": 3,
                      "type": "ARRAY_BUFFER"
                    },
                    "Vertex": {
                      "elements": [ 1, 1, 1, 1, 1, -1, -1, 1, 1, -1, 1, -1, -1, -1, -1, -1, -1, 1, 1, -1, -1, 1, -1, 1 ],
                      "itemSize": 3,
                      "type": "ARRAY_BUFFER"
                    }
                  },
                  "name": "CubeTriangleMaterial",
                  "primitives": [ {
                      "indices": {
                        "elements": [ 0, 1, 2, 1, 3, 2, 4, 5, 2, 4, 2, 3, 6, 7, 4, 7, 5, 4, 1, 0, 6, 0, 7, 6, 0, 2, 5, 0, 5, 7, 1, 6, 4, 1, 4, 3 ],
                        "itemSize": 1,
                        "type": "ELEMENT_ARRAY_BUFFER"
                      },
                      "mode": "TRIANGLES"
                    }
                  ],
                  "stateset": {
                    "material": {
                      "ambient": [ 0.35913, 0.10205, 0.10205, 1, ],
                      "diffuse": [ 0.43095, 0.12246, 0.12246, 1, ],
                      "emission": [ 0, 0, 0, 1, ],
                      "name": "red",
                      "shininess": 12.5,
                      "specular": [ 0, 0, 0, 1, ]
                    }
                  }
                }
              ],
              "name": "GeodeCubeTriangleMaterial"
            }
          ],
          "matrix": [ 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 7.97427, 0, 1 ],
          "name": "CubeTriangleMaterial"
        },
{
          "children": [ {
              "children": [ {
                  "attributes": {
                    "Normal": {
                      "elements": [ 0.66665, 0.33332, 0.66665, 0.33332, 0.66665, -0.66665, -0.66665, 0.66665, 0.33332, -0.57735, 0.57735, -0.57735, -0.57735, -0.57735, -0.57735, -0.40825, -0.40825, 0.81649, 0.81649, -0.40825, -0.40825, 0.40825, -0.81649, 0.40825 ],
                      "itemSize": 3,
                      "type": "ARRAY_BUFFER"
                    },
                    "Vertex": {
                      "elements": [ 1, 1, 1, 1, 1, -1, -1, 1, 1, -1, 1, -1, -1, -1, -1, -1, -1, 1, 1, -1, -1, 1, -1, 1 ],
                      "itemSize": 3,
                      "type": "ARRAY_BUFFER"
                    }
                  },
                  "name": "CubeTriangleSmooth",
                  "primitives": [ {
                      "indices": {
                        "elements": [ 0, 1, 2, 1, 3, 2, 4, 5, 2, 4, 2, 3, 6, 7, 4, 7, 5, 4, 1, 0, 6, 0, 7, 6, 0, 2, 5, 0, 5, 7, 1, 6, 4, 1, 4, 3 ],
                        "itemSize": 1,
                        "type": "ELEMENT_ARRAY_BUFFER"
                      },
                      "mode": "TRIANGLES"
                    }
                  ]
                }
              ],
              "name": "GeodeCubeTriangleSmooth"
            }
          ],
          "matrix": [ 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 2.54099, 0, 1 ],
          "name": "CubeTriangleSmooth"
        },
{
          "children": [ {
              "children": [ {
                  "attributes": {
                    "Normal": {
                      "elements": [ 0.66665, 0.33332, 0.66665, 0.33332, 0.66665, -0.66665, -0.66665, 0.66665, 0.33332, -0.57735, 0.57735, -0.57735, -0.57735, -0.57735, -0.57735, -0.40825, -0.40825, 0.81649, -0.66665, 0.66665, 0.33332, -0.57735, 0.57735, -0.57735, 0.81649, -0.40825, -0.40825, 0.40825, -0.81649, 0.40825, -0.57735, -0.57735, -0.57735, -0.40825, -0.40825, 0.81649, 0.33332, 0.66665, -0.66665, 0.66665, 0.33332, 0.66665, 0.81649, -0.40825, -0.40825, 0.40825, -0.81649, 0.40825, 0.66665, 0.33332, 0.66665, -0.66665, 0.66665, 0.33332, -0.40825, -0.40825, 0.81649, 0.40825, -0.81649, 0.40825, 0.33332, 0.66665, -0.66665, 0.81649, -0.40825, -0.40825, -0.57735, -0.57735, -0.57735, -0.57735, 0.57735, -0.57735 ],
                      "itemSize": 3,
                      "type": "ARRAY_BUFFER"
                    },
                    "TexCoord0": {
                      "elements": [ 1, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0 ],
                      "itemSize": 2,
                      "type": "ARRAY_BUFFER"
                    },
                    "TexCoord1": {
                      "elements": [ 1, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0 ],
                      "itemSize": 2,
                      "type": "ARRAY_BUFFER"
                    },
                    "Vertex": {
                      "elements": [ 1, 1, 1, 1, 1, -1, -1, 1, 1, -1, 1, -1, -1, -1, -1, -1, -1, 1, -1, 1, 1, -1, 1, -1, 1, -1, -1, 1, -1, 1, -1, -1, -1, -1, -1, 1, 1, 1, -1, 1, 1, 1, 1, -1, -1, 1, -1, 1, 1, 1, 1, -1, 1, 1, -1, -1, 1, 1, -1, 1, 1, 1, -1, 1, -1, -1, -1, -1, -1, -1, 1, -1 ],
                      "itemSize": 3,
                      "type": "ARRAY_BUFFER"
                    }
                  },
                  "name": "CubeTriangleTextured",
                  "primitives": [ {
                      "indices": {
                        "elements": [ 0, 1, 2, 1, 3, 2, 4, 5, 6, 4, 6, 7, 8, 9, 10, 9, 11, 10, 12, 13, 14, 13, 15, 14, 16, 17, 18, 16, 18, 19, 20, 21, 22, 20, 22, 23 ],
                        "itemSize": 1,
                        "type": "ELEMENT_ARRAY_BUFFER"
                      },
                      "mode": "TRIANGLES"
                    }
                  ],
                  "stateset": {
                    "material": {
                      "ambient": [ 0.4, 0.4, 0.4, 1, ],
                      "diffuse": [ 0.64, 0.64, 0.64, 1, ],
                      "emission": [ 0, 0, 0, 1, ],
                      "name": "Material.004",
                      "shininess": 12.5,
                      "specular": [ 0.5, 0.5, 0.5, 1, ]
                    },
                    "textures": [ {
                        "file": "textures/One.png",
                        "mag_filter": "LINEAR",
                        "min_filter": "LINEAR_MIPMAP_LINEAR"
                      },
{
                        "file": "textures/Two.png",
                        "mag_filter": "LINEAR",
                        "min_filter": "LINEAR_MIPMAP_LINEAR"
                      }
                    ]
                  }
                }
              ],
              "name": "GeodeCubeTriangleTextured"
            }
          ],
          "matrix": [ 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 5.12236, 0, 1 ],
          "name": "CubeTriangleTextured"
        },
{
          "children": [ {
              "children": [ {
                  "attributes": {
                    "Normal": {
                      "elements": [ 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, -1, 0, -0, -1, 0, -0, -1, 0, -0, -1, 0, -0, -1, 0, -0, -1, 0, -0, -0, -1, -0, -0, -1, -0, -0, -1, -0, -0, -1, 0, -0, -1, 0, -0, -1, 0, 1, 0, -0, 1, 0, -0, 1, 0, -0, 1, -0, 0, 1, -0, 0, 1, -0, 0, -0, 0, 1, -0, 0, 1, -0, 0, 1, 0, -0, 1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, -0, -1 ],
                      "itemSize": 3,
                      "type": "ARRAY_BUFFER"
                    },
                    "Vertex": {
                      "elements": [ 1, 1, 1, 1, 1, -1, -1, 1, 1, 1, 1, -1, -1, 1, -1, -1, 1, 1, -1, -1, -1, -1, -1, 1, -1, 1, 1, -1, -1, -1, -1, 1, 1, -1, 1, -1, 1, -1, -1, 1, -1, 1, -1, -1, -1, 1, -1, 1, -1, -1, 1, -1, -1, -1, 1, 1, -1, 1, 1, 1, 1, -1, -1, 1, 1, 1, 1, -1, 1, 1, -1, -1, 1, 1, 1, -1, 1, 1, -1, -1, 1, 1, -1, 1, 1, 1, -1, 1, -1, -1, -1, -1, -1, -1, 1, -1 ],
                      "itemSize": 3,
                      "type": "ARRAY_BUFFER"
                    }
                  },
                  "name": "CubeTriangle",
                  "primitives": [ {
                      "indices": {
                        "elements": [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 24, 26, 27, 28, 29, 30, 28, 30, 31 ],
                        "itemSize": 1,
                        "type": "ELEMENT_ARRAY_BUFFER"
                      },
                      "mode": "TRIANGLES"
                    }
                  ]
                }
              ],
              "name": "GeodeCubeTriangle"
            }
          ],
          "matrix": [ 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1 ],
          "name": "CubeTriangle"
        },
{
          "children": [ {
              "children": [ {
                  "attributes": {
                    "Normal": {
                      "elements": [ 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, -0, 1, 0, -0, 1, 0, -0, 1, 0, -0, 1, 1, -0, 0, 1, -0, 0, 1, -0, 0, 1, -0, 0, -0, -1, -0, -0, -1, -0, -0, -1, -0, -0, -1, -0, -1, 0, -0, -1, 0, -0, -1, 0, -0, -1, 0, -0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0 ],
                      "itemSize": 3,
                      "type": "ARRAY_BUFFER"
                    },
                    "Vertex": {
                      "elements": [ 1, 1, -1, 1, -1, -1, -1, -1, -1, -1, 1, -1, 1, 1, 1, -1, 1, 1, -1, -1, 1, 1, -1, 1, 1, 1, -1, 1, 1, 1, 1, -1, 1, 1, -1, -1, 1, -1, -1, 1, -1, 1, -1, -1, 1, -1, -1, -1, -1, -1, -1, -1, -1, 1, -1, 1, 1, -1, 1, -1, 1, 1, 1, 1, 1, -1, -1, 1, -1, -1, 1, 1 ],
                      "itemSize": 3,
                      "type": "ARRAY_BUFFER"
                    }
                  },
                  "name": "CubeQuads",
                  "primitives": [ {
                      "indices": {
                        "elements": [ 0, 1, 3, 1, 2, 3, 4, 5, 7, 5, 6, 7, 8, 9, 11, 9, 10, 11, 12, 13, 15, 13, 14, 15, 16, 17, 19, 17, 18, 19, 20, 21, 23, 21, 22, 23 ],
                        "itemSize": 1,
                        "type": "ELEMENT_ARRAY_BUFFER"
                      },
                      "mode": "TRIANGLES"
                    }
                  ]
                }
              ],
              "name": "GeodeCubeQuads"
            }
          ],
          "matrix": [ 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, -2.20374, 0, 1 ],
          "name": "CubeQuads"
        }
      ],
      "name": "Root"
    }
  ]
};
  };




OSG.globalify();

var main = function() {
	osg.ReportWebGLError = true;
    var canvas = document.getElementById("3DView");
    var w = window.innerWidth;
    var h = window.innerHeight;
    osg.log("size " + w + " x " + h );
    canvas.style.width = w;
    canvas.style.height = h;
    canvas.width = w;
    canvas.height = h;

    var stats = document.getElementById("Stats");
	var lod;
    var viewer;
	
    // try {
        viewer = new osgViewer.Viewer(canvas, {antialias : true, alpha: true });
        viewer.init();
        viewer.setupManipulator();
     //   var node = new osg.Node();
     //   node.addChild();
        
        viewer.getCamera().setClearColor([1.0, 1.0, 1.0, 1.0]);
        viewer.setSceneData(createScene());
       // var bs = lod.getBound();
		viewer.setupManipulator();
	//	viewer.getManipulator().setDistance(bs.radius()*1.5);
	//	viewer.getManipulator().setTarget(bs.center()); 
        // viewer.getManipulator().setDistance(100.0);
        // viewer.getManipulator().setTarget([0,0,0]);

        viewer.run();

    // } catch (er) {
    //     osg.log("exception in osgViewer " + er);
    // }
};

function createScene() {
    var lodNode = new osg.Lod();
    var o = ReadJSON.create();
    Q.when(osgDB.parseSceneGraph(o)).then(function(o) { 
    lodNode.addChild(o,0,20);
    });
    
    Q.when(osgDB.parseSceneGraph(getModelB())).then(function(o) { 
    lodNode.addChild(o,20,100);
    });
    
    Q.when(osgDB.parseSceneGraph(getModel())).then(function(data) {
    lodNode.addChild(data,100,300);
    });
    return lodNode;
   
  /*  var node = new osg.Node();

	

   	Q.when(osgDB.parseSceneGraph(getModel())).then(function(data) {
		node.addChild(data);
		});
    return node; */
}

var getModel = function(func) {
    var defer = Q.defer();
    var node = new osg.Lod();
    //node.setMatrix(osg.Matrix.makeRotate(-Math.PI/2, 1,0,0, []));
    var loadModel = function(url) 
    {
        osg.log("loading " + url);
        var reader = new FileReader();
		reader.onload = function(e) 
		{
			text = reader.result;
			Q.when(osgDB.parseSceneGraph(JSON.parse(text))).then(
				function(child) 
				{		
					node.addChild(child,10,20);
					
					defer.resolve(node);
					//removeLoading(node, child);
					osg.log("success " + url);	  
				}
			);
			
	    };  
	 reader.readAsText(url);	
	};
        /*var req = new XMLHttpRequest();
        req.open('GET', url, true);
        req.onreadystatechange = function (aEvt) {
            if (req.readyState == 4) {
                var child;
                if(req.status == 200) {
                    Q.when(osgDB.parseSceneGraph(JSON.parse(req.responseText))).then(function(child) {
                        node.addChild(child);
                        removeLoading(node, child);
                        defer.resolve(node);
                        osg.log("success " + url);
                    });
                } else{
                    removeLoading(node, child);
                    osg.log("error " + url);
                }
            }
        };
        req.send(null);
        addLoading();*/
    
    //loadModel('monkey.osgjs');
    //loadModel('sponza.osgjs');
    loadModel('raceship.osgjs');
    return defer.promise;
};

window.addEventListener("load", main ,true);
