var requirejs,require,define;(function(e){function c(e,t){return f.call(e,t)}function h(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!a&&v&&v[r]&&(a=v[r],f=l)}!s&&a&&(s=a,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function p(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function d(e){return function(t){return h(t,e)}}function v(e){return function(t){s[e]=t}}function m(n){if(c(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!c(s,n)&&!c(a,n))throw new Error("No "+n);return s[n]}function g(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function y(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice;r=function(e,t){var n,r=g(e),i=r[0];return e=r[1],i&&(i=h(i,t),n=m(i)),i?n&&n.normalize?e=n.normalize(e,d(t)):e=h(e,t):(e=h(e,t),r=g(e),i=r[0],e=r[1],i&&(n=m(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return p(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:y(e)}}},t=function(t,n,u,f){var l,h,d,g,y,b=[],w;f=f||t;if(typeof u=="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){g=r(n[y],f),h=g.f;if(h==="require")b[y]=i.require(t);else if(h==="exports")b[y]=i.exports(t),w=!0;else if(h==="module")l=b[y]=i.module(t);else if(c(s,h)||c(o,h)||c(a,h))b[y]=m(h);else{if(!g.p)throw new Error(t+" missing "+h);g.p.load(g.n,p(f,!0),v(h),{}),b[y]=s[h]}}d=u.apply(s[t],b);if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(d!==e||!w)s[t]=d}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){return typeof s=="string"?i[s]?i[s](o):m(r(s,o).f):(s.splice||(u=s,o.splice?(s=o,o=a,a=null):s=e),o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n)},n.config=function(e){return u=e,u.deps&&n(u.deps,u.callback),n},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!c(s,e)&&!c(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("almond",function(){}),define("osgUtil/osgPool",[],function(){var e={};return e.memoryPools={},e.OsgObjectMemoryPool=function(e){return{_memPool:[],reset:function(){return this._memPool=[],this},put:function(e){this._memPool.push(e)},get:function(){return this._memPool.length>0?this._memPool.pop():(this.grow(),this.get())},grow:function(t){t===undefined&&(t=this._memPool.length>0?this._memPool.length*2:20);var n=this._memPool.length;while(n++<t)this._memPool.push(new e);return this}}},e.OsgArrayMemoryPool=function(){return{_mempoolofPools:[],reset:function(){return this._memPoolofPools={},this},put:function(e){this._memPoolofPools[e.length]||(this._memPoolofPools[e.length]=[]),this._memPoolofPools[e.length].push(e)},get:function(e){if(!this._memPoolofPools[e])this._memPoolofPools[e]=[];else if(this._memPoolofPools.length>0)return this._memPool.pop();return this.grow(e),this.get()},grow:function(e,t){t===undefined&&(t=this._memPool.length>0?this._memPool.length*2:20);var n=this._memPool.length;while(n++<t)this._memPool.push(new Array(e));return this}}},e}),define("osg/StateGraph",["osgUtil/osgPool"],function(e){var t=function(){this.depth=0,this.children={},this.children.keys=[],this.leafs=[],this.stateset=undefined,this.parent=undefined};return t.prototype={clean:function(){this.leafs.splice(0,this.leafs.length),this.stateset=undefined,this.parent=undefined,this.depth=0;var t,n=this.children.keys;for(var r=0,i=n.length;r<i;r++)t=n[r],this.children[t].clean(),e.memoryPools.stateGraph.put(this.children[t]);this.children={},n.splice(0,n.length),this.children.keys=n},getStateSet:function(){return this.stateset},findOrInsert:function(t){var n;return this.children[t.id]?n=this.children[t.id]:(n=e.memoryPools.stateGraph.get(),n.parent=this,n.depth=this.depth+1,n.stateset=t,this.children[t.id]=n,this.children.keys.push(t.id)),n},moveToRootStateGraph:function(e,t){while(t)t.stateSet&&e.popStateSet(),t=t._parent},moveStateGraph:function(e,t,n){var r,i;if(n===t||n===undefined)return;if(t===undefined){r=[];do n.stateset!==undefined&&r.push(n.stateset),n=n.parent;while(n);r.reverse();for(i=0,l=r.length;i<l;++i)e.pushStateSet(r[i]);return}if(t.parent===n.parent){t.stateset!==undefined&&e.popStateSet(),n.stateset!==undefined&&e.pushStateSet(n.stateset);return}while(t.depth>n.depth)t.stateset!==undefined&&e.popStateSet(),t=t.parent;r=[];while(n.depth>t.depth)n.stateset!==undefined&&r.push(n.stateset),n=n.parent;while(t!==n)t.stateset!==undefined&&e.popStateSet(),t=t.parent,n.stateset!==undefined&&r.push(n.stateset),n=n.parent;r.reverse(),stackLength=r.length;for(i=0;i<stackLength;++i)e.pushStateSet(r[i])}},t}),define("osg/Utils",["osgUtil/osgPool","osg/StateGraph"],function(e,t){var n={};return n.init=function(){e.memoryPools.stateGraph=(new e.OsgObjectMemoryPool(t)).grow(50)},n.isArray=function(e){return toString.call(e)==="[object Array]"},n.extend=function(){var e=Object.prototype.toString,t=Object.prototype.hasOwnProperty,r=function(t){return e.call(t)==="[object Function]"},i=n.isArray,s=function(n){if(!n||e.call(n)!=="[object Object]"||n.nodeType||n.setInterval)return!1;if(n.constructor&&!t.call(n,"constructor")&&!t.call(n.constructor.prototype,"isPrototypeOf"))return!1;var r;for(r in n);return r===undefined||t.call(n,r)},o=arguments[0]||{},u=1,a=arguments.length,f=!1,l,c,h,p;typeof o=="boolean"&&(f=o,o=arguments[1]||{},u=2),typeof o!="object"&&!r(o)&&(o={}),a===u&&(o=this,--u);for(;u<a;u++)if((l=arguments[u])!==null)for(c in l){h=o[c],p=l[c];if(o===p)continue;if(f&&p&&(s(p)||i(p))){var d=h&&(s(h)||i(h))?h:i(p)?[]:{};o[c]=n.extend(f,d,p)}else p!==undefined&&(o[c]=p)}return o},n.objectInehrit=n.objectInherit=function(e,t){function r(){}r.prototype=e;var i=new r;for(var s=1;s<arguments.length;s++)n.objectMix(i,arguments[s],!1);return i},n.objectMix=function(e,t,n){for(var r in t)if(!n||!e[r])e[r]=t[r];return e},n.objectLibraryClass=function(e,t,n){e.className=function(){return n},e.libraryName=function(){return t};var r=t+"::"+n;return e.libraryClassName=function(){return r},e},n.objectType={},n.objectType.type=0,n.objectType.generate=function(e){var t=n.objectType.type;return n.objectType[t]=e,n.objectType[e]=t,n.objectType.type+=1,t},n.Float32Array=typeof Float32Array!="undefined"?Float32Array:null,n.Int32Array=typeof Int32Array!="undefined"?Int32Array:null,n.Uint16Array=typeof Uint16Array!="undefined"?Uint16Array:null,n.performance={},n.performance.now=function(){if(window.performance===undefined)return function(){return Date.now()};var e=window.performance.now||window.performance.mozNow||window.performance.msNow||window.performance.oNow||window.performance.webkitNow||function(){return Date.now()};return function(){return e.apply(window.performance,arguments)}}(),n}),define("osg/Object",["osg/Utils"],function(e){var t=function(){this._name=undefined,this._userdata=undefined,this._instanceID=t.getInstanceID()};return t.prototype=e.objectLibraryClass({getInstanceID:function(){return this._instanceID},setName:function(e){this._name=e},getName:function(){return this._name},setUserData:function(e){this._userdata=e},getUserData:function(){return this._userdata}},"osg","Object"),function(){var e=0;t.getInstanceID=function(){return e+=1,e}}(),t}),define("osg/StateAttribute",["osg/Utils","osg/Object"],function(e,t){var n=function(){t.call(this),this._dirty=!0};return n.prototype=e.objectLibraryClass(e.objectInherit(t.prototype,{isDirty:function(){return this._dirty},dirty:function(){this._dirty=!0},setDirty:function(e){this._dirty=e}}),"osg","StateAttribute"),n.OFF=0,n.ON=1,n.OVERRIDE=2,n.PROTECTED=4,n.INHERIT=8,n}),define("osg/BlendColor",["osg/Utils","osg/StateAttribute"],function(e,t){var n=function(e){t.call(this),this._constantColor=new Array(4),this._constantColor[0]=this._constantColor[1]=this._constantColor[2]=this._constantColor[3]=1,e!==undefined&&this.setConstantColor(e)};return n.prototype=e.objectLibraryClass(e.objectInehrit(t.prototype,{attributeType:"BlendColor",cloneType:function(){return new n},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},getConstantColor:function(){return this._constantColor},apply:function(e){var t=e.getGraphicContext();t.blendColor(this._constantColor[0],this._constantColor[1],this._constantColor[2],this._constantColor[3]),this._dirty=!1}}),"osg","BlendColor"),n}),define("osg/BlendFunc",["osg/Utils","osg/StateAttribute"],function(e,t){var n=function(e,r,i,s){t.call(this),this._sourceFactor=n.ONE,this._destinationFactor=n.ZERO,this._sourceFactorAlpha=this._sourceFactor,this._destinationFactorAlpha=this._destinationFactor,this._separate=!1,e!==undefined&&this.setSource(e),r!==undefined&&this.setDestination(r),i!==undefined&&this.setSourceAlpha(i),s!==undefined&&this.setDestinationAlpha(s)};return n.ZERO=0,n.ONE=1,n.SRC_COLOR=768,n.ONE_MINUS_SRC_COLOR=769,n.SRC_ALPHA=770,n.ONE_MINUS_SRC_ALPHA=771,n.DST_ALPHA=772,n.ONE_MINUS_DST_ALPHA=773,n.DST_COLOR=774,n.ONE_MINUS_DST_COLOR=775,n.SRC_ALPHA_SATURATE=776,n.BLEND_DST_RGB=32968,n.BLEND_SRC_RGB=32969,n.BLEND_DST_ALPHA=32970,n.BLEND_SRC_ALPHA=32971,n.CONSTANT_COLOR=32769,n.ONE_MINUS_CONSTANT_COLOR=32770,n.CONSTANT_ALPHA=32771,n.ONE_MINUS_CONSTANT_ALPHA=32772,n.BLEND_COLOR=32773,n.prototype=e.objectLibraryClass(e.objectInehrit(t.prototype,{attributeType:"BlendFunc",cloneType:function(){return new n},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setSource:function(e){this.setSourceRGB(e),this.setSourceAlpha(e)},setDestination:function(e){this.setDestinationRGB(e),this.setDestinationAlpha(e)},checkSeparate:function(){return this._sourceFactor!==this._sourceFactorAlpha||this._destinationFactor!==this._destinationFactorAlpha},setSourceRGB:function(e){typeof e=="string"?this._sourceFactor=n[e]:this._sourceFactor=e,this._separate=this.checkSeparate()},setSourceAlpha:function(e){typeof e=="string"?this._sourceFactorAlpha=n[e]:this._sourceFactorAlpha=e,this._separate=this.checkSeparate()},setDestinationRGB:function(e){typeof e=="string"?this._destinationFactor=n[e]:this._destinationFactor=e,this._separate=this.checkSeparate()},setDestinationAlpha:function(e){typeof e=="string"?this._destinationFactorAlpha=n[e]:this._destinationFactorAlpha=e,this._separate=this.checkSeparate()},apply:function(e){var t=e.getGraphicContext();t.enable(t.BLEND),this._separate?t.blendFuncSeparate(this._sourceFactor,this._destinationFactor,this._sourceFactorAlpha,this._destinationFactorAlpha):t.blendFunc(this._sourceFactor,this._destinationFactor)}}),"osg","BlendFunc"),n}),define("osg/BoundingBox",["osg/Utils"],function(e){var t=function(){this.init()};return t.prototype=e.objectLibraryClass({_cache_radius2_tmp:[0,0,0],init:function(){this._min=[Infinity,Infinity,Infinity],this._max=[-Infinity,-Infinity,-Infinity]},valid:function(){return this._max[0]>=this._min[0]&&this._max[1]>=this._min[1]&&this._max[2]>=this._min[2]},expandBySphere:function(e){if(!e.valid())return;var t=this._max,n=this._min;n[0]=Math.min(n[0],e._center[0]-e._radius),n[1]=Math.min(n[1],e._center[1]-e._radius),n[2]=Math.min(n[2],e._center[2]-e._radius),t[0]=Math.max(t[0],e._center[0]+e._radius),t[1]=Math.max(t[1],e._center[1]+e._radius),t[2]=Math.max(t[2],e._center[2]+e._radius)},expandByVec3:function(e){var t=this._min,n=this._max;t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),n[0]=Math.max(n[0],e[0]),n[1]=Math.max(n[1],e[1]),n[2]=Math.max(n[2],e[2])},center:function(){var e=this._min,t=this._max;return[(e[0]+t[0])*.5,(e[1]+t[1])*.5,(e[2]+t[2])*.5]},radius:function(){return Math.sqrt(this.radius2())},radius2:function(){var e=this._min,t=this._max,n=this._cache_radius2_tmp;return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],.25*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2])},corner:function(e){return ret=[0,0,0],e&1?ret[0]=this._max[0]:ret[0]=this._min[0],e&2?ret[1]=this._max[1]:ret[1]=this._min[1],e&4?ret[2]=this._max[2]:ret[2]=this._min[2],ret}},"osg","BoundingBox"),t}),define("osg/Vec3",[],function(){var e={init:function(e){return e[0]=0,e[1]=0,e[2]=0,e},copy:function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},cross:function(e,t,n){var r=e[1]*t[2]-e[2]*t[1],i=e[2]*t[0]-e[0]*t[2],s=e[0]*t[1]-e[1]*t[0];return n[0]=r,n[1]=i,n[2]=s,n},valid:function(e){return isNaN(e[0])?!1:isNaN(e[1])?!1:isNaN(e[2])?!1:!0},mult:function(e,t,n){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n},length2:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},length:function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},distance:function(e,t){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+r*r+i*i)},normalize:function(e,t){var n=this.length2(e);if(n>0){var r=1/Math.sqrt(n);t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}else t[0]=e[0],t[1]=e[1],t[2]=e[2];return t},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},sub:function(e,t,n){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n},add:function(e,t,n){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n},neg:function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},lerp:function(e,t,n,r){return r[0]=t[0]+(n[0]-t[0])*e,r[1]=t[1]+(n[1]-t[1])*e,r[2]=t[2]+(n[2]-t[2])*e,r}};return e}),define("osg/BoundingSphere",["osg/Vec3"],function(e){var t=function(){this._center=[0,0,0],this._radius=-1};return t.prototype={init:function(){this._center=[0,0,0],this._radius=-1},valid:function(){return this._radius>=0},set:function(e,t){this._center=e,this._radius=t},center:function(){return this._center},radius:function(){return this._radius},radius2:function(){return this._radius*this._radius},expandByBox:function(t){if(t.valid()){var n;if(this.valid()){var r=new BoundingBox;r._min[0]=t._min[0],r._min[1]=t._min[1],r._min[2]=t._min[2],r._max[0]=t._max[0],r._max[1]=t._max[1],r._max[2]=t._max[2];for(var i=0;i<8;i++){var s=e.sub(t.corner(n),this._center,[]);e.normalize(s,s),nv[0]*=-this._radius,nv[1]*=-this._radius,nv[2]*=-this._radius,nv[0]+=this._center[0],nv[1]+=this._center[1],nv[2]+=this._center[2],r.expandBy(nv)}n=r.center(),this._center[0]=n[0],this._center[1]=n[1],this._center[2]=n[2],this._radius=r.radius()}else n=t.center(),this._center[0]=n[0],this._center[1]=n[1],this._center[2]=n[2],this._radius=t.radius()}},expandByVec3:function(t){if(this.valid()){var n=e.sub(t,this.center(),[]);r=e.length(n),r>this.radius()&&(dr=(r-this.radius())*.5,this._center[0]+=n[0]*(dr/r),this._center[1]+=n[1]*(dr/r),this._center[2]+=n[2]*(dr/r),this._radius+=dr)}else this._center[0]=t[0],this._center[1]=t[1],this._center[2]=t[2],this._radius=0},expandRadiusBySphere:function(t){if(t.valid())if(this.valid()){var n=e.sub,r=e.length,i=r(n(t._center,this._center,[]))+t._radius;i>this._radius&&(this._radius=i)}else this._center=e.copy(t._center,[]),this._radius=t._radius},expandBy:function(t){if(!t.valid())return;if(!this.valid()){this._center[0]=t._center[0],this._center[1]=t._center[1],this._center[2]=t._center[2],this._radius=t.radius();return}var n=e.sub(this.center(),t.center(),[]);d=e.length(n);if(d+t.radius()<=this.radius())return;if(d+this.radius()<=t.radius()){this._center[0]=t._center[0],this._center[1]=t._center[1],this._center[2]=t._center[2],this._radius=t._radius;return}new_radius=(this.radius()+d+t.radius())*.5,ratio=(new_radius-this.radius())/d,this._center[0]+=(t._center[0]-this._center[0])*ratio,this._center[1]+=(t._center[1]-this._center[1])*ratio,this._center[2]+=(t._center[2]-this._center[2])*ratio,this._radius=new_radius},contains:function(t){var n=e.sub(t,this.center(),[]);return valid()&&e.length2(n)<=radius2()},intersects:function(t){var n=e.length2(e.sub(this.center(),t.center(),[]));return valid()&&t.valid()&&n<=(this.radius()+t.radius())*(this.radius()+t.radius())}},t}),define("osg/Notify",[],function(){var e={};return e.DEBUG=0,e.INFO=1,e.NOTICE=2,e.WARN=3,e.ERROR=4,e.setNotifyLevel=function(t){var n=function(e){window.console!==undefined&&window.console.log(e,getStackTrace())},r=function(e){window.console!==undefined&&window.console.info(e,getStackTrace())},i=function(e){window.console!==undefined&&window.console.warn(e,getStackTrace())},s=function(e){window.console!==undefined&&window.console.error(e,getStackTrace())},o=function(e){window.console!==undefined&&window.console.debug(e,getStackTrace())},u=function(){};e.debug=u,e.info=u,e.log=u,e.warn=u,e.error=u,t<=e.DEBUG&&(e.debug=o),t<=e.INFO&&(e.info=r),t<=e.NOTICE&&(e.log=n),t<=e.WARN&&(e.warn=i),t<=e.ERROR&&(e.error=s)},e.setNotifyLevel(e.NOTICE),e.reportWebGLError=!1,e}),define("osg/BufferArray",["osg/Notify","osg/Utils","osg/Object"],function(e,t,n){var r=function(e,i,s){this._instanceID=n.getInstanceID(),this.dirty(),this._itemSize=s,typeof e=="string"&&(e=r[e]),this._type=e,i!==undefined&&(this._type===r.ELEMENT_ARRAY_BUFFER?this._elements=new t.Uint16Array(i):this._elements=new t.Float32Array(i))};return r.ELEMENT_ARRAY_BUFFER=34963,r.ARRAY_BUFFER=34962,r.prototype={setItemSize:function(e){this._itemSize=e},isValid:function(){return this._buffer!==undefined||this._elements!==undefined?!0:!1},releaseGLObjects:function(e){this._buffer!==undefined&&this._buffer!==null&&e.deleteBuffer(this._buffer),this._buffer=undefined},bind:function(e){var t=this._type,n=this._buffer;if(n){e.bindBuffer(t,n);return}!n&&this._elements.length>0&&(this._buffer=e.createBuffer(),this._numItems=this._elements.length/this._itemSize,e.bindBuffer(t,this._buffer))},getItemSize:function(){return this._itemSize},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},compile:function(e){this._dirty&&(e.bufferData(this._type,this._elements,e.STATIC_DRAW),this._dirty=!1)},getElements:function(){return this._elements},setElements:function(e){this._elements=e,this._dirty=!0}},r.create=function(t,n,i){return e.log("BufferArray.create is deprecated, use new BufferArray with same arguments instead"),new r(t,n,i)},r}),define("osg/StateSet",["osg/Utils","osg/StateAttribute","osg/Object"],function(e,t,n){var r=function(){n.call(this),this.id=r.instance++,this.attributeMap={},this.attributeMap.attributeKeys=[],this.textureAttributeMapList=[],this._binName=undefined,this._binNumber=0,this._shaderGenerator=undefined};return r.instance=0,r.AttributePair=function(e,t){this._object=e,this._value=t},r.AttributePair.prototype={getAttribute:function(){return this._object},getUniform:function(){return this._object},getValue:function(){return this._value}},r.prototype=e.objectLibraryClass(e.objectInehrit(n.prototype,{getAttributePair:function(e,t){return new r.AttributePair(e,t)},addUniform:function(e,n){n===undefined&&(n=t.ON),this.uniforms||(this.uniforms={},this.uniforms.uniformKeys=[]);var r=e.name;this.uniforms[r]=this.getAttributePair(e,n),this.uniforms.uniformKeys.indexOf(r)===-1&&this.uniforms.uniformKeys.push(r)},getUniform:function(e){return this.uniforms&&this.uniforms[e]?this.uniforms[e].getAttribute():undefined},getUniformList:function(){return this.uniforms},setTextureAttributeAndMode:function(e,n,r){r===undefined&&(r=t.ON),this._setTextureAttribute(e,this.getAttributePair(n,r))},getNumTextureAttributeLists:function(){return this.textureAttributeMapList.length},getTextureAttribute:function(e,t){return this.textureAttributeMapList[e]===undefined||this.textureAttributeMapList[e][t]===undefined?undefined:this.textureAttributeMapList[e][t].getAttribute()},removeTextureAttribute:function(e,t){if(this.textureAttributeMapList[e]===undefined||this.textureAttributeMapList[e][t]===undefined)return;delete this.textureAttributeMapList[e][t];var n=this.textureAttributeMapList[e].attributeKeys.indexOf(t);this.textureAttributeMapList[e].attributeKeys.splice(n,1)},getAttribute:function(e){return this.attributeMap[e]===undefined?undefined:this.attributeMap[e].getAttribute()},setAttributeAndMode:function(e,n){n===undefined&&(n=t.ON),this._setAttribute(this.getAttributePair(e,n))},setAttribute:function(e,n){n===undefined&&(n=t.ON),this._setAttribute(this.getAttributePair(e,n))},removeAttribute:function(e){if(this.attributeMap[e]!==undefined){delete this.attributeMap[e];var t=this.attributeMap.attributeKeys.indexOf(e);this.attributeMap.attributeKeys.splice(t,1)}},setRenderingHint:function(e){e==="OPAQUE_BIN"?this.setRenderBinDetails(0,"RenderBin"):e==="TRANSPARENT_BIN"?this.setRenderBinDetails(10,"DepthSortedBin"):this.setRenderBinDetails(0,"")},setRenderBinDetails:function(e,t){this._binNumber=e,this._binName=t},getAttributeMap:function(){return this.attributeMap},getBinNumber:function(){return this._binNumber},getBinName:function(){return this._binName},setBinNumber:function(e){this._binNumber=e},setBinName:function(e){this._binName=e},getAttributeList:function(){var e=this.attributeMap,t=e.attributeKeys,n=t.length,r=new Array(n);for(var i=0;i<n;i++)r[i]=e[t[i]];return r},setShaderGenerator:function(e){this._shaderGenerator=e},getShaderGenerator:function(){return this._shaderGenerator},_getUniformMap:function(){return this.uniforms},_setTextureAttribute:function(e,t){this.textureAttributeMapList[e]===undefined&&(this.textureAttributeMapList[e]={},this.textureAttributeMapList[e].attributeKeys=[]);var n=t.getAttribute().getTypeMember();this.textureAttributeMapList[e][n]=t,this.textureAttributeMapList[e].attributeKeys.indexOf(n)===-1&&this.textureAttributeMapList[e].attributeKeys.push(n)},_setAttribute:function(e){var t=e.getAttribute().getTypeMember();this.attributeMap[t]=e,this.attributeMap.attributeKeys.indexOf(t)===-1&&this.attributeMap.attributeKeys.push(t)}}),"osg","StateSet"),r.prototype.setTextureAttributeAndModes=r.prototype.setTextureAttributeAndMode,r.prototype.setAttributeAndModes=r.prototype.setAttributeAndMode,r}),define("osg/NodeVisitor",[],function(){var e=function(t){this.traversalMask=-1,this.nodeMaskOverride=0,this.traversalMode=t,t===undefined&&(this.traversalMode=e.TRAVERSE_ALL_CHILDREN),this.nodePath=[]};return e.TRAVERSE_PARENTS=1,e.TRAVERSE_ALL_CHILDREN=2,e._traversalFunctions={},e._traversalFunctions[e.TRAVERSE_PARENTS]=function(e){e.ascend(this)},e._traversalFunctions[e.TRAVERSE_ALL_CHILDREN]=function(e){e.traverse(this)},e._pushOntoNodePath={},e._pushOntoNodePath[e.TRAVERSE_PARENTS]=function(e){this.nodePath.unshift(e)},e._pushOntoNodePath[e.TRAVERSE_ALL_CHILDREN]=function(e){this.nodePath.push(e)},e._popFromNodePath={},e._popFromNodePath[e.TRAVERSE_PARENTS]=function(){return this.nodePath.shift()},e._popFromNodePath[e.TRAVERSE_ALL_CHILDREN]=function(){this.nodePath.pop()},e.prototype={setNodeMaskOverride:function(e){this.nodeMaskOverride=e},getNodeMaskOverride:function(){return this.nodeMaskOverride},setTraversalMask:function(e){this.traversalMask=e},getTraversalMask:function(){return this.traversalMask},pushOntoNodePath:function(t){e._pushOntoNodePath[this.traversalMode].call(this,t)},popFromNodePath:function(){e._popFromNodePath[this.traversalMode].call(this)},validNodeMask:function(e){var t=e.getNodeMask();return(this.traversalMask&(this.nodeMaskOverride|t))!==0},apply:function(e){this.traverse(e)},traverse:function(t){e._traversalFunctions[this.traversalMode].call(this,t)}},e}),define("osg/Vec4",[],function(){var e={dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},copy:function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},sub:function(e,t,n){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n},mult:function(e,t,n){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r},add:function(e,t,n){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n},neg:function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},lerp:function(e,t,n,r){var i=1-e;return r[0]=t[0]*i+e*n[0],r[1]=t[1]*i+e*n[1],r[2]=t[2]*i+e*n[2],r[3]=t[3]*i+e*n[3],r}};return e}),define("osg/Quat",[],function(){var e={copy:function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},makeIdentity:function(t){return e.init(t)},zeroRotation:function(t){return e.init(t)},init:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},sub:function(e,t,n){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n},add:function(e,t,n){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},length2:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]},neg:function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},makeRotate:function(e,t,n,r,i){var s=1e-7,o=Math.sqrt(t*t+n*n+r*r);if(o<s)return this.init();var u=1/o,a=Math.cos(.5*e),f=Math.sin(.5*e);return i===undefined&&(i=[]),i[0]=t*f*u,i[1]=n*f*u,i[2]=r*f*u,i[3]=a,i},lerp:function(e,t,n,r){return r[0]=t[0]+(n[0]-t[0])*e,r[1]=t[1]+(n[1]-t[1])*e,r[2]=t[2]+(n[2]-t[2])*e,r[3]=t[3]+(n[3]-t[3])*e,r},slerp:function(e,t,n,r){var i=1e-5,s=n,o=this.dot(t,s);o<0&&(o=-o,this.neg(n,s));var u,a,f,l;return 1-o>i?(u=Math.acos(o),a=Math.sin(u),f=Math.sin((1-e)*u)/a,l=Math.sin(e*u)/a):(f=1-e,l=e),r[0]=t[0]*f+s[0]*l,r[1]=t[1]*f+s[1]*l,r[2]=t[2]*f+s[2]*l,r[3]=t[3]*f+s[3]*l,r},normalize:function(e,t){var n=1/this.length2(e);return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},conj:function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},inverse:function(e,t){var n=1/this.length2(e);return this.conj(e,t),t[0]*=n,t[1]*=n,t[2]*=n,t[3]*=n,t},mult:function(e,t,n){return n[0]=e[0]*t[3]+e[1]*t[2]-e[2]*t[1]+e[3]*t[0],n[1]=-e[0]*t[2]+e[1]*t[3]+e[2]*t[0]+e[3]*t[1],n[2]=e[0]*t[1]-e[1]*t[0]+e[2]*t[3]+e[3]*t[2],n[3]=-e[0]*t[0]-e[1]*t[1]-e[2]*t[2]+e[3]*t[3],n},div:function(e,t,n){var r=1/t;return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n},exp:function(e,t){var n=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),r=Math.exp(e[3]),i=0;return n>1e-5&&(i=r*Math.sin(n)/n),t===undefined&&(t=[]),t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=r*Math.cos(n),t},ln:function(e,t){var n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=Math.sqrt(n),i=0;return r>1e-5&&(i=Math.atan2(r,e[3])/r),t===undefined&&(t=[]),n+=e[3]*e[3],t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=.5*Math.log(n),t},squad:function(e,t,n,r,i,s){var o=this.slerp(e,t,i),u=this.slerp(e,n,r);return this.slerp(2*e*(1-e),o,u,s)},computeTangent:function(e,t,n,r){var i=this.inv(t),s,o;return this.mult(n,i,s),this.ln(s,s),this.mult(e,i,o),this.ln(o,o),this.add(s,o,s),this.div(s,-4,s),this.exp(s,o),this.mult(o,q1,r)}};return e}),define("osg/Matrix",["osg/Notify","osg/Vec3","osg/Vec4","osg/Quat"],function(e,t,n,r){var i={_tmp0:[],_tmp1:[],valid:function(e){for(var t=0;t<16;t++)if(isNaN(e[t]))return!1;return!0},setRow:function(e,t,n,r,i,s){var o=t*4;e[o+0]=n,e[o+1]=r,e[o+2]=i,e[o+3]=s},innerProduct:function(e,t,n,r){var i=n*4;return e[i+0]*t[0+r]+e[i+1]*t[4+r]+e[i+2]*t[8+r]+e[i+3]*t[12+r]},set:function(e,t,n,r){return e[t*4+n]=r,r},get:function(e,t,n){return e[t*4+n]},makeIdentity:function(t){return t===undefined&&(t=[],e.log("Matrix.makeIdentity without matrix destination is deprecated")),i.setRow(t,0,1,0,0,0),i.setRow(t,1,0,1,0,0),i.setRow(t,2,0,0,1,0),i.setRow(t,3,0,0,0,1),t},makeTranslate:function(e,t,n,r){return r===undefined&&(r=[]),i.setRow(r,0,1,0,0,0),i.setRow(r,1,0,1,0,0),i.setRow(r,2,0,0,1,0),i.setRow(r,3,e,t,n,1),r},setTrans:function(e,t,n,r){return e[12]=t,e[13]=n,e[14]=r,e},getTrans:function(e,t){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},preMult:function(e,t){var n,r,i,s;return n=t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12],r=t[4]*e[0]+t[5]*e[4]+t[6]*e[8]+t[7]*e[12],i=t[8]*e[0]+t[9]*e[4]+t[10]*e[8]+t[11]*e[12],s=t[12]*e[0]+t[13]*e[4]+t[14]*e[8]+t[15]*e[12],e[0]=n,e[4]=r,e[8]=i,e[12]=s,n=t[0]*e[1]+t[1]*e[5]+t[2]*e[9]+t[3]*e[13],r=t[4]*e[1]+t[5]*e[5]+t[6]*e[9]+t[7]*e[13],i=t[8]*e[1]+t[9]*e[5]+t[10]*e[9]+t[11]*e[13],s=t[12]*e[1]+t[13]*e[5]+t[14]*e[9]+t[15]*e[13],e[1]=n,e[5]=r,e[9]=i,e[13]=s,n=t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+t[3]*e[14],r=t[4]*e[2]+t[5]*e[6]+t[6]*e[10]+t[7]*e[14],i=t[8]*e[2]+t[9]*e[6]+t[10]*e[10]+t[11]*e[14],s=t[12]*e[2]+t[13]*e[6]+t[14]*e[10]+t[15]*e[14],e[2]=n,e[6]=r,e[10]=i,e[14]=s,n=t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3]*e[15],r=t[4]*e[3]+t[5]*e[7]+t[6]*e[11]+t[7]*e[15],i=t[8]*e[3]+t[9]*e[7]+t[10]*e[11]+t[11]*e[15],s=t[12]*e[3]+t[13]*e[7]+t[14]*e[11]+t[15]*e[15],e[3]=n,e[7]=r,e[11]=i,e[15]=s,e},postMult:function(e,t){return btmp0=t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12],btmp1=t[0]*e[1]+t[1]*e[5]+t[2]*e[9]+t[3]*e[13],btmp2=t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+t[3]*e[14],btmp3=t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3]*e[15],t[0]=btmp0,t[1]=btmp1,t[2]=btmp2,t[3]=btmp3,btmp0=t[4]*e[0]+t[5]*e[4]+t[6]*e[8]+t[7]*e[12],btmp1=t[4]*e[1]+t[5]*e[5]+t[6]*e[9]+t[7]*e[13],btmp2=t[4]*e[2]+t[5]*e[6]+t[6]*e[10]+t[7]*e[14],btmp3=t[4]*e[3]+t[5]*e[7]+t[6]*e[11]+t[7]*e[15],t[4]=btmp0,t[5]=btmp1,t[6]=btmp2,t[7]=btmp3,btmp0=t[8]*e[0]+t[9]*e[4]+t[10]*e[8]+t[11]*e[12],btmp1=t[8]*e[1]+t[9]*e[5]+t[10]*e[9]+t[11]*e[13],btmp2=t[8]*e[2]+t[9]*e[6]+t[10]*e[10]+t[11]*e[14],btmp3=t[8]*e[3]+t[9]*e[7]+t[10]*e[11]+t[11]*e[15],t[8]=btmp0,t[9]=btmp1,t[10]=btmp2,t[11]=btmp3,btmp0=t[12]*e[0]+t[13]*e[4]+t[14]*e[8]+t[15]*e[12],btmp1=t[12]*e[1]+t[13]*e[5]+t[14]*e[9]+t[15]*e[13],btmp2=t[12]*e[2]+t[13]*e[6]+t[14]*e[10]+t[15]*e[14],btmp3=t[12]*e[3]+t[13]*e[7]+t[14]*e[11]+t[15]*e[15],t[12]=btmp0,t[13]=btmp1,t[14]=btmp2,t[15]=btmp3,t},multa:function(e,t,n){return n===e?this.preMult(e,t):n===t?this.postMult(e,t):(n===undefined&&(n=[]),n[0]=t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12],n[1]=t[0]*e[1]+t[1]*e[5]+t[2]*e[9]+t[3]*e[13],n[2]=t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+t[3]*e[14],n[3]=t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3]*e[15],n[4]=t[4]*e[0]+t[5]*e[4]+t[6]*e[8]+t[7]*e[12],n[5]=t[4]*e[1]+t[5]*e[5]+t[6]*e[9]+t[7]*e[13],n[6]=t[4]*e[2]+t[5]*e[6]+t[6]*e[10]+t[7]*e[14],n[7]=t[4]*e[3]+t[5]*e[7]+t[6]*e[11]+t[7]*e[15],n[8]=t[8]*e[0]+t[9]*e[4]+t[10]*e[8]+t[11]*e[12],n[9]=t[8]*e[1]+t[9]*e[5]+t[10]*e[9]+t[11]*e[13],n[10]=t[8]*e[2]+t[9]*e[6]+t[10]*e[10]+t[11]*e[14],n[11]=t[8]*e[3]+t[9]*e[7]+t[10]*e[11]+t[11]*e[15],n[12]=t[12]*e[0]+t[13]*e[4]+t[14]*e[8]+t[15]*e[12],n[13]=t[12]*e[1]+t[13]*e[5]+t[14]*e[9]+t[15]*e[13],n[14]=t[12]*e[2]+t[13]*e[6]+t[14]*e[10]+t[15]*e[14],n[15]=t[12]*e[3]+t[13]*e[7]+t[14]*e[11]+t[15]*e[15],n)},mult:function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=t[9],p=t[10],d=t[11],v=t[12],m=t[13],g=t[14],y=t[15],b=e[0],w=e[1],E=e[2],S=e[3],x=e[4],T=e[5],N=e[6],C=e[7],k=e[8],L=e[9],A=e[10],O=e[11],M=e[12],_=e[13],D=e[14],P=e[15];return n[0]=r*b+i*x+s*k+o*M,n[1]=r*w+i*T+s*L+o*_,n[2]=r*E+i*N+s*A+o*D,n[3]=r*S+i*C+s*O+o*P,n[4]=u*b+a*x+f*k+l*M,n[5]=u*w+a*T+f*L+l*_,n[6]=u*E+a*N+f*A+l*D,n[7]=u*S+a*C+f*O+l*P,n[8]=c*b+h*x+p*k+d*M,n[9]=c*w+h*T+p*L+d*_,n[10]=c*E+h*N+p*A+d*D,n[11]=c*S+h*C+p*O+d*P,n[12]=v*b+m*x+g*k+y*M,n[13]=v*w+m*T+g*L+y*_,n[14]=v*E+m*N+g*A+y*D,n[15]=v*S+m*C+g*O+y*P,n},multOrig:function(e,t,n){var r;if(n===e){r=[];for(var s=0;s<4;s++)r[0]=i.innerProduct(t,e,0,s),r[1]=i.innerProduct(t,e,1,s),r[2]=i.innerProduct(t,e,2,s),r[3]=i.innerProduct(t,e,3,s),e[0+s]=r[0],e[4+s]=r[1],e[8+s]=r[2],e[12+s]=r[3];return e}if(n===t){r=[];for(var o=0;o<4;o++)r[0]=i.innerProduct(t,e,o,0),r[1]=i.innerProduct(t,e,o,1),r[2]=i.innerProduct(t,e,o,2),r[3]=i.innerProduct(t,e,o,3),this.setRow(t,o,r[0],r[1],r[2],r[3]);return t}n===undefined&&(n=[]);var u=t[0],a=t[1],f=t[2],l=t[3],c=t[4],h=t[5],p=t[6],d=t[7],v=t[8],m=t[9],g=t[10],y=t[11],b=t[12],w=t[13],E=t[14],S=t[15],x=e[0],T=e[1],N=e[2],C=e[3],k=e[4],L=e[5],A=e[6],O=e[7],M=e[8],_=e[9],D=e[10],P=e[11],H=e[12],B=e[13],j=e[14],F=e[15];return n[0]=u*x+a*k+f*M+l*H,n[1]=u*T+a*L+f*_+l*B,n[2]=u*N+a*A+f*D+l*j,n[3]=u*C+a*O+f*P+l*F,n[4]=c*x+h*k+p*M+d*H,n[5]=c*T+h*L+p*_+d*B,n[6]=c*N+h*A+p*D+d*j,n[7]=c*C+h*O+p*P+d*F,n[8]=v*x+m*k+g*M+y*H,n[9]=v*T+m*L+g*_+y*B,n[10]=v*N+m*A+g*D+y*j,n[11]=v*C+m*O+g*P+y*F,n[12]=b*x+w*k+E*M+S*H,n[13]=b*T+w*L+E*_+S*B,n[14]=b*N+w*A+E*D+S*j,n[15]=b*C+w*O+E*P+S*F,n},makeLookAt:function(e,n,r,s){s===undefined&&(s=[]);var o=t.sub(n,e,[]);t.normalize(o,o);var u=t.cross(o,r,[]);t.normalize(u,u);var a=t.cross(u,o,[]);return t.normalize(a,a),s[0]=u[0],s[1]=a[0],s[2]=-o[0],s[3]=0,s[4]=u[1],s[5]=a[1],s[6]=-o[1],s[7]=0,s[8]=u[2],s[9]=a[2],s[10]=-o[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,i.multTranslate(s,t.neg(e,[]),s),s},makeOrtho:function(e,t,n,r,s,o,u){u===undefined&&(u=[]);var a=-(t+e)/(t-e),f=-(r+n)/(r-n),l=-(o+s)/(o-s),c=i.setRow;return c(u,0,2/(t-e),0,0,0),c(u,1,0,2/(r-n),0,0),c(u,2,0,0,-2/(o-s),0),c(u,3,a,f,l,1),u},getLookAt:function(e,n,r,s,o){o===undefined&&(o=1);var u=[],a=i.inverse(e,u);a||i.makeIdentity(u),i.transformVec3(u,[0,0,0],n),i.transform3x3(e,[0,1,0],s),i.transform3x3(e,[0,0,-1],r),t.normalize(r,r),t.add(t.mult(r,o,[]),n,r)},getRotate:function(e,t){t===undefined&&(t=[]);var n,r=[],i,s,o=e[0],u=e[5],a=e[10];r[0]=1+o+u+a,r[1]=1+o-u-a,r[2]=1-o+u-a,r[3]=1-o-u+a,s=0;for(i=1;i<4;i++)r[i]>r[s]?s=i:s=s;return s===0?(t[3]=r[0],t[0]=e[6]-e[9],t[1]=e[8]-e[2],t[2]=e[1]-e[4]):s==1?(t[3]=e[6]-e[9],t[0]=r[1],t[1]=e[1]+e[4],t[2]=e[8]+e[2]):s==2?(t[3]=e[8]-e[2],t[0]=e[1]+e[4],t[1]=r[2],t[2]=e[6]+e[9]):(t[3]=e[1]-e[4],t[0]=e[8]+e[2],t[1]=e[6]+e[9],t[2]=r[3]),n=Math.sqrt(.25/r[s]),t[3]*=n,t[0]*=n,t[1]*=n,t[2]*=n,t},preMultTranslate:function(e,t){return t[0]!==0&&(val=t[0],e[12]+=val*e[0],e[13]+=val*e[1],e[14]+=val*e[2],e[15]+=val*e[3]),t[1]!==0&&(val=t[1],e[12]+=val*e[4],e[13]+=val*e[5],e[14]+=val*e[6],e[15]+=val*e[7]),t[2]!==0&&(val=t[2],e[12]+=val*e[8],e[13]+=val*e[9],e[14]+=val*e[10],e[15]+=val*e[11]),e},multTranslate:function(e,t,n){n===undefined&&(n=[]),n!==e&&i.copy(e,n);var r;return t[0]!==0&&(r=t[0],n[12]+=r*e[0],n[13]+=r*e[1],n[14]+=r*e[2],n[15]+=r*e[3]),t[1]!==0&&(r=t[1],n[12]+=r*e[4],n[13]+=r*e[5],n[14]+=r*e[6],n[15]+=r*e[7]),t[2]!==0&&(r=t[2],n[12]+=r*e[8],n[13]+=r*e[9],n[14]+=r*e[10],n[15]+=r*e[11]),n},makeRotate:function(t,n,r,s,o){o===undefined&&(e.log("makeRotate without given matrix destination is deprecated"),o=[]);var u=Math.sqrt(n*n+r*r+s*s),a=Math.sin(t),f=Math.cos(t);if(u>0){var l,c,h,p,d,v,m,g,y,b,w;return u=1/u,n*=u,r*=u,s*=u,l=n*n,c=r*r,h=s*s,p=n*r,d=r*s,v=s*n,m=n*a,g=r*a,y=s*a,b=1-f,o[0]=b*l+f,o[1]=b*p-y,o[2]=b*v+g,o[3]=0,o[4]=b*p+y,o[5]=b*c+f,o[6]=b*d-m,o[7]=0,o[8]=b*v-g,o[9]=b*d+m,o[10]=b*h+f,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}return i.makeIdentity(o)},transform3x3:function(e,t,n){return n===undefined&&(n=[]),n[0]=e[0]*t[0]+e[1]*t[1]+e[2]*t[2],n[1]=e[4]*t[0]+e[5]*t[1]+e[6]*t[2],n[2]=e[8]*t[0]+e[9]*t[1]+e[10]*t[2],n},transformVec3:function(n,r,i){var s=1/(n[3]*r[0]+n[7]*r[1]+n[11]*r[2]+n[15]);i===undefined&&(e.warn("deprecated, Matrix.transformVec3 needs a third parameter as result"),i=[]);var o;return i===r?o=[]:o=i,o[0]=(n[0]*r[0]+n[4]*r[1]+n[8]*r[2]+n[12])*s,o[1]=(n[1]*r[0]+n[5]*r[1]+n[9]*r[2]+n[13])*s,o[2]=(n[2]*r[0]+n[6]*r[1]+n[10]*r[2]+n[14])*s,i===r&&t.copy(o,i),i},transformVec4:function(e,t,r){r===undefined&&(r=[]);var i;return r===t?i=[]:i=r,i[0]=e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],i[1]=e[4]*t[0]+e[5]*t[1]+e[6]*t[2]+e[7]*t[3],i[2]=e[8]*t[0]+e[9]*t[1]+e[10]*t[2]+e[11]*t[3],i[3]=e[12]*t[0]+e[13]*t[1]+e[14]*t[2]+e[15]*t[3],r===t&&n.copy(i,r),r},copy:function(e,t){return t===undefined&&(t=[]),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},inverse:function(e,t){return t===e&&(i.copy(e,i._tmp1),e=i._tmp1),e[3]===0&&e[7]===0&&e[11]===0&&e[15]===1?this.inverse4x3(e,t):this.inverse4x4(e,t)},inverse4x4:function(t,n){var r=t[10]*t[15],i=t[14]*t[11],s=t[6]*t[15],o=t[14]*t[7],u=t[6]*t[11],a=t[10]*t[7],f=t[2]*t[15],l=t[14]*t[3],c=t[2]*t[11],h=t[10]*t[3],p=t[2]*t[7],d=t[6]*t[3],v=t[8]*t[13],m=t[12]*t[9],g=t[4]*t[13],y=t[12]*t[5],b=t[4]*t[9],w=t[8]*t[5],E=t[0]*t[13],S=t[12]*t[1],x=t[0]*t[9],T=t[8]*t[1],N=t[0]*t[5],C=t[4]*t[1],k=r*t[5]+o*t[9]+u*t[13]-(i*t[5]+s*t[9]+a*t[13]),L=i*t[1]+f*t[9]+h*t[13]-(r*t[1]+l*t[9]+c*t[13]),A=s*t[1]+l*t[5]+p*t[13]-(o*t[1]+f*t[5]+d*t[13]),O=a*t[1]+c*t[5]+d*t[9]-(u*t[1]+h*t[5]+p*t[9]),M=t[0]*k+t[4]*L+t[8]*A+t[12]*O;if(Math.abs(M)<1e-5)return e.log("Warning can't inverse matrix "+t),!1;var _=1/M,D=_*k,P=_*L,H=_*A,B=_*O,j=_*(i*t[4]+s*t[8]+a*t[12]-(r*t[4]+o*t[8]+u*t[12])),F=_*(r*t[0]+l*t[8]+c*t[12]-(i*t[0]+f*t[8]+h*t[12])),I=_*(o*t[0]+f*t[4]+d*t[12]-(s*t[0]+l*t[4]+p*t[12])),q=_*(u*t[0]+h*t[4]+p*t[8]-(a*t[0]+c*t[4]+d*t[8])),R=_*(v*t[7]+y*t[11]+b*t[15]-(m*t[7]+g*t[11]+w*t[15])),U=_*(m*t[3]+E*t[11]+T*t[15]-(v*t[3]+S*t[11]+x*t[15])),z=_*(g*t[3]+S*t[7]+N*t[15]-(y*t[3]+E*t[7]+C*t[15])),W=_*(w*t[3]+x*t[7]+C*t[11]-(b*t[3]+T*t[7]+N*t[11])),X=_*(g*t[10]+w*t[14]+m*t[6]-(b*t[14]+v*t[6]+y*t[10])),V=_*(x*t[14]+v*t[2]+S*t[10]-(E*t[10]+T*t[14]+m*t[2])),$=_*(E*t[6]+C*t[14]+y*t[2]-(N*t[14]+g*t[2]+S*t[6])),J=_*(N*t[10]+b*t[2]+T*t[6]-(x*t[6]+C*t[10]+w*t[2]));return n[0]=D,n[1]=P,n[2]=H,n[3]=B,n[4]=j,n[5]=F,n[6]=I,n[7]=q,n[8]=R,n[9]=U,n[10]=z,n[11]=W,n[12]=X,n[13]=V,n[14]=$,n[15]=J,!0},inverse4x3:function(e,t){var n=e[0],r=e[1],s=e[2],o=e[4],u=e[5],a=e[6],f=e[8],l=e[9],c=e[10];t[0]=u*c-a*l,t[1]=s*l-r*c,t[2]=r*a-s*u;var h=1/(n*t[0]+o*t[1]+f*t[2]);n*=h,o*=h,f*=h,t[0]*=h,t[1]*=h,t[2]*=h,t[3]=0,t[4]=a*f-o*c,t[5]=n*c-s*f,t[6]=s*o-n*a,t[7]=0,t[8]=o*l-u*f,t[9]=r*f-n*l,t[10]=n*u-r*o,t[11]=0,t[15]=1;var p,d,v,m=e[15],g=m-1;if(g*g>1e-6){var y=i._tmp0;t[12]=t[13]=t[14]=0;var b=e[3],w=e[7],E=e[11],S=t[0]*b+t[1]*w+t[2]*E,x=t[4]*b+t[5]*w+t[6]*E,T=t[8]*b+t[9]*w+t[10]*E;p=e[12],d=e[13],v=e[14];var N=1/(m-(p*S+d*x+v*T));p*=N,d*=N,v*=N,y[0]=p*S+1,y[1]=d*S,y[2]=v*S,y[3]=-S*N,y[4]=p*x,y[5]=d*x+1,y[6]=v*x,y[7]=-x*N,y[8]=p*T,y[9]=d*T,y[10]=v*T+1,y[11]=-T*N,y[12]=-p,y[13]=-d,y[14]=-v,y[15]=N,i.preMult(t,y)}else p=e[12],d=e[13],v=e[14],t[12]=-(p*t[0]+d*t[4]+v*t[8]),t[13]=-(p*t[1]+d*t[5]+v*t[9]),t[14]=-(p*t[2]+d*t[6]+v*t[10]);return!0},transpose:function(e,t){if(e===t){var n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],u=e[11];return e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=n,e[6]=e[9],e[7]=e[13],e[8]=r,e[9]=s,e[11]=e[14],e[12]=i,e[13]=o,e[14]=u,e}return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},makePerspective:function(e,t,n,r,s){s===undefined&&(s=[]);var o=n*Math.tan(e*Math.PI/360),u=-o,a=u*t,f=o*t;return i.makeFrustum(a,f,u,o,n,r,s)},getFrustum:function(e,t){var n=0,r=0,i=0,s=0;if(e[3]!==0||e[7]!==0||e[11]!==-1||e[15]!==0)return!1;var o=e[14]/(e[10]-1),u=e[14]/(1+e[10]);return r=o*(e[8]-1)/e[0],n=o*(1+e[8])/e[0],i=o*(1+e[9])/e[5],s=o*(e[9]-1)/e[5],zNear=o,zFar=u,t.left=r,t.right=n,t.top=i,t.bottom=s,t.zNear=zNear,t.zFar=zFar,!0},getPerspective:function(e,t){var n={right:0,left:0,top:0,bottom:0,zNear:0,zFar:0},r=this.getFrustum(e,n);return r&&(t.fovy=180/Math.PI*(Math.atan(n.top/n.zNear)-Math.atan(n.bottom/n.zNear)),t.aspectRatio=(n.right-n.left)/(n.top-n.bottom)),t.zNear=n.zNear,t.zFar=n.zFar,t},makeScale:function(e,t,n,r){return r===undefined&&(r=[]),this.setRow(r,0,e,0,0,0),this.setRow(r,1,0,t,0,0),this.setRow(r,2,0,0,n,0),this.setRow(r,3,0,0,0,1),r},computeFrustrumCornersVectors:function(e,t){var n=e[14]/(e[10]-1),r=e[14]/(e[10]+1),i=1/e[0],s=1/e[5];return t[0]=[-i,s,1],t[1]=[-i,-s,1],t[2]=[i,-s,1],t[3]=[i,s,1],t},makeFrustum:function(e,t,n,r,i,s,o){o===undefined&&(o=[]);var u=2*i/(t-e),a=2*i/(r-n),f=(t+e)/(t-e),l=(r+n)/(r-n),c=-(s+i)/(s-i),h=-2*s*i/(s-i);return this.setRow(o,0,u,0,0,0),this.setRow(o,1,0,a,0,0),this.setRow(o,2,f,l,c,-1),this.setRow(o,3,0,0,h,0),o},makeRotateFromQuat:function(e,t){return this.makeIdentity(t),this.setRotateFromQuat(t,e)},setRotateFromQuat:function(e,t){var n=r.length2(t);if(Math.abs(n)<=Number.MIN_VALUE)e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[8]=0,e[9]=0,e[10]=0;else{var i;n!==1?i=2/n:i=2;var s,o,u,a,f,l,c,h,p,d,v,m;d=i*t[0],v=i*t[1],m=i*t[2],a=t[0]*d,c=t[0]*v,h=t[0]*m,f=t[1]*v,l=t[1]*m,p=t[2]*m,s=t[3]*d,o=t[3]*v,u=t[3]*m,e[0]=1-(f+p),e[4]=c-u,e[8]=h+o,e[1]=c+u,e[5]=1-(a+p),e[9]=l-s,e[2]=h-o,e[6]=l+s,e[10]=1-(a+f)}return e}};return i}),define("osg/ComputeMatrixFromNodePath",["osg/Matrix"],function(e){return computeLocalToWorld=function(t,n){var r=n;r===undefined&&(r=!0);var i=e.makeIdentity([]),s=0;if(r)for(s=t.length-1;s>0;s--){var o=t[s];if(o.objectType===1&&(o.getReferenceFrame!==0||o.getParents().length===0))break}for(var u=s,a=t.length;u<a;u++){var f=t[u];f.computeLocalToWorldMatrix&&f.computeLocalToWorldMatrix(i)}return i},{computeLocalToWorld:computeLocalToWorld}}),define("osg/Node",["osg/Utils","osg/Object","osg/BoundingBox","osg/BoundingSphere","osg/StateSet","osg/NodeVisitor","osg/Matrix","osg/ComputeMatrixFromNodePath"],function(e,t,n,r,i,s,o,u){var a=function(){t.call(this),this.children=[],this.parents=[],this.nodeMask=-1,this.boundingSphere=new r,this.boundingSphereComputed=!1,this._updateCallbacks=[],this._cullCallback=undefined};return a.prototype=e.objectLibraryClass(e.objectInehrit(t.prototype,{getOrCreateStateSet:function(){return this.stateset===undefined&&(this.stateset=new i),this.stateset},getStateSet:function(){return this.stateset},accept:function(e){e.validNodeMask(this)&&(e.pushOntoNodePath(this),e.apply(this),e.popFromNodePath())},dirtyBound:function(){if(this.boundingSphereComputed===!0){this.boundingSphereComputed=!1;for(var e=0,t=this.parents.length;e<t;e++)this.parents[e].dirtyBound()}},setNodeMask:function(e){this.nodeMask=e},getNodeMask:function(e){return this.nodeMask},setStateSet:function(e){this.stateset=e},setUpdateCallback:function(e){this._updateCallbacks[0]=e},getUpdateCallback:function(){return this._updateCallbacks[0]},addUpdateCallback:function(e){this._updateCallbacks.push(e)},removeUpdateCallback:function(e){var t=this._updateCallbacks.indexOf(e);t!==-1&&this._updateCallbacks.splice(t,1)},getUpdateCallbackList:function(){return this._updateCallbacks},setCullCallback:function(e){this._cullCallback=e},getCullCallback:function(){return this._cullCallback},hasChild:function(e){for(var t=0,n=this.children.length;t<n;t++)if(this.children[t]===e)return!0;return!1},addChild:function(e){var t=this.children.push(e);return e.addParent(this),this.dirtyBound(),t},getChildren:function(){return this.children},getParents:function(){return this.parents},addParent:function(e){this.parents.push(e)},removeParent:function(e){for(var t=0,n=this.parents.length,r=this.parents;t<n;t++)if(r[t]===e){r.splice(t,1);return}},removeChildren:function(){var e=this.children;if(e.length!==0){for(var t=0,n=e.length;t<n;t++)e[t].removeParent(this);this.children.splice(0,this.children.length),this.dirtyBound()}},removeChild:function(e){for(var t=0,n=this.children.length;t<n;t++)this.children[t]===e&&(e.removeParent(this),this.children.splice(t,1),this.dirtyBound())},traverse:function(e){for(var t=0,n=this.children.length;t<n;t++){var r=this.children[t];r.accept(e)}},ascend:function(e){for(var t=0,n=this.parents.length;t<n;t++){var r=this.parents[t];r.accept(e)}},getBound:function(){return this.boundingSphereComputed||(this.computeBound(this.boundingSphere),this.boundingSphereComputed=!0),this.boundingSphere},computeBound:function(e){var t=new n;t.init(),e.init();for(var r=0,i=this.children.length;r<i;r++){var s=this.children[r];(s.referenceFrame===undefined||s.referenceFrame===0)&&t.expandBySphere(s.getBound())}if(!t.valid())return e;e._center=t.center(),e._radius=0;for(var o=0,u=this.children.length;o<u;o++){var a=this.children[o];(a.referenceFrame===undefined||a.referenceFrame===0)&&e.expandRadiusBySphere(a.getBound())}return e},getWorldMatrices:function(t){var n=function(e){this.nodePaths=[],this.halt=e,s.call(this,s.TRAVERSE_PARENTS)};n.prototype=e.objectInehrit(s.prototype,{apply:function(e){e.parents.length===0||e===this.halt?this.nodePaths.push(this.nodePath.slice(0)):this.traverse(e)}});var r=new n(t);this.accept(r);var i=[];for(var a=0,f=r.nodePaths.length;a<f;a++){var l=r.nodePaths[a];l.length===0?i.push(o.makeIdentity([])):i.push(u.computeLocalToWorld(l))}return i}}),"osg","Node"),a.prototype.objectType=e.objectType.generate("Node"),a}),define("osg/Transform",["osg/Utils","osg/Node","osg/Matrix","osg/Vec3"],function(e,t,n,r){var i=function(){t.call(this),this.referenceFrame=i.RELATIVE_RF};return i.RELATIVE_RF=0,i.ABSOLUTE_RF=1,i.prototype=e.objectInehrit(t.prototype,{setReferenceFrame:function(e){this.referenceFrame=e},getReferenceFrame:function(){return this.referenceFrame},computeBound:function(e){t.prototype.computeBound.call(this,e);if(!e.valid())return e;var i=n.makeIdentity([]);this.computeLocalToWorldMatrix(i);var s=r.copy(e._center,[]);s[0]+=e._radius,n.transformVec3(i,s,s);var o=r.copy(e._center,[]);o[1]+=e._radius,n.transformVec3(i,o,o);var u=r.copy(e._center,[]);u[2]+=e._radius,n.transformVec3(i,u,u),n.transformVec3(i,e._center,e._center),r.sub(s,e._center,s);var a=r.length(s);r.sub(o,e._center,o);var f=r.length(o);r.sub(u,e._center,u);var l=r.length(u);return e._radius=a,e._radius<f&&(e._radius=f),e._radius<l&&(e._radius=l),e}}),i}),define("osg/CullSettings",[],function(){var e=function(){this._computeNearFar=!0,this._nearFarRatio=.005;var e=[0,0,-1];this.bbCornerFar=(e[0]>=0?1:0)|(e[1]>=0?2:0)|(e[2]>=0?4:0),this.bbCornerNear=~this.bbCornerFar&7};return e.prototype={setCullSettings:function(e){this._computeNearFar=e._computeNearFar,this._nearFarRatio=e._nearFarRatio},setNearFarRatio:function(e){this._nearFarRatio=e},getNearFarRatio:function(){return this._nearFarRatio},setComputeNearFar:function(e){this._computeNearFar=e},getComputeNearFar:function(){return this._computeNearFar}},e}),define("osg/Camera",["osg/Utils","osg/Transform","osg/CullSettings","osg/Matrix"],function(e,t,n,r){var i=function(){t.call(this),n.call(this),this.viewport=undefined,this.setClearColor([0,0,0,1]),this.setClearDepth(1),this.setClearMask(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),this.setViewMatrix(r.makeIdentity([])),this.setProjectionMatrix(r.makeIdentity([])),this.renderOrder=i.NESTED_RENDER,this.renderOrderNum=0};return i.PRE_RENDER=0,i.NESTED_RENDER=1,i.POST_RENDER=2,i.COLOR_BUFFER_BIT=16384,i.DEPTH_BUFFER_BIT=256,i.STENCIL_BUFFER_BIT=1024,i.prototype=e.objectLibraryClass(e.objectInehrit(n.prototype,e.objectInehrit(t.prototype,{setClearDepth:function(e){this.clearDepth=e},getClearDepth:function(){return this.clearDepth},setClearMask:function(e){this.clearMask=e},getClearMask:function(){return this.clearMask},setClearColor:function(e){this.clearColor=e},getClearColor:function(){return this.clearColor},setViewport:function(e){this.viewport=e,this.getOrCreateStateSet().setAttributeAndMode(e)},getViewport:function(){return this.viewport},setViewMatrix:function(e){this.modelviewMatrix=e},setProjectionMatrix:function(e){this.projectionMatrix=e},setProjectionMatrixAsOrtho:function(e,t,n,i,s,o){r.makeOrtho(e,t,n,i,s,o,this.getProjectionMatrix())},getViewMatrix:function(){return this.modelviewMatrix},getProjectionMatrix:function(){return this.projectionMatrix},getRenderOrder:function(){return this.renderOrder},setRenderOrder:function(e,t){this.renderOrder=e,this.renderOrderNum=t},attachTexture:function(e,t,n){this.frameBufferObject&&this.frameBufferObject.dirty(),n===undefined&&(n=0),this.attachments===undefined&&(this.attachments={}),this.attachments[e]={texture:t,level:n}},attachRenderBuffer:function(e,t){this.frameBufferObject&&this.frameBufferObject.dirty(),this.attachments===undefined&&(this.attachments={}),this.attachments[e]={format:t}},computeLocalToWorldMatrix:function(e,n){return this.referenceFrame===t.RELATIVE_RF?r.preMult(e,this.modelviewMatrix):e=this.modelviewMatrix,!0},computeWorldToLocalMatrix:function(e,n){var i=[];return r.inverse(this.modelviewMatrix,i),this.referenceFrame===t.RELATIVE_RF?r.postMult(i,e):e=i,!0}})),"osg","Camera"),i.prototype.objectType=e.objectType.generate("Camera"),i}),define("osg/CullFace",["osg/Utils","osg/StateAttribute"],function(e,t){var n=function(e){t.call(this),e===undefined&&(e=n.BACK),this.setMode(e)};return n.DISABLE=0,n.FRONT=1028,n.BACK=1029,n.FRONT_AND_BACK=1032,n.prototype=e.objectLibraryClass(e.objectInehrit(t.prototype,{attributeType:"CullFace",cloneType:function(){return new n},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setMode:function(e){typeof e=="string"&&(e=n[e]),this._mode=e},getMode:function(){return this._mode},apply:function(e){var t=e.getGraphicContext();this._mode===n.DISABLE?t.disable(t.CULL_FACE):(t.enable(t.CULL_FACE),t.cullFace(this._mode)),this._dirty=!1}}),"osg","CullFace"),n}),define("osg/CullStack",[],function(){var e=function(){this._modelviewMatrixStack=[],this._projectionMatrixStack=[],this._viewportStack=[],this._bbCornerFar=0,this._bbCornerNear=0};return e.prototype={getProjectionMatrixStack:function(){return this._projectionMatrixStack},getModelviewMatrixStack:function(){return this._modelviewMatrixStack},getCurrentProjectionMatrix:function(){return this._projectionMatrixStack[this._projectionMatrixStack.length-1]},getCurrentModelviewMatrix:function(){return this._modelviewMatrixStack[this._modelviewMatrixStack.length-1]},getViewport:function(){return this._viewportStack.length===0?undefined:this._viewportStack[this._viewportStack.length-1]},getLookVectorLocal:function(){var e=this._modelviewMatrixStack[this._modelviewMatrixStack.length-1];return[-e[2],-e[6],-e[10]]},pushViewport:function(e){this._viewportStack.push(e)},popViewport:function(){this._viewportStack.pop()},pushModelviewMatrix:function(e){this._modelviewMatrixStack.push(e);var t=this.getLookVectorLocal();this._bbCornerFar=(t[0]>=0?1:0)|(t[1]>=0?2:0)|(t[2]>=0?4:0),this._bbCornerNear=~this._bbCornerFar&7},popModelviewMatrix:function(){this._modelviewMatrixStack.pop();var e;this._modelviewMatrixStack.length!==0?e=this.getLookVectorLocal():e=[0,0,-1],this._bbCornerFar=(e[0]>=0?1:0)|(e[1]>=0?2:0)|(e[2]>=0?4:0),this._bbCornerNear=~this._bbCornerFar&7},pushProjectionMatrix:function(e){this._projectionMatrixStack.push(e)},popProjectionMatrix:function(){this._projectionMatrixStack.pop()}},e}),define("osg/MatrixTransform",["osg/Utils","osg/Matrix","osg/Transform"],function(e,t,n){var r=function(){n.call(this),this.matrix=t.makeIdentity([])};return r.prototype=e.objectLibraryClass(e.objectInehrit(n.prototype,{getMatrix:function(){return this.matrix},setMatrix:function(e){this.matrix=e},computeLocalToWorldMatrix:function(e,r){return this.referenceFrame===n.RELATIVE_RF?t.preMult(e,this.matrix):e=this.matrix,!0},computeWorldToLocalMatrix:function(e,r){var i=[];return t.inverse(this.matrix,i),this.referenceFrame===n.RELATIVE_RF?t.postMult(i,e):e=inverse,!0}}),"osg","MatrixTransform"),r.prototype.objectType=e.objectType.generate("MatrixTransform"),r}),define("osg/Projection",["osg/Utils","osg/Node","osg/Matrix"],function(e,t,n){var r=function(){t.call(this),this.projection=n.makeIdentity([])};return r.prototype=e.objectInehrit(t.prototype,{getProjectionMatrix:function(){return this.projection},setProjectionMatrix:function(e){this.projection=e}}),r.prototype.objectType=e.objectType.generate("Projection"),r}),define("osg/LightSource",["osg/Utils","osg/Node"],function(e,t){var n=function(){t.call(this),this._light=undefined};return n.prototype=e.objectLibraryClass(e.objectInehrit(t.prototype,{getLight:function(){return this._light},setLight:function(e){this._light=e}}),"osg","LightSource"),n.prototype.objectType=e.objectType.generate("LightSource"),n}),define("osg/Geometry",["osg/Utils","osg/Node","osg/BoundingBox"],function(e,t,n){var r=function(){t.call(this),this.primitives=[],this.attributes={},this.boundingBox=new n,this.boundingBoxComputed=!1,this.cacheAttributeList={}};return r.prototype=e.objectLibraryClass(e.objectInehrit(t.prototype,{releaseGLObjects:function(e){var t;for(t in this.attributes)this.attributes[t].releaseGLObjects(e);for(var n=0,r=this.primitives.length;n<r;n++){var i=this.primitives[n];i.getIndices!==undefined&&i.getIndices()!==undefined&&i.getIndices()!==null&&i.indices.releaseGLObjects(e)}},dirtyBound:function(){this.boundingBoxComputed===!0&&(this.boundingBoxComputed=!1),t.prototype.dirtyBound.call(this)},dirty:function(){this.cacheAttributeList={}},getPrimitives:function(){return this.primitives},getAttributes:function(){return this.attributes},getVertexAttributeList:function(){return this.attributes},getPrimitiveSetList:function(){return this.primitives},drawImplementation:function(e){var t=e.getLastProgramApplied(),n=t.getInstanceID();if(this.cacheAttributeList[n]===undefined){var r,i=t.attributesCache,s=[],o="//generated by Geometry::implementation\n";o+="state.lazyDisablingOfVertexAttributes();\n",o+="var attr;\n";for(var u=0,a=i.attributeKeys.length;u<a;u++){var f=i.attributeKeys[u];r=i[f];var l=this.attributes[f];if(l===undefined)continue;s.push(r),o+="attr = this.attributes['"+f+"'];\n",o+="if (!attr.isValid()) { return; }\n",o+="state.setVertexAttribArray("+r+", attr, false);\n"}o+="state.applyDisablingOfVertexAttributes();\n";var c=this.primitives;o+="var primitives = this.primitives;\n";for(var h=0,p=c.length;h<p;++h)o+="primitives["+h+"].draw(state);\n";this.cacheAttributeList[n]=new Function("state",o)}this.cacheAttributeList[n].call(this,e)},drawImplementationDummy:function(e){var t=e.getLastProgramApplied(),n,r=[],i=t.attributesCache,s=this.primitives;for(var o=0,u=s.length;o<u;++o);},getBoundingBox:function(){return this.boundingBoxComputed||(this.computeBoundingBox(this.boundingBox),this.boundingBoxComputed=!0),this.boundingBox},computeBoundingBox:function(e){var t=this.getAttributes().Vertex;if(t!==undefined&&t.getElements()!==undefined&&t.getItemSize()>2){var n=[0,0,0];vertexes=t.getElements();for(var r=0,i=vertexes.length;r<i;r+=3)n[0]=vertexes[r],n[1]=vertexes[r+1],n[2]=vertexes[r+2],e.expandByVec3(n)}return e},computeBound:function(e){e.init();var t=this.getBoundingBox();return e.expandByBox(t),e}}),"osg","Geometry"),r.prototype.objectType=e.objectType.generate("Geometry"),r}),define("osg/RenderBin",["osg/Notify","osg/StateGraph","osg/Matrix"],function(e,t,n){var r=function(){this._leafs=[],this.positionedAttribute=[],this._renderStage=undefined,this._bins={},this.stateGraphList=[],this._parent=undefined,this._binNum=0,this._sorted=!1,this._sortMode=r.SORT_BY_STATE};return r.SORT_BY_STATE=0,r.SORT_BACK_TO_FRONT=1,r.BinPrototypes={RenderBin:function(){return new r},DepthSortedBin:function(){var e=new r;return e._sortMode=r.SORT_BACK_TO_FRONT,e}},r.prototype={_createRenderBin:function(e){return e===undefined||r.BinPrototypes[e]===undefined?r.BinPrototypes.RenderBin():r.BinPrototypes[e]()},getStateGraphList:function(){return this.stateGraphList},copyLeavesFromStateGraphListToRenderLeafList:function(){this._leafs.splice(0,this._leafs.length);var t=!1;for(var n=0,r=this.stateGraphList.length;n<r;n++){var i=this.stateGraphList[n].leafs;for(var s=0,o=i.length;s<o;s++){var u=i[s];isNaN(u.depth)?t=!0:this._leafs.push(u)}}t&&e.debug("warning: RenderBin::copyLeavesFromStateGraphListToRenderLeafList() detected NaN depth values, database may be corrupted."),this.stateGraphList.splice(0,this.stateGraphList.length)},sortBackToFront:function(){this.copyLeavesFromStateGraphListToRenderLeafList();var e=function(e,t){return t.depth-e.depth};this._leafs.sort(e)},sortImplementation:function(){var e=r;switch(this._sortMode){case e.SORT_BACK_TO_FRONT:this.sortBackToFront();break;case e.SORT_BY_STATE:}},sort:function(){if(this._sorted)return;var e=this._bins,t=Object.keys(e);for(var n=0,r=t.length;n<r;n++)e[t[n]].sort();this.sortImplementation(),_sorted=!0},setParent:function(e){this._parent=e},getParent:function(){return this._parent},getBinNumber:function(){return this._binNum},findOrInsert:function(e,t){var n=this._bins[e];return n===undefined&&(n=this._createRenderBin(t),n._parent=this,n._binNum=e,n._renderStage=this._renderStage,this._bins[e]=n),n},getStage:function(){return this._renderStage},addStateGraph:function(e){this.stateGraphList.push(e)},reset:function(){this.stateGraphList.length=0,this._bins={},this.positionedAttribute.length=0,this._leafs.length=0,this._sorted=!1},applyPositionedAttribute:function(e,t){for(var n=0,r=t.length;n<r;n++){var i=t[n],s=i[1],o=i[0];e.setGlobalDefaultValue(s),s.apply(e),s.applyPositionedUniform(o,e),e.haveAppliedAttribute(s)}},drawImplementation:function(e,t){var n=t,r=Object.keys(this._bins),i=this._bins,s=[];for(var o=0,u=r.length;o<u;o++){var a=r[o];s.push(i[a])}var f=function(e,t){return e._binNum-t._binNum};s.sort(f);var l=0,c=s.length,h;for(;l<c;l++){h=s[l];if(h.getBinNumber()>0)break;n=h.drawImplementation(e,n)}n=this.drawLeafs(e,n);for(;l<c;l++)h=s[l],n=h.drawImplementation(e,n);return n},drawLeafs:function(e,r){var i=this.stateGraphList,s=this._leafs,o,u,a,f,l,c=r,h=[],p=[];c&&t.prototype.moveToRootStateGraph(e,r.parent);var d,v,m,g,y;for(var b=0,w=s.length;b<w;b++)d=s[b],v=!1,c!==undefined?(m=c.parent,g=m.parent,y=d.parent,g!==y.parent?(y.moveStateGraph(e,g,y.parent),e.pushStateSet(y.stateset),v=!0):y!==m&&(e.pushStateSet(y.stateset),v=!0)):(d.parent.moveStateGraph(e,undefined,d.parent.parent),e.pushStateSet(d.parent.stateset),v=!0),v===!0&&(e.apply(),f=e.getLastProgramApplied(),u=f.uniformsCache[e.modelViewMatrix.name],a=f.uniformsCache[e.projectionMatrix.name],o=f.uniformsCache[e.normalMatrix.name]),u!==undefined&&(e.modelViewMatrix.set(d.modelview),e.modelViewMatrix.apply(u)),a!==undefined&&(e.projectionMatrix.set(d.projection),e.projectionMatrix.apply(a)),o!==undefined&&(n.copy(d.modelview,h),h[12]=0,h[13]=0,h[14]=0,n.inverse(h,h),n.transpose(h,h),e.normalMatrix.set(h),e.normalMatrix.apply(o)),d.geometry.drawImplementation(e),v===!0&&(e.popGeneratedProgram(),e.popStateSet()),c=d;for(var E=0,S=i.length;E<S;E++){var x=i[E];for(var T=0,N=x.leafs.length;T<N;T++)d=x.leafs[T],v=!1,c!==undefined?(m=c.parent,g=m.parent,y=d.parent,g!==y.parent?(y.moveStateGraph(e,g,y.parent),e.pushStateSet(y.stateset),v=!0):y!==m&&(e.pushStateSet(y.stateset),v=!0)):(d.parent.moveStateGraph(e,undefined,d.parent.parent),e.pushStateSet(d.parent.stateset),v=!0),v===!0&&(e.apply(),f=e.getLastProgramApplied(),u=f.uniformsCache[e.modelViewMatrix.name],a=f.uniformsCache[e.projectionMatrix.name],o=f.uniformsCache[e.normalMatrix.name]),u!==undefined&&(e.modelViewMatrix.set(d.modelview),e.modelViewMatrix.apply(u)),a!==undefined&&(e.projectionMatrix.set(d.projection),e.projectionMatrix.apply(a)),o!==undefined&&(n.copy(d.modelview,h),h[12]=0,h[13]=0,h[14]=0,n.inverse(h,h),n.transpose(h,h),e.normalMatrix.set(h),e.normalMatrix.apply(o)),d.geometry.drawImplementation(e),v===!0&&(e.popGeneratedProgram(),e.popStateSet()),c=d}return c}},r}),define("osg/FrameBufferObject",["osg/Notify","osg/Utils","osg/StateAttribute"],function(e,t,n){var r=function(){n.call(this),this.fbo=undefined,this.attachments=[],this.dirty()};return r.COLOR_ATTACHMENT0=36064,r.DEPTH_ATTACHMENT=36096,r.DEPTH_COMPONENT16=33189,r.prototype=t.objectInehrit(n.prototype,{attributeType:"FrameBufferObject",cloneType:function(){return new r},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setAttachment:function(e){this.attachments.push(e)},_reportFrameBufferError:function(t){switch(t){case 36054:e.debug("FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case 36055:e.debug("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case 36057:e.debug("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case 36061:Notifiy.debug("FRAMEBUFFER_UNSUPPORTED");break;default:e.debug("FRAMEBUFFER unknown error "+t.toString(16))}},apply:function(t){var n=t.getGraphicContext(),r;if(this.attachments.length>0)if(this.isDirty()){this.fbo||(this.fbo=n.createFramebuffer()),n.bindFramebuffer(n.FRAMEBUFFER,this.fbo);var i=!1;for(var s=0,o=this.attachments.length;s<o;++s)if(this.attachments[s].texture===undefined){var u=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,u),n.renderbufferStorage(n.RENDERBUFFER,this.attachments[s].format,this.attachments[s].width,this.attachments[s].height),n.framebufferRenderbuffer(n.FRAMEBUFFER,this.attachments[s].attachment,n.RENDERBUFFER,u),i=!0}else{var a=this.attachments[s].texture;t.applyTextureAttribute(0,a),n.framebufferTexture2D(n.FRAMEBUFFER,this.attachments[s].attachment,a.getTextureTarget(),a.getTextureObject(),this.attachments[s].level)}r=n.checkFramebufferStatus(n.FRAMEBUFFER),r!==36053&&this._reportFrameBufferError(r),i&&n.bindRenderbuffer(n.RENDERBUFFER,null),this.setDirty(!1)}else n.bindFramebuffer(n.FRAMEBUFFER,this.fbo),e.reportWebGLError===!0&&(r=n.checkFramebufferStatus(n.FRAMEBUFFER),r!==36053&&this._reportFrameBufferError(r));else n.bindFramebuffer(n.FRAMEBUFFER,null)}}),r}),define("osg/RenderStage",["osg/Notify","osg/Utils","osg/RenderBin","osg/Camera","osg/FrameBufferObject"],function(e,t,n,r,i){var s=function(){n.call(this),this.positionedAttribute=[],this.clearDepth=1,this.clearColor=[0,0,0,1],this.clearMask=r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT,this.camera=undefined,this.viewport=undefined,this.preRenderList=[],this.postRenderList=[],this._renderStage=this};return s.prototype=t.objectInehrit(n.prototype,{reset:function(){n.prototype.reset.call(this),this.preRenderList.length=0,this.postRenderList.length=0},setClearDepth:function(e){this.clearDepth=e},getClearDepth:function(){return this.clearDepth},setClearColor:function(e){this.clearColor=e},getClearColor:function(){return this.clearColor},setClearMask:function(e){this.clearMask=e},getClearMask:function(){return this.clearMask},setViewport:function(e){this.viewport=e},getViewport:function(){return this.viewport},setCamera:function(e){this.camera=e},addPreRenderStage:function(e,t){for(var n=0,r=this.preRenderList.length;n<r;n++){var i=this.preRenderList[n];if(t<i.order)break}n<this.preRenderList.length?this.preRenderList=this.preRenderList.splice(n,0,{order:t,renderStage:e}):this.preRenderList.push({order:t,renderStage:e})},addPostRenderStage:function(e,t){for(var n=0,r=this.postRenderList.length;n<r;n++){var i=this.postRenderList[n];if(t<i.order)break}n<this.postRenderList.length?this.postRenderList=this.postRenderList.splice(n,0,{order:t,renderStage:e}):this.postRenderList.push({order:t,renderStage:e})},drawPreRenderStages:function(e,t){var n=t;for(var r=0,i=this.preRenderList.length;r<i;++r){var s=this.preRenderList[r].renderStage;n=s.draw(e,n)}return n},draw:function(e,t){var n=this.drawPreRenderStages(e,t);return n=this.drawImplementation(e,n),n=this.drawPostRenderStages(e,n),n},sort:function(){for(var e=0,t=this.preRenderList.length;e<t;++e)this.preRenderList[e].renderStage.sort();n.prototype.sort.call(this);for(var r=0,i=this.postRenderList.length;e<t;++e)this.postRenderList[e].renderStage.sort()},drawPostRenderStages:function(e,t){var n=t;for(var r=0,i=this.postRenderList.length;r<i;++r){var s=this.postRenderList[r].renderStage;n=s.draw(e,n)}return n},applyCamera:function(e){var t=e.getGraphicContext();if(this.camera===undefined){t.bindFramebuffer(t.FRAMEBUFFER,null);return}var n=this.camera.getViewport(),r=this.camera.frameBufferObject;r||(r=new i,this.camera.frameBufferObject=r);if(r.isDirty()&&this.camera.attachments!==undefined)for(var s in this.camera.attachments){var o=this.camera.attachments[s],u;o.texture===undefined?u={attachment:s,format:o.format,width:n.width(),height:n.height()}:o.texture!==undefined&&(u={attachment:s,texture:o.texture,level:o.level},o.format&&(u.format=o.format)),r.setAttachment(u)}r.apply(e)},drawImplementation:function(t,r){var i,s=t.getGraphicContext();this.applyCamera(t),this.viewport===undefined&&e.log("RenderStage does not have a valid viewport"),t.applyAttribute(this.viewport),this.clearMask&s.COLOR_BUFFER_BIT&&s.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),this.clearMask&s.DEPTH_BUFFER_BIT&&(s.depthMask(!0),s.clearDepth(this.clearDepth)),s.clear(this.clearMask),this.positionedAttribute&&this.applyPositionedAttribute(t,this.positionedAttribute);var o=n.prototype.drawImplementation.call(this,t,r);return o}}),s}),define("osg/CullVisitor",["osg/Notify","osg/Utils","osg/NodeVisitor","osg/CullSettings","osg/CullStack","osg/Matrix","osg/MatrixTransform","osg/Projection","osg/LightSource","osg/Geometry","osg/RenderStage","osg/Node","osg/Transform","osg/Camera"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=function(){n.call(this),r.call(this),i.call(this),this._rootStateGraph=undefined,this._currentStateGraph=undefined,this._currentRenderBin=undefined,this._currentRenderStage=undefined,this._rootRenderStage=undefined,this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY;var e=[0,0,-1];this._bbCornerFar=(e[0]>=0?1:0)|(e[1]>=0?2:0)|(e[2]>=0?4:0),this._bbCornerNear=~this._bbCornerFar&7,this._reserveMatrixStack=[[]],this._reserveMatrixStack.current=0,this._reserveLeafStack=[{}],this._reserveLeafStack.current=0,this._renderBinStack=[]};return d.prototype=t.objectInehrit(i.prototype,t.objectInehrit(r.prototype,t.objectInehrit(n.prototype,{distance:function(e,t){return-(e[0]*t[2]+e[1]*t[6]+e[2]*t[10]+t[14])},handleCullCallbacksAndTraverse:function(e){var t=e.getCullCallback();if(t&&!t.cull(e,this))return;this.traverse(e)},updateCalculatedNearFar:function(e,t){var n=t.getBoundingBox(),r,i;r=this.distance(n.corner(this._bbCornerNear),e),i=this.distance(n.corner(this._bbCornerFar),e);if(r>i){var s=r;r=i,i=s}return i<0?!1:(r<this._computedNear&&(this._computedNear=r),i>this._computedFar&&(this._computedFar=i),!0)},clampProjectionMatrix:function(t,n,r,i,o){var u=1e-6;if(r<n-u)return e.log("clampProjectionMatrix not applied, invalid depth range, znear = "+n+"  zfar = "+r),!1;var a,f;if(r<n+u){var l=(n+r)*.5;n=l-u,r=l+u}if(Math.abs(s.get(t,0,3))<u&&Math.abs(s.get(t,1,3))<u&&Math.abs(s.get(t,2,3))<u){var c=(r-n)*.02;c<1&&(c=1),a=n-c,f=r+c,n=a,r=f,s.set(t,2,2,-2/(f-a)),s.set(t,3,2,-(f+a)/(f-a))}else{var h=1.02,p=.98;a=n*p,f=r*h;var d=r*i;a<d&&(a=d),n=a,r=f;var v=s.get(t,2,2),m=s.get(t,3,2),g=s.get(t,2,3),y=s.get(t,3,3),b=(-a*v+m)/(-a*g+y),w=(-f*v+m)/(-f*g+y),E=Math.abs(2/(b-w)),S=-(b+w)/2,x=[1,0,0,0,0,1,0,0,0,0,E,0,0,0,S*E,1];s.postMult(x,t)}return o!==undefined&&(o[0]=n,o[1]=r),!0},setStateGraph:function(e){this._rootStateGraph=e,this._currentStateGraph=e},setRenderStage:function(e){this._rootRenderStage=e,this._currentRenderBin=e},reset:function(){this._modelviewMatrixStack.splice(0,this._modelviewMatrixStack.length),this._projectionMatrixStack.splice(0,this._projectionMatrixStack.length),this._reserveMatrixStack.current=0,this._reserveLeafStack.current=0,this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY},getCurrentRenderBin:function(){return this._currentRenderBin},setCurrentRenderBin:function(e){this._currentRenderBin=e},addPositionedAttribute:function(e){var t=this._modelviewMatrixStack[this._modelviewMatrixStack.length-1];this._currentRenderBin.getStage().positionedAttribute.push([t,e])},pushStateSet:function(e){this._currentStateGraph=this._currentStateGraph.findOrInsert(e);if(e.getBinName()!==undefined){var t=this._renderBinStack,n=this._currentRenderBin;t.push(n),this._currentRenderBin=n.getStage().findOrInsert(e.getBinNumber(),e.getBinName())}},popStateSet:function(){var e=this._currentStateGraph,t=e.getStateSet();this._currentStateGraph=e.parent;if(t.getBinName()!==undefined){var n=this._renderBinStack;n.length===0?this._currentRenderBin=this._currentRenderBin.getStage():this._currentRenderBin=n.pop()}},popProjectionMatrix:function(){if(this._computeNearFar===!0&&this._computedFar>=this._computedNear){var e=this._projectionMatrixStack[this._projectionMatrixStack.length-1];this.clampProjectionMatrix(e,this._computedNear,this._computedFar,this._nearFarRatio)}i.prototype.popProjectionMatrix.call(this)},apply:function(e){this[e.objectType].call(this,e)},_getReservedMatrix:function(){var e=this._reserveMatrixStack[this._reserveMatrixStack.current++];return this._reserveMatrixStack.current===this._reserveMatrixStack.length&&this._reserveMatrixStack.push(s.makeIdentity([])),e},_getReservedLeaf:function(){var e=this._reserveLeafStack[this._reserveLeafStack.current++];return this._reserveLeafStack.current===this._reserveLeafStack.length&&this._reserveLeafStack.push({}),e}}))),d.prototype[p.prototype.objectType]=function(e){var t=e.getStateSet();t&&this.pushStateSet(t),e.light&&this.addPositionedAttribute(e.light);var n=this._modelviewMatrixStack[this._modelviewMatrixStack.length-1],i=this._getReservedMatrix(),o=this._getReservedMatrix();if(e.getReferenceFrame()===h.RELATIVE_RF){var u=this._projectionMatrixStack[this._projectionMatrixStack.length-1];s.mult(u,e.getProjectionMatrix(),o);var a=this._modelviewMatrixStack[this._modelviewMatrixStack.length-1];s.mult(a,e.getViewMatrix(),i)}else s.copy(e.getViewMatrix(),i),s.copy(e.getProjectionMatrix(),o);this.pushProjectionMatrix(o),this.pushModelviewMatrix(i),e.getViewport()&&this.pushViewport(e.getViewport());var f=this._computedNear,c=this._computedFar,d=new r;d.setCullSettings(this),this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY,this.setCullSettings(e);if(e.getRenderOrder()===p.NESTED_RENDER)this.handleCullCallbacksAndTraverse(e);else{var v=this.getCurrentRenderBin().getStage(),m=new l;m.setCamera(e),m.setClearDepth(e.getClearDepth()),m.setClearColor(e.getClearColor()),m.setClearMask(e.getClearMask());var g;e.getViewport()===undefined?g=v.getViewport():g=e.getViewport(),m.setViewport(g);var y=this.getCurrentRenderBin();this.setCurrentRenderBin(m),this.handleCullCallbacksAndTraverse(e),this.setCurrentRenderBin(y),e.getRenderOrder()===p.PRE_RENDER?this.getCurrentRenderBin().getStage().addPreRenderStage(m,e.renderOrderNum):this.getCurrentRenderBin().getStage().addPostRenderStage(m,e.renderOrderNum)}this.popModelviewMatrix(),this.popProjectionMatrix(),e.getViewport()&&this.popViewport(),this.setCullSettings(d),this._computedNear=f,this._computedFar=c,t&&this.popStateSet()},d.prototype[o.prototype.objectType]=function(e){var t=this._getReservedMatrix();if(e.getReferenceFrame()===h.RELATIVE_RF){var n=this._modelviewMatrixStack[this._modelviewMatrixStack.length-1];s.mult(n,e.getMatrix(),t)}else s.copy(e.getMatrix(),t);this.pushModelviewMatrix(t);var r=e.getStateSet();r&&this.pushStateSet(r),e.light&&this.addPositionedAttribute(e.light),this.handleCullCallbacksAndTraverse(e),r&&this.popStateSet(),this.popModelviewMatrix()},d.prototype[u.prototype.objectType]=function(e){lastMatrixStack=this._projectionMatrixStack[this._projectionMatrixStack.length-1];var t=this._getReservedMatrix();s.mult(lastMatrixStack,e.getProjectionMatrix(),t),this.pushProjectionMatrix(t);var n=e.getStateSet();n&&this.pushStateSet(n),this.handleCullCallbacksAndTraverse(e),n&&this.popStateSet(),this.popProjectionMatrix()},d.prototype[c.prototype.objectType]=function(e){var t=e.getStateSet();t&&this.pushStateSet(t),e.light&&this.addPositionedAttribute(e.light),this.handleCullCallbacksAndTraverse(e),t&&this.popStateSet()},d.prototype[a.prototype.objectType]=function(e){var t=e.getStateSet();t&&this.pushStateSet(t);var n=e.getLight();n&&this.addPositionedAttribute(n),this.handleCullCallbacksAndTraverse(e),t&&this.popStateSet()},d.prototype[f.prototype.objectType]=function(t){var n=this._modelviewMatrixStack[this._modelviewMatrixStack.length-1],r=t.getBoundingBox();if(this._computeNearFar&&r.valid()&&!this.updateCalculatedNearFar(n,t))return;var i=t.getStateSet();i&&this.pushStateSet(i),this.handleCullCallbacksAndTraverse(t);var s=this._currentStateGraph.leafs;s.length===0&&this._currentRenderBin.addStateGraph(this._currentStateGraph);var o=this._getReservedLeaf(),u=0;r.valid()&&(u=this.distance(r.center(),n)),isNaN(u)?e.warn("warning geometry has a NaN depth, "+n+" center "+r.center()):(o.parent=this._currentStateGraph,o.projection=this._projectionMatrixStack[this._projectionMatrixStack.length-1],o.geometry=t,o.modelview=n,o.depth=u,s.push(o)),i&&this.popStateSet()},d}),define("osg/Depth",["osg/Utils","osg/StateAttribute"],function(e,t,n){var n=function(e,r,i,s){t.call(this),this._func=n.LESS,this._near=0,this._far=1,this._writeMask=!0,e!==undefined&&(typeof e=="string"?this._func=n[e]:this._func=e),r!==undefined&&(this._near=r),i!==undefined&&(this._far=i),s!==undefined&&(this._writeMask=s)};return n.DISABLE=0,n.NEVER=512,n.LESS=513,n.EQUAL=514,n.LEQUAL=515,n.GREATE=516,n.NOTEQU=517,n.GEQUAL=518,n.ALWAYS=519,n.prototype=e.objectLibraryClass(e.objectInehrit(t.prototype,{attributeType:"Depth",cloneType:function(){return new n},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setRange:function(e,t){this._near=e,this._far=t},setWriteMask:function(e){this._writeMask=e},apply:function(e){var t=e.getGraphicContext();this._func===0?t.disable(t.DEPTH_TEST):(t.enable(t.DEPTH_TEST),t.depthFunc(this._func),t.depthMask(this._writeMask),t.depthRange(this._near,this._far))}}),"osg","Depth"),n}),define("osg/DrawArrayLengths",[],function(){var e=function(e,t,n){this._mode=e,this._first=t,this._arrayLengths=n.slice(0)};return e.prototype={draw:function(e){var t=e.getGraphicContext(),n=this._mode,r=this._first,i=this._arrayLengths;for(var s=0,o=i.length;s<o;s++){var u=i[s];t.drawArrays(n,r,u),r+=u}},getMode:function(){return this._mode},getNumIndices:function(){var e=0,t=this._arrayLengths;for(var n=0,r=t.length;n<r;n++)e+=t[n];return e},getArrayLengths:function(){return this._arrayLengths},getFirst:function(){return this._first},setFirst:function(e){this._first=e}},e}),define("osg/DrawArrays",["osg/Notify"],function(e){var t=function(e,t,n){this.mode=e,this.first=t,this.count=n};return t.prototype={draw:function(e){var t=e.getGraphicContext();t.drawArrays(this.mode,this.first,this.count)},getMode:function(){return this.mode},getCount:function(){return this.count},getFirst:function(){return this.first}},t.create=function(n,r,i){e.log("DrawArrays.create is deprecated, use new DrawArrays with same arguments");var s=new t(n,r,i);return s},t}),define("osg/PrimitiveSet",[],function(){var e={};return e.POINTS=0,e.LINES=1,e.LINE_LOOP=2,e.LINE_STRIP=3,e.TRIANGLES=4,e.TRIANGLE_STRIP=5,e.TRIANGLE_FAN=6,e}),define("osg/DrawElements",["osg/Notify","osg/PrimitiveSet"],function(e,t){var n=function(e,n){this.mode=t.POINTS,e!==undefined&&(this.mode=e),this.count=0,this.offset=0,this.indices=n,n!==undefined&&this.setIndices(n)};return n.prototype={getMode:function(){return this.mode},draw:function(e){e.setIndexArray(this.indices);var t=e.getGraphicContext();t.drawElements(this.mode,this.count,t.UNSIGNED_SHORT,this.offset)},setIndices:function(e){this.indices=e,this.count=e.getElements().length},getIndices:function(){return this.indices},setFirst:function(e){this.offset=e},getFirst:function(){return this.offset},setCount:function(e){this.count=e},getCount:function(){return this.count}},n.create=function(t,r){return e.log("DrawElements.create is deprecated, use new DrawElements with same arguments"),new n(t,r)},n}),define("osg/EllipsoidModel",["osg/Notify","osg/Matrix","osg/Vec3"],function(e,t,n){var r=function(){this._radiusEquator=r.WGS_84_RADIUS_EQUATOR,this._radiusPolar=r.WGS_84_RADIUS_POLAR,this.computeCoefficients()};return r.WGS_84_RADIUS_EQUATOR=6378137,r.WGS_84_RADIUS_POLAR=6356752.3142,r.prototype={setRadiusEquator:function(e){this._radiusEquator=e,this.computeCoefficients()},getRadiusEquator:function(){return this._radiusEquator},setRadiusPolar:function(e){this._radiusPolar=e,this.computeCoefficients()},getRadiusPolar:function(){return this._radiusPolar},convertLatLongHeightToXYZ:function(t,n,r,i){i===undefined&&(e.warn("deprecated, use this signature convertLatLongHeightToXYZ( latitude, longitude, height, result )"),i=[]);var s=Math.sin(t),o=Math.cos(t),u=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*s*s),a=(u+r)*o*Math.cos(n),f=(u+r)*o*Math.sin(n),l=(u*(1-this._eccentricitySquared)+r)*s;return i[0]=a,i[1]=f,i[2]=l,i},convertXYZToLatLongHeight:function(t,n,r,i){i===undefined&&(e.warn("deprecated, use this signature convertXYZToLatLongHeight( X,  Y,  Z , result)"),i=[]);var s=Math.sqrt(t*t+n*n),o=Math.atan2(r*this._radiusEquator,s*this._radiusPolar),u=(this._radiusEquator*this._radiusEquator-this._radiusPolar*this._radiusPolar)/(this._radiusPolar*this._radiusPolar),a=Math.sin(o),f=Math.cos(o);latitude=Math.atan((r+u*this._radiusPolar*a*a*a)/(s-this._eccentricitySquared*this._radiusEquator*f*f*f)),longitude=Math.atan2(n,t);var l=Math.sin(latitude),c=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*l*l);return height=s/Math.cos(latitude)-c,i[0]=latitude,i[1]=longitude,i[2]=height,i},computeLocalUpVector:function(e,t,n){var r,i,s,o=this.convertXYZToLatLongHeight(e,t,n,r,i,s);return r=o[0],i=o[1],s=o[2],[Math.cos(i)*Math.cos(r),Math.sin(i)*Math.cos(r),Math.sin(r)]},isWGS84:function(){return this._radiusEquator==r.WGS_84_RADIUS_EQUATOR&&this._radiusPolar==r.WGS_84_RADIUS_POLAR},computeCoefficients:function(){var e=(this._radiusEquator-this._radiusPolar)/this._radiusEquator;this._eccentricitySquared=2*e-e*e},computeLocalToWorldTransformFromLatLongHeight:function(n,r,i,s){s===undefined&&(e.warn("deprecated, use this signature computeLocalToWorldTransformFromLatLongHeight(latitude, longitude, height, result)"),s=new Array(16));var o=this.convertLatLongHeightToXYZ(n,r,i,s),u=t.makeTranslate(o[0],o[1],o[2],s);return this.computeCoordinateFrame(n,r,s),s},computeLocalToWorldTransformFromXYZ:function(e,n,r){var i=this.convertXYZToLatLongHeight(e,n,r),s=t.makeTranslate(e,n,r);return this.computeCoordinateFrame(i[0],i[1],s),s},computeCoordinateFrame:function(e,r,i){var s=[Math.cos(r)*Math.cos(e),Math.sin(r)*Math.cos(e),Math.sin(e)],o=[-Math.sin(r),Math.cos(r),0],u=n.cross(s,o,[]);t.set(i,0,0,o[0]),t.set(i,0,1,o[1]),t.set(i,0,2,o[2]),t.set(i,1,0,u[0]),t.set(i,1,1,u[1]),t.set(i,1,2,u[2]),t.set(i,2,0,s[0]),t.set(i,2,1,s[1]),t.set(i,2,2,s[2])}},r}),define("osg/FrameStamp",[],function(){var e=function(){var e=0,t=0,n=0;this.setReferenceTime=function(e){t=e},this.setSimulationTime=function(e){n=e},this.getReferenceTime=function(){return t},this.getSimulationTime=function(){return n},this.setFrameNumber=function(t){e=t},this.getFrameNumber=function(){return e}};return e}),define("osg/Image",["osg/Utils","osg/Object"],function(e,t){var n=function(e){t.call(this),this._imageObject=undefined,this._url=undefined,this._width=undefined,this._height=undefined,e&&this.setImage(e),this._isGreyscale=undefined};return n.prototype=e.objectLibraryClass(e.objectInherit(t.prototype,{dirty:function(){this._isGreyscale=undefined},getImage:function(){return this._imageObject},getURL:function(){return this._url},setURL:function(e){this._url=e},setImage:function(e){!this._url&&e&&e.src&&(this._url=e.src),this._imageObject=e,this.dirty()},isCanvas:function(){return this._imageObject instanceof HTMLCanvasElement},isImage:function(){return this._imageObject instanceof window.Image},isTypedArray:function(){return this._imageObject instanceof Uint8Array},setWidth:function(e){this._width=e},setHeight:function(e){this._height=e},getWidth:function(){return this.isImage()?this._imageObject.naturalWidth:this.isCanvas()?this._imageObject.width:this._width},getHeight:function(){return this.isImage()?this._imageObject.naturalHeight:this.isCanvas()?this._imageObject.height:this._height},isGreyscale:function(){if(this._isGreyscale!==undefined)return this._isGreyscale;if(this._imageObject!==undefined&&this.isReady()&&this._isGreyscale===undefined){var e=this._imageObject;this.isCanvas()||(e=document.createElement("canvas"));var t=e.getContext("2d");e.width=img.width,e.height=img.height,t.drawImage(img,0,0);var n=t.getImageData(0,0,1,1).data,r=n[0]==n[1]&&n[1]==n[2];this._isGreyscale=r}return this._isGreyscale},isReady:function(){if(this.isCanvas()||this.isTypedArray())return!0;if(this.isImage()){var e=this._imageObject;if(e.complete)return e.naturalWidth!==undefined&&e.naturalWidth===0?!1:!0}return!1}}),"osg","Image"),n.prototype.objectType=e.objectType.generate("Image"),n}),define("osg/Uniform",["osg/Utils"],function(e){var t=function(){this.transpose=!1,this._dirty=!0,this.name="",this.type=undefined};return t.isUniform=function(e){return e.prototype===t.prototype?!0:!1},t.prototype={getName:function(){return this.name},getType:function(){return this.type},get:function(){return this.data},set:function(e){this.data=e,this.dirty()},dirty:function(){this._dirty=!0},apply:function(e){this._dirty&&(this.update.call(this.glData,this.data),this._dirty=!1),this.glCall(e,this.glData)},applyMatrix:function(e){this._dirty&&(this.update.call(this.glData,this.data),this._dirty=!1),this.glCall(e,this.transpose,this.glData)},update:function(e){for(var t=0,n=e.length;t<n;++t)this[t]=e[t]},_updateArray:function(e){for(var t=0,n=e.length;t<n;++t)this[t]=e[t]},_updateFloat1:function(e){this[0]=e[0]},_updateFloat2:function(e){this[0]=e[0],this[1]=e[1]},_updateFloat3:function(e){this[0]=e[0],this[1]=e[1],this[2]=e[2]},_updateFloat4:function(e){this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3]},_updateFloat9:function(e){this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8]},_updateFloat16:function(e){this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15]}},t.createFloat1=function(n,r){var i=n,s=r;s===undefined&&(s=i,i=[0]);var o=new t;return o.data=[i],o.glCall=function(e,t){gl.uniform1fv(e,t)},o.glData=new e.Float32Array(o.data),o.update=t.prototype._updateFloat1,o.set=function(e){typeof e=="number"?this.data[0]=e:this.data=e,this.dirty()},o.name=s,o.type="float",o},t.createFloat=t.createFloat1,t["float"]=t.createFloat1,t.createFloatArray=function(e,n){var r=t.createFloat.call(this,e,n);return r.update=t.prototype._updateArray,r},t.createFloat2=function(n,r){var i=n,s=r;s===undefined&&(s=i,i=[0,0]);var o=new t;return o.data=i,o.glCall=function(e,t){gl.uniform2fv(e,t)},o.glData=new e.Float32Array(o.data),o.update=t.prototype._updateFloat2,o.name=s,o.type="vec2",o},t.vec2=t.createFloat2,t.createFloat2Array=function(e,n){var r=t.createFloat2.call(this,e,n);return r.update=t.prototype._updateArray,r},t.createFloat3=function(n,r){var i=n,s=r;s===undefined&&(s=i,i=[0,0,0]);var o=new t;return o.data=i,o.glCall=function(e,t){gl.uniform3fv(e,t)},o.glData=new e.Float32Array(o.data),o.update=t.prototype._updateFloat3,o.name=s,o.type="vec3",o},t.vec3=t.createFloat3,t.createFloat3Array=function(e,n){var r=t.createFloat3.call(this,e,n);return r.update=t.prototype._updateArray,r},t.createFloat4=function(n,r){var i=n,s=r;s===undefined&&(s=i,i=[0,0,0,0]);var o=new t;return o.data=i,o.glCall=function(e,t){gl.uniform4fv(e,t)},o.glData=new e.Float32Array(o.data),o.update=t.prototype._updateFloat4,o.name=s,o.type="vec4",o},t.vec4=t.createFloat4,t.createFloat4Array=function(e,n){var r=t.createFloat4.call(this,e,n);return r.update=t.prototype._updateArray,r},t.createInt1=function(n,r){var i=n,s=r;s===undefined&&(s=i,i=[0]);var o=new t;return o.data=[i],o.glCall=function(e,t){gl.uniform1iv(e,t)},o.set=function(e){typeof e=="number"?this.data[0]=e:this.data=e,this.dirty()},o.glData=new e.Int32Array(o.data),o.name=s,o.type="int",o},t["int"]=t.createInt1,t.createInt=t.createInt1,t.createIntArray=function(e,n){var r=t.createInt.call(this,e,n);return r.update=t.prototype._updateArray,r},t.createInt2=function(n,r){var i=n,s=r;s===undefined&&(s=i,i=[0,0]);var o=new t;return o.data=i,o.glCall=function(e,t){gl.uniform2iv(e,t)},o.glData=new e.Int32Array(o.data),o.name=s,o.type="vec2i",o},t.vec2i=t.createInt2,t.createInt2Array=function(e,n){var r=t.createInt2.call(this,e,n);return r.update=t.prototype._updateArray,r},t.createInt3=function(n,r){var i=n,s=r;s===undefined&&(s=i,i=[0,0,0]);var o=new t;return o.data=i,o.glCall=function(e,t){gl.uniform3iv(e,t)},o.glData=new e.Int32Array(o.data),o.name=s,o.type="vec3i",o},t.vec3i=t.createInt3,t.createInt3Array=function(e,n){var r=t.createInt3.call(this,e,n);return r.update=t.prototype._updateArray,r},t.createInt4=function(n,r){var i=n,s=r;s===undefined&&(s=i,i=[0,0,0,0]);var o=new t;return o.data=i,o.glCall=function(e,t){gl.uniform4iv(e,t)},o.glData=new e.Int32Array(o.data),o.name=s,o.type="vec4i",o},t.vec4i=t.createInt4,t.createInt4Array=function(e,n){var r=t.createInt4.call(this,e,n);return r.update=t.prototype._updateArray,r},t.createMatrix2=function(n,r){var i=n,s=r;s===undefined&&(s=i,i=[1,0,0,1]);var o=new t;return o.data=i,o.glCall=function(e,t,n){gl.uniformMatrix2fv(e,t,n)},o.apply=o.applyMatrix,o.transpose=!1,o.glData=new e.Float32Array(o.data),o.update=t.prototype._updateFloat4,o.name=s,o.type="mat2",o},t.createMat2=t.createMatrix2,t.mat2=t.createMat2,t.createMatrix3=function(n,r){var i=n,s=r;s===undefined&&(s=i,i=[1,0,0,0,1,0,0,0,1]);var o=new t;return o.data=i,o.glCall=function(e,t,n){gl.uniformMatrix3fv(e,t,n)},o.apply=o.applyMatrix,o.transpose=!1,o.glData=new e.Float32Array(o.data),o.update=t.prototype._updateFloat9,o.name=s,o.type="mat3",o},t.createMat3=t.createMatrix3,t.mat3=t.createMatrix3,t.createMatrix4=function(n,r){var i=n,s=r;s===undefined&&(s=i,i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);var o=new t;return o.data=i,o.glCall=function(e,t,n){gl.uniformMatrix4fv(e,t,n)},o.apply=o.applyMatrix,o.transpose=!1,o.glData=new e.Float32Array(o.data),o.update=t.prototype._updateFloat16,o.name=s,o.type="mat4",o},t.createMat4=t.createMatrix4,t.mat4=t.createMatrix4,t}),define("osg/Program",["osg/Notify","osg/Utils","osg/StateAttribute"],function(e,t,n){var r=function(e,t){n.call(this),this.program=null,this.setVertexShader(e),this.setFragmentShader(t),this.dirty=!0};return r.prototype=t.objectLibraryClass(t.objectInehrit(n.prototype,{attributeType:"Program",cloneType:function(){var e=new r;return e.default_program=!0,e},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},setVertexShader:function(e){this.vertex=e},setFragmentShader:function(e){this.fragment=e},getVertexShader:function(){return this.vertex},getFragmentShader:function(){return this.fragment},apply:function(t){if(!this.program||this.isDirty()){if(this.default_program===!0)return;this.vertex.shader||this.vertex.compile(),this.fragment.shader||this.fragment.compile(),this.program=gl.createProgram(),gl.attachShader(this.program,this.vertex.shader),gl.attachShader(this.program,this.fragment.shader),gl.linkProgram(this.program),gl.validateProgram(this.program);if(!gl.getProgramParameter(this.program,gl.LINK_STATUS)&&!gl.isContextLost())return e.log("can't link program\nvertex shader:\n"+this.vertex.text+"\n fragment shader:\n"+this.fragment.text),e.log(gl.getProgramInfoLog(this.program)),this.setDirty(!1),null;this.uniformsCache={},this.uniformsCache.uniformKeys=[],this.attributesCache={},this.attributesCache.attributeKeys=[],this.cacheUniformList(this.vertex.text),this.cacheUniformList(this.fragment.text),this.cacheAttributeList(this.vertex.text),this.setDirty(!1)}gl.useProgram(this.program)},cacheUniformList:function(e){var t=e.match(/uniform\s+\w+\s+\w+/g);if(t!==null)for(var n=0,r=t.length;n<r;n++){var i=t[n].match(/uniform\s+\w+\s+(\w+)/)[1],s=gl.getUniformLocation(this.program,i);s!==undefined&&s!==null&&this.uniformsCache[i]===undefined&&(this.uniformsCache[i]=s,this.uniformsCache.uniformKeys.push(i))}},cacheAttributeList:function(e){var t=e.match(/attribute\s+\w+\s+\w+/g);if(t!==null)for(var n=0,r=t.length;n<r;n++){var i=t[n].match(/attribute\s+\w+\s+(\w+)/)[1],s=gl.getAttribLocation(this.program,i);s!==-1&&s!==undefined&&this.attributesCache[i]===undefined&&(this.attributesCache[i]=s,this.attributesCache.attributeKeys.push(i))}}}),"osg","Program"),r.create=function(e,t){console.log("Program.create is deprecated use new Program(vertex, fragment) instead");var n=new r(e,t);return n},r}),define("osg/Shader",["osg/Notify"],function(e){var t=function(e,n){var r=e;typeof e=="string"&&(r=t[e]),this.type=r,this.setText(n)};return t.VERTEX_SHADER=35633,t.FRAGMENT_SHADER=35632,t.prototype={setText:function(e){this.text=e},getText:function(){return this.text},compile:function(){this.shader=gl.createShader(this.type),gl.shaderSource(this.shader,this.text),gl.compileShader(this.shader);if(!gl.getShaderParameter(this.shader,gl.COMPILE_STATUS)&&!gl.isContextLost()){e.log("can't compile shader:\n"+this.text+"\n");var t="\n"+this.text,n=t.split("\n"),r="\n";for(var i=0,s=n.length;i<s;++i)r+=i+" "+n[i]+"\n";e.log(r),e.log(gl.getShaderInfoLog(this.shader))}}},t.create=function(n,r){return e.log("Shader.create is deprecated, use new Shader with the same arguments instead"),new t(n,r)},t}),define("osg/ShaderGenerator",["osg/Notify","osg/Program","osg/Shader"],function(e,t,n){var r=function(){this.cache=[]};return r.Type={VertexInit:0,VertexFunction:1,VertexMain:2,VertexEnd:3,FragmentInit:5,FragmentFunction:6,FragmentMain:7,FragmentEnd:8},r.prototype={getActiveTypeMember:function(e){var t=[];for(var n=0,r=e.attributeMap.attributeKeys.length;n<r;n++){var i=e.attributeMap.attributeKeys[n],s=e.attributeMap[i];if(s.length===0&&s.globalDefault.applyPositionedUniform===undefined)continue;(s.globalDefault.getOrCreateUniforms!==undefined||s.globalDefault.writeToShader!==undefined)&&t.push(i)}for(var o=0,u=e.textureAttributeMapList.length;o<u;o++){var a=e.textureAttributeMapList[o];if(a===undefined)continue;for(var f=0,l=a.attributeKeys.length;f<l;f++){var c=a.attributeKeys[f],h=a[c];if(h.length===0)continue;(h.globalDefault.getOrCreateUniforms!==undefined||h.globalDefault.writeToShader!==undefined)&&t.push(c+o)}}return t},getActiveAttributeMapKeys:function(e){var t=[];for(var n=0,r=e.attributeMap.attributeKeys.length;n<r;n++){var i=e.attributeMap.attributeKeys[n],s=e.attributeMap[i];if(s.length===0&&s.globalDefault.applyPositionedUniform===undefined)continue;(s.globalDefault.getOrCreateUniforms!==undefined||s.globalDefault.writeToShader!==undefined)&&t.push(i)}return t},getActiveTextureAttributeMapKeys:function(e){var t=[];for(var n=0,r=e.textureAttributeMapList.length;n<r;n++){var i=e.textureAttributeMapList[n];if(i===undefined)continue;t[n]=[];for(var s=0,o=i.attributeKeys.length;s<o;s++){var u=i.attributeKeys[s],a=i[u];if(a.length===0)continue;(a.globalDefault.getOrCreateUniforms!==undefined||a.globalDefault.writeToShader!==undefined)&&t[n].push(u)}}return t},getActiveUniforms:function(e,t,n){var r={};for(var i=0,s=t.length;i<s;i++){var o=t[i];if(e.attributeMap[o].globalDefault.getOrCreateUniforms===undefined)continue;var u=e.attributeMap[o].globalDefault.getOrCreateUniforms();for(var a=0,f=u.uniformKeys.length;a<f;a++){var l=u.uniformKeys[a],c=u[l];r[c.name]=c}}for(var h=0,p=n.length;h<p;h++){var d=n[h];if(d===undefined)continue;for(var v=0,m=d.length;v<m;v++){var g=d[v],y=e.textureAttributeMapList[h][g].globalDefault;if(y.getOrCreateUniforms===undefined)continue;var b=y.getOrCreateUniforms(h);for(var w=0,E=b.uniformKeys.length;w<E;w++){var S=b.uniformKeys[w],x=b[S];r[x.name]=x}}}var T=[];for(var N in r)T.push(N);return r.uniformKeys=T,r},getOrCreateProgram:function(r){var i=this.getActiveTypeMember(r);for(var s=0,o=this.cache.length;s<o;++s)if(this.compareAttributeMap(i,this.cache[s].flattenKeys)===0)return this.cache[s];var u=this.getActiveAttributeMapKeys(r),a=this.getActiveTextureAttributeMapKeys(r),f=this.getOrCreateVertexShader(r,u,a),l=this.getOrCreateFragmentShader(r,u,a),c=new t(new n(gl.VERTEX_SHADER,f),new n(gl.FRAGMENT_SHADER,l));return c.flattenKeys=i,c.activeAttributeKeys=u,c.activeTextureAttributeKeys=a,c.activeUniforms=this.getActiveUniforms(r,u,a),c.generated=!0,e.log(c.vertex.text),e.log(c.fragment.text),this.cache.push(c),c},compareAttributeMap:function(e,t){var n;for(var r=0,i=e.length;r<i;r++){n=e[r];if(t.indexOf(n)===-1)return 1}return t.length!==e.length?-1:0},fillTextureShader:function(e,t,n){var r="",i={};for(var s=0,o=t.length;s<o;s++){var u=t[s];if(u===undefined)continue;var a=e[s];for(var f=0,l=u.length;f<l;f++){var c=u[f],h=a[c].globalDefault;h.generateShaderCommon!==undefined&&i[c]===undefined&&(r+=h.generateShaderCommon(s,n),i[c]=!0),h.generateShader&&(r+=h.generateShader(s,n))}}return r},fillShader:function(e,t,n){var r="",i={};for(var s=0,o=t.length;s<o;s++){var u=t[s],a=e[u].globalDefault,f=a.getType();a.generateShaderCommon!==undefined&&i[f]===undefined&&(r+=a.generateShaderCommon(n),i[f]=!0),a.generateShader&&(r+=a.generateShader(n))}return r},getOrCreateVertexShader:function(e,t,n){var i,s=r.Type,o=["","#ifdef GL_ES","precision highp float;","#endif","attribute vec3 Vertex;","attribute vec4 Color;","attribute vec3 Normal;","uniform float ArrayColorEnabled;","uniform mat4 ModelViewMatrix;","uniform mat4 ProjectionMatrix;","uniform mat4 NormalMatrix;","varying vec4 VertexColor;",""].join("\n");o+=this._writeShaderFromMode(e,t,n,s.VertexInit);var u=["","vec4 ftransform() {","  return ProjectionMatrix * ModelViewMatrix * vec4(Vertex, 1.0);","}"].join("\n");o+=u,o+=this._writeShaderFromMode(e,t,n,s.VertexFunction);var a=["","void main(void) {","  gl_Position = ftransform();","  if (ArrayColorEnabled == 1.0)","    VertexColor = Color;","  else","    VertexColor = vec4(1.0,1.0,1.0,1.0);","  gl_PointSize = 1.0;",""].join("\n");return o+=a,o+=this._writeShaderFromMode(e,t,n,s.VertexMain),o+=["}",""].join("\n"),o},_writeShaderFromMode:function(e,t,n,r){var i="";return i+=this.fillTextureShader(e.textureAttributeMapList,n,r),i+=this.fillShader(e.attributeMap,t,r),i},getOrCreateFragmentShader:function(e,t,n){var i,s=["","#ifdef GL_ES","precision highp float;","#endif","varying vec4 VertexColor;","uniform float ArrayColorEnabled;","vec4 fragColor;",""].join("\n"),o=r.Type;return s+=this._writeShaderFromMode(e,t,n,o.FragmentInit),s+=this._writeShaderFromMode(e,t,n,o.FragmentFunction),s+=["void main(void) {","  fragColor = VertexColor;",""].join("\n"),s+=this._writeShaderFromMode(e,t,n,o.FragmentMain),s+=this._writeShaderFromMode(e,t,n,o.FragmentEnd),s+=["","  gl_FragColor = fragColor;","}"].join("\n"),s}},r}),define("osg/Light",["osg/Utils","osg/StateAttribute","osg/Uniform","osg/Matrix","osg/Vec4","osg/ShaderGenerator"],function(e,t,n,r,i,s){var o=function(e){t.call(this),e===undefined&&(e=0),this._ambient=[.2,.2,.2,1],this._diffuse=[.8,.8,.8,1],this._specular=[.2,.2,.2,1],this._position=[0,0,1,0],this._direction=[0,0,-1],this._spotCutoff=180,this._spotBlend=.01,this._constantAttenuation=1,this._linearAttenuation=0,this._quadraticAttenuation=0,this._lightUnit=e,this._enabled=0,this.dirty()};return o.uniforms={},o.prototype=e.objectLibraryClass(e.objectInehrit(t.prototype,{attributeType:"Light",cloneType:function(){return new o(this._lightUnit)},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType+this._lightUnit},getOrCreateUniforms:function(){var e=o.uniforms,t=this.getTypeMember();if(e[t]===undefined){var i=n;e[t]={ambient:i.createFloat4([.2,.2,.2,1],this.getUniformName("ambient")),diffuse:i.createFloat4([.8,.8,.8,1],this.getUniformName("diffuse")),specular:i.createFloat4([.2,.2,.2,1],this.getUniformName("specular")),position:i.createFloat4([0,0,1,0],this.getUniformName("position")),direction:i.createFloat3([0,0,1],this.getUniformName("direction")),spotCutoff:i.createFloat1(180,this.getUniformName("spotCutoff")),spotBlend:i.createFloat1(.01,this.getUniformName("spotBlend")),constantAttenuation:i.createFloat1(0,this.getUniformName("constantAttenuation")),linearAttenuation:i.createFloat1(0,this.getUniformName("linearAttenuation")),quadraticAttenuation:i.createFloat1(0,this.getUniformName("quadraticAttenuation")),enable:i.createInt1(0,this.getUniformName("enable")),matrix:i.createMatrix4(r.makeIdentity([]),this.getUniformName("matrix")),invMatrix:i.createMatrix4(r.makeIdentity([]),this.getUniformName("invMatrix"))},e[t].uniformKeys=Object.keys(e[t])}return e[t]},setPosition:function(e){i.copy(e,this._position)},getPosition:function(){return this._position},setAmbient:function(e){this._ambient=e,this.dirty()},setSpecular:function(e){this._specular=e,this.dirty()},setDiffuse:function(e){this._diffuse=e,this.dirty()},setSpotCutoff:function(e){this._spotCutoff=e,this.dirty()},getSpotCutoff:function(){return this._spotCutoff},setSpotBlend:function(e){this._spotBlend=e,this.dirty()},getSpotBlend:function(){return this._spotBlend},setConstantAttenuation:function(e){this._constantAttenuation=e,this.dirty()},setLinearAttenuation:function(e){this._linearAttenuation=e,this.dirty()},setQuadraticAttenuation:function(e){this._quadraticAttenuation=e,this.dirty()},setDirection:function(e){this._direction=e,this.dirty()},getDirection:function(){return this._direction},setLightNumber:function(e){this._lightUnit=e,this.dirty()},getLightNumber:function(){return this._lightUnit},getPrefix:function(){return this.getType()+this._lightUnit},getParameterName:function(e){return this.getPrefix()+"_"+e},getUniformName:function(e){return this.getPrefix()+"_uniform_"+e},applyPositionedUniform:function(e,t){var n=this.getOrCreateUniforms();r.copy(e,n.matrix.get()),n.matrix.dirty(),r.copy(e,n.invMatrix.get()),n.invMatrix.get()[12]=0,n.invMatrix.get()[13]=0,n.invMatrix.get()[14]=0,r.inverse(n.invMatrix.get(),n.invMatrix.get()),r.transpose(n.invMatrix.get(),n.invMatrix.get()),n.invMatrix.dirty()},apply:function(e){var t=this.getOrCreateUniforms();t.ambient.set(this._ambient),t.diffuse.set(this._diffuse),t.specular.set(this._specular),t.position.set(this._position),t.direction.set(this._direction);var n=Math.cos(this._spotCutoff*Math.PI/180);t.spotCutoff.get()[0]=n,t.spotCutoff.dirty(),t.spotBlend.get()[0]=(1-n)*this._spotBlend,t.spotBlend.dirty(),t.constantAttenuation.get()[0]=this._constantAttenuation,t.constantAttenuation.dirty(),t.linearAttenuation.get()[0]=this._linearAttenuation,t.linearAttenuation.dirty(),t.quadraticAttenuation.get()[0]=this._quadraticAttenuation,t.quadraticAttenuation.dirty(),this.setDirty(!1)},_replace:function(e,t,n,r){for(var i=0,s=t.length;i<s;i++){var o=new RegExp(e+t[i],"g");n=n.replace(o,r.call(this,t[i]))}return n},_shader:{},_shaderCommon:{},generateShader:function(e){return this._shader[e]?this._shader[e].call(this):""},generateShaderCommon:function(e){return this._shaderCommon[e]?this._shaderCommon[e].call(this):""}}),"osg","Light"),o.prototype._shaderCommon[s.Type.VertexInit]=function(){return["","varying vec3 FragNormal;","varying vec3 FragEyeVector;","",""].join("\n")},o.prototype._shaderCommon[s.Type.VertexFunction]=function(){return["","vec3 computeNormal() {","   return vec3(NormalMatrix * vec4(Normal, 0.0));","}","","vec3 computeEyeVertex() {","   return vec3(ModelViewMatrix * vec4(Vertex,1.0));","}","",""].join("\n")},o.prototype._shaderCommon[s.Type.VertexMain]=function(){return["","  FragEyeVector = computeEyeVertex();","  FragNormal = computeNormal();",""].join("\n")},o.prototype._shaderCommon[s.Type.FragmentInit]=function(){return["varying vec3 FragNormal;","varying vec3 FragEyeVector;",""].join("\n")},o.prototype._shaderCommon[s.Type.FragmentFunction]=function(){return["","float getLightAttenuation(vec3 lightDir, float constant, float linear, float quadratic) {","    ","    float d = length(lightDir);","    float att = 1.0 / ( constant + linear*d + quadratic*d*d);","    return att;","}","vec4 computeLightContribution(vec4 materialAmbient,","                              vec4 materialDiffuse,","                              vec4 materialSpecular,","                              float materialShininess,","                              vec4 lightAmbient,","                              vec4 lightDiffuse,","                              vec4 lightSpecular,","                              vec3 normal,","                              vec3 eye,","                              vec3 lightDirection,","                              vec3 lightSpotDirection,","                              float lightCosSpotCutoff,","                              float lightSpotBlend,","                              float lightAttenuation)","{","    vec3 L = lightDirection;","    vec3 N = normal;","    float NdotL = max(dot(L, N), 0.0);","    float halfTerm = NdotL;","    vec4 ambient = lightAmbient;","    vec4 diffuse = vec4(0.0);","    vec4 specular = vec4(0.0);","    float spot = 0.0;","","    if (NdotL > 0.0) {","        vec3 E = eye;","        vec3 R = reflect(-L, N);","        float RdotE = max(dot(R, E), 0.0);","        if ( RdotE > 0.0) {","           RdotE = pow( RdotE, materialShininess );","        }","        vec3 D = lightSpotDirection;","        spot = 1.0;","        if (lightCosSpotCutoff > 0.0) {","          float cosCurAngle = dot(-L, D);","          if (cosCurAngle < lightCosSpotCutoff) {","             spot = 0.0;","          } else {","             if (lightSpotBlend > 0.0)","               spot = cosCurAngle * smoothstep(0.0, 1.0, (cosCurAngle-lightCosSpotCutoff)/(lightSpotBlend));","          }","        }","        diffuse = lightDiffuse * ((halfTerm));","        specular = lightSpecular * RdotE;","    }","","    return (materialAmbient*ambient + (materialDiffuse*diffuse + materialSpecular*specular) * spot) * lightAttenuation;","}","float linearrgb_to_srgb1(const in float c)","{","  float v = 0.0;","  if(c < 0.0031308) {","    if ( c > 0.0)","      v = c * 12.92;","  } else {","    v = 1.055 * pow(c, 1.0/2.4) - 0.055;","  }","  return v;","}","vec4 linearrgb_to_srgb(const in vec4 col_from)","{","  vec4 col_to;","  col_to.r = linearrgb_to_srgb1(col_from.r);","  col_to.g = linearrgb_to_srgb1(col_from.g);","  col_to.b = linearrgb_to_srgb1(col_from.b);","  col_to.a = col_from.a;","  return col_to;","}","float srgb_to_linearrgb1(const in float c)","{","  float v = 0.0;","  if(c < 0.04045) {","    if (c >= 0.0)","      v = c * (1.0/12.92);","  } else {","    v = pow((c + 0.055)*(1.0/1.055), 2.4);","  }"," return v;","}","vec4 srgb2linear(const in vec4 col_from)","{","  vec4 col_to;","  col_to.r = srgb_to_linearrgb1(col_from.r);","  col_to.g = srgb_to_linearrgb1(col_from.g);","  col_to.b = srgb_to_linearrgb1(col_from.b);","  col_to.a = col_from.a;","  return col_to;","}",""].join("\n")},o.prototype._shaderCommon[s.Type.FragmentMain]=function(){return["","  vec3 normal = normalize(FragNormal);","  vec3 eyeVector = normalize(-FragEyeVector);","  vec4 lightColor = MaterialEmission;",""].join("\n")},o.prototype._shaderCommon[s.Type.FragmentEnd]=function(){return["","  fragColor *= lightColor;",""].join("\n")},o.prototype._shader[s.Type.FragmentInit]=function(){var e=["","uniform vec4 Light_position;","uniform vec3 Light_direction;","uniform mat4 Light_matrix;","uniform mat4 Light_invMatrix;","uniform float Light_constantAttenuation;","uniform float Light_linearAttenuation;","uniform float Light_quadraticAttenuation;","uniform vec4 Light_ambient;","uniform vec4 Light_diffuse;","uniform vec4 Light_specular;","uniform float Light_spotCutoff;","uniform float Light_spotBlend;",""].join("\n");return uniforms=Object.keys(this.getOrCreateUniforms()),e=this._replace("Light_",uniforms,e,this.getUniformName),e},o.prototype._shader[s.Type.FragmentMain]=function(){var e=["","  vec3 lightEye = vec3(Light_matrix * Light_position);","  vec3 lightDir;","  if (Light_position[3] == 1.0) {","    lightDir = lightEye - FragEyeVector;","  } else {","    lightDir = lightEye;","  }","  vec3 spotDirection = normalize(mat3(vec3(Light_invMatrix[0]), vec3(Light_invMatrix[1]), vec3(Light_invMatrix[2]))*Light_direction);","  float attenuation = getLightAttenuation(lightDir, Light_constantAttenuation, Light_linearAttenuation, Light_quadraticAttenuation);","  lightDir = normalize(lightDir);","  lightColor += computeLightContribution(MaterialAmbient,","                                         MaterialDiffuse, ","                                         MaterialSpecular,","                                         MaterialShininess,","                                         Light_ambient,","                                         Light_diffuse,","                                         Light_specular,","                                         normal,","                                         eyeVector,","                                         lightDir,","                                         spotDirection,","                                         Light_spotCutoff,","                                         Light_spotBlend,","                                         attenuation);",""].join("\n"),t=["lightEye","lightDir","spotDirection","attenuation"];return e=this._replace("",t,e,this.getParameterName),uniforms=Object.keys(this.getOrCreateUniforms()),e=this._replace("Light_",uniforms,e,this.getUniformName),e},o}),define("osg/LineWidth",["osg/Utils","osg/StateAttribute"],function(e,t){var n=function(e){t.call(this),this.lineWidth=1,e!==undefined&&(this.lineWidth=e)};return n.prototype=e.objectLibraryClass(e.objectInehrit(t.prototype,{attributeType:"LineWidth",cloneType:function(){return new n},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},apply:function(e){e.getGraphicContext().lineWidth(this.lineWidth)}}),"osg","LineWidth"),n}),define("osg/Material",["osg/Utils","osg/StateAttribute","osg/Vec4","osg/Uniform","osg/ShaderGenerator"],function(e,t,n,r,i){var s=function(){t.call(this),this.ambient=[.2,.2,.2,1],this.diffuse=[.8,.8,.8,1],this.specular=[0,0,0,1],this.emission=[0,0,0,1],this.shininess=12.5};return s.prototype=e.objectLibraryClass(e.objectInehrit(t.prototype,{setEmission:function(e){n.copy(e,this.emission),this._dirty=!0},setAmbient:function(e){n.copy(e,this.ambient),this._dirty=!0},setSpecular:function(e){n.copy(e,this.specular),this._dirty=!0},setDiffuse:function(e){n.copy(e,this.diffuse),this._dirty=!0},setShininess:function(e){this.shininess=e,this._dirty=!0},getEmission:function(){return this.emission},getAmbient:function(){return this.ambient},getSpecular:function(){return this.specular},getDiffuse:function(){return this.diffuse},getShininess:function(){return this.shininess},attributeType:"Material",cloneType:function(){return new s},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},getOrCreateUniforms:function(){if(s.uniforms===undefined){s.uniforms={ambient:r.createFloat4([0,0,0,0],"MaterialAmbient"),diffuse:r.createFloat4([0,0,0,0],"MaterialDiffuse"),specular:r.createFloat4([0,0,0,0],"MaterialSpecular"),emission:r.createFloat4([0,0,0,0],"MaterialEmission"),shininess:r.createFloat1([0],"MaterialShininess")};var e=[];for(var t in s.uniforms)e.push(t);s.uniforms.uniformKeys=e}return s.uniforms},apply:function(e){var t=this.getOrCreateUniforms();t.ambient.set(this.ambient),t.diffuse.set(this.diffuse),t.specular.set(this.specular),t.emission.set(this.emission),t.shininess.set([this.shininess]),this._dirty=!1},_shader:{},_shaderCommon:{},generateShader:function(e){return this._shader[e]?this._shader[e].call(this):""}}),"osg","Material"),s.prototype._shader[i.Type.VertexInit]=function(){var e=["uniform vec4 MaterialAmbient;","uniform vec4 MaterialDiffuse;","uniform vec4 MaterialSpecular;","uniform vec4 MaterialEmission;","uniform float MaterialShininess;",""].join("\n");return e},s.prototype._shader[i.Type.FragmentInit]=function(){var e=["uniform vec4 MaterialAmbient;","uniform vec4 MaterialDiffuse;","uniform vec4 MaterialSpecular;","uniform vec4 MaterialEmission;","uniform float MaterialShininess;",""].join("\n");return e},s}),define("osg/Math",[],function(){var e=function(e,t,n){return Math.min(n,Math.max(t,e))},t=function(t,n,r){var i=e((r-t)/(n-t),0,1);return i*i*(3-2*i)};return{clamp:e,smoothStep:t}}),define("osg/Shape",["osg/Notify","osg/StateAttribute","osg/Vec3","osg/Uniform","osg/BufferArray","osg/Geometry","osg/PrimitiveSet","osg/DrawArrays","osg/DrawElements","osg/Program","osg/Shader"],function(e,t,n,r,i,s,o,u,a,f,l){var c=function(e,t,n,r,u,f){var l=new s,c,h,p;c=r/2,h=u/2,p=f/2;var d=[],v=[],m=[];d[0]=e-c,d[1]=t-h,d[2]=n+p,m[0]=0,m[1]=-1,m[2]=0,v[0]=0,v[1]=1,d[3]=e-c,d[4]=t-h,d[5]=n-p,m[3]=0,m[4]=-1,m[5]=0,v[2]=0,v[3]=0,d[6]=e+c,d[7]=t-h,d[8]=n-p,m[6]=0,m[7]=-1,m[8]=0,v[4]=1,v[5]=0,d[9]=e+c,d[10]=t-h,d[11]=n+p,m[9]=0,m[10]=-1,m[11]=0,v[6]=1,v[7]=1,d[12]=e+c,d[13]=t+h,d[14]=n+p,m[12]=0,m[13]=1,m[14]=0,v[8]=0,v[9]=1,d[15]=e+c,d[16]=t+h,d[17]=n-p,m[15]=0,m[16]=1,m[17]=0,v[10]=0,v[11]=0,d[18]=e-c,d[19]=t+h,d[20]=n-p,m[18]=0,m[19]=1,m[20]=0,v[12]=1,v[13]=0,d[21]=e-c,d[22]=t+h,d[23]=n+p,m[21]=0,m[22]=1,m[23]=0,v[14]=1,v[15]=1,d[24]=e+c,d[25]=t-h,d[26]=n+p,m[24]=1,m[25]=0,m[26]=0,v[16]=0,v[17]=1,d[27]=e+c,d[28]=t-h,d[29]=n-p,m[27]=1,m[28]=0,m[29]=0,v[18]=0,v[19]=0,d[30]=e+c,d[31]=t+h,d[32]=n-p,m[30]=1,m[31]=0,m[32]=0,v[20]=1,v[21]=0,d[33]=e+c,d[34]=t+h,d[35]=n+p,m[33]=1,m[34]=0,m[35]=0,v[22]=1,v[23]=1,d[36]=e-c,d[37]=t+h,d[38]=n+p,m[36]=-1,m[37]=0,m[38]=0,v[24]=0,v[25]=1,d[39]=e-c,d[40]=t+h,d[41]=n-p,m[39]=-1,m[40]=0,m[41]=0,v[26]=0,v[27]=0,d[42]=e-c,d[43]=t-h,d[44]=n-p,m[42]=-1,m[43]=0,m[44]=0,v[28]=1,v[29]=0,d[45]=e-c,d[46]=t-h,d[47]=n+p,m[45]=-1,m[46]=0,m[47]=0,v[30]=1,v[31]=1,d[48]=e-c,d[49]=t+h,d[50]=n+p,m[48]=0,m[49]=0,m[50]=1,v[32]=0,v[33]=1,d[51]=e-c,d[52]=t-h,d[53]=n+p,m[51]=0,m[52]=0,m[53]=1,v[34]=0,v[35]=0,d[54]=e+c,d[55]=t-h,d[56]=n+p,m[54]=0,m[55]=0,m[56]=1,v[36]=1,v[37]=0,d[57]=e+c,d[58]=t+h,d[59]=n+p,m[57]=0,m[58]=0,m[59]=1,v[38]=1,v[39]=1,d[60]=e+c,d[61]=t+h,d[62]=n-p,m[60]=0,m[61]=0,m[62]=-1,v[40]=0,v[41]=1,d[63]=e+c,d[64]=t-h,d[65]=n-p,m[63]=0,m[64]=0,m[65]=-1,v[42]=0,v[43]=0,d[66]=e-c,d[67]=t-h,d[68]=n-p,m[66]=0,m[67]=0,m[68]=-1,v[44]=1,v[45]=0,d[69]=e-c,d[70]=t+h,d[71]=n-p,m[69]=0,m[70]=0,m[71]=-1,v[46]=1,v[47]=1;var g=[];g[0]=0,g[1]=1,g[2]=2,g[3]=0,g[4]=2,g[5]=3,g[6]=4,g[7]=5,g[8]=6,g[9]=4,g[10]=6,g[11]=7,g[12]=8,g[13]=9,g[14]=10,g[15]=8,g[16]=10,g[17]=11,g[18]=12,g[19]=13,g[20]=14,g[21]=12,g[22]=14,g[23]=15,g[24]=16,g[25]=17,g[26]=18,g[27]=16,g[28]=18,g[29]=19,g[30]=20,g[31]=21,g[32]=22,g[33]=20,g[34]=22,g[35]=23,l.getAttributes().Vertex=new i(i.ARRAY_BUFFER,d,3),l.getAttributes().Normal=new i(i.ARRAY_BUFFER,m,3),l.getAttributes().TexCoord0=new i(i.ARRAY_BUFFER,v,2);var y=new a(o.TRIANGLES,new i(i.ELEMENT_ARRAY_BUFFER,g,1));return l.getPrimitives().push(y),l},h=function(e,t,r,u,f,l,c,h,p,d,v,m,g){m===undefined&&g===undefined&&(m=d,g=v,d=0,v=0);var y=new s,b=[];b[0]=e+c,b[1]=t+h,b[2]=r+p,b[3]=e,b[4]=t,b[5]=r,b[6]=e+u,b[7]=t+f,b[8]=r+l,b[9]=e+u+c,b[10]=t+f+h,b[11]=r+l+p,m===undefined&&(m=1),g===undefined&&(g=1);var w=[];w[0]=d,w[1]=g,w[2]=d,w[3]=v,w[4]=m,w[5]=v,w[6]=m,w[7]=g;var E=n.cross([u,f,l],[c,h,p],[]),S=[];S[0]=E[0],S[1]=E[1],S[2]=E[2],S[3]=E[0],S[4]=E[1],S[5]=E[2],S[6]=E[0],S[7]=E[1],S[8]=E[2],S[9]=E[0],S[10]=E[1],S[11]=E[2];var x=[];x[0]=0,x[1]=1,x[2]=2,x[3]=0,x[4]=2,x[5]=3,y.getAttributes().Vertex=new i(i.ARRAY_BUFFER,b,3),y.getAttributes().Normal=new i(i.ARRAY_BUFFER,S,3),y.getAttributes().TexCoord0=new i(i.ARRAY_BUFFER,w,2);var T=new a(o.TRIANGLES,new i(i.ELEMENT_ARRAY_BUFFER,x,1));return y.getPrimitives().push(T),y},p=function(t,n,r,i,s,o){return e.log("createTexturedBox is deprecated use instead createTexturedBoxGeometry"),c(t,n,r,i,s,o)},d=function(t,n,r,i,s,o,u,a,f,l,c,p,d){return e.log("createTexturedQuad is deprecated use instead createTexturedQuadGeometry"),h(t,n,r,i,s,o,u,a,f,l,c,p,d)},v=function(e){e===undefined&&(e=5),v.getShader===undefined&&(v.getShader=function(){if(v.getShader.program===undefined){var e=["#ifdef GL_ES","precision highp float;","#endif","attribute vec3 Vertex;","attribute vec4 Color;","uniform mat4 ModelViewMatrix;","uniform mat4 ProjectionMatrix;","","varying vec4 FragColor;","","vec4 ftransform() {","return ProjectionMatrix * ModelViewMatrix * vec4(Vertex, 1.0);","}","","void main(void) {","gl_Position = ftransform();","FragColor = Color;","}"].join("\n"),t=["#ifdef GL_ES","precision highp float;","#endif","varying vec4 FragColor;","void main(void) {","gl_FragColor = FragColor;","}"].join("\n"),n=new f(new l(gl.VERTEX_SHADER,e),new l(gl.FRAGMENT_SHADER,t));v.getShader.program=n}return v.getShader.program});var t=new s,n=[];n.push(0,0,0),n.push(e,0,0),n.push(0,0,0),n.push(0,e,0),n.push(0,0,0),n.push(0,0,e);var r=[];r.push(1,0,0,1),r.push(1,0,0,1),r.push(0,1,0,1),r.push(0,1,0,1),r.push(0,0,1,1),r.push(0,0,1,1),t.getAttributes().Vertex=new i(i.ARRAY_BUFFER,n,3),t.getAttributes().Color=new i(i.ARRAY_BUFFER,r,4);var a=new u(o.LINES,0,6);return t.getPrimitives().push(a),t.getOrCreateStateSet().setAttributeAndMode(v.getShader()),t},m=function(e,t,r,o,u,f,l){e=e||50,o=o!==undefined?o:0,u=u!==undefined?u:Math.PI*2,f=f!==undefined?f:0,l=l!==undefined?l:Math.PI;var c=Math.max(3,Math.floor(t)||8),h=Math.max(2,Math.floor(r)||6),p,d,v=[],m=[],g=[],y=[];for(d=0;d<=h;d++){var b=[],w=[];for(p=0;p<=c;p++){var E=p/c,S=d/h,x={};x.x=-e*Math.cos(o+E*u)*Math.sin(f+S*l),x.y=e*Math.cos(f+S*l),x.z=e*Math.sin(o+E*u)*Math.sin(f+S*l),g.push(x),b.push(g.length-1),w.push({u:E,v:1-S})}v.push(b),m.push(w)}var T=[],N=[],C=[],k=0;for(d=0;d<h;d++)for(p=0;p<c;p++){var L={},A={},O={},M={},_=d*c*3+p*3,L=v[d][p+1],A=v[d][p],O=v[d+1][p],M=v[d+1][p+1],D=g[L],P=g[A],H=g[O],B=g[M];T.push(D.x),T.push(D.y),T.push(D.z),T.push(P.x),T.push(P.y),T.push(P.z),T.push(H.x),T.push(H.y),T.push(H.z),T.push(B.x),T.push(B.y),T.push(B.z),k+=4;var j=k-4;y.push(j),y.push(j+1),y.push(j+2),y.push(j),y.push(j+2),y.push(j+3);var F=n.normalize([D.x,D.y,D.z],[]),I=n.normalize([P.x,P.y,P.z],[]),q=n.normalize([H.x,H.y,H.z],[]),R=n.normalize([B.x,B.y,B.z],[]);N.push(F[0]),N.push(F[1]),N.push(F[2]),N.push(I[0]),N.push(I[1]),N.push(I[2]),N.push(q[0]),N.push(q[1]),N.push(q[2]),N.push(R[0]),N.push(R[1]),N.push(R[2]);var U=m[d][p+1],z=m[d][p],W=m[d+1][p],X=m[d+1][p+1];C.push(U.u),C.push(U.v),C.push(z.u),C.push(z.v),C.push(W.u),C.push(W.v),C.push(X.u),C.push(X.v)}var V=new s;V.getAttributes().Vertex=new i(gl.ARRAY_BUFFER,T,3),V.getAttributes().Normal=new i(gl.ARRAY_BUFFER,N,3),V.getAttributes().TexCoord0=new i(gl.ARRAY_BUFFER,C,2);var $=new a(gl.TRIANGLES,new i(gl.ELEMENT_ARRAY_BUFFER,y,1));return V.getPrimitives().push($),V};return{createTexturedBoxGeometry:c,createTexturedQuadGeometry:h,createTexturedBox:p,createTexturedQuad:d,createAxisGeometry:v,createTexturedSphere:m}}),define("osg/Stack",[],function(){var e=function(){};return e.create=function(){var e=[];return e.globalDefault=undefined,e.lastApplied=undefined,e.back=function(){return this[this.length-1]},e},e}),define("osg/State",["osg/StateAttribute","osg/Stack","osg/Uniform","osg/Matrix","osg/ShaderGenerator"],function(e,t,n,r,i){var s=function(){this._graphicContext=undefined,this.currentVBO=null,this.vertexAttribList=[],this.programs=t.create(),this.stateSets=t.create(),this.uniforms={},this.uniforms.uniformKeys=[],this.textureAttributeMapList=[],this.attributeMap={},this.attributeMap.attributeKeys=[],this.modeMap={},this.shaderGenerator=new i,this.modelViewMatrix=n.createMatrix4(r.makeIdentity([]),"ModelViewMatrix"),this.projectionMatrix=n.createMatrix4(r.makeIdentity([]),"ProjectionMatrix"),this.normalMatrix=n.createMatrix4(r.makeIdentity([]),"NormalMatrix"),this.uniforms.ArrayColorEnabled=t.create(),this.uniforms.ArrayColorEnabled.globalDefault=n.createFloat1(0,"ArrayColorEnabled"),this.uniforms.ArrayColorEnabled.uniformKeys=[],this.uniforms.ArrayColorEnabled.uniformKeys.push("ArrayColorEnabled"),this.vertexAttribMap={},this.vertexAttribMap._disable=[],this.vertexAttribMap._keys=[]};return s.prototype={setGraphicContext:function(e){this._graphicContext=e},getGraphicContext:function(){return this._graphicContext},pushStateSet:function(e){this.stateSets.push(e),e.attributeMap&&this.pushAttributeMap(this.attributeMap,e.attributeMap);if(e.textureAttributeMapList){var t=e.textureAttributeMapList;for(var n=0,r=t.length;n<r;n++){if(t[n]===undefined)continue;this.textureAttributeMapList[n]||(this.textureAttributeMapList[n]={},this.textureAttributeMapList[n].attributeKeys=[]),this.pushAttributeMap(this.textureAttributeMapList[n],t[n])}}e.uniforms&&this.pushUniformsList(this.uniforms,e.uniforms)},applyStateSet:function(e){this.pushStateSet(e),this.apply(),this.popStateSet()},popAllStateSets:function(){while(this.stateSets.length)this.popStateSet()},popStateSet:function(){var e=this.stateSets.pop();e.program&&this.programs.pop(),e.attributeMap&&this.popAttributeMap(this.attributeMap,e.attributeMap);if(e.textureAttributeMapList){var t=e.textureAttributeMapList;for(var n=0,r=t.length;n<r;n++){if(t[n]===undefined)continue;this.popAttributeMap(this.textureAttributeMapList[n],t[n])}}e.uniforms&&this.popUniformsList(this.uniforms,e.uniforms)},haveAppliedAttribute:function(e){var t=e.getTypeMember(),n=this.attributeMap[t];n.lastApplied=e,n.asChanged=!0},applyAttribute:function(e){var n=e.getTypeMember(),r=this.attributeMap[n];r===undefined&&(r=t.create(),this.attributeMap[n]=r,this.attributeMap[n].globalDefault=e.cloneType(),this.attributeMap.attributeKeys.push(n)),r.lastApplied!==e&&(e.apply&&e.apply(this),r.lastApplied=e,r.asChanged=!0)},applyTextureAttribute:function(e,n){var r=this.getGraphicContext();r.activeTexture(r.TEXTURE0+e);var i=n.getTypeMember();this.textureAttributeMapList[e]||(this.textureAttributeMapList[e]={},this.textureAttributeMapList[e].attributeKeys=[]);var s=this.textureAttributeMapList[e][i];s===undefined&&(s=t.create(),this.textureAttributeMapList[e][i]=s,s.globalDefault=n.cloneType(),this.textureAttributeMapList[e].attributeKeys.push(i)),s.lastApplied!==n&&(n.apply&&n.apply(this),s.lastApplied=n,s.asChanged=!0)},getLastProgramApplied:function(){return this.programs.lastApplied},pushGeneratedProgram:function(){var t;if(this.attributeMap.Program!==undefined&&this.attributeMap.Program.length!==0){t=this.attributeMap.Program.back().object,value=this.attributeMap.Program.back().value;if(t!==undefined&&value!==e.OFF)return this.programs.push(this.getObjectPair(t,value)),t}var n={textureAttributeMapList:this.textureAttributeMapList,attributeMap:this.attributeMap},r=this.stateSets.back().getShaderGenerator();return r===undefined&&(r=this.shaderGenerator),t=r.getOrCreateProgram(n),this.programs.push(this.getObjectPair(t,e.ON)),t},popGeneratedProgram:function(){this.programs.pop()},applyWithoutProgram:function(){this.applyAttributeMap(this.attributeMap),this.applyTextureAttributeMapList(this.textureAttributeMapList)},apply:function(){var e=this._graphicContext;this.applyAttributeMap(this.attributeMap),this.applyTextureAttributeMapList(this.textureAttributeMapList),this.pushGeneratedProgram();var t=this.programs.back().object;this.programs.lastApplied!==t&&(t.apply(this),this.programs.lastApplied=t);var n,r,i,s,o=this,u;if(t.generated===!0)n=t.uniformsCache,r=t.activeUniforms,u=this.uniforms,function(){var e=t.uniformsCache,n=t.activeUniforms,r=t.foreignUniforms;r||(function(){r=[];for(var i=0,s=e.uniformKeys.length;i<s;i++){var u=e.uniformKeys[i],a=e[u];a!==undefined&&n[u]===undefined&&u!==o.modelViewMatrix.name&&u!==o.projectionMatrix.name&&u!==o.normalMatrix.name&&u!=="ArrayColorEnabled"&&r.push(u)}t.foreignUniforms=r}(),function(){var t=!1;for(var r=0,i=n.uniformKeys.length;r<i;r++){var s=n.uniformKeys[r],o=e[s];(o===undefined||o===null)&&delete n[s]}var u=Object.keys(n);for(var a=0,f=u.length;a<f;a++)if(u[a]==="uniformKeys"){u.splice(a,1);break}n.uniformKeys=u}()),function(){for(var t=0,r=n.uniformKeys.length;t<r;t++){var i=n.uniformKeys[t],s=e[i];n[i].apply(s)}}(),function(){for(var t=0,n=r.length;t<n;t++){var i=r[t],s=u[i],o=e[i],a;s!==undefined&&(s.length===0?a=s.globalDefault:a=s.back().object,a.apply(o))}}()}();else{var p=t.program,d,v,m;n=t.uniformsCache,u=this.uniforms,r=[];var g=t.trackAttributes,y=t.trackUniforms,w,E,S;if(g!==undefined&&y===undefined){var x=t.trackAttributes.attributeKeys;if(x!==undefined)for(i=0,l=x.length;i<l;i++){s=x[i],attributeStack=this.attributeMap[s];if(attributeStack===undefined)continue;w=attributeStack.globalDefault;if(w.getOrCreateUniforms===undefined)continue;E=w.getOrCreateUniforms();for(S=0,b=E.uniformKeys.length;S<b;S++)r.push(E[E.uniformKeys[S]])}var T=t.trackAttributes.textureAttributeKeys;if(T!==undefined)for(i=0,l=T.length;i<l;i++){var N=T[i];if(N===undefined)continue;for(var C=0,k=N.length;C<k;C++){s=N[C];var L=this.textureAttributeMapList[i];if(L===undefined)continue;attributeStack=L[s];if(attributeStack===undefined)continue;w=attributeStack.globalDefault;if(w.getOrCreateUniforms===undefined)continue;E=w.getOrCreateUniforms(i);for(S=0,b=E.uniformKeys.length;S<b;S++)r.push(E[E.uniformKeys[S]])}}var A={};for(i=0,l=r.length;i<l;i++){var O=r[i],M=e.getUniformLocation(p,O.name);M!==undefined&&M!==null&&(A[O.name]=r[i])}t.trackUniforms=A}for(i=0,l=n.uniformKeys.length;i<l;i++){var _=n.uniformKeys[i];d=n[_],v=u[_],v===undefined?t.trackUniforms!==undefined&&(m=t.trackUniforms[_],m!==undefined&&m.apply(d)):(v.length===0?m=v.globalDefault:m=v.back().object,m.apply(d))}}},applyUniformList:function(e,t){var n=this.getLastProgramApplied(),r=n.program,i,s,o,u={},a,f=n.uniformsCache;for(var l=0,c=f.uniformKeys.length;l<c;l++){var h=f.uniformKeys[l];i=f[h],o=t[h];if(o===undefined){s=e[h];if(s===undefined)continue;s.length===0?o=s.globalDefault:o=s.back().object}o.apply(i)}},applyAttributeMap:function(e){var t;for(var n=0,r=e.attributeKeys.length;n<r;n++){var i=e.attributeKeys[n];t=e[i];if(t===undefined)continue;var s;t.length===0?s=t.globalDefault:s=t.back().object,t.asChanged&&(t.lastApplied!==s&&(s.apply&&s.apply(this),t.lastApplied=s),t.asChanged=!1)}},getObjectPair:function(e,t){return{object:e,value:t}},pushUniformsList:function(n,r){var i,s;for(var o=0,u=r.uniformKeys.length;o<u;o++){var a=r.uniformKeys[o];uniformPair=r[a],s=uniformPair.getUniform(),i=s.name,n[i]===undefined&&(n[i]=t.create(),n[i].globalDefault=s,n.uniformKeys.push(i));var f=uniformPair.getValue(),l=n[i];l.length===0?l.push(this.getObjectPair(s,f)):l[l.length-1].value&e.OVERRIDE&&!(f&e.PROTECTED)?l.push(l[l.length-1]):l.push(this.getObjectPair(s,f))}},popUniformsList:function(e,t){var n;for(var r=0,i=t.uniformKeys.length;r<i;r++){var s=t.uniformKeys[r];e[s].pop()}},applyTextureAttributeMapList:function(e){var t=this._graphicContext,n;for(var r=0,i=e.length;r<i;r++){n=e[r];if(n===undefined)continue;for(var s=0,o=n.attributeKeys.length;s<o;s++){var u=n.attributeKeys[s],a=n[u];if(a===undefined)continue;var f;a.length===0?f=a.globalDefault:f=a.back().object,a.asChanged&&(t.activeTexture(t.TEXTURE0+r),f.apply(this,r),a.lastApplied=f,a.asChanged=!1)}}},setGlobalDefaultValue:function(e){var n=e.getTypeMember();this.attributeMap[n]?this.attributeMap[n].globalDefault=e:(this.attributeMap[n]=t.create(),this.attributeMap[n].globalDefault=e,this.attributeMap.attributeKeys.push(n))},pushAttributeMap:function(n,r){var i;for(var s=0,o=r.attributeKeys.length;s<o;s++){var u=r.attributeKeys[s],a=r[u],f=a.getAttribute();n[u]===undefined&&(n[u]=t.create(),n[u].globalDefault=f.cloneType(),n.attributeKeys.push(u));var l=a.getValue();i=n[u],i.length===0?i.push(this.getObjectPair(f,l)):i[i.length-1].value&e.OVERRIDE&&!(l&e.PROTECTED)?i.push(i[i.length-1]):i.push(this.getObjectPair(f,l)),i.asChanged=!0}},popAttributeMap:function(e,t){var n;for(var r=0,i=t.attributeKeys.length;r<i;r++)type=t.attributeKeys[r],n=e[type],n.pop(),n.asChanged=!0},setIndexArray:function(e){var t=this._graphicContext;this.currentIndexVBO!==e&&(e.bind(t),this.currentIndexVBO=e),e.isDirty()&&e.compile(t)},lazyDisablingOfVertexAttributes:function(){var e=this.vertexAttribMap._keys;for(var t=0,n=e.length;t<n;t++){var r=e[t];this.vertexAttribMap[r]&&(this.vertexAttribMap._disable[r]=!0)}},applyDisablingOfVertexAttributes:function(){var e=this.vertexAttribMap._keys;for(var t=0,n=e.length;t<n;t++)if(this.vertexAttribMap._disable[e[t]]===!0){var r=e[t];this._graphicContext.disableVertexAttribArray(r),this.vertexAttribMap._disable[r]=!1,this.vertexAttribMap[r]=!1}var i=this.programs.lastApplied;if(i!==undefined){var s=!1,o=!1;i.attributesCache.Color!==undefined&&(o=this.vertexAttribMap[i.attributesCache.Color]);var u=this.uniforms.ArrayColorEnabled.globalDefault;this.previousHasColorAttrib!==o&&(s=!0),this.previousHasColorAttrib=o,s&&(o?u.get()[0]=1:u.get()[0]=0,u.dirty()),u.apply(i.uniformsCache.ArrayColorEnabled)}},setVertexAttribArray:function(e,t,n){var r=this.vertexAttribMap;r._disable[e]=!1;var i=this._graphicContext,s=!1;t.isDirty()&&(t.bind(i),t.compile(i),s=!0),r[e]!==t&&(s||t.bind(i),r[e]||(i.enableVertexAttribArray(e),r[e]===undefined&&r._keys.push(e)),r[e]=t,i.vertexAttribPointer(e,t._itemSize,i.FLOAT,n,0,0))}},s}),function(e){if(typeof bootstrap=="function")bootstrap("promise",e);else if(typeof exports=="object")module.exports=e();else if(typeof define=="function"&&define.amd)define("vendors/Q",e);else if(typeof ses!="undefined"){if(!ses.ok())return;ses.makeQ=e}else Q=e()}(function(){function u(e){return function(){return o.apply(e,arguments)}}function m(e){return e===Object(e)}function g(e){return v(e)==="[object StopIteration]"||e instanceof y}function E(t,n){if(e&&n.stack&&typeof t=="object"&&t!==null&&t.stack&&t.stack.indexOf(w)===-1){var r=[];for(var i=n;!!i;i=i.source)i.stack&&r.unshift(i.stack);r.unshift(t.stack);var s=r.join("\n"+w+"\n");t.stack=S(s)}}function S(e){var t=e.split("\n"),n=[];for(var r=0;r<t.length;++r){var i=t[r];!N(i)&&!x(i)&&i&&n.push(i)}return n.join("\n")}function x(e){return e.indexOf("(module.js:")!==-1||e.indexOf("(node.js:")!==-1}function T(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(e);if(r)return[r[1],Number(r[2])]}function N(e){var t=T(e);if(!t)return!1;var i=t[0],s=t[1];return i===r&&s>=n&&s<=lt}function C(){if(!e)return;try{throw new Error}catch(t){var n=t.stack.split("\n"),i=n[0].indexOf("@")>0?n[1]:n[2],s=T(i);if(!s)return;return r=s[0],s[1]}}function k(e,t,n){return function(){return typeof console!="undefined"&&typeof console.warn=="function"&&console.warn(t+" is deprecated, use "+n+" instead.",(new Error("")).stack),e.apply(e,arguments)}}function L(e){return H(e)?e:B(e)?G(e):Q(e)}function A(){function l(e){r=e,o.source=e,f(t,function(t,n){s(function(){e.promiseDispatch.apply(e,n)})},void 0),t=void 0,n=void 0}var t=[],n=[],r,i=h(A.prototype),o=h(_.prototype);o.promiseDispatch=function(e,i,o){var u=a(arguments);t?(t.push(u),i==="when"&&o[1]&&n.push(o[1])):s(function(){r.promiseDispatch.apply(r,u)})},o.valueOf=k(function(){if(t)return o;var e=P(r);return H(e)&&(r=e),e},"valueOf","inspect"),o.inspect=function(){return r?r.inspect():{state:"pending"}};if(L.longStackSupport&&e)try{throw new Error}catch(u){o.stack=u.stack.substring(u.stack.indexOf("\n")+1)}return i.promise=o,i.resolve=function(e){if(r)return;l(L(e))},i.fulfill=function(e){if(r)return;l(Q(e))},i.reject=function(e){if(r)return;l(K(e))},i.notify=function(e){if(r)return;f(n,function(t,n){s(function(){n(e)})},void 0)},i}function O(e){if(typeof e!="function")throw new TypeError("resolver must be a function.");var t=A();try{e(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}return t.promise}function M(e){return O(function(t,n){for(var r=0,i=e.length;r<i;r++)L(e[r]).then(t,n)})}function _(e,t,n){t===void 0&&(t=function(e){return K(new Error("Promise does not support operation: "+e))}),n===void 0&&(n=function(){return{state:"unknown"}});var r=h(_.prototype);r.promiseDispatch=function(n,i,s){var o;try{e[i]?o=e[i].apply(r,s):o=t.call(r,i,s)}catch(u){o=K(u)}n&&n(o)},r.inspect=n;if(n){var i=n();i.state==="rejected"&&(r.exception=i.reason),r.valueOf=k(function(){var e=n();return e.state==="pending"||e.state==="rejected"?r:e.value})}return r}function D(e,t,n,r){return L(e).then(t,n,r)}function P(e){if(H(e)){var t=e.inspect();if(t.state==="fulfilled")return t.value}return e}function H(e){return m(e)&&typeof e.promiseDispatch=="function"&&typeof e.inspect=="function"}function B(e){return m(e)&&typeof e.then=="function"}function j(e){return H(e)&&e.inspect().state==="pending"}function F(e){return!H(e)||e.inspect().state==="fulfilled"}function I(e){return H(e)&&e.inspect().state==="rejected"}function W(){!U&&typeof window!="undefined"&&!window.Touch&&window.console&&console.warn("[Q] Unhandled rejection reasons (should be empty):",q),U=!0}function X(){for(var e=0;e<q.length;e++){var t=q[e];console.warn("Unhandled rejection reason:",t)}}function V(){q.length=0,R.length=0,U=!1,z||(z=!0,typeof process!="undefined"&&process.on&&process.on("exit",X))}function $(e,t){if(!z)return;R.push(e),t&&typeof t.stack!="undefined"?q.push(t.stack):q.push("(no stack) "+t),W()}function J(e){if(!z)return;var t=l(R,e);t!==-1&&(R.splice(t,1),q.splice(t,1))}function K(e){var t=_({when:function(t){return t&&J(this),t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return $(t,e),t}function Q(e){return _({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},"delete":function(t){delete e[t]},post:function(t,n){return t===null||t===void 0?e.apply(void 0,n):e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},keys:function(){return d(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function G(e){var t=A();return s(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}}),t.promise}function Y(e){return _({isDef:function(){}},function(n,r){return it(e,n,r)},function(){return L(e).inspect()})}function Z(e,t,n){return L(e).spread(t,n)}function et(e){return function(){function t(e,t){var s;if(b){try{s=n[e](t)}catch(o){return K(o)}return s.done?s.value:D(s.value,r,i)}try{s=n[e](t)}catch(o){return g(o)?o.value:K(o)}return D(s,r,i)}var n=e.apply(this,arguments),r=t.bind(t,"next"),i=t.bind(t,"throw");return r()}}function tt(e){L.done(L.async(e)())}function nt(e){throw new y(e)}function rt(e){return function(){return Z([this,st(arguments)],function(t,n){return e.apply(t,n)})}}function it(e,t,n){return L(e).dispatch(t,n)}function st(e){return D(e,function(e){var t=0,n=A();return f(e,function(r,i,s){var o;H(i)&&(o=i.inspect()).state==="fulfilled"?e[s]=o.value:(++t,D(i,function(r){e[s]=r,--t===0&&n.resolve(e)},n.reject,function(e){n.notify({index:s,value:e})}))},void 0),t===0&&n.resolve(e),n.promise})}function ot(e){return D(e,function(e){return e=c(e,L),D(st(c(e,function(e){return D(e,i,i)})),function(){return e})})}function ut(e){return L(e).allSettled()}function at(e,t){return L(e).then(void 0,void 0,t)}function ft(e,t){return L(e).nodeify(t)}var e=!1;try{throw new Error}catch(t){e=!!t.stack}var n=C(),r,i=function(){},s=function(){function o(){while(e.next){e=e.next;var t=e.task;e.task=void 0;var r=e.domain;r&&(e.domain=void 0,r.enter());try{t()}catch(s){if(i)throw r&&r.exit(),setTimeout(o,0),r&&r.enter(),s;setTimeout(function(){throw s},0)}r&&r.exit()}n=!1}var e={task:void 0,next:null},t=e,n=!1,r=void 0,i=!1;s=function(e){t=t.next={task:e,domain:i&&process.domain,next:null},n||(n=!0,r())};if(typeof process!="undefined"&&process.nextTick)i=!0,r=function(){process.nextTick(o)};else if(typeof setImmediate=="function")typeof window!="undefined"?r=setImmediate.bind(window,o):r=function(){setImmediate(o)};else if(typeof MessageChannel!="undefined"){var u=new MessageChannel;u.port1.onmessage=function(){r=a,u.port1.onmessage=o,o()};var a=function(){u.port2.postMessage(0)};r=function(){setTimeout(o,0),a()}}else r=function(){setTimeout(o,0)};return s}(),o=Function.call,a=u(Array.prototype.slice),f=u(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(arguments.length===1)do{if(n in this){t=this[n++];break}if(++n>=r)throw new TypeError}while(1);for(;n<r;n++)n in this&&(t=e(t,this[n],n));return t}),l=u(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),c=u(Array.prototype.map||function(e,t){var n=this,r=[];return f(n,function(i,s,o){r.push(e.call(t,s,o,n))},void 0),r}),h=Object.create||function(e){function t(){}return t.prototype=e,new t},p=u(Object.prototype.hasOwnProperty),d=Object.keys||function(e){var t=[];for(var n in e)p(e,n)&&t.push(n);return t},v=u(Object.prototype.toString),y;typeof ReturnValue!="undefined"?y=ReturnValue:y=function(e){this.value=e};var b;try{new Function("(function* (){ yield 1; })"),b=!0}catch(t){b=!1}var w="From previous event:";L.resolve=L,L.nextTick=s,L.longStackSupport=!1,L.defer=A,A.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):arguments.length>2?e.resolve(a(arguments,1)):e.resolve(n)}},L.promise=O,L.passByCopy=function(e){return e},_.prototype.passByCopy=function(){return this},L.join=function(e,t){return L(e).join(t)},_.prototype.join=function(e){return L([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Can't join: not the same: "+e+" "+t)})},L.race=M,_.prototype.race=function(){return this.then(L.race)},L.makePromise=_,_.prototype.toString=function(){return"[object Promise]"},_.prototype.then=function(e,t,n){function u(t){try{return typeof e=="function"?e(t):t}catch(n){return K(n)}}function a(e){if(typeof t=="function"){E(e,r);try{return t(e)}catch(n){return K(n)}}return K(e)}function f(e){return typeof n=="function"?n(e):e}var r=this,i=A(),o=!1;return s(function(){r.promiseDispatch(function(e){if(o)return;o=!0,i.resolve(u(e))},"when",[function(e){if(o)return;o=!0,i.resolve(a(e))}])}),r.promiseDispatch(void 0,"when",[void 0,function(e){var t,n=!1;try{t=f(e)}catch(r){n=!0;if(!L.onerror)throw r;L.onerror(r)}n||i.notify(t)}]),i.promise},L.when=D,_.prototype.thenResolve=function(e){return this.then(function(){return e})},L.thenResolve=function(e,t){return L(e).thenResolve(t)},_.prototype.thenReject=function(e){return this.then(function(){throw e})},L.thenReject=function(e,t){return L(e).thenReject(t)},L.nearer=P,L.isPromise=H,L.isPromiseAlike=B,L.isPending=j,_.prototype.isPending=function(){return this.inspect().state==="pending"},L.isFulfilled=F,_.prototype.isFulfilled=function(){return this.inspect().state==="fulfilled"},L.isRejected=I,_.prototype.isRejected=function(){return this.inspect().state==="rejected"};var q=[],R=[],U=!1,z=!0;L.resetUnhandledRejections=V,L.getUnhandledReasons=function(){return q.slice()},L.stopUnhandledRejectionTracking=function(){V(),typeof process!="undefined"&&process.on&&process.removeListener("exit",X),z=!1},V(),L.reject=K,L.fulfill=Q,L.master=Y,L.spread=Z,_.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},L.async=et,L.spawn=tt,L["return"]=nt,L.promised=rt,L.dispatch=it,_.prototype.dispatch=function(e,t){var n=this,r=A();return s(function(){n.promiseDispatch(r.resolve,e,t)}),r.promise},L.get=function(e,t){return L(e).dispatch("get",[t])},_.prototype.get=function(e){return this.dispatch("get",[e])},L.set=function(e,t,n){return L(e).dispatch("set",[t,n])},_.prototype.set=function(e,t){return this.dispatch("set",[e,t])},L.del=L["delete"]=function(e,t){return L(e).dispatch("delete",[t])},_.prototype.del=_.prototype["delete"]=function(e){return this.dispatch("delete",[e])},L.mapply=L.post=function(e,t,n){return L(e).dispatch("post",[t,n])},_.prototype.mapply=_.prototype.post=function(e,t){return this.dispatch("post",[e,t])},L.send=L.mcall=L.invoke=function(e,t){return L(e).dispatch("post",[t,a(arguments,2)])},_.prototype.send=_.prototype.mcall=_.prototype.invoke=function(e){return this.dispatch("post",[e,a(arguments,1)])},L.fapply=function(e,t){return L(e).dispatch("apply",[void 0,t])},_.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},L["try"]=L.fcall=function(e){return L(e).dispatch("apply",[void 0,a(arguments,1)])},_.prototype.fcall=function(){return this.dispatch("apply",[void 0,a(arguments)])},L.fbind=function(e){var t=L(e),n=a(arguments,1);return function(){return t.dispatch("apply",[this,n.concat(a(arguments))])}},_.prototype.fbind=function(){var e=this,t=a(arguments);return function(){return e.dispatch("apply",[this,t.concat(a(arguments))])}},L.keys=function(e){return L(e).dispatch("keys",[])},_.prototype.keys=function(){return this.dispatch("keys",[])},L.all=st,_.prototype.all=function(){return st(this)},L.allResolved=k(ot,"allResolved","allSettled"),_.prototype.allResolved=function(){return ot(this)},L.allSettled=ut,_.prototype.allSettled=function(){return this.then(function(e){return st(c(e,function(e){function t(){return e.inspect()}return e=L(e),e.then(t,t)}))})},L.fail=L["catch"]=function(e,t){return L(e).then(void 0,t)},_.prototype.fail=_.prototype["catch"]=function(e){return this.then(void 0,e)},L.progress=at,_.prototype.progress=function(e){return this.then(void 0,void 0,e)},L.fin=L["finally"]=function(e,t){return L(e)["finally"](t)},_.prototype.fin=_.prototype["finally"]=function(e){return e=L(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},L.done=function(e,t,n,r){return L(e).done(t,n,r)},_.prototype.done=function(e,t,n){var r=function(e){s(function(){E(e,i);if(!L.onerror)throw e;L.onerror(e)})},i=e||t||n?this.then(e,t,n):this;typeof process=="object"&&process&&process.domain&&(r=process.domain.bind(r)),i.then(void 0,r)},L.timeout=function(e,t,n){return L(e).timeout(t,n)},_.prototype.timeout=function(e,t){var n=A(),r=setTimeout(function(){n.reject(new Error(t||"Timed out after "+e+" ms"))},e);return this.then(function(e){clearTimeout(r),n.resolve(e)},function(e){clearTimeout(r),n.reject(e)},n.notify),n.promise},L.delay=function(e,t){return t===void 0&&(t=e,e=void 0),L(e).delay(t)},_.prototype.delay=function(e){return this.then(function(t){var n=A();return setTimeout(function(){n.resolve(t)},e),n.promise})},L.nfapply=function(e,t){return L(e).nfapply(t)},_.prototype.nfapply=function(e){var t=A(),n=a(e);return n.push(t.makeNodeResolver()),this.fapply(n).fail(t.reject),t.promise},L.nfcall=function(e){var t=a(arguments,1);return L(e).nfapply(t)},_.prototype.nfcall=function(){var e=a(arguments),t=A();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},L.nfbind=L.denodeify=function(e){var t=a(arguments,1);return function(){var n=t.concat(a(arguments)),r=A();return n.push(r.makeNodeResolver()),L(e).fapply(n).fail(r.reject),r.promise}},_.prototype.nfbind=_.prototype.denodeify=function(){var e=a(arguments);return e.unshift(this),L.denodeify.apply(void 0,e)},L.nbind=function(e,t){var n=a(arguments,2);return function(){function s(){return e.apply(t,arguments)}var r=n.concat(a(arguments)),i=A();return r.push(i.makeNodeResolver()),L(s).fapply(r).fail(i.reject),i.promise}},_.prototype.nbind=function(){var e=a(arguments,0);return e.unshift(this),L.nbind.apply(void 0,e)},L.nmapply=L.npost=function(e,t,n){return L(e).npost(t,n)},_.prototype.nmapply=_.prototype.npost=function(e,t){var n=a(t||[]),r=A();return n.push(r.makeNodeResolver()),this.dispatch("post",[e,n]).fail(r.reject),r.promise},L.nsend=L.nmcall=L.ninvoke=function(e,t){var n=a(arguments,2),r=A();return n.push(r.makeNodeResolver()),L(e).dispatch("post",[t,n]).fail(r.reject),r.promise},_.prototype.nsend=_.prototype.nmcall=_.prototype.ninvoke=function(e){var t=a(arguments,1),n=A();return t.push(n.makeNodeResolver()),this.dispatch("post",[e,t]).fail(n.reject),n.promise},L.nodeify=ft,_.prototype.nodeify=function(e){if(!e)return this;this.then(function(t){s(function(){e(null,t)})},function(t){s(function(){e(t)})})};var lt=C();return L}),define("osgDB/Input",["osg/osg","osg/Notify","vendors/Q","osgDB/osgDB","osg/Image","osg/BufferArray","osg/PrimitiveSet","osg/DrawElements"],function(e,t,n,r,i,s,u,a){var f=function(e,t){this._json=e;var n=t;n===undefined&&(n={}),this._identifierMap=n,this._objectRegistry={},this._progressXHRCallback=undefined,this._prefixURL="",this.setImageLoadingOptions({promise:!0,onload:undefined})};return f.imageFallback||(f.imageFallback=function(){var e=new window.Image;return e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2P8DwQACgAD/il4QJ8AAAAASUVORK5CYII=",e}()),f.prototype={setImageLoadingOptions:function(e){this._defaultImageOptions=e},getImageLoadingOptions:function(){return this._defaultImageOptions},setProgressXHRCallback:function(e){this._progressXHRCallback=e},registerObject:function(e,t){this._objectRegistry[e]=t},getJSON:function(){return this._json},setJSON:function(e){return this._json=e,this},setPrefixURL:function(e){this._prefixURL=e},getPrefixURL:function(){return this._prefixURL},computeURL:function(e){return this._prefixURL===undefined?e:this._prefixURL+e},getObjectWrapper:function(e){if(this._objectRegistry[e]!==undefined)return new this._objectRegistry[e];var t=window,n=e.split(".");for(var r=0,i=n.length;r<i;r++){var s=t[n[r]];if(s===undefined)return undefined;t=s}return new t},fetchImage:function(e,n,r,i){var s="data:image/",o=n.substring(0,s.length)===s,u=new window.Image;return u.onerror=function(){t.warn("warning use white texture as fallback instead of "+n),e.setImage(f.imageFallback),i&&i.resolve(e)},!o&&r.crossOrigin&&(u.crossOrigin=r.crossOrigin),u.onload=function(){i?(r.onload&&r.onload.call(e),i.resolve(e)):r.onload&&r.onload.call(e)},e.setURL(n),e.setImage(u),u.src=n,e},readImageURL:function(e,t){var r=this;e.substr(0,10)!=="data:image"&&(e=this.computeURL(e)),t===undefined&&(t=this._defaultImageOptions);var s=new i;return t.promise!==!0?this.fetchImage(s,e,t):(defer=n.defer(),this.fetchImage(s,e,t,defer),defer.promise)},readNodeURL:function(e,i){e=this.computeURL(e);var s=n.defer();i=i||{};var o={progressXHRCallback:i.progressXHRCallback,prefixURL:i.prefixURL,defaultImageOptions:i.defaultImageOptions};if(o.prefixURL===undefined){var u=this.getPrefixURL(),a=e.lastIndexOf("/");a!==-1&&(u=e.substring(0,a+1)),o.prefixURL=u}var f=new XMLHttpRequest;return f.open("GET",e,!0),f.onreadystatechange=function(i){if(f.readyState==4){var u;f.status==200?n.when(r.parseSceneGraph(JSON.parse(f.responseText),o),function(n){s.resolve(n),t.log("loaded "+e)}).fail(function(e){s.reject(e)}):s.reject(f.status)}},f.send(null),s.promise},readBinaryArrayURL:function(e){e=this.computeURL(e);if(this._identifierMap[e]!==undefined)return this._identifierMap[e];var t=n.defer(),r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",this._progressXHRCallback&&r.addEventListener("progress",this._progressXHRCallback,!1),r.addEventListener("error",function(){t.reject()},!1);var i=this;return r.addEventListener("load",function(n){var s=r.response;s?(i._identifierMap[e]=s,t.resolve(s)):t.reject()},!1),r.send(null),this._identifierMap[e]=t.promise,t.promise},readBufferArray:function(){var r=this.getJSON(),i=r.UniqueID,u;if(i!==undefined){u=this._identifierMap[i];if(u!==undefined)return u}var a=function(e){return e.Elements===undefined&&e.Array===undefined||e.ItemSize===undefined||!e.Type?!1:!0};if(!a(r))return;var f,l;if(r.Elements!==undefined)f=new s(s[r.Type],r.Elements,r.ItemSize);else if(r.Array!==undefined){var c=new s(s[r.Type]);c.setItemSize(r.ItemSize);var h,p;r.Array.Float32Array!==undefined?(h=r.Array.Float32Array,p="Float32Array"):r.Array.Uint16Array!==undefined?(h=r.Array.Uint16Array,p="Uint16Array"):(t.warn("Typed Array "+Object.keys(o.Array)[0]),p="Float32Array");if(h!==undefined)if(h.File!==undefined){var d=h.File;l=n.defer(),n.when(this.readBinaryArrayURL(d)).then(function(n){var r,i;(function(){var e=new Uint8Array([18,52]),t=new Uint16Array(e.buffer);i=t[0].toString(16)==="1234"})();var s=0;h.Offset!==undefined&&(s=h.Offset);var o=e[p].BYTES_PER_ELEMENT,u=h.Size,a=c.getItemSize(),f=u*o*a;if(i){t.log("big endian detected");var d=e[p],m=new d(u*a),g=new DataView(n,s,f),y=0,w=m.length;if(p==="Uint16Array")for(;y<w;y++)tempArray[y]=g.getUint16(y*o,!0);else if(p==="Float32Array")for(;y<w;y++)tempArray[y]=g.getFloat32(y*o,!0);r=tempArray,g=null}else r=new e[p](n,s,a*u);v=b=null,c.setElements(r),l.resolve(c)})}else if(h.Elements!==undefined){var v=new e[p](h.Elements);c.setElements(v)}f=c}return i!==undefined&&(this._identifierMap[i]=f),l!==undefined?l.promise:f},readUserDataContainer:function(){var e=this.getJSON(),t,n=e.UniqueID;if(n!==undefined){t=this._identifierMap[n];if(t!==undefined)return t.Values}return this._identifierMap[n]=e,e.Values},readPrimitiveSet:function(){var e=this.getJSON(),t,r,i,s,o=e.DrawElementUShort||e.DrawElementUByte||e.DrawElementUInt||e.DrawElementsUShort||e.DrawElementsUByte||e.DrawElementsUInt||undefined;if(o){t=o.UniqueID;if(t!==undefined){r=this._identifierMap[t];if(r!==undefined)return r}s=n.defer();var f=o.Indices,l=e;mode=o.Mode,mode?mode=u[mode]:mode=u.TRIANGLES,i=new a(mode),this.setJSON(f),n.when(this.readBufferArray()).then(function(e){i.setIndices(e),s.resolve(i)}),this.setJSON(l)}var c=e.DrawArray||e.DrawArrays;if(c){t=c.UniqueID;if(t!==undefined){r=this._identifierMap[t];if(r!==undefined)return r}mode=c.Mode||c.mode,first=c.First!==undefined?c.First:c.first,count=c.Count!==undefined?c.Count:c.count;var h=new DrawArrays(u[mode],first,count);i=h}var p=e.DrawArrayLengths||undefined;if(p){t=p.UniqueID;if(t!==undefined){r=this._identifierMap[t];if(r!==undefined)return r}mode=p.Mode,first=p.First;var d=p.ArrayLengths,v=new DrawArrayLengths(u[mode],first,d);i=v}return t!==undefined&&(this._identifierMap[t]=i),s?s.promise:i},readObject:function(){var e=this.getJSON(),n=Object.keys(e)[0];if(!n)return t.warn("can't find property for object "+e),undefined;var i=e[n].UniqueID,s;if(i!==undefined){s=this._identifierMap[i];if(s!==undefined)return s}var o=this.getObjectWrapper(n);if(!o)return t.warn("can't instanciate object "+n),undefined;var u=r.ObjectWrapper.serializers,a=n.split(".");for(var f=0,l=a.length;f<l;f++){var c=u[a[f]];if(c===undefined)return t.warn("can't find function to read object "+n+" - undefined"),undefined;u=c}var h=u(this.setJSON(e[n]),o);return i!==undefined&&(this._identifierMap[i]=o,o._uniqueID=i),h}},f}),define("osgDB/osgDB",["osg/Notify","osg/Utils","vendors/Q","osg/Texture","osg/Uniform","osg/BlendFunc","osg/Material","osg/Geometry","osg/BufferArray","osg/PrimitiveSet","osg/DrawArrays","osg/DrawElements","osg/StateSet","osg/Node","osg/Matrix","osg/MatrixTransform","osg/Projection","osgDB/Input"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){var y={};return y.Input=g,y.ObjectWrapper={},y.ObjectWrapper.serializers={},y.readImage=function(e,t){return y.registry().readImageURL(e,t)},y.readImageURL=y.readImage,y.readNodeURL=function(e,t){return y.registry().readNodeURL(e,t)},y.registry=function(){return y.registry._input===undefined&&(y.registry._input=new g),y.registry._input},y.parseSceneGraph=function(t,n){if(!(t.Version!==undefined&&t.Version>0))return y.parseSceneGraph_deprecated(t);var r=function(e){var t=Object.keys(e);for(var n=0,r=t.length;n<r;n++)if(t[n]!=="Generator"&&t[n]!=="Version")return t[n];return undefined},i=r(t);if(i){var s={};s[i]=t[i];var o=new g(s);return o.setImageLoadingOptions(y.registry().getImageLoadingOptions()),n!==undefined&&(o.setProgressXHRCallback(n.progressXHRCallback),o.setPrefixURL(n.prefixURL)),o.readObject()}e.log("can't parse scenegraph "+t)},y.parseSceneGraph_deprecated=function(g){var b=function(e,t){var n=t[e];return n===undefined&&(n=t[e.toLowerCase()]),n},w=function(e,t){var n=b("Name",t);n&&e.setName!==undefined&&e.setName(n)},E=function(e,t){w(e,t),e.setAmbient(b("Ambient",t)),e.setDiffuse(b("Diffuse",t)),e.setEmission(b("Emission",t)),e.setSpecular(b("Specular",t)),e.setShininess(b("Shininess",t))},S=function(e,t){w(e,t),e.setSourceRGB(t.SourceRGB),e.setSourceAlpha(t.SourceAlpha),e.setDestinationRGB(t.DestinationRGB),e.setDestinationAlpha(t.DestinationAlpha)},x=function(e,t){var r=t.MagFilter||t.mag_filter||undefined;r&&e.setMagFilter(r);var i=t.MinFilter||t.min_filter||undefined;i&&e.setMinFilter(i);var s=t.WrapT||t.wrap_t||undefined;s&&e.setWrapT(s);var o=t.WrapS||t.wrap_s||undefined;o&&e.setWrapS(o);var u=b("File",t);n.when(y.readImage(u)).then(function(t){e.setImage(t)})},T=function(t,n){w(t,n);var u=b("Textures",n)||b("TextureAttributeList",n)||undefined;if(u)for(var a=0,f=u.length;a<f;a++){var l=b("File",u[a]);if(!l){e.log("no texture on unit "+a+" skip it");continue}var c=new r;x(c,u[a]),t.setTextureAttributeAndMode(a,c),t.addUniform(i.createInt1(a,"Texture"+a))}var h=b("BlendFunc",n);if(h){var p=new s;S(p,h),t.setAttributeAndMode(p)}var d=b("Material",n);if(d){var v=new o;E(v,d),t.setAttributeAndMode(v)}},N,C=g.children,k=g.primitives||g.Primitives||undefined,L=g.attributes||g.Attributes||undefined;if(k||L){N=new u,w(N,g),t.extend(N,g),g=N,g.primitives=k,g.attributes=L;var A;for(var O=0,M=k.length;O<M;O++){var _=k[O].mode;if(k[O].indices){var D=k[O].indices;D=new a(a[D.type],D.elements,D.itemSize),_?_=f[_]:_=gl.TRIANGLES,k[O]=new c(_,D)}else{_=gl[_];var P=k[O].first,H=k[O].count;k[O]=new l(_,P,H)}}for(var B in L)if(L.hasOwnProperty(B)){var j=L[B];L[B]=new a(gl[j.type],j.elements,j.itemSize)}}var F=b("StateSet",g);if(F){var I=new h;T(I,F),g.stateset=I}var q=g.matrix||g.Matrix||undefined;q&&(N=new v,w(N,g),t.extend(N,g),N.setMatrix(d.copy(q)),g=N);var R=g.projection||g.Projection||undefined;R&&(N=new m,w(N,g),t.extend(N,g),N.setProjectionMatrix(d.copy(R)),g=N),g.objectType===undefined&&(N=new p,w(N,g),t.extend(N,g),g=N);if(C){g.children=[];for(var U=0,z=C.length;U<z;U++)g.addChild(y.parseSceneGraph_deprecated(C[U]))}return g},y}),define("osg/Texture",["osg/Notify","osg/Utils","osg/StateAttribute","osg/Uniform","osg/Image","osg/ShaderGenerator","osgDB/osgDB","vendors/Q"],function(e,t,n,r,i,s,o,u){var a=function(){n.call(this),this.setDefaultParameters(),this._applyTexImage2DCallbacks=[]};return a.DEPTH_COMPONENT=6402,a.ALPHA=6406,a.RGB=6407,a.RGBA=6408,a.LUMINANCE=6409,a.LUMINANCE_ALPHA=6410,a.LINEAR=9729,a.NEAREST=9728,a.NEAREST_MIPMAP_NEAREST=9984,a.LINEAR_MIPMAP_NEAREST=9985,a.NEAREST_MIPMAP_LINEAR=9986,a.LINEAR_MIPMAP_LINEAR=9987,a.CLAMP_TO_EDGE=33071,a.REPEAT=10497,a.MIRRORED_REPEAT=33648,a.TEXTURE_2D=3553,a.TEXTURE_CUBE_MAP=34067,a.TEXTURE_BINDING_CUBE_MAP=34068,a.TEXTURE_CUBE_MAP_POSITIVE_X=34069,a.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,a.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,a.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,a.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,a.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,a.MAX_CUBE_MAP_TEXTURE_SIZE=34076,a.UNSIGNED_BYTE=5121,a.FLOAT=5126,a.prototype=t.objectLibraryClass(t.objectInehrit(n.prototype,{attributeType:"Texture",cloneType:function(){var e=new a;return e.default_type=!0,e},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},getOrCreateUniforms:function(e){a.uniforms===undefined&&(a.uniforms=[]);if(a.uniforms[e]===undefined){var t=this.getType()+e,n={};n.texture=r.createInt1(e,t),n.uniformKeys=Object.keys(n),a.uniforms[e]=n}return a.uniforms[e]},setDefaultParameters:function(){this._image=undefined,this._magFilter=a.LINEAR,this._minFilter=a.LINEAR,this._wrapS=a.CLAMP_TO_EDGE,this._wrapT=a.CLAMP_TO_EDGE,this._textureWidth=0,this._textureHeight=0,this._unrefImageDataAfterApply=!1,this.setInternalFormat(a.RGBA),this._textureTarget=a.TEXTURE_2D,this._type=a.UNSIGNED_BYTE},getTextureTarget:function(){return this._textureTarget},getTextureObject:function(){return this._textureObject},setTextureSize:function(e,t){this._textureWidth=e,this._textureHeight=t},init:function(e){this._textureObject||(this._textureObject=e.createTexture(),this.dirty())},addApplyTexImage2DCallback:function(e){var t=this._applyTexImage2DCallbacks.indexOf(e);t<0&&this._applyTexImage2DCallbacks.push(e)},removeApplyTexImage2DCallback:function(e){var t=this._applyTexImage2DCallbacks.indexOf(e);t>=0&&this._applyTexImage2DCallbacks.splice(t,1)},getWidth:function(){return this._textureWidth},getHeight:function(){return this._textureHeight},releaseGLObjects:function(e){this._textureObject!==undefined&&this._textureObject!==null&&(e.deleteTexture(this._textureObject),this._textureObject=null,this._image=undefined)},setWrapS:function(e){typeof e=="string"?this._wrapS=a[e]:this._wrapS=e},setWrapT:function(e){typeof e=="string"?this._wrapT=a[e]:this._wrapT=e},getWrapT:function(){return this._wrapT},getWrapS:function(){return this._wrapS},getMinFilter:function(e){return this._minFilter},getMagFilter:function(e){return this._magFilter},setMinFilter:function(e){typeof e=="string"?this._minFilter=a[e]:this._minFilter=e},setMagFilter:function(e){typeof e=="string"?this._magFilter=a[e]:this._magFilter=e},setImage:function(e,t){var n=e;if(e instanceof window.Image||e instanceof HTMLCanvasElement||e instanceof Uint8Array)n=new i(e);this._image=n,this.setImageFormat(t),this.dirty()},getImage:function(){return this._image},setImageFormat:function(e){e?(typeof e=="string"&&(e=a[e]),this._imageFormat=e):this._imageFormat=a.RGBA,this.setInternalFormat(this._imageFormat)},setType:function(e){typeof e=="string"?this._type=a[e]:this._type=e},setUnrefImageDataAfterApply:function(e){this._unrefImageDataAfterApply=e},setInternalFormat:function(e){this._internalFormat=e},getInternalFormat:function(){return this._internalFormat},applyFilterParameter:function(e,t){var n=function(e){return e!==0&&(e&~e+1)===e},r=n(this._textureWidth)&&n(this._textureHeight);r||(this.setWrapT(a.CLAMP_TO_EDGE),this.setWrapS(a.CLAMP_TO_EDGE),(this._minFilter===a.LINEAR_MIPMAP_LINEAR||this._minFilter===a.LINEAR_MIPMAP_NEAREST)&&this.setMinFilter(a.LINEAR)),e.texParameteri(t,e.TEXTURE_MAG_FILTER,this._magFilter),e.texParameteri(t,e.TEXTURE_MIN_FILTER,this._minFilter),e.texParameteri(t,e.TEXTURE_WRAP_S,this._wrapS),e.texParameteri(t,e.TEXTURE_WRAP_T,this._wrapT)},generateMipmap:function(e,t){(this._minFilter===e.NEAREST_MIPMAP_NEAREST||this._minFilter===e.LINEAR_MIPMAP_NEAREST||this._minFilter===e.NEAREST_MIPMAP_LINEAR||this._minFilter===e.LINEAR_MIPMAP_LINEAR)&&e.generateMipmap(t)},applyTexImage2D:function(e){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);e.texImage2D.apply(e,t);var n=this._applyTexImage2DCallbacks.length;if(n>0)for(var r=0,i=n;r<i;r++)this._applyTexImage2DCallbacks[r].call(this)},apply:function(e){var t=e.getGraphicContext();if(this._textureObject!==undefined&&!this.isDirty())t.bindTexture(this._textureTarget,this._textureObject);else if(this.default_type)t.bindTexture(this._textureTarget,null);else{var n=this._image;if(n!==undefined)if(n.isReady()){this._textureObject||this.init(t),this.setDirty(!1),t.bindTexture(this._textureTarget,this._textureObject);var r=n.getWidth()||this._textureWidth,i=n.getHeight()||this._textureHeight;this.setTextureSize(r,i),n.isTypedArray()?this.applyTexImage2D(t,this._textureTarget,0,this._internalFormat,this._textureWidth,this._textureHeight,0,this._internalFormat,this._type,this._image.getImage()):this.applyTexImage2D(t,this._textureTarget,0,this._internalFormat,this._imageFormat,this._type,n.getImage()),this.applyFilterParameter(t,this._textureTarget),this.generateMipmap(t,this._textureTarget),this._unrefImageDataAfterApply&&(this._image=undefined)}else t.bindTexture(this._textureTarget,null);else this._textureHeight!==0&&this._textureWidth!==0&&(this._textureObject||this.init(t),t.bindTexture(this._textureTarget,this._textureObject),this.applyTexImage2D(t,this._textureTarget,0,this._internalFormat,this._textureWidth,this._textureHeight,0,this._internalFormat,this._type,null),this.applyFilterParameter(t,this._textureTarget),this.generateMipmap(t,this._textureTarget),this.setDirty(!1))}},setShaderGeneratorFunction:function(e,t){this[t]=e},generateShader:function(e,t){return this[t]?this[t].call(this,e):""}}),"osg","Texture"),a.prototype[s.Type.VertexInit]=function(e){var t="attribute vec2 TexCoord"+e+";\n";return t+="varying vec2 FragTexCoord"+e+";\n",t},a.prototype[s.Type.VertexMain]=function(e){return"FragTexCoord"+e+" = TexCoord"+e+";\n"},a.prototype[s.Type.FragmentInit]=function(e){var t="varying vec2 FragTexCoord"+e+";\n";return t+="uniform sampler2D Texture"+e+";\n",t+="vec4 texColor"+e+";\n",t},a.prototype[s.Type.FragmentMain]=function(e){var t="texColor"+e+" = texture2D( Texture"+e+", FragTexCoord"+e+".xy );\n";return t+="fragColor = fragColor * texColor"+e+";\n",t},a.createFromURL=function(e,t){var n=new a;return u.when(o.readImage(e)).then(function(e){n.setImage(e,t)}),n},a.createFromImage=function(e,t){var n=new a;return n.setImage(e,t),n},a.createFromCanvas=function(e,t){return a.createFromImage(e,t)},a.create=function(t){return e.log("Texture.create is deprecated, use Texture.createFromURL instead"),a.createFromURL(t)},a}),define("osg/TextureCubeMap",["osg/Utils","osg/Texture","osg/Image"],function(e,t,n){var r=function(){t.call(this),this._images={}};return r.prototype=e.objectLibraryClass(e.objectInehrit(t.prototype,{setDefaultParameters:function(){t.prototype.setDefaultParameters.call(this),this._textureTarget=t.TEXTURE_CUBE_MAP},cloneType:function(){var e=new r;return e.default_type=!0,e},setImage:function(e,r,i){typeof e=="string"&&(e=t[e]),this._images[e]===undefined&&(this._images[e]={}),typeof i=="string"&&(i=t[i]),i===undefined&&(i=t.RGBA);var s=r;s instanceof n==0&&(s=new n(r)),this._images[e].image=s,this._images[e].format=i,this._images[e].dirty=!0,this.dirty()},getImage:function(e){return this._images[e].image},applyTexImage2D_load:function(e,t,n,r,i,s,o){return o?o.isReady()?(this.setTextureSize(o.getWidth(),o.getHeight()),e.texImage2D(t,0,r,i,s,o.getImage()),!0):!1:!1},_applyImageTarget:function(e,t,n){var r=this._images[n];return r?r.dirty?this.applyTexImage2D_load(e,n,0,t,r.format,e.UNSIGNED_BYTE,r.image)?(r.dirty=!1,this._unrefImageDataAfterApply&&delete this._images[n],1):0:1:0},apply:function(e){var t=e.getGraphicContext();if(this._textureObject!==undefined&&!this.isDirty())t.bindTexture(this._textureTarget,this._textureObject);else if(this.default_type)t.bindTexture(this._textureTarget,null);else{var n=this._images;this._textureObject||this.init(t),t.bindTexture(this._textureTarget,this._textureObject);var r=this._internalFormat,i=0;i+=this._applyImageTarget(t,r,t.TEXTURE_CUBE_MAP_POSITIVE_X),i+=this._applyImageTarget(t,r,t.TEXTURE_CUBE_MAP_NEGATIVE_X),i+=this._applyImageTarget(t,r,t.TEXTURE_CUBE_MAP_POSITIVE_Y),i+=this._applyImageTarget(t,r,t.TEXTURE_CUBE_MAP_NEGATIVE_Y),i+=this._applyImageTarget(t,r,t.TEXTURE_CUBE_MAP_POSITIVE_Z),i+=this._applyImageTarget(t,r,t.TEXTURE_CUBE_MAP_NEGATIVE_Z),i===6&&(this.setDirty(!1),this.applyFilterParameter(t,this._textureTarget),this.generateMipmap(t,this._textureTarget))}}}),"osg","TextureCubeMap"),r}),define("osg/UpdateVisitor",["osg/Utils","osg/NodeVisitor","osg/FrameStamp"],function(e,t,n){var r=function(){t.call(this);var e=new n;this.getFrameStamp=function(){return e},this.setFrameStamp=function(t){e=t}};return r.prototype=e.objectInehrit(t.prototype,{apply:function(e){var t=e.getUpdateCallbackList();for(var n=0;n<t.length;n++)if(!t[n].update(e,this))return;this.traverse(e)}}),r}),define("osg/Vec2",[],function(){var e={copy:function(e,t){return t[0]=e[0],t[1]=e[1],t},valid:function(e){return isNaN(e[0])?!1:isNaN(e[1])?!1:!0},mult:function(e,t,n){return n[0]=e[0]*t,n[1]=e[1]*t,n},length2:function(e){return e[0]*e[0]+e[1]*e[1]},length:function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])},distance:function(e,t){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)},normalize:function(e,t){var n=this.length2(e);if(n>0){var r=1/Math.sqrt(n);t[0]=e[0]*r,t[1]=e[1]*r}else t[0]=e[0],t[1]=e[1];return t},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]},sub:function(e,t,n){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n},add:function(e,t,n){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n},neg:function(e,t){return t[0]=-e[0],t[1]=-e[1],t},lerp:function(e,t,n,r){var i=1-e;return r[0]=t[0]*i+e*n[0],r[1]=t[1]*i+e*n[1],r}};return e}),define("osg/Viewport",["osg/Utils","osg/StateAttribute","osg/Matrix","osg/Viewport"],function(e,t,n,r){var r=function(e,n,r,i){t.call(this),e===undefined&&(e=0),n===undefined&&(n=0),r===undefined&&(r=800),i===undefined&&(i=600),this._x=e,this._y=n,this._width=r,this._height=i,this._dirty=!0};return r.prototype=e.objectLibraryClass(e.objectInehrit(t.prototype,{attributeType:"Viewport",cloneType:function(){return new r},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},apply:function(e){var t=e.getGraphicContext();t.viewport(this._x,this._y,this._width,this._height),this._dirty=!1},setViewport:function(e,t,n,r){this._x=e,this._y=t,this._width=n,this._height=r,this.dirty()},x:function(){return this._x},y:function(){return this._y},width:function(){return this._width},height:function(){return this._height},computeWindowMatrix:function(){var e=n.makeTranslate(1,1,1),t=n.makeScale(.5*this._width,.5*this._height,.5),r=n.makeTranslate(this._x,this._y,0);return n.preMult(r,n.preMult(t,e))}}),"osg","Viewport"),r}),define("osg/osg",["osg/BlendColor","osg/BlendFunc","osg/BoundingBox","osg/BoundingSphere","osg/BufferArray","osg/Camera","osg/ComputeMatrixFromNodePath","osg/CullFace","osg/CullSettings","osg/CullStack","osg/CullVisitor","osg/Depth","osg/DrawArrayLengths","osg/DrawArrays","osg/DrawElements","osg/EllipsoidModel","osg/FrameBufferObject","osg/FrameStamp","osg/Geometry","osg/Image","osg/Light","osg/LightSource","osg/LineWidth","osg/Material","osg/Math","osg/Matrix","osg/MatrixTransform","osg/Node","osg/NodeVisitor","osg/Notify","osg/Object","osg/PrimitiveSet","osg/Program","osg/Projection","osg/Quat","osg/RenderBin","osg/RenderStage","osg/Shader","osg/ShaderGenerator","osg/Shape","osg/Stack","osg/State","osg/StateAttribute","osg/StateGraph","osg/StateSet","osg/Texture","osg/TextureCubeMap","osg/Transform","osg/Uniform","osg/UpdateVisitor","osg/Utils","osg/Vec2","osg/Vec3","osg/Vec4","osg/Viewport"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et){var tt={};return tt.BlendColor=e,tt.BlendFunc=t,tt.BoundingBox=n,tt.BoundingSphere=r,tt.BufferArray=i,tt.Camera=s,tt.ComputeMatrixFromNodePath=o,tt.CullFace=u,tt.CullSettings=a,tt.CullStack=f,tt.CullVisitor=l,tt.Depth=c,tt.DrawArrayLengths=h,tt.DrawArrays=p,tt.DrawElements=d,tt.EllipsoidModel=v,tt.FrameBufferObject=m,tt.FrameStamp=g,tt.Geometry=y,tt.Image=b,tt.Light=w,tt.LightSource=E,tt.LineWidth=S,tt.Material=x,tt.Math=T,tt.Matrix=N,tt.MatrixTransform=C,tt.Node=k,tt.NodeVisitor=L,tt.Notify=A,tt.Object=O,tt.PrimitiveSet=M,tt.Program=_,tt.Projection=D,tt.Quat=P,tt.RenderBin=H,tt.RenderStage=B,tt.Shader=j,tt.ShaderGenerator=F,tt.Shape=I,tt.Stack=q,tt.State=R,tt.StateAttribute=U,tt.StateGraph=z,tt.StateSet=W,tt.Texture=X,tt.TextureCubeMap=V,tt.Transform=$,tt.Uniform=J,tt.UpdateVisitor=K,Q.objectMix(tt,Q),tt.Vec2=G,tt.Vec3=Y,tt.Vec4=Z,tt.Viewport=et,tt}),define("osgAnimation/Animation",["osg/Utils","osg/Object"],function(e,t){var n=function(){t.call(this),this._channels=[]};return n.prototype=e.objectInehrit(t.prototype,{getChannels:function(){return this._channels},getDuration:function(){var e=1e5,t=-1e5;for(var n=0,r=this._channels.length;n<r;n++){var i=this._channels[n];e=Math.min(e,i.getStartTime()),t=Math.max(t,i.getEndTime())}return t-e}}),n}),define("osgAnimation/AnimationUpdateCallback",["osg/Notify","osg/Utils","osg/Object"],function(e,t,n){var r=function(){};return r.prototype=t.objectInehrit(n.prototype,{linkChannel:function(){},linkAnimation:function(t){var n=this.getName();if(n.length===0)return e.log("no name on an update callback, discard"),0;var r=0,i=t.getChannels();for(var s=0,o=i.length;s<o;s++){var u=i[s];u.getTargetName()===n&&(this.linkChannel(u),r++)}return r}}),r}),define("osgAnimation/BasicAnimationManager",["osg/Notify","osg/Utils","osg/Object"],function(e,t,n){var r=function(){n.call(this),this._animations={},this._actives={},this._actives._keys=[],this._lastUpdate=undefined,this._targets=[]};return r.prototype=t.objectInehrit(n.prototype,{_updateAnimation:function(e,t,n){var r=e.duration,i=e.weight,s=e.anim,o=e.start,u=e.loop;if(u>0){var a=t-o;if(a>=u*r)return!0}t=(t-o)%r;var f=e.callback;f&&f(t);var l=s.getChannels();for(var c=0,h=l.length;c<h;c++){var p=l[c];p.update(t,i,n)}return!1},update:function(e,t){var n=t.getFrameStamp().getSimulationTime();return this.updateManager(n),!0},updateManager:function(e){var t=this._targets;for(var n=0,r=t.length;n<r;n++)t[n].reset();if(this._actives._keys.length>0){var i=this._actives._keys.length-1;while(i>=0){var s=this._actives[i],o=this._actives[i]._keys,u=[];for(var a=0,f=o.length;a<f;a++){var l=o[a],c=s[l];c.start===undefined&&(c.start=e);var h=this._updateAnimation(c,e,i);h&&u.push(a)}for(var p=u.length-1;p>=0;p--){var d=o[p];o.splice(p,1),delete s[d]}i--}}},stopAll:function(){},isPlaying:function(e){if(this._actives._keys.length>0){var t=this._actives._keys.length-1;while(t>=0){if(this._actives[t][e])return!0;t--}}return!1},stopAnimation:function(e){if(this._actives._keys.length>0){var t=this._actives._keys.length-1,r=function(e,t,n){return e!=="_keys"};while(t>=0){if(this._actives[t][e]){delete this._actives[t][e],this._actives[t]._keys=n.keys(this._actives[t]).filter(r);return}t--}}},playAnimationObject:function(t){if(t.name===undefined)return;var n=this._animations[t.name];if(n===undefined){e.log("no animation "+t.name+" found");return}if(this.isPlaying(t.name))return;t.priority===undefined&&(t.priority=0),t.weight===undefined&&(t.weight=1),t.timeFactor===undefined&&(t.timeFactor=1),t.loop===undefined&&(t.loop=0),this._actives[t.priority]===undefined&&(this._actives[t.priority]={},this._actives[t.priority]._keys=[],this._actives._keys.push(t.priority)),t.start=undefined,t.duration=n.getDuration(),t.anim=n,this._actives[t.priority][t.name]=t,this._actives[t.priority]._keys.push(t.name)},playAnimation:function(e,t,n){var r=e;if(typeof e=="object"){if(e.getName===undefined)return this.playAnimationObject(e);r=e.getName()}var i={name:r,priority:t,weight:n};return this.playAnimationObject(i)},registerAnimation:function(e){this._animations[e.getName()]=e,this.buildTargetList()},getAnimationMap:function(){return this._animations},buildTargetList:function(){this._targets.length=0;var e=n.keys(this._animations);for(var t=0,r=e.length;t<r;t++){var i=this._animations[e[t]],s=i.getChannels();for(var o=0,u=s.length;o<u;o++){var a=s[o];this._targets.push(a.getTarget())}}}}),r}),define("osgAnimation/Channel",["osg/Utils","osg/Object"],function(e,t){var n=function(e,n){t.call(this),this._sampler=e,this._target=n,this._targetName=undefined,this._data={value:undefined,key:0}};return n.prototype=e.objectInehrit(t.prototype,{getKeyframes:function(){return this._sampler.getKeyframes()},setKeyframes:function(e){this._sampler.setKeyframes(e)},getStartTime:function(){return this._sampler.getStartTime()},getEndTime:function(){return this._sampler.getEndTime()},getSampler:function(){return this._sampler},setSampler:function(e){this._sampler=e},getTarget:function(){return this._target},setTarget:function(e){this._target=e},setTargetName:function(e){this._targetName=e},getTargetName:function(){return this._targetName},update:function(e,t,n){t=t||1,n=n||0;if(t<1e-4)return;var r=this._data;this._sampler.getValueAt(e,r),this._target.update.call(this._target,t,r.value,n)},reset:function(){this._target.reset()}}),n}),define("osgAnimation/Easing",[],function(){var e=function(e){return-(e*(e-2))},t=function(e){return e*e},n=function(e){return e-=1,e*e*e+1},r=function(e){return e*e*e},i=function(e){return e-=1,-(e*e*e*e-1)},s=function(e){return e*e*e*e},o=function(e){return Math.pow(2,-10*e)*Math.sin((e-.075)*2*Math.PI/.3)+1},u=function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375};return{easeOutQuad:e,easeInQuad:t,easeOutCubic:n,easeInCubic:r,easeOutQuart:i,easeInQuart:s,easeOutElastic:o,easeOutBounce:u}}),define("osgAnimation/Sampler",[],function(){var e=function(e,t){e||(e=[]),this._keys=e,this._interpolator=t};return e.prototype={getKeyframes:function(){return this._keys},setKeyframes:function(e){this._keys=e},setInterpolator:function(e){this._interpolator=e},getInterpolator:function(){return this._interpolator},getStartTime:function(){return this._keys.length===0?undefined:this._keys[0].t},getEndTime:function(){return this._keys.length===0?undefined:this._keys[this._keys.length-1].t},getValueAt:function(e,t){this._keys[t.key].t>e&&(t.key=0),this._interpolator(this._keys,e,t)}},e}),define("osgAnimation/Interpolator",["osg/Quat"],function(e){var t=function(e,t,n){var r,i,s=e[e.length-1],o=s.t;if(t>=o){n.key=0,n.value[0]=s[0],n.value[1]=s[1],n.value[2]=s[2];return}r=e[0],i=r.t;if(t<=i){n.key=0,n.value[0]=r[0],n.value[1]=r[1],n.value[2]=r[2];return}var u=n.key;while(e[u+1].t<t)u++;var a=u+1,f=e[u].t,l=e[u][0],c=e[u][1],h=e[u][2],p=e[a].t,d=e[a][0],v=e[a][1],m=e[a][2],g=(t-f)/(p-f);n.value[0]=l+(d-l)*g,n.value[1]=c+(v-c)*g,n.value[2]=h+(m-h)*g,n.key=u};return QuatLerpInterpolator=function(e,t,n){var r,i,s=e[e.length-1],o=s.t;if(t>=o){n.key=0,n.value[0]=s[0],n.value[1]=s[1],n.value[2]=s[2],n.value[3]=s[3];return}r=e[0],i=r.t;if(t<=i){n.key=0,n.value[0]=r[0],n.value[1]=r[1],n.value[2]=r[2],n.value[3]=r[3];return}var u=n.key;while(e[u+1].t<t)u++;var a=u+1,f=e[u].t,l=e[u][0],c=e[u][1],h=e[u][2],p=e[u][3],d=e[a].t,v=e[a][0],m=e[a][1],g=e[a][2],y=e[a][3],b=(t-f)/(d-f);n.value[0]=l+(v-l)*b,n.value[1]=c+(m-c)*b,n.value[2]=h+(g-h)*b,n.value[3]=p+(y-p)*b,n.key=u},QuatSlerpInterpolator=function(t,n,r){var i,s,o=t[t.length-1],u=o.t;if(n>=u){r.key=0,r.value[0]=o[0],r.value[1]=o[1],r.value[2]=o[2],r.value[3]=o[3];return}i=t[0],s=i.t;if(n<=s){r.key=0,r.value[0]=i[0],r.value[1]=i[1],r.value[2]=i[2],r.value[3]=i[3];return}var a=r.key;while(t[a+1].t<n)a++;var f=a+1,l=t[a].t,c=t[f].t,h=(n-l)/(c-l);e.slerp(h,t[a],t[f],r.value),r.key=a},FloatLerpInterpolator=function(e,t,n){var r,i,s=e[e.length-1],o=s.t;if(t>=o){n.key=0,n.value=s[0];return}r=e[0],i=r.t;if(t<=i){n.key=0,n.value=r[0];return}var u=n.key;while(e[u+1].t<t)u++;var a=u+1,f=e[u].t,l=e[u][0],c=e[a].t,h=e[a][0],p=(t-f)/(c-f);n.value=l+(h-l)*p,n.key=u},FloatStepInterpolator=function(e,t,n){var r,i,s=e[e.length-1],o=s.t;if(t>=o){n.key=0,n.value=s[0];return}r=e[0],i=r.t;if(t<=i){n.key=0,n.value=r[0];return}var u=n.key;while(e[u+1].t<t)u++;var a=u+1,f=e[u].t,l=e[u][0];n.value=l,n.key=u},{Vec3LerpInterpolator:t,QuatLerpInterpolator:QuatLerpInterpolator,QuatSlerpInterpolator:QuatSlerpInterpolator,FloatLerpInterpolator:FloatLerpInterpolator,FloatStepInterpolator:FloatStepInterpolator}}),define("osgAnimation/Target",[],function(e){var t=function(){this._weight=0,this._priorityWeight=0,this._count=0,this._lastPriority=0,this._target=undefined};return t.prototype={reset:function(){this._weight=0,this._priorityWeight=0},getValue:function(){return this._target}},t}),define("osgAnimation/FloatTarget",["osg/Utils","osgAnimation/Target"],function(e,n){var r=function(e){n.call(this),this._target=[e]};return r.prototype=e.objectInehrit(n.prototype,{update:function(e,n,r){this._weight||this._priorityWeight?(this._lastPriority!=r&&(this._weight+=this._priorityWeight*(1-this._weight),this._priorityWeight=0,this._lastPriority=r),this._priorityWeight+=e,t=(1-this._weight)*e/this._priorityWeight,this._target+=(n-this._target)*t):(this._priorityWeight=e,this._lastPriority=r,this._target=n)}}),r}),define("osgAnimation/FloatLerpChannel",["osgAnimation/Channel","osgAnimation/Sampler","osgAnimation/Interpolator","osgAnimation/FloatTarget"],function(e,t,n,r){var i=function(i,s){var o=new t;i||(i=[]),s||(s=new r),e.call(this,o,s),o.setInterpolator(n.FloatLerpInterpolator),this.setKeyframes(i),this._data.value=s.getValue()};return i.prototype=e.prototype,i}),define("osgAnimation/Keyframe",[],function(){var e=function(e,t){var n=t.slice(0);return n.t=e,n};return createQuatKeyframe=function(e,t){var n=t.slice(0);return n.t=e,n},createFloatKeyframe=function(e,t){var n=[t];return n.t=e,n},{createVec3Keyframe:e,createQuatKeyframe:createQuatKeyframe,createFloatKeyframe:createFloatKeyframe}}),define("osgAnimation/LinkVisitor",["osg/Notify","osg/Utils","osg/NodeVisitor","osg/Object","osgAnimation/AnimationUpdateCallback"],function(e,t,n,r,i){var s=function(){n.call(this),this._animations=undefined,this._nbLinkTarget=0};return s.prototype=t.objectInehrit(n.prototype,{setAnimationMap:function(e){this._animations=e,this._animationKeys=r.keys(e)},apply:function(e){var t=e.getUpdateCallbackList();for(var n=0,r=t.length;n<r;n++){var s=t[n];s instanceof i&&this.link(s)}this.traverse(e)},link:function(t){var n=0,r=this._animations,i=this._animationKeys;for(var s=0,o=i.length;s<o;s++){var u=i[s],a=r[u];n+=t.linkAnimation(a)}this._nbLinkedTarget+=n,e.log("linked "+n+' for "'+t.getName()+'"')}}),s}),define("osgAnimation/QuatTarget",["osg/Utils","osgAnimation/Target","osg/Quat"],function(e,n,r){var i=function(){n.call(this),this._target=[],r.makeIdentity(this._target)};return i.prototype=e.objectInehrit(n.prototype,{update:function(e,n,i){this._weight||this._priorityWeight?(this._lastPriority!=i&&(this._weight+=this._priorityWeight*(1-this._weight),this._priorityWeight=0,this._lastPriority=i),this._priorityWeight+=e,t=(1-this._weight)*e/this._priorityWeight,r.lerp(t,this._target,n,this._target),r.normalize(this._target,this._target)):(this._priorityWeight=e,this._lastPriority=i,r.copy(n,this._target))}}),i}),define("osgAnimation/QuatLerpChannel",["osgAnimation/Channel","osgAnimation/Sampler","osgAnimation/Interpolator","osgAnimation/QuatTarget","osg/Quat"],function(e,t,n,r,i){var s=function(r,i){var s=new t;r||(r=[]),i||(i=new QuatTarget),e.call(this,s,i),s.setInterpolator(n.QuatLerpInterpolator),this.setKeyframes(r),this._data.value=Quat.copy(i.getValue(),[])};return s.prototype=e.prototype,s}),define("osgAnimation/QuatSLerpChannel",["osgAnimation/Channel","osgAnimation/QuatLerpChannel","osgAnimation/Interpolator"],function(e,t,n){var r=function(e,r){t.call(this,e,r),this.getSampler().setInterpolator(n.QuatSlerpInterpolator)};return r.prototype=e.prototype,r}),define("osgAnimation/StackedQuaternion",["osg/Utils","osg/Object","osg/Matrix","osgAnimation/QuatTarget","osg/Quat"],function(e,t,n,r,i){var s=function(e,r){t.call(this),r||(r=[0,0,0,1]),this._quaternion=r,this._target=undefined,this._matrixTmp=[],n.makeIdentity(this._matrixTmp),this.setName(e)};return s.prototype=e.objectInehrit(t.prototype,{setQuaternion:function(e){i.copy(e,this._quaternion)},setTarget:function(e){this._target=e},getTarget:function(){return this._target},update:function(){this._target!==undefined&&i.copy(this._target.getValue(),this._quaternion)},getOrCreateTarget:function(){return this._target||(this._target=new r(this._quaternion)),this._target},applyToMatrix:function(e){var t=this._matrixTmp;n.setRotateFromQuat(t,this._quaternion),n.preMult(e,t)}}),s}),define("osgAnimation/Vec3Target",["osg/Utils","osgAnimation/Target","osg/Vec3"],function(e,n,r){var i=function(){n.call(this),this._target=[0,0,0]};return i.prototype=e.objectInehrit(n.prototype,{update:function(e,n,i){this._weight||this._priorityWeight?(this._lastPriority!=i&&(this._weight+=this._priorityWeight*(1-this._weight),this._priorityWeight=0,this._lastPriority=i),this._priorityWeight+=e,t=(1-this._weight)*e/this._priorityWeight,r.lerp(t,this._target,n,this._target)):(this._priorityWeight=e,this._lastPriority=i,r.copy(n,this._target))}}),i}),define("osgAnimation/StackedRotateAxis",["osg/Utils","osg/Object","osg/Matrix","osgAnimation/Vec3Target","osgAnimation/FloatTarget","osg/Vec3","osg/Quat"],function(e,t,n,r,i,s,o){var u=function(e,r,i){t.call(this),r||(r=[1,0,0]),i||(i=0),this._axis=r,this._angle=i,this._target=undefined,this.setName(e),this._matrixTmp=[],n.makeIdentity(this._matrixTmp),this._quatTmp=[],o.makeIdentity(this._quatTmp)};return u.prototype=e.objectInehrit(t.prototype,{setAxis:function(e){s.copy(e,this._axis)},setAngle:function(e){this._angle=e},setTarget:function(e){this._target=e},getTarget:function(){return this._target},update:function(){this._target!==undefined&&(this._angle=this._target.getValue())},getOrCreateTarget:function(){return this._target||(this._target=new i(this._angle)),this._target},applyToMatrix:function(e){var t=this._axis,r=this._quatTmp,i=this._matrixTmp;o.makeRotate(this._angle,t[0],t[1],t[2],r),n.setRotateFromQuat(i,r),n.preMult(e,i)}}),u}),define("osgAnimation/StackedTranslate",["osg/Utils","osg/Object","osg/Matrix","osgAnimation/Vec3Target","osg/Vec3"],function(e,t,n,r,i){var s=function(e,n){t.call(this),n||(n=[0,0,0]),this._translate=n,this._target=undefined,this.setName(e)};return s.prototype=e.objectInehrit(t.prototype,{setTranslate:function(e){i.copy(e,this._translate)},setTarget:function(e){this._target=e},getTarget:function(){return this._target},update:function(){this._target!==undefined&&i.copy(this._target.getValue(),this._translate)},getOrCreateTarget:function(){return this._target||(this._target=new r(this._translate)),this._target},applyToMatrix:function(e){n.preMultTranslate(e,this._translate)}}),s}),define("osgAnimation/UpdateMatrixTransform",["osg/Notify","osg/Utils","osgAnimation/AnimationUpdateCallback"],function(e,t,n){var r=function(){n.call(this),this._stackedTransforms=[]};return r.prototype=t.objectInehrit(n.prototype,{getStackedTransforms:function(){return this._stackedTransforms},update:function(e,t){var n=e.getMatrix();Matrix.makeIdentity(n);var r=this._stackedTransforms;for(var i=0,s=r.length;i<s;i++){var o=r[i];o.update(),o.applyToMatrix(n)}return!0},linkChannel:function(t){var n=t.getName(),r=this._stackedTransforms;for(var i=0,s=r.length;i<s;i++){var o=r[i],u=o.getName();if(n.length>0&&u===n){var a=o.getOrCreateTarget();if(a)return t.setTarget(a),!0}}e.log("can't link channel "+n+", does not contain a symbolic name that can be linked to TransformElements")}}),r}),define("osgAnimation/Vec3LerpChannel",["osgAnimation/Channel","osgAnimation/Sampler","osgAnimation/Interpolator","osgAnimation/Vec3Target","osg/Vec3"],function(e,t,n,r,i){var s=function(s,o){var u=new t;s||(s=[]),o||(o=new r),e.call(this,u,o),u.setInterpolator(n.Vec3LerpInterpolator),this.setKeyframes(s),this._data.value=i.copy(o.getValue(),[])};return s.prototype=e.prototype,s}),define("osgAnimation/osgAnimation",["osg/Utils","osgAnimation/Animation","osgAnimation/AnimationUpdateCallback","osgAnimation/BasicAnimationManager","osgAnimation/Channel","osgAnimation/Easing","osgAnimation/FloatLerpChannel","osgAnimation/FloatTarget","osgAnimation/Interpolator","osgAnimation/Keyframe","osgAnimation/LinkVisitor","osgAnimation/QuatLerpChannel","osgAnimation/QuatSLerpChannel","osgAnimation/QuatTarget","osgAnimation/Sampler","osgAnimation/StackedQuaternion","osgAnimation/StackedRotateAxis","osgAnimation/StackedTranslate","osgAnimation/Target","osgAnimation/UpdateMatrixTransform","osgAnimation/Vec3LerpChannel","osgAnimation/Vec3Target"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E){var S={};return S.Animation=t,S.AnimationUpdateCallback=n,S.BasicAnimationManager=r,S.Channel=i,e.objectMix(S,s),S.FloatLerpChannel=o,S.FloatTarget=u,e.objectMix(S,a),e.objectMix(S,f),S.LinkVisitor=l,S.QuatLerpChannel=c,S.QuatSLerpChannel=h,S.QuatTarget=p,S.Sampler=d,S.StackedQuaternion=v,S.StackedRotateAxis=m,S.StackedTranslate=g,S.Target=y,S.UpdateMatrixTransform=b,S.Vec3LerpChannel=w,S.Vec3Target=E,S}),define("osgGA/Manipulator",["osg/Matrix"],function(e){var t=function(){this._controllerList={},this._inverseMatrix=new Array(16),e.makeIdentity(this._inverseMatrix)};return t.prototype={update:function(e){},getInverseMatrix:function(){return this._inverseMatrix},getControllerList:function(){return this._controllerList}},t}),define("osgGA/OrbitManipulatorLeapMotionController",["osg/Notify","osg/Vec3"],function(e,t){var n=function(e){this._manipulator=e,this.init()},r={rotate:{dtx:-1.44,dty:-1.08,dtz:-0.1,delay:.05,method:"getRotateInterpolator"},pan:{dtx:-1.44,dty:-1.08,delay:.05,method:"getPanInterpolator"},zoom:{dtx:0,dty:-0.5,delay:.05,method:"getZoomInterpolator"},"zoom-twohands":{dtx:-0.05,dty:0,delay:.05,method:"getZoomInterpolator"}};return n.prototype={init:function(){this._virtualCursor=[0,0],this._targetPosition=[0,0],this._previousFrame=undefined,this._displacement=[0,0],this._top=[0,1,0],this._motion=[0,0],this._delay=.05,this._threshold=.08,this._direction_dot_threshold=.5,this._mode="rotate"},update:function(n){this._previousFrame||(this._previousFrame=n);if(n.fingers.length===0)return;var i=this._previousFrame.translation(n);this._previousFrame=n;if(n.hands.length===0)return;if(Math.abs(i[0])<this._threshold&&Math.abs(i[1])<this._threshold)return;var s=this._mode,o=0;if(n.gestures.length>0)for(var u=0;u<n.gestures.length;u++){var a=n.gestures[u];if(a.type==="circle"){this._manipulator.computeHomePosition();return}}if(n.hands.length===1)n.hands[0].fingers.length>=3?(s="zoom",o=n.hands[0].palmPosition[1]/10,o=Math.max(o-4,.01)):n.hands[0].fingers.length>1?s="pan":s="rotate";else if(n.hands.length===2){var f=Math.abs(t.dot(n.hands[0].palmNormal,this._top)),l=Math.abs(t.dot(n.hands[1].palmNormal,this._top));f<this._direction_dot_threshold&&l<this._direction_dot_threshold?s="zoom-twohands":(s=undefined,this.hands_distance_old=undefined)}var c=this._manipulator.getZoomInterpolator();if(s===undefined)return;if(s!==this._mode){e.info("Switch to mode "+s),this._motion[0]=0,this._motion[1]=0,this._mode=s,(s==="zoom"||s==="zoom-twohands")&&c.isReset()&&(c._start=1,c.set(0));return}var h,p,d;h=r[s].dtx,p=r[s].dty,d=r[s].dtz,this._motion[0]+=i[0]*h,this._motion[1]+=i[1]*p;var v=r[s].delay,m=r[s].method;this._manipulator[m]().setDelay(v);if(s==="zoom")e.log(o),c.setTarget(o);else if(s==="zoom-twohands"){var g=t.distance(n.hands[0].palmPosition,n.hands[1].palmPosition);if(this.hands_distance_old!==undefined){var y=h*(g-this.hands_distance_old);o=c._target,o[0]+=y}this.hands_distance_old=g}else s==="rotate"&&(o=c._target[0],o+=i[2]*d,o=Math.max(o,.01),c.setTarget(o)),this._manipulator[m]().addTarget(this._motion[0],this._motion[1]);this._motion[1]=this._motion[0]=0}},n}),define("osgGA/OrbitManipulatorMouseKeyboardController",[],function(){var e={Rotate:0,Pan:1,Zoom:2},t=function(e){this._manipulator=e,this.init()};return t.prototype={init:function(){this.releaseButton(),this._rotateKey=65,this._zoomKey=83,this._panKey=68,this._mode=undefined,this._delay=.15},getMode:function(){return this._mode},setMode:function(e){this._mode=e},setEventProxy:function(e){this._eventProxy=e},setManipulator:function(e){this._manipulator=e},mousemove:function(t){if(this._buttonup===!0)return;var n=this._eventProxy.getPositionRelativeToCanvas(t),r=this._manipulator;if(isNaN(n[0])===!1&&isNaN(n[1])===!1){var i,s,o=this.getMode();if(o===e.Rotate)r.getRotateInterpolator().setDelay(this._delay),r.getRotateInterpolator().setTarget(n[0],n[1]);else if(o===e.Pan)r.getPanInterpolator().setTarget(n[0],n[1]);else if(o===e.Zoom){var u=r.getZoomInterpolator();u.isReset()&&(u._start=n[1],u.set(0));var a=n[1]-u._start;u._start=n[1];var f=u.getTarget()[0];u.setTarget(f-a/20)}}t.preventDefault()},mousedown:function(t){var n=this._manipulator,r=this.getMode();r===undefined&&(t.button===0?t.shiftKey?this.setMode(e.Pan):t.ctrlKey?this.setMode(e.Zoom):this.setMode(e.Rotate):this.setMode(e.Pan)),this.pushButton();var i=this._eventProxy.getPositionRelativeToCanvas(t);r=this.getMode(),r===0?(n.getRotateInterpolator().reset(),n.getRotateInterpolator().set(i[0],i[1])):r===1?(n.getPanInterpolator().reset(),n.getPanInterpolator().set(i[0],i[1])):r===2&&(n.getZoomInterpolator()._start=i[1],n.getZoomInterpolator().set(0)),t.preventDefault()},mouseup:function(e){this.releaseButton(),this.setMode(undefined)},mousewheel:function(e,t,n,r){var i=this._manipulator;e.preventDefault();var s=i.getZoomInterpolator().getTarget()[0]-t;i.getZoomInterpolator().setTarget(s)},pushButton:function(){this._buttonup=!1},releaseButton:function(){this._buttonup=!0},keydown:function(t){t.keyCode===32?this._manipulator.computeHomePosition():t.keyCode===this._panKey&&this.getMode()!==e.Pan?(this.setMode(e.Pan),this._manipulator.getPanInterpolator().reset(),this.pushButton(),t.preventDefault()):t.keyCode===this._zoomKey&&this.getMode()!==e.Zoom?(this.setMode(e.Zoom),this._manipulator.getZoomInterpolator().reset(),this.pushButton(),t.preventDefault()):t.keyCode===this._rotateKey&&this.getMode()!==e.Rotate&&(this.setMode(e.Rotate),this._manipulator.getRotateInterpolator().reset(),this.pushButton(),t.preventDefault())},keyup:function(e){e.keyCode===this._panKey?this.mouseup(e):e.keyCode===this._rotateKey?this.mouseup(e):e.keyCode===this._rotateKey&&this.mouseup(e),this.setMode(undefined)}},t}),define("osgGA/OrbitManipulatorHammerController",["osg/Notify"],function(e){var t=function(e){this._manipulator=e,this.init()};return t.prototype={init:function(){this._panFactorX=.5,this._panFactorY=-this._panFactorX,this._rotateFactorX=.6,this._rotateFactorY=-this._rotateFactorX,this._zoomFactor=5,this._pan=!1,this._delay=.15},setEventProxy:function(t){if(t===undefined||t!==undefined&&t===this._eventProxy)return;this._eventProxy=t;var n=this,r=t,i=function(e){return e.touches!==undefined?e.touches.length:1},s=function(e){return"touches "+i(e)+" distance "+e.distance+" x "+e.deltaX+" y "+e.deltaY};r.on("dragstart",function(t){var r=n._manipulator;if(!r||n._transformStarted)return;var o=t.gesture;i(o)===2&&(n._pan=!0),n._dragStarted=!0,n._pan?(r.getPanInterpolator().reset(),r.getPanInterpolator().set(o.center.pageX*n._panFactorX,o.center.pageY*n._panFactorY)):(r.getRotateInterpolator().reset(),r.getRotateInterpolator().set(o.center.pageX*n._rotateFactorX,o.center.pageY*n._rotateFactorY)),e.debug("drag start, "+s(o))}),r.on("drag",function(t){var r=n._manipulator;if(!r)return;if(!n._dragStarted)return;if(n._transformStarted){n._dragStarted=!1;return}var o=t.gesture;if(n._pan){if(i(o)!==2)return;r.getPanInterpolator().setTarget(o.center.pageX*n._panFactorX,o.center.pageY*n._panFactorY),e.debug("pad, "+s(o))}else r.getRotateInterpolator().setDelay(n._delay),r.getRotateInterpolator().setTarget(o.center.pageX*n._rotateFactorX,o.center.pageY*n._rotateFactorY),e.debug("rotate, "+s(o))}),r.on("dragend",function(t){var r=n._manipulator;if(!r||!n._dragStarted)return;n._dragStarted=!1;var i=t.gesture;n._pan=!1,e.debug("drag end, "+s(i))});var o;r.on("transformstart",function(t){var i=n._manipulator;if(!i)return;n._transformStarted=!0;var s=t.gesture;o=s.scale;var u=s.scale;i.getZoomInterpolator().reset(),i.getZoomInterpolator().set(s.scale),e.debug("transform start "+s.scale+" "+u),t.preventDefault(),r.options.drag=!1}),r.on("transformend",function(t){n._transformStarted=!1,e.debug("transform end "+t.gesture.scale),r.options.drag=!0}),r.on("transform",function(t){var r=n._manipulator;if(!r||!n._transformStarted)return;var i=t.gesture,s=(i.scale-o)*n._zoomFactor;o=i.scale;var u=r.getZoomInterpolator().getTarget()[0];r.getZoomInterpolator().setTarget(u-s),e.debug("transform "+i.scale+" "+(u-s))})},setManipulator:function(e){this._manipulator=e}},t}),define("osgGA/OrbitManipulatorGamePadController",[],function(){var e=function(e){this._manipulator=e,this.init()};return e.prototype={init:function(){this._delay=.15,this._threshold=.08,this._mode=0,this._padFactor=10,this._zoomFactor=.5,this._rotateFactor=5},addPan:function(e,t,n){e.setDelay(this._delay),e.addTarget(t*this._padFactor,n*this._padFactor)},addZoom:function(e,t){e.setDelay(this._delay),e.addTarget(t*this._zoomFactor)},addRotate:function(e,t,n){e.setDelay(this._delay),rotateTarget=e.getTarget(),e.addTarget(t*this._rotateFactor,n*this._rotateFactor)},gamepadaxes:function(e){var t=.005,n,r,i=this._manipulator.getRotateInterpolator(),s=this._manipulator.getZoomInterpolator(),o=this._manipulator.getPanInterpolator();e.length==4?((Math.abs(e[0])>t||Math.abs(e[1])>t)&&this.addRotate(i,-e[0],e[1]),Math.abs(e[3])>t&&this.addZoom(s,-e[3])):e.length>=5&&((Math.abs(e[0])>t||Math.abs(e[1])>t)&&this.addPan(o,-e[0],e[1]),Math.abs(e[2])>t&&this.addZoom(s,-e[2]),(Math.abs(e[3])>t||Math.abs(e[4])>t)&&this.addRotate(i,e[4],e[3]))},gamepadbuttondown:function(e,t){if(e.button>=12&&e.button<=15){var n=this._manipulator.getPanInterpolator(),r=n.getTarget(),i={12:[0,-1],13:[0,1],14:[-1,0],15:[1,0]}[e.button];n.setDelay(this._delay),n.setTarget(r[0]-i[0]*10,r[1]+i[1]*10)}},update:function(e){if(!e)return;var t=e.getGamePad(),n=t.axes,r=t.buttons;this.gamepadaxes(n);var i=function(){};for(var s=0;s<r.length;s++)r[s]&&this.gamepadbuttondown({preventDefault:i,gamepad:t,button:s},!!r[s])}},e}),define("osgGA/OrbitManipulator",["osg/Utils","osg/Vec3","osg/Matrix","osgGA/Manipulator","osgGA/OrbitManipulatorLeapMotionController","osgGA/OrbitManipulatorMouseKeyboardController","osgGA/OrbitManipulatorHammerController","osgGA/OrbitManipulatorGamePadController"],function(e,t,n,r,i,s,o,u){var a=function(){r.call(this),this._tmpInverse=n.makeIdentity([]),this._tmpHomePosition=t.init([]),this.init()};return a.Interpolator=function(e,t){this._current=new Array(e),this._target=new Array(e),this._delta=new Array(e),this._delay=t!==undefined?t:.15,this._reset=!1,this.reset()},a.Interpolator.prototype={setDelay:function(e){this._delay=e},reset:function(){for(var e=0,t=this._current.length;e<t;e++)this._current[e]=this._target[e]=0;this._reset=!0},update:function(){for(var e=0,t=this._current.length;e<t;e++){var n=(this._target[e]-this._current[e])*this._delay;this._delta[e]=n,this._current[e]+=n}return this._delta},set:function(){for(var e=0,t=this._current.length;e<t;e++)this._current[e]=this._target[e]=arguments[e];this._reset=!1},isReset:function(){return this._reset},getCurrent:function(){return this._current},setTarget:function(){for(var e=0,t=this._target.length;e<t;e++)this._reset?this._target[e]=this._current[e]=arguments[e]:this._target[e]=arguments[e];this._reset=!1},addTarget:function(){for(var e=0;e<arguments.length;e++)this._target[e]+=arguments[e]},getTarget:function(){return this._target},getDelta:function(){return this._delta}},a.Rotate=0,a.Pan=1,a.Zoom=2,a.AvailableControllerList=["StandardMouseKeyboard","LeapMotion","GamePad","Hammer"],a.ControllerList=["StandardMouseKeyboard","LeapMotion","GamePad","Hammer"],a.prototype=e.objectInehrit(r.prototype,{init:function(){this._distance=25,this._target=new Array(3),t.init(this._target),this._rotation=n.mult(n.makeRotate(Math.PI,0,0,1,[]),n.makeRotate(-Math.PI/10,1,0,0,[]),[]),this._time=0,this._rotate=new a.Interpolator(2),this._pan=new a.Interpolator(2),this._zoom=new a.Interpolator(1),this._zoom.reset=function(){a.Interpolator.prototype.reset.call(this),this._start=0},this._buttonup=!0,this._scale=10,this._maxDistance=0,this._minDistance=0,this._scaleMouseMotion=1,this._inverseMatrix=new Array(16),this._rotateKey=65,this._zoomKey=83,this._panKey=68;var e=this;a.ControllerList.forEach(function(t){a[t]!==undefined&&(e._controllerList[t]=new a[t](e))})},reset:function(){this.init()},setNode:function(e){this._node=e},setTarget:function(e){t.copy(e,this._target);var n=new Array(3);this.getEyePosition(n),this._distance=t.distance(n,e)},setEyePosition:function(e){var n=this._rotation,r=this._target,i=[0,0,1],s=t.sub(e,r,[]);t.normalize(s,s);var o=t.cross(s,i,[]);t.normalize(o,o);var u=t.cross(o,s,[]);t.normalize(u,u),n[0]=o[0],n[1]=s[0],n[2]=u[0],n[3]=0,n[4]=o[1],n[5]=s[1],n[6]=u[1],n[7]=0,n[8]=o[2],n[9]=s[2],n[10]=u[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this._distance=t.distance(e,r)},computeHomePosition:function(){if(this._node!==undefined){var e=this._node.getBound();this.setDistance(e.radius()*1.5),this.setTarget(e.center())}},getHomePosition:function(){var e=this._tmpHomePosition;if(this._node!==undefined){var t=this._node.getBound(),n=t.radius()*1.5,r=t.center();this.computeEyePosition(r,n,e)}return e},setMaxDistance:function(e){this._maxDistance=e},setMinDistance:function(e){this._minDistance=e},setDistance:function(e){this._distance=e},getDistance:function(){return this._distance},computePan:function(e,r){r*=this._distance,e*=this._distance;var i=new Array(16),s=new Array(3),o=new Array(3);n.inverse(this._rotation,i),s[0]=n.get(i,0,0),s[1]=n.get(i,0,1),s[2]=n.get(i,0,2),t.normalize(s,s),o[0]=n.get(i,2,0),o[1]=n.get(i,2,1),o[2]=n.get(i,2,2),t.normalize(o,o),t.mult(s,-e,s),t.mult(o,r,o),t.add(this._target,s,this._target),t.add(this._target,o,this._target)},computeRotation:function(e,r){var i=n.makeRotate(e/10,0,0,1,[]),s=n.mult(this._rotation,i,[]);i=n.makeRotate(r/10,1,0,0,[]);var o=n.mult(i,s,[]),u=[];n.inverse(o,u);var a=n.transformVec3(u,[0,this._distance,0],new Array(3)),f=t.neg(a,[]);t.normalize(f,f);var l=t.dot(f,[0,0,1]);if(Math.abs(l)>.95){this._rotation=s;return}this._rotation=o},computeZoom:function(e){this.zoom(e)},zoom:function(e){var t=this._distance*e;this._minDistance>0&&t<this._minDistance&&(t=this._minDistance),this._maxDistance>0&&t>this._maxDistance&&(t=this._maxDistance),this._distance=t},getRotateInterpolator:function(){return this._rotate},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getTarget:function(e){return t.copy(this._target,e),e},getEyePosition:function(e){this.computeEyePosition(this._target,this._distance,e)},computeEyePosition:function(e,r,i){var s=this._tmpInverse;n.inverse(this._rotation,this._tmpInverse),n.transformVec3(s,[0,r,0],i),t.add(e,i,i)},update:function(e){var r=e.getFrameStamp().getSimulationTime();this._lastUpdate===undefined&&(this._lastUpdate=r);var i=r-this._lastUpdate;this._lastUpdate=r;var s,o=.1;s=this._rotate.update(),this.computeRotation(-s[0]*o*this._scaleMouseMotion,-s[1]*o*this._scaleMouseMotion);var u=.002;s=this._pan.update(),this.computePan(-s[0]*u,-s[1]*u),s=this._zoom.update(),this.computeZoom(1+s[0]/10);var a=this._target,f=this._distance,l=new Array(3);n.inverse(this._rotation,this._inverseMatrix),n.transformVec3(this._inverseMatrix,[0,f,0],l),n.makeLookAt(t.add(a,l,l),a,[0,0,1],this._inverseMatrix)},getInverseMatrix:function(){return this._inverseMatrix}}),function(e){e.LeapMotion=i}(a),function(e){e.StandardMouseKeyboard=s}(a),function(e){e.Hammer=o}(a),function(e){e.GamePad=u}(a),a}),define("osgGA/FirstPersonManipulatorMouseKeyboardController",[],function(){var e=function(e){this._manipulator=e,this.init()};return e.prototype={init:function(){this.releaseButton(),this._delay=.15,this._stepFactor=1},setEventProxy:function(e){this._eventProxy=e},setManipulator:function(e){this._manipulator=e,this._manipulator.setStepFactor(this._stepFactor)},pushButton:function(){this._buttonup=!1},releaseButton:function(){this._buttonup=!0},mousedown:function(e){var t=this._eventProxy.getPositionRelativeToCanvas(e),n=this._manipulator;n.getLookPositionInterpolator().set(t[0],t[1]),this.pushButton()},mouseup:function(e){this.releaseButton()},mousemove:function(e){if(this._buttonup===!0)return;var t,n,r,i,s=this._eventProxy.getPositionRelativeToCanvas(e);this._manipulator.getLookPositionInterpolator().setDelay(this._delay),this._manipulator.getLookPositionInterpolator().setTarget(s[0],s[1])},mousewheel:function(e,t,n,r){e.preventDefault(),this._stepFactor=Math.min(Math.max(.001,this._stepFactor+t*.01),4),this._manipulator.setStepFactor(this._stepFactor)},keydown:function(e){var t=this._manipulator;if(e.keyCode===32)t.computeHomePosition();else{if(e.keyCode===87||e.keyCode===90||e.keyCode===38)return t.getFowardInterpolator().setDelay(this._delay),t.getFowardInterpolator().setTarget(1),!1;if(e.keyCode===83||e.keyCode===40)return t.getFowardInterpolator().setDelay(this._delay),t.getFowardInterpolator().setTarget(-1),!1;if(e.keyCode===68||e.keyCode===39)return t.getSideInterpolator().setDelay(this._delay),t.getSideInterpolator().setTarget(1),!1;if(e.keyCode===65||e.keyCode===81||e.keyCode===37)return t.getSideInterpolator().setDelay(this._delay),t.getSideInterpolator().setTarget(-1),!1}},keyup:function(e){var t=this._manipulator;if(e.keyCode===87||e.keyCode===90||e.keyCode===38||e.keyCode==83||e.keyCode===40)return t.getFowardInterpolator().setDelay(this._delay),t.getFowardInterpolator().setTarget(0),!1;if(e.keyCode==68||e.keyCode===39||e.keyCode===65||e.keyCode===81||e.keyCode===37)return t.getSideInterpolator().setDelay(this._delay),t.getSideInterpolator().setTarget(0),!1}},e}),define("osgGA/FirstPersonManipulator",["osg/Utils","osgGA/Manipulator","osgGA/OrbitManipulator","osg/Matrix","osg/Vec2","osg/Vec3","osgGA/FirstPersonManipulatorMouseKeyboardController"],function(e,t,n,r,i,s,o){var u=function(){t.call(this),this.init()};return u.AvailableControllerList=["StandardMouseKeyboard"],u.ControllerList=["StandardMouseKeyboard"],u.prototype=e.objectInehrit(t.prototype,{setNode:function(e){this._node=e,this.computeHomePosition()},computeHomePosition:function(){if(this._node!==undefined){var e=this._node.getBound();this._radius=e.radius(),this._eye=[0,-e.radius()*1.5,0]}},init:function(){this._direction=[0,1,0],this._eye=[0,25,10],this._up=[0,0,1],this._radius=1,this._forward=new n.Interpolator(1),this._side=new n.Interpolator(1),this._lookPosition=new n.Interpolator(2),this._stepFactor=1,this._target=new Array(3),s.init(this._target),this._angleVertical=0,this._angleHorizontal=0,this._tmpComputeRotation1=r.makeIdentity([]),this._tmpComputeRotation2=r.makeIdentity([]),this._tmpComputeRotation3=r.makeIdentity([]),this._tmpGetTargetDir=s.init([]);var e=this;this._controllerList={},u.ControllerList.forEach(function(t){u[t]!==undefined&&(e._controllerList[t]=new u[t](e))})},getEyePosition:function(e){return e[0]=this._eye[0],e[1]=this._eye[1],e[2]=this._eye[2],e},setEyePosition:function(e){return this._eye[0]=e[0],this._eye[1]=e[1],this._eye[2]=e[2],this},getTarget:function(e,t){t===undefined&&(t=25);var n=s.mult(this._direction,t,this._tmpGetTargetDir);s.add(this._eye,n,e)},setTarget:function(e){this._target[0]=e[0],this._target[1]=e[1],this._target[2]=e[2];var t=this._tmpGetTargetDir;s.sub(e,this._eye,t),t[2]=0,s.normalize(t,t),this._angleHorizontal=Math.acos(t[1]),t[0]<0&&(this._angleHorizontal=-this._angleHorizontal),s.sub(e,this._eye,t),s.normalize(t,t),this._angleVertical=-Math.asin(t[2]),s.copy(t,this._direction)},getLookPositionInterpolator:function(){return this._lookPosition},getSideInterpolator:function(){return this._side},getFowardInterpolator:function(){return this._forward},computeRotation:function(e,t){this._angleVertical+=t*.01,this._angleHorizontal-=e*.01;var n=this._tmpComputeRotation1,i=this._tmpComputeRotation2,o=this._tmpComputeRotation3;r.makeRotate(this._angleVertical,1,0,0,n),r.makeRotate(this._angleHorizontal,0,0,1,i),r.mult(i,n,o),this._direction=r.transformVec3(o,[0,1,0],this._direction),s.normalize(this._direction,this._direction),this._up=r.transformVec3(o,[0,0,1],this._up)},reset:function(){this.init()},setStepFactor:function(e){this._stepFactor=e},update:function(e){var t=e.getFrameStamp().getSimulationTime();this._lastUpdate===undefined&&(this._lastUpdate=t);var n=t-this._lastUpdate;this._lastUpdate=t,this._forward.update(),this._side.update();var o=this._lookPosition.update();this.computeRotation(-o[0]*.5,-o[1]*.5);var u=new Array(2);u[0]=this._forward.getCurrent()[0],u[1]=this._side.getCurrent()[0],i.length(u)>1&&i.normalize(u,u);var a=this._radius;this._radius<.001&&(a=1),this.moveForward(u[0]*a*this._stepFactor*n),this.strafe(u[1]*a*this._stepFactor*n);var f=s.add(this._eye,this._direction,[]);this._target=f,r.makeLookAt(this._eye,f,this._up,this._inverseMatrix)},getInverseMatrix:function(){return this._inverseMatrix},moveForward:function(e){var t=s.mult(s.normalize(this._direction,[]),e,[]);this._eye=s.add(this._eye,t,[])},strafe:function(e){var t=s.cross(this._direction,this._up,[]),n=s.mult(s.normalize(t,t),e,[]);this._eye=s.add(this._eye,n,[])}}),function(e){e.StandardMouseKeyboard=o}(u),u}),define("osgGA/SwitchManipulator",["osg/Notify"],function(e){var t=function(){this._manipulatorList=[],this._currentManipulator=undefined};return t.prototype={update:function(e){var t=this.getCurrentManipulator();if(t!==undefined)return t.update(e)},setNode:function(t){var n=this.getCurrentManipulator();if(n.setNode===undefined){e.log("manipulator has not setNode method");return}n.setNode(t)},getControllerList:function(){return this.getCurrentManipulator().getControllerList()},getNumManipulator:function(){return this._manipulatorList.length},addManipulator:function(e){this._manipulatorList.push(e),this._currentManipulator===undefined&&this.setManipulatorIndex(0)},getManipulatorList:function(){return this._manipulatorList},setManipulatorIndex:function(e){this._currentManipulator=e},getCurrentManipulatorIndex:function(){return this._currentManipulator},getCurrentManipulator:function(){var e=this._manipulatorList[this._currentManipulator];return e},reset:function(){this.getCurrentManipulator().reset()},computeHomePosition:function(){var e=this.getCurrentManipulator();e!==undefined&&e.computeHomePosition()},getInverseMatrix:function(){var e=this.getCurrentManipulator();if(e!==undefined)return e.getInverseMatrix()}},t}),define("osgGA/osgGA",["osgGA/FirstPersonManipulator","osgGA/FirstPersonManipulatorMouseKeyboardController","osgGA/Manipulator","osgGA/OrbitManipulator","osgGA/OrbitManipulatorGamePadController","osgGA/OrbitManipulatorHammerController","osgGA/OrbitManipulatorLeapMotionController","osgGA/OrbitManipulatorMouseKeyboardController","osgGA/SwitchManipulator"],function(e,t,n,r,i,s,o,u,a){var f={};return f.FirstPersonManipulator=e,f.getFirstPersonStandardMouseKeyboardControllerClass=function(){return t},f.getFirstPersonStandardMouseKeyboardControllerClass2=t,f.Manipulator=n,f.OrbitManipulator=r,f.getOrbitManipulatorGamePadController=function(){return i},f.getOrbitManipulatorHammerController=function(){return s},f.getOrbitManipulatorLeapMotionController=function(){return o},f.getOrbitManipulatorMouseKeyboardController=function(){return u},f.SwitchManipulator=a,f}),define("osgUtil/Composer",["osg/Notify","osg/Utils","osg/Node","osg/Depth","osg/Texture","osg/Camera","osg/FrameBufferObject","osg/Viewport","osg/Matrix","osg/Transform","osg/Uniform","osg/StateSet","osg/Program","osg/Shader","osg/Texture","osg/Shape"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,i,d){var v=function(){n.call(this),this._stack=[],this._renderToScreen=!1,this._dirty=!1;var e=function(){};e.prototype={update:function(e,t){e.isDirty()&&e.build()}},this.setUpdateCallback(new e),this.getOrCreateStateSet().setAttributeAndModes(new r("DISABLE"))};return v.prototype=t.objectInehrit(n.prototype,{dirty:function(){for(var e=0,t=this._stack.length;e<t;e++)this._stack[e].filter.dirty()},addPass:function(e,t,n){t instanceof i?this._stack.push({filter:e,texture:t}):t!==undefined&&n!==undefined?this._stack.push({filter:e,width:Math.floor(t),height:Math.floor(n)}):this._stack.push({filter:e})},renderToScreen:function(e,t){this._renderToScreen=!0,this._renderToScreenWidth=e,this._renderToScreenHeight=t},isDirty:function(){for(var e=0,t=this._stack.length;e<t;e++)if(this._stack[e].filter.isDirty())return!0;return!1},build:function(){var t=this;this.removeChildren();var n,r=this;this._stack.forEach(function(c,h,p){c.filter.isDirty()&&c.filter.build();var v=c.filter.getStateSet(),m,g;if(c.texture!==undefined)m=c.texture.getWidth(),g=c.texture.getHeight();else if(c.width!==undefined&&c.height!==undefined)m=c.width,g=c.height;else{var y=v.getTextureAttribute(0,"Texture");y===undefined&&e.warn("Composer can't find any information to setup texture output size"),m=y.getWidth(),g=y.getHeight()}var b=h===p.length-1&&r._renderToScreen===!0;if(!b&&v.getAttribute("Program")===undefined){p[h+1].filter.getStateSet().setTextureAttributeAndModes(0,v.getTextureAttribute(0,"Texture"));return}var w=new s;w.setClearMask(0);var E,S;b===!0?(m=r._renderToScreenWidth,g=r._renderToScreenHeight):(w.setRenderOrder(s.PRE_RENDER,0),E=c.texture,E===undefined&&(E=new i,E.setTextureSize(m,g)),w.attachTexture(o.COLOR_ATTACHMENT0,E,0));var x=new u(0,0,m,g),T=a.makeOrtho(-m/2,m/2,-g/2,g/2,-5,5,[]);w.setReferenceFrame(f.ABSOLUTE_RF),w.setViewport(x),w.setProjectionMatrix(T),w.setStateSet(c.filter.getStateSet()),S=d.createTexturedQuadGeometry(-m/2,-g/2,0,m,0,0,0,g,0),c.filter.buildGeometry!==undefined&&(S=c.filter.buildGeometry(S)),S.setName("composer layer"),n=E,h+1<p.length&&p[h+1].filter.getStateSet().setTextureAttributeAndModes(0,n),w.addChild(S),c.filter.getStateSet().addUniform(l.createFloat2([m,g],"RenderSize")),w.setName("Composer Pass"+h),t.addChild(w)}),this._resultTexture=n}}),v.Filter=function(){this._stateSet=new c,this._dirty=!0},v.Filter.prototype={getStateSet:function(){return this._stateSet},getOrCreateStateSet:function(){return this._stateSet},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty}},v.Filter.defaultVertexShader=["#ifdef GL_ES","precision highp float;","#endif","attribute vec3 Vertex;","attribute vec2 TexCoord0;","varying vec2 FragTexCoord0;","uniform mat4 ModelViewMatrix;","uniform mat4 ProjectionMatrix;","void main(void) {","  gl_Position = ProjectionMatrix * ModelViewMatrix * vec4(Vertex,1.0);","  FragTexCoord0 = TexCoord0;","}",""].join("\n"),v.Filter.defaultFragmentShaderHeader=["#ifdef GL_ES","precision highp float;","#endif","varying vec2 FragTexCoord0;","uniform vec2 RenderSize;","uniform sampler2D Texture0;",""].join("\n"),v.Filter.shaderUtils=["vec4 packFloatTo4x8(in float v) {","vec4 enc = vec4(1.0, 255.0, 65025.0, 160581375.0) * v;","enc = fract(enc);","enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);","return enc;","}"," ","vec4 pack2FloatTo4x8(in vec2 val) {"," const vec2 bitSh = vec2(256.0, 1.0);"," const vec2 bitMsk = vec2(0.0, 1.0/256.0);"," vec2 res1 = fract(val.x * bitSh);"," res1 -= res1.xx * bitMsk;"," vec2 res2 = fract(val.y * bitSh);"," res2 -= res2.xx * bitMsk;"," return vec4(res1.x,res1.y,res2.x,res2.y);","}"," ","float unpack4x8ToFloat( vec4 rgba ) {"," return dot( rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/160581375.0) );","}"," ","vec2 unpack4x8To2Float(in vec4 val) {"," const vec2 unshift = vec2(1.0/256.0, 1.0);"," return vec2(dot(val.xy, unshift), dot(val.zw, unshift));","}","vec2 encodeNormal (vec3 n)","{","    float f = sqrt(8.0*n.z+8.0);","    return n.xy / f + 0.5;","}","vec3 decodeNormal (vec2 enc)","{","    vec2 fenc = enc*4.0-2.0;","    float f = dot(fenc,fenc);","    float g = sqrt(1.0-f/4.0);","    vec3 n;","    n.xy = fenc*g;","    n.z = 1.0-f/2.0;","    return n;","}",""].join("\n"),v.Filter.Helper={getOrCreatePascalCoefficients:function(){var e=v.Filter.Helper.getOrCreatePascalCoefficients.cache;return e!==undefined?e:(e=function(e){var t=[[1]];for(var n=0;n<e-1;n++){var r=Math.pow(2,n),i=t[n],s=i.length,o=s+1,u=new Array(s);u[0]=1,u[o-1]=1;var a=1;for(var f=0;f<s-1;f++){var l=i[f]+i[f+1];u[a++]=l}t.push(u)}return function(){for(var e=0;e<t.length;e++){var n=t[e],r=Math.pow(2,e);for(var i=0;i<n.length;i++)n[i]=n[i]/r}}(),t}(20),v.Filter.Helper.getOrCreatePascalCoefficients.cache=e,e)}},v.Filter.Custom=function(e,t){v.Filter.call(this),this._fragmentShader=e,this._uniforms=t,this._vertexShader=v.Filter.defaultVertexShader},v.Filter.Custom.prototype=t.objectInehrit(v.Filter.prototype,{build:function(){var e=new h(new p("VERTEX_SHADER",this._vertexShader),new p("FRAGMENT_SHADER",this._fragmentShader)),t=this;if(this._uniforms){var n=0,r=this._fragmentShader.match(/uniform\s+\w+\s+\w+/g);if(r!==null)for(var i=0,s=r.length;i<s;i++){var o=r[i].match(/uniform\s+(\w+)\s+(\w+)/),u=o[1],a=o[2],f;this._uniforms[a]!==undefined&&(uniform_value=this._uniforms[a],u.search("sampler")!==-1?(this._stateSet.setTextureAttributeAndModes(n,uniform_value),f=l.createInt1(n,a),n++,this._stateSet.addUniform(f)):(l.isUniform(uniform_value)?f=uniform_value:f=l[u](this._uniforms[a],a),this._stateSet.addUniform(f)))}}this._stateSet.setAttributeAndModes(e),this._dirty=!1}}),v.Filter.AverageHBlur=function(e){v.Filter.call(this),e===undefined?this.setBlurSize(5):this.setBlurSize(e),this._pixelSize=1},v.Filter.AverageHBlur.prototype=t.objectInehrit(v.Filter.prototype,{setBlurSize:function(e){e%2!==1&&(e+=1),this._nbSamples=e,this.dirty()},setPixelSize:function(e){this._pixelSize=e,this.dirty()},getUVOffset:function(e){return"vec2(float("+e+"), 0.0)/RenderSize[0];"},getShaderBlurKernel:function(){var e=this._nbSamples,t=[];t.push(" pixel = texture2D(Texture0, FragTexCoord0 );"),t.push(" if (pixel.w == 0.0) { gl_FragColor = pixel; return; }"),t.push(" vec2 offset;");for(var n=1;n<Math.ceil(e/2);n++)t.push(" offset = "+this.getUVOffset(n*this._pixelSize)),t.push(" pixel += texture2D(Texture0, FragTexCoord0 + offset);"),t.push(" pixel += texture2D(Texture0, FragTexCoord0 - offset);");return t.push(" pixel /= float("+e+");"),t},build:function(){var e=this._nbSamples,t=v.Filter.defaultVertexShader,n=[v.Filter.defaultFragmentShaderHeader,"uniform float width;","void main (void)","{","  vec4 pixel;",this.getShaderBlurKernel().join("\n"),"  gl_FragColor = vec4(pixel);","}",""].join("\n"),r=new h(new p("VERTEX_SHADER",t),new p("FRAGMENT_SHADER",n));this._stateSet.getUniform("Texture0")===undefined&&this._stateSet.addUniform(l.createInt1(0,"Texture0")),this._stateSet.setAttributeAndModes(r),this._dirty=!1}}),v.Filter.AverageVBlur=function(e){v.Filter.AverageHBlur.call(this,e)},v.Filter.AverageVBlur.prototype=t.objectInehrit(v.Filter.AverageHBlur.prototype,{getUVOffset:function(e){return"vec2(0.0, float("+e+"))/RenderSize[1];"}}),v.Filter.BilateralHBlur=function(e){v.Filter.call(this),e===undefined&&(e={});var t=e.nbSamples,n=e.depthTexture,r=e.radius;t===undefined?this.setBlurSize(5):this.setBlurSize(t),this._depthTexture=n,this._radius=l.createFloat(1,"radius"),this._pixelSize=l.createFloat(1,"pixelSize"),this.setRadius(r)},v.Filter.BilateralHBlur.prototype=t.objectInehrit(v.Filter.prototype,{setBlurSize:function(e){e%2!==1&&(e+=1),this._nbSamples=e,this.dirty()},setPixelSize:function(e){this._pixelSize.get()[0]=e,this._pixelSize.dirty()},setRadius:function(e){this._radius.get()[0]=e,this._radius.dirty()},getUVOffset:function(e){return"vec2(0.0, float("+e+") * pixelSize )/RenderSize[1];"},getShaderBlurKernel:function(){var e=this._nbSamples,t=[];t.push(" pixel = texture2D(Texture0, FragTexCoord0 );"),t.push(" if (pixel.w <= 0.0001) { gl_FragColor = vec4(1.0); return; }"),t.push(" vec2 offset, tmpUV;"),t.push(" depth = getDepthValue(texture2D(Texture1, FragTexCoord0 ));");for(var n=1;n<Math.ceil(e/2);n++)t.push(" offset = "+this.getUVOffset(n)),t.push(" tmpUV =  FragTexCoord0 + offset;"),t.push(" tmpDepth = getDepthValue(texture2D(Texture1, tmpUV ));"),t.push(" if ( abs(depth-tmpDepth) < radius) {"),t.push("   pixel += texture2D(Texture0, tmpUV);"),t.push("   nbHits += 1.0;"),t.push(" }"),t.push(" tmpUV =  FragTexCoord0 - offset;"),t.push(" tmpDepth = getDepthValue(texture2D(Texture1, tmpUV ));"),t.push(" if ( abs(depth-tmpDepth) < radius) {"),t.push("   pixel += texture2D(Texture0, tmpUV);"),t.push("   nbHits += 1.0;"),t.push(" }");return t.push(" pixel /= nbHits;"),t},build:function(){var e=this._nbSamples,t=v.Filter.defaultVertexShader,n=[v.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform float width;","uniform mat4 projection;","uniform float radius;","uniform float pixelSize;","float znear,zfar,zrange;","",v.Filter.shaderUtils,"","float getDepthValue(vec4 v) {","  float depth = unpack4x8ToFloat(v);","  depth = depth*zrange+znear;","  return -depth;","}","void main (void)","{","  vec4 pixel;","  float depth, tmpDepth;","  znear = projection[3][2] / (projection[2][2]-1.0);","  zfar = projection[3][2] / (projection[2][2]+1.0);","  zrange = zfar-znear;","  float nbHits = 1.0;",this.getShaderBlurKernel().join("\n"),"  gl_FragColor = vec4(pixel);","}",""].join("\n"),r=new h(new p("VERTEX_SHADER",t),new p("FRAGMENT_SHADER",n));this._stateSet.getUniform("Texture0")===undefined&&this._stateSet.addUniform(l.createInt1(0,"Texture0")),this._stateSet.getUniform("Texture1")===undefined&&this._stateSet.addUniform(l.createInt1(1,"Texture1")),this._stateSet.addUniform(this._radius),this._stateSet.addUniform(this._pixelSize),this._stateSet.setTextureAttributeAndModes(1,this._depthTexture),this._stateSet.setAttributeAndModes(r),this._dirty=!1}}),v.Filter.BilateralVBlur=function(e){v.Filter.BilateralHBlur.call(this,e)},v.Filter.BilateralVBlur.prototype=t.objectInehrit(v.Filter.BilateralHBlur.prototype,{getUVOffset:function(e){return"vec2(float("+e+")*pixelSize,0.0)/RenderSize[0];"}}),v.Filter.InputTexture=function(e){v.Filter.call(this),this._stateSet.setTextureAttributeAndModes(0,e)},v.Filter.InputTexture.prototype=t.objectInehrit(v.Filter.prototype,{build:function(){this._dirty=!1}}),v.Filter.HBlur=function(e){v.Filter.call(this),e===undefined?this.setBlurSize(5):this.setBlurSize(e)},v.Filter.HBlur.prototype=t.objectInehrit(v.Filter.prototype,{setBlurSize:function(e){e%2!==1&&(e+=1),this._nbSamples=e,this.dirty()},getUVOffset:function(e){return"vec2(float("+e+"), 0.0)/RenderSize[0];"},build:function(){var e=this._nbSamples,t=v.Filter.defaultVertexShader,n=v.Filter.Helper.getOrCreatePascalCoefficients(),r=n[e-1],i=Math.floor(e/2),s=[];s.push(" pixel += float("+r[i]+")*texture2D(Texture0, FragTexCoord0 ).rgb;");var o=1;s.push(" vec2 offset;");for(var u=i+1;u<e;u++){var a=r[u];s.push(" offset = "+this.getUVOffset(u)),o++,s.push(" pixel += "+a+"*texture2D(Texture0, FragTexCoord0 + offset).rgb;"),s.push(" pixel += "+a+"*texture2D(Texture0, FragTexCoord0 - offset).rgb;")}var f=[v.Filter.defaultFragmentShaderHeader,"uniform float width;","void main (void)","{","  vec3 pixel;",s.join("\n"),"  gl_FragColor = vec4(pixel,1.0);","}",""].join("\n"),c=new h(new p("VERTEX_SHADER",t),new p("FRAGMENT_SHADER",f));this._stateSet.getUniform("Texture0")===undefined&&this._stateSet.addUniform(l.createInt1(0,"Texture0")),this._stateSet.setAttributeAndModes(c),this._dirty=!1}}),v.Filter.VBlur=function(e){v.Filter.HBlur.call(this)},v.Filter.VBlur.prototype=t.objectInehrit(v.Filter.HBlur.prototype,{getUVOffset:function(e){return"vec2(0.0, float("+e+"))/RenderSize[1];"}}),v.Filter.SobelFilter=function(){v.Filter.call(this),this._color=l.createFloat3([1,1,1],"color"),this._factor=l.createFloat(1,"factor")},v.Filter.SobelFilter.prototype=t.objectInehrit(v.Filter.prototype,{setColor:function(e){this._color.get()[0]=e[0],this._color.get()[1]=e[1],this._color.get()[2]=e[2],this._color.dirty()},setFactor:function(e){this._factor.get()[0]=e,this._factor.dirty()},build:function(){var e=this._stateSet,t=v.Filter.defaultVertexShader,n=["",v.Filter.defaultFragmentShaderHeader,"uniform vec3 color;","uniform float factor;","void main (void)","{","  float fac0 = 2.0;","  float fac1 = 1.0;","  float offsetx = 1.0/RenderSize[0];","  float offsety = 1.0/RenderSize[1];","  vec4 texel0 = texture2D(Texture0, FragTexCoord0 + vec2(offsetx, offsety));","  vec4 texel1 = texture2D(Texture0, FragTexCoord0 + vec2(offsetx, 0.0));","  vec4 texel2 = texture2D(Texture0, FragTexCoord0 + vec2(offsetx, -offsety));","  vec4 texel3 = texture2D(Texture0, FragTexCoord0 + vec2(0.0, -offsety));","  vec4 texel4 = texture2D(Texture0, FragTexCoord0 + vec2(-offsetx, -offsety));","  vec4 texel5 = texture2D(Texture0, FragTexCoord0 + vec2(-offsetx, 0.0));","  vec4 texel6 = texture2D(Texture0, FragTexCoord0 + vec2(-offsetx, offsety));","  vec4 texel7 = texture2D(Texture0, FragTexCoord0 + vec2(0.0, offsety));","  vec4 rowx = -fac0*texel5 + fac0*texel1 +  -fac1*texel6 + fac1*texel0 + -fac1*texel4 + fac1*texel2;","  vec4 rowy = -fac0*texel3 + fac0*texel7 +  -fac1*texel4 + fac1*texel6 + -fac1*texel2 + fac1*texel0;","  float mag = sqrt(dot(rowy,rowy)+dot(rowx,rowx));","  if (mag < 1.0/255.0) { discard; return; }","  mag *= factor;","  mag = min(1.0, mag);","  gl_FragColor = vec4(color*mag,mag);","}",""].join("\n"),r=new h(new p("VERTEX_SHADER",t),new p("FRAGMENT_SHADER",n));e.setAttributeAndModes(r),e.addUniform(this._color),e.addUniform(this._factor),e.addUniform(l.createInt1(0,"Texture0")),this._dirty=!1}}),v.Filter.BlendMix=function(){v.Filter.call(this);var e,t,n,r=0,i=1,s=this._stateSet;arguments.length===3?(e=arguments[0],t=arguments[1],n=arguments[2],r=1,i=2,s.setTextureAttributeAndModes(r,e)):arguments.length===2?(t=arguments[0],n=arguments[1]):arguments.length===1&&(t=arguments[0],n=.5),s.setTextureAttributeAndModes(i,t),s.addUniform(l.createInt1(r,"Texture0")),s.addUniform(l.createInt1(i,"Texture1")),this._mixValueUniform=l.createFloat1(n,"MixValue"),s.addUniform(mixValueUniform)},v.Filter.BlendMix=t.objectInehrit(v.Filter.prototype,{getBlendFactorUniform:function(){return this._mixValueUniform},build:function(){var e=this._stateSet,t=v.Filter.defaultVertexShader,n=["",v.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform float MixValue;","void main (void)","{","  gl_FragColor = mix(texture2D(Texture0,FragTexCoord0), texture2D(Texture1,FragTexCoord0),MixValue);","}",""].join("\n"),r=new h(new p("VERTEX_SHADER",t),new p("FRAGMENT_SHADER",n));e.setAttributeAndModes(r),this._dirty=!1}}),v.Filter.BlendMultiply=function(){v.Filter.call(this);var e=this._stateSet,t,n,r,i=0,s=1;arguments.length===2?(t=arguments[0],n=arguments[1],i=1,i=2,e.setTextureAttributeAndModes(i,t)):arguments.length===1&&(n=arguments[0]),e.setTextureAttributeAndModes(s,n),e.addUniform(l.createInt1(i,"Texture0")),e.addUniform(l.createInt1(s,"Texture1"))},v.Filter.BlendMultiply.prototype=t.objectInehrit(v.Filter.prototype,{build:function(){var e=v.Filter.defaultVertexShader,t=["",v.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform float MixValue;","void main (void)","{","  gl_FragColor = texture2D(Texture0,FragTexCoord0)*texture2D(Texture1,FragTexCoord0);","}",""].join("\n"),n=new h(new p("VERTEX_SHADER",e),new p("FRAGMENT_SHADER",t));this._stateSet.setAttributeAndModes(n),this._dirty=!1}}),v.Filter.SSAO=function(e){v.Filter.call(this);var t=this._stateSet,n=16,r=.05;e!==undefined&&(e.nbSamples!==undefined&&(n=e.nbSamples),e.radius!==undefined&&(r=e.radius));var i=e.normal,s=e.position;this._radius=r,this._nbSamples=n,this._noiseTextureSize=16,this._sceneRadius=2,t.addUniform(l.createFloat1(1,"Power")),t.addUniform(l.createFloat1(r,"Radius")),t.addUniform(l.createInt1(0,"Texture0")),t.addUniform(l.createInt1(1,"Texture1")),t.addUniform(l.createInt1(2,"Texture2")),t.addUniform(l.createFloat1(.1,"AngleLimit"));var o=i.getWidth(),u=i.getHeight();this._size=[o,u],t.setTextureAttributeAndModes(0,i),t.setTextureAttributeAndModes(1,s),this.initNoise()},v.Filter.SSAO.prototype=t.objectInehrit(v.Filter.prototype,{initNoise:function(){var e=this._noiseTextureSize,t=new Array(e*e*3);(function(t){for(var n=0;n<e*e;n++){var r,i,s;r=2*(Math.random()-.5),i=2*(Math.random()-.5),s=0;var o=Vec3.normalize([r,i,s],[]);t[n*3+0]=255*(o[0]*.5+.5),t[n*3+1]=255*(o[1]*.5+.5),t[n*3+2]=255*(o[2]*.5+.5)}})(t);var n=new i;n.setWrapS("REPEAT"),n.setWrapT("REPEAT"),n.setMinFilter("NEAREST"),n.setMagFilter("NEAREST"),n.setTextureSize(e,e),n.setImage(new Uint8Array(t),"RGB"),this._noiseTexture=n},setSceneRadius:function(e){this._sceneRadius=e,this.dirty()},setAngleLimit:function(e){var t=this._stateSet.getUniform("AngleLimit");t.get()[0]=e,t.dirty()},setNbSamples:function(e){if(e===this._nbSamples)return;this._nbSamples=Math.floor(e),this.dirty()},setRadius:function(e){var t=this._stateSet.getUniform("Radius");t.get()[0]=e,t.dirty()},setPower:function(e){var t=this._stateSet.getUniform("Power");t.get()[0]=e,t.dirty()},build:function(){var e=this._stateSet,t=this._nbSamples,n=new Array(t*4);(function(e){for(var n=0;n<t;n++){var r,i,s;r=2*(Math.random()-.5),i=2*(Math.random()-.5),s=Math.random();var o=Vec3.normalize([r,i,s],[]),u=Math.max(n/t,.1);u=.1+.9*u*u,e[n*3+0]=o[0],e[n*3+1]=o[1],e[n*3+2]=o[2],e[n*3+3]=u}})(n),e.setTextureAttributeAndModes(2,this._noiseTexture);var r=e.getUniform("noiseSampling");r===undefined?(r=l.createFloat2([this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize],"noiseSampling"),e.addUniform(r)):(r.set([this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize]),r.dirty());var i=["","#ifdef GL_ES","precision highp float;","#endif","attribute vec3 Vertex;","attribute vec2 TexCoord0;","varying vec2 FragTexCoord0;","uniform mat4 ModelViewMatrix;","uniform mat4 ProjectionMatrix;","void main(void) {","  gl_Position = ProjectionMatrix * ModelViewMatrix * vec4(Vertex,1.0);","  FragTexCoord0 = TexCoord0;","}",""].join("\n"),s=[];for(var o=0;o<t;o++)s.push("kernel["+o+"] = vec4("+n[o*3]+","+n[o*3+1]+", "+n[o*3+2]+", "+n[o*3+3]+");");s=s.join("\n");var u=this._sceneRadius*.002,a=this._sceneRadius*.05,f=(a-u)/200,c=["",v.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform sampler2D Texture2;","uniform mat4 projection;","uniform vec2 noiseSampling;","uniform float Power;","uniform float Radius;","uniform float AngleLimit;","#define NB_SAMPLES "+this._nbSamples,"float depth;","vec3 normal;","vec4 position;","vec4 kernel["+t+"];","mat3 computeBasis()","{","  vec2 uvrand = FragTexCoord0*noiseSampling;","  vec3 rvec = texture2D(Texture2, uvrand*2.0).xyz*2.0-vec3(1.0);","  vec3 tangent = normalize(rvec - normal * dot(rvec, normal));","  vec3 bitangent = cross(normal, tangent);","  mat3 tbn = mat3(tangent, bitangent, normal);","  return tbn;","}","void main (void)","{",s,"  position = texture2D(Texture1, FragTexCoord0);","  vec4 p = texture2D(Texture0, FragTexCoord0);","  depth = p.w;","  normal = vec3(p);","  if ( position.w == 0.0) {","     gl_FragColor = vec4(1.0,1.0,1.0,0.0);","     return;","  }",""," mat3 tbn = computeBasis();"," float occlusion = 0.0;"," for (int i = 0; i < NB_SAMPLES; i++) {","    vec3 vecKernel = vec3(kernel[i]);","    vecKernel[2] = max(AngleLimit,vecKernel[2]);","    vec3 sample = tbn * vecKernel;","    vec3 dir = sample;","    float w = dot(dir, normal);","    float dist = 1.0-kernel[i].w;","    w *= dist*dist*Power;","    sample = dir * float(Radius) + position.xyz;","    vec4 offset = projection * vec4(sample,1.0);","    offset.xy /= offset.w;","    offset.xy = offset.xy * 0.5 + 0.5;","    float sample_depth = texture2D(Texture1, offset.xy).z;","    float range_check = abs(sample.z - sample_depth) < float(Radius) ? 1.0 : 0.0;","    occlusion += (sample_depth > sample.z ? 1.0 : 0.0) * range_check*w;"," }"," occlusion = 1.0 - (occlusion / float(NB_SAMPLES));"," gl_FragColor = vec4(vec3(occlusion),1.0);","}",""].join("\n"),d=new h(new p("VERTEX_SHADER",i),new p("FRAGMENT_SHADER",c));e.setAttributeAndModes(d),this._dirty=!1}}),v.Filter.SSAO8=function(e){v.Filter.SSAO.call(this,e)},v.Filter.SSAO8.prototype=t.objectInehrit(v.Filter.SSAO.prototype,{buildGeometry:function(e){return e.getAttributes().TexCoord1=this._texCoord1,e},build:function(){var e=this._stateSet,t=this._nbSamples,n=new Array(t*4),r=this._angleLimit;(function(e){for(var n=0;n<t;n++){var r,i,s;r=2*(Math.random()-.5),i=2*(Math.random()-.5),s=Math.random();var o=Vec3.normalize([r,i,s],[]),u=Math.max(n/t,.1);u=.1+.9*u*u,e[n*3+0]=o[0],e[n*3+1]=o[1],e[n*3+2]=o[2],e[n*3+3]=u}})(n);var i=this._noiseTextureSize;e.setTextureAttributeAndModes(2,this._noiseTexture);var s=e.getUniform("noiseSampling");s===undefined?(s=l.createFloat2([this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize],"noiseSampling"),e.addUniform(s)):(s.set([this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize]),s.dirty());var o=["","#ifdef GL_ES","precision highp float;","#endif","attribute vec3 Vertex;","attribute vec2 TexCoord0;","attribute vec3 TexCoord1;","varying vec2 FragTexCoord0;","varying vec3 FragTexCoord1;","uniform mat4 ModelViewMatrix;","uniform mat4 ProjectionMatrix;","void main(void) {","  gl_Position = ProjectionMatrix * ModelViewMatrix * vec4(Vertex,1.0);","  FragTexCoord0 = TexCoord0;","  FragTexCoord1 = TexCoord1;","}",""].join("\n"),u=[];for(var a=0;a<t;a++)u.push("kernel["+a+"] = vec4("+n[a*3]+","+n[a*3+1]+", "+n[a*3+2]+", "+n[a*3+3]+");");u=u.join("\n");var f=this._sceneRadius*.002,c=this._sceneRadius*.05,d=(c-f)/200,m=["",v.Filter.defaultFragmentShaderHeader,"varying vec3 FragTexCoord1;","uniform sampler2D Texture1;","uniform sampler2D Texture2;","uniform mat4 projection;","uniform vec2 noiseSampling;","uniform float Power;","uniform float Radius;","uniform float AngleLimit;","#define NB_SAMPLES "+this._nbSamples,"float depth;","float znear, zfar, zrange;","vec3 normal;","vec3 position;","vec4 kernel["+t+"];",v.Filter.shaderUtils,"mat3 computeBasis()","{","  vec2 uvrand = FragTexCoord0*noiseSampling;","  //uvrand = rand(gl_FragCoord.xy);","  vec3 rvec = texture2D(Texture2, uvrand*2.0).xyz*2.0-vec3(1.0);","  //vec3 rvec = normalize(vec3(uvrand,0.0));","  vec3 tangent = normalize(rvec - normal * dot(rvec, normal));","  vec3 bitangent = cross(normal, tangent);","  mat3 tbn = mat3(tangent, bitangent, normal);","  return tbn;","}","float getDepthValue(vec4 v) {","  float depth = unpack4x8ToFloat(v);","  depth = depth*zrange+znear;","  //depth = depth*zrange;","  return -depth;","}","void main (void)","{",u,"  vec4 p = texture2D(Texture0, FragTexCoord0);","  if (dot(p,p) < 0.001) { ","     gl_FragColor = vec4(1.0,1.0,1.0,0.0);","     return;","  }","  znear = projection[3][2] / (projection[2][2]-1.0);","  zfar = projection[3][2] / (projection[2][2]+1.0);","  zrange = zfar-znear;","  depth = getDepthValue(texture2D(Texture1, FragTexCoord0));","  if ( -depth < znear) {","     gl_FragColor = vec4(1.0,1.0,1.0,0.0);","     return;","  }","  normal = decodeNormal(unpack4x8To2Float(p));","  position = -FragTexCoord1*depth;","  position.z = -position.z;",""," mat3 tbn = computeBasis();"," float occlusion = 0.0;"," for (int i = 0; i < NB_SAMPLES; i++) {","    vec3 vecKernel = vec3(kernel[i]);","    vecKernel[2] = max(AngleLimit,vecKernel[2]);","    vec3 sample = tbn * vec3(vecKernel);","    vec3 dir = sample;","    float w = dot(dir, normal);","    float dist = 1.0-kernel[i].w;","    w *= dist*dist*Power;","    sample = dir * float(Radius) + position.xyz;","    vec4 offset = projection * vec4(sample,1.0);","    offset.xy /= offset.w;","    offset.xy = offset.xy * 0.5 + 0.5;","    float sample_depth = getDepthValue(texture2D(Texture1, offset.xy));","    float range_check = abs(sample.z - sample_depth) < float(Radius) ? 1.0 : 0.0;","    occlusion += (sample_depth > sample.z ? 1.0 : 0.0) * range_check*w;"," }"," occlusion = 1.0 - (occlusion / float(NB_SAMPLES));"," gl_FragColor = vec4(vec3(occlusion),1.0);","}",""].join("\n"),g=new h(new p("VERTEX_SHADER",o),new p("FRAGMENT_SHADER",m));e.setAttributeAndModes(g),this._dirty=!1}}),v}),define("osgUtil/TriangleIntersect",["osg/Notify","osg/Vec3"],function(e,t){var n=function(e,t,n,r,i,s,o,u){this.index=e,this.normal=t,this.r1=n,this.v1=r,this.r2=i,this.v2=s,this.r3=o,this.v3=u};return TriangleIntersect=function(){this.hits=[],this.nodePath=[]},TriangleIntersect.prototype={setNodePath:function(e){this.nodePath=e},set:function(e,t){this.start=e,this.end=t,this.dir=Vec3.sub(t,e,[]),this.length=Vec3.length(this.dir);var n=1/this.length;Vec3.mult(this.dir,n,this.dir)},applyDrawElementsTriangles:function(e,t,n){var r=[],i=[],s=[],o,u,a;for(var f=0;f<e;f+=3)o=n[f]*3,r[0]=t[o],r[1]=t[o+1],r[2]=t[o+2],u=n[f+1]*3,i[0]=t[u],i[1]=t[u+1],i[2]=t[u+2],a=n[f+2]*3,s[0]=t[a],s[1]=t[a+1],s[2]=t[a+2],this.intersect(r,i,s)},applyDrawElementsTriangleStrip:function(e,t,n){var r=[],i=[],s=[],o,u,a;for(var f=2,l=0;f<e;f++,l++)f%2?(o=n[l]*3,u=n[l+2]*3,a=n[l+1]*3):(o=n[l]*3,u=n[l+1]*3,a=n[l+2]*3),r[0]=t[o],r[1]=t[o+1],r[2]=t[o+2],i[0]=t[u],i[1]=t[u+1],i[2]=t[u+2],s[0]=t[a],s[1]=t[a+1],s[2]=t[a+2],this.intersect(r,i,s)},applyDrawElementsTriangleFan:function(e,t,n){var r=[],i=[],s=[],o=n[0]*3;r[0]=t[o],r[1]=t[o+1],r[2]=t[o+2];var u,a;for(var f=2,l=1;f<e;f++,l++)u=n[l]*3,a=n[l+1]*3,i[0]=t[u],i[1]=t[u+1],i[2]=t[u+2],s[0]=t[a],s[1]=t[a+1],s[2]=t[a+2],this.intersect(r,i,s)},applyDrawArraysTriangles:function(e,t,n){var r=[],i=[],s=[];for(var o=e;o<t;o+=9)r[0]=n[o],r[1]=n[o+1],r[2]=n[o+2],i[0]=n[o+3],i[1]=n[o+4],i[2]=n[o+5],s[0]=n[o+6],s[1]=n[o+7],s[2]=n[o+8],this.intersect(r,i,s)},applyDrawArraysTriangleStrip:function(e,t,n){var r=[],i=[],s=[],o,u,a;for(var f=2,l=e;f<t;f++,l++)f%2?(o=l*3,u=(l+2)*3,a=(l+1)*3):(o=l*3,u=(l+1)*3,a=(l+2)*3),r[0]=n[o],r[1]=n[o+1],r[2]=n[o+2],i[0]=n[u],i[1]=n[u+1],i[2]=n[u+2],s[0]=n[a],s[1]=n[a+1],s[2]=n[a+2],this.intersect(r,i,s)},applyDrawArraysTriangleFan:function(e,t,n){var r=[],i=[],s=[],o=e*3;r[0]=n[o],r[1]=n[o+1],r[2]=n[o+2];var u,a;for(var f=2,l=e+1;f<t;f++,l++)u=l*3,a=(l+1)*3,i[0]=n[u],i[1]=n[u+1],i[2]=n[u+2],s[0]=n[a],s[1]=n[a+1],s[2]=n[a+2],this.intersect(r,i,s)},apply:function(e){if(!e.getAttributes().Vertex)return;var t,n,r=e.getAttributes().Vertex.getElements();this.index=0;for(var i=0,s=e.primitives.length;i<s;i++){t=e.primitives[i];if(t.getIndices!==undefined){var o=t.indices.getElements();switch(t.getMode()){case gl.TRIANGLES:this.applyDrawElementsTriangles(t.getCount(),r,o);break;case gl.TRIANGLE_STRIP:this.applyDrawElementsTriangleStrip(t.getCount(),r,o);break;case gl.TRIANGLE_FAN:this.applyDrawElementsTriangleFan(t.getCount(),r,o)}}else switch(t.getMode()){case gl.TRIANGLES:this.applyDrawArraysTriangles(t.getFirst(),t.getCount(),r);break;case gl.TRIANGLE_STRIP:this.applyDrawArraysTriangleStrip(t.getFirst(),t.getCount(),r);break;case gl.TRIANGLE_FAN:this.applyDrawArraysTriangleFan(t.getFirst(),t.getCount(),r)}}},intersect:function(t,r,i){this.index++;if(t==r||r==i||t==i)return;var s=Vec3.sub(r,t,[]),o=Vec3.cross(s,this.dir,[]),u=Vec3.dot(Vec3.sub(this.start,t,[]),o),a=Vec3.dot(Vec3.sub(i,t,[]),o);if(a>=0){if(u<0)return;if(u>a)return}else{if(u>0)return;if(u<a)return}var f=Vec3.sub(i,r,[]),l=Vec3.cross(f,this.dir,[]),c=Vec3.dot(Vec3.sub(this.start,r,[]),l),h=Vec3.dot(Vec3.sub(t,r,[]),l);if(h>=0){if(c<0)return;if(c>h)return}else{if(c>0)return;if(c<h)return}var p=Vec3.sub(t,i,[]),d=Vec3.cross(p,this.dir,[]),v=Vec3.dot(Vec3.sub(this.start,i,[]),d),m=Vec3.dot(Vec3.sub(r,i,[]),d);if(m>=0){if(v<0)return;if(v>m)return}else{if(v>0)return;if(v<m)return}var g;if(u===0)g=0;else{if(a===0)return;g=u/a}var y;if(c===0)y=0;else{if(h===0)return;y=c/h}var b;if(v===0)b=0;else{if(m===0)return;b=v/m}var w=y+b+g;if(w!==1){if(w===0)return;var E=1/w;y*=E,b*=E,g*=E}var S=[];Vec3.add(Vec3.mult(t,y,[]),Vec3.mult(r,b,[]),S),Vec3.add(Vec3.mult(i,g,[]),S,S);if(!Vec3.valid(S)){e.log("Warning: TriangleIntersect "),e.log("hit:     "+S),e.log("         "+t),e.log("         "+r),e.log("         "+i);return}var x=Vec3.dot(Vec3.sub(S,this.start,[]),this.dir);if(x<0)return;if(x>this.length)return;var T=Vec3.cross(s,f,[]);Vec3.normalize(T,T);var N=x/this.length,C=[];C[0]=this.start[0]*(1-N)+this.end[0]*N,C[1]=this.start[1]*(1-N)+this.end[1]*N,C[2]=this.start[2]*(1-N)+this.end[2]*N,this.hits.push({ratio:N,nodepath:this.nodePath.slice(0),triangleHit:new n(this.index-1,T,y,t,b,r,g,i),point:C}),this.hit=!0}},TriangleIntersect}),define("osgUtil/IntersectVisitor",["osg/Utils","osg/NodeVisitor","osg/Matrix","osg/Vec3","osgUtil/TriangleIntersect"],function(e,t,n,r,i){var s=function(){t.call(this),this.matrix=[],this.hits=[],this.nodePath=[]};return s.prototype=e.objectInehrit(t.prototype,{addLineSegment:function(e,t){this.start=e,this.end=t},intersectSegmentWithSphere:function(e,t,n){var i=r.sub(e,n.center),s=r.length2(i)-n.radius*n.radius;if(s<0)return!0;var o=r.sub(t,e),u=r.length2(o),a=r.dot(i,o)*2,f=a*a-4*u*s;if(f<0)return!1;f=Math.sqrt(f);var l=.5*u,c=(-a-f)*l,h=(-a+f)*l;return c<=0&&h<=0?!1:c>=1&&h>=1?!1:!0},pushModelMatrix:function(e){if(this.matrix.length>0){var t=n.copy(this.matrix[this.matrix.length-1]);n.preMult(t,e),this.matrix.push(t)}else this.matrix.push(e)},getModelMatrix:function(){return this.matrix.length===0?n.makeIdentity([]):this.matrix[this.matrix.length-1]},popModelMatrix:function(){return this.matrix.pop()},getWindowMatrix:function(){return this.windowMatrix},getProjectionMatrix:function(){return this.projectionMatrix},getViewMatrix:function(){return this.viewMatrix},intersectSegmentWithGeometry:function(e,t,n){ti=new i,ti.setNodePath(this.nodePath),ti.set(e,t),ti.apply(n);var r=ti.hits.length;if(r>0){for(var s=0;s<r;s++)this.hits.push(ti.hits[s]);return!0}return!1},pushCamera:function(e){this.projectionMatrix=e.getProjectionMatrix(),this.viewMatrix=e.getViewMatrix();var t=e.getViewport();t!==undefined&&(this.windowMatrix=t.computeWindowMatrix())},applyCamera:function(e){this.pushCamera(e),this.traverse(e)},applyNode:function(e){e.getMatrix&&this.pushModelMatrix(e.getMatrix());if(e.primitives){var t=[];n.copy(this.getWindowMatrix(),t),n.preMult(t,this.getProjectionMatrix()),n.preMult(t,this.getViewMatrix()),n.preMult(t,this.getModelMatrix());var r=[],i=n.inverse(t,r);if(!i)return;var s=n.transformVec3(r,this.start,new Array(3)),o=n.transformVec3(r,this.end,new Array(3));this.intersectSegmentWithGeometry(s,o,e)}e.traverse&&this.traverse(e),e.getMatrix&&this.popModelMatrix()},apply:function(e){if(this.enterNode(e)===!1)return;e.getViewMatrix?this.applyCamera(e):this.applyNode(e)},enterNode:function(e){var t=e.boundingSphere;return t!==undefined&&!this.intersectSegmentWithSphere?!1:!0}}),s}),define("osgUtil/ShaderParameterVisitor",["osg/Notify","osg/Utils","osg/Uniform","osg/NodeVisitor"],function(e,t,n,r){var i=function(e){e!==undefined&&(e.object!==undefined&&e.field!==undefined&&this.createInternalSlider(param),this._uniform=this.createInternalSliderUniform(param))};i.prototype={setTargetHTML:function(e){this.parent=e},addToDom:function(e){var t=document.createElement("div");t.innerHTML=e,this.parent.appendChild(t)},getValue:function(e){if(window.localStorage){var t=window.localStorage.getItem(e);return t}return null},setValue:function(e,t){window.localStorage&&window.localStorage.setItem(e,t)},createHTMLSlider:function(e,t,n,r){var i='<div>NAME [ MIN - MAX ] <input type="range" min="MIN" max="MAX" value="VALUE" step="STEP" onchange="ONCHANGE" /><span id="UPDATE"></span></div>',s=e.min,o=e.max,u=e.step,a=n,f=r,l=f+"(this.value)";return i=i.replace(/MIN/g,s),i=i.replace(/MAX/g,o+u),i=i.replace("STEP",u),i=i.replace("VALUE",t),i=i.replace(/NAME/g,a),i=i.replace(/UPDATE/g,f),i=i.replace("ONCHANGE",l),i},createUniformFunction:function(t,n,r,i,s){return self=this,function(){var o=n,u=r,a=i,f=s,l=function(n){a.get()[u]=n,a.dirty(),e.debug(o+" value "+n),document.getElementById(s).innerHTML=Number(n).toFixed(4),self.setValue(f,n),t.onchange!==undefined&&t.onchange(a.get())};return l}()},createFunction:function(t,n,r,i,s,o){return self=this,function(){var u=n,a=r,f=s,l=o,c=i,h=function(n){typeof n=="string"&&(n=parseFloat(n)),typeof i[f]=="number"?c[f]=n:c[f][r]=n,e.debug(u+" value "+n),document.getElementById(o).innerHTML=Number(n).toFixed(4),self.setValue(l,n),t.onchange!==undefined&&t.onchange(c[f])};return h}()},getCallbackName:function(e,t){return"change_"+t+"_"+e},copyDefaultValue:function(e){var t=e.value;return Array.isArray(e.value)?t=e.value.slice():t=[t],t},createInternalSliderUniform:function(t){var r=t.value,i=t.uniform;if(i===undefined){var s=t.type;s=s.charAt(0).toUpperCase()+s.slice(1),i=n["create"+s](r,t.name)}var o=this.getCallbackName(t.name,t.id),u=r.length;for(var a=0;a<u;a++){var f=a.toString(),l=t.name+f,c=o+f,h=r[a],p=this.getValue(c);p!==null?h=p:t.uniform&&t.uniform.get()[a]!==undefined&&(h=t.uniform.get()[a]);var d=this.createHTMLSlider(t,h,l,c);this.addToDom(d),window[c]=this.createUniformFunction(t,l,a,i,c),e.log(l+" "+h),window[c](h)}return this.uniform=i,i},createInternalSlider:function(t){var n=t.value,r=t.name,i=t.id,s=n.length,o=this.getCallbackName(r,i),u=t.object,a=t.field;for(var f=0;f<s;f++){var l=f.toString(),c=r+l,h=o+l,p=n[f],d=this.getValue(h);d!==null?p=d:typeof u[a]=="number"?p=u[a]:p=u[a][f];var v=this.createHTMLSlider(t,p,c,h);this.addToDom(v),window[h]=this.createFunction(t,c,f,u,a,h),e.log(c+" "+p),window[h](p)}},createSlider:function(e){return e.html!==undefined&&this.setTargetHTML(e.html),e.id===undefined&&(e.id=e.name),e.value=this.copyDefaultValue(e),e.type!==undefined?this.createInternalSliderUniform(e):(e.object===undefined&&(e.object={data:e.value},e.field="data"),this.createInternalSlider(e))}};var s=function(){r.call(this),this.arraySlider=new i,this.setTargetHTML(document.body)};return s.createSlider=function(e){(new i).createSlider(e)},s.prototype=t.objectInehrit(r.prototype,{setTargetHTML:function(e){this.targetHTML=e,this.arraySlider.setTargetHTML(this.targetHTML)},getUniformList:function(e,t){var n="(uniform)",r=".*?",i="((?:[a-z][a-z]+))",s=".*?",o="((?:[a-z][a-z]+))",u=".*?",a=".",f=".*?",l=".",c=".*?",h="(.)",p="(.)",d=".*?",v="(\\{.*?\\})",m=new RegExp(n+r+i+s+o+u+a+f+l+c+h+p+d+v,["g"]),g=e.match(m),y=t;if(g!==null){var b=new RegExp(n+r+i+s+o+u+a+f+l+c+h+p+d+v,["i"]);for(var w=0,E=g.length;w<E;w++){var S=g[w].match(b);if(S!==null){var x=S[1],T=S[2],N=S[3],C=S[4],k=S[5],L=S[6],A=JSON.parse(L);A.type=T,A.name=N;var O=A.value;A.value=function(){return O},y[N]=A}}}return y},getUniformFromStateSet:function(e,t){var n=e.getUniformList();if(!n)return;var r=Object.keys(t);for(var i=0,s=r.length;i<s;i++){var o=r[i];n[o]!==undefined&&t[o].uniform===undefined&&(t[o].uniform=n[o].object)}},findExistingUniform:function(e,n){var i=function(){r.call(this,r.TRAVERSE_PARENTS)};i.prototype=t.objectInehrit(r.prototype,{setUniformMap:function(e){this.uniformMap=e},apply:function(e){var t=e.getStateSet();t&&s.prototype.getUniformFromStateSet(t,this.uniformMap),this.traverse(e)}});var o=new i;o.setUniformMap(n),e.accept(o)},applyProgram:function(t,n){var r=n.getAttribute("Program"),i=r.getName(),s=r.getVertexShader().getText(),o={};this.getUniformList(r.getVertexShader().getText(),o),this.getUniformList(r.getFragmentShader().getText(),o);var u=Object.keys(o);if(i===undefined){var a=function(e){var t=0,n=0;if(e.length===0)return t;for(c=0;c<e.length;c++)n=e.charCodeAt(c),t=(t<<5)-t+n,t&=t;return t<0&&(t=-t),t},f=u.join("");i=a(f).toString()}this.findExistingUniform(t,o);var l=!1;for(var c=0;c<u.length;c++){var h=u[c],p=o[h],d=p.type,v=p.name;p.id=i;var m=this.arraySlider.createSlider(p);p.uniform===undefined&&m&&n.addUniform(m),l=!0}if(l){var g=document.createElement("div");g.innerHTML="<p> </p>",this.targetHTML.appendChild(g)}e.log(o)},applyStateSet:function(e,t){t.getAttribute("Program")!==undefined&&this.applyProgram(e,t)},apply:function(e){var t=this.targetHTML;if(t===undefined||t===null)return;var n=e.getStateSet();n!==undefined&&this.applyStateSet(e,n),this.traverse(e)}}),s}),define("osgUtil/osgUtil",["osgUtil/Composer","osgUtil/IntersectVisitor","osgUtil/ShaderParameterVisitor","osgUtil/TriangleIntersect"],function(e,t,n,r){var i={};return i.Composer=e,i.IntersectVisitor=t,i.ShaderParameterVisitor=n,i.TriangleIntersect=r,i}),define("osgViewer/View",["osg/Camera","osg/Node","osg/FrameStamp","osg/Material","osg/Depth","osg/BlendFunc","osg/CullFace","osg/Viewport","osg/Matrix","osg/Light"],function(e,t,n,r,i,s,o,u,a,f){var l=function(){this._graphicContext=undefined,this._camera=new e,this._scene=new t,this._sceneData=undefined,this._frameStamp=new n,this._lightingMode=undefined,this._manipulator=undefined,this.setLightingMode(l.LightingMode.HEADLIGHT),this._scene.getOrCreateStateSet().setAttributeAndMode(new r),this._scene.getOrCreateStateSet().setAttributeAndMode(new i),this._scene.getOrCreateStateSet().setAttributeAndMode(new s),this._scene.getOrCreateStateSet().setAttributeAndMode(new o)};return l.LightingMode={NO_LIGHT:0,HEADLIGHT:1,SKY_LIGHT:2},l.prototype={setGraphicContext:function(e){this._graphicContext=e},getGraphicContext:function(){return this._graphicContext},setUpView:function(e){var t=e.width!==0?e.width:800,n=e.height!==0?e.height:600,r=t/n;this._camera.setViewport(new u(0,0,t,n)),a.makeLookAt([0,0,-10],[0,0,0],[0,1,0],this._camera.getViewMatrix()),a.makePerspective(55,r,1,1e3,this._camera.getProjectionMatrix())},computeIntersections:function(e,t,n){n===undefined&&(n=-1);var r=new IntersectVisitor;return r.setTraversalMask(n),r.addLineSegment([e,t,0],[e,t,1]),r.pushCamera(this._camera),this._sceneData.accept(r),r.hits},setFrameStamp:function(e){this._frameStamp=e},getFrameStamp:function(){return this._frameStamp},setCamera:function(e){this._camera=e},getCamera:function(){return this._camera},setSceneData:function(e){this._scene.removeChildren(),this._scene.addChild(e),this._sceneData=e},getSceneData:function(){return this._sceneData},getScene:function(){return this._scene},getManipulator:function(){return this._manipulator},setManipulator:function(e){this._manipulator=e},getLight:function(){return this._light},setLight:function(e){this._light=e,this._lightingMode!==l.LightingMode.NO_LIGHT&&this._scene.getOrCreateStateSet().setAttributeAndMode(this._light)},getLightingMode:function(){return this._lightingMode},setLightingMode:function(e){this._lightingMode!==e&&(this._lightingMode=e,this._lightingMode!==l.LightingMode.NO_LIGHT?this._light||(this._light=new f,this._light.setAmbient([.2,.2,.2,1]),this._light.setDiffuse([.8,.8,.8,1]),this._light.setSpecular([.5,.5,.5,1])):this._light=undefined)}},l}),define("osgViewer/eventProxy/GamePad",["osg/Notify"],function(e){var t=function(e){this._viewer=e,this._type="GamePad",this._enable=!0};return t.prototype={init:function(e){var t=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads;if(!t)return},isValid:function(){if(!this._enable)return!1;var e=this._viewer.getManipulator();if(!e)return!1;var t=e.getControllerList();return t[this._type]?!0:!1},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},webkitGamepadPoll:function(){var e=this,t=navigator.webkitGetGamepads&&navigator.webkitGetGamepads()||navigator.webkitGamepads;if(!t)return;t[0]?(this._gamepad||this.onGamepadConnect({gamepad:t[0]}),this._gamepad=t[0]):this._gamepad&&this.onGamepadDisconnect({gamepad:this._gamepad})},onGamepadConnect:function(t){this._gamepad=t.gamepad,e.log("Detected new gamepad!",this._gamepad)},onGamepadDisconnect:function(t){this._gamepad=!1,e.log("Gamepad disconnected",this._gamepad)},getGamePad:function(){return this._gamepad},update:function(){this.webkitGamepadPoll();if(!this._gamepad)return;var e=this.getManipulatorController();e.update&&e.update(this)}},t}),define("osgViewer/eventProxy/Hammer",[],function(){var e=function(e){this._enable=!0,this._viewer=e,this._type="Hammer",this._eventNode=undefined};return e.prototype={init:function(e){var t={prevent_default:!0,drag_max_touches:2,transform_min_scale:.08,transform_min_rotation:180,transform_always_block:!0,hold:!1,release:!1,swipe:!1,tap:!1};this._eventNode=e.eventNode,this._eventNode&&(this._hammer=new Hammer(this._eventNode,t))},isValid:function(){return this._enable&&this._viewer.getManipulator()&&this._viewer.getManipulator().getControllerList()[this._type]?!0:!1},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},update:function(){if(!this.isValid())return;this.getManipulatorController().setEventProxy(this._hammer)}},e}),define("osgViewer/eventProxy/LeapMotion",["osg/Notify"],function(e){var t=function(e){this._viewer=e,this._type="LeapMotion",this._enable=!0};return t.prototype={init:function(t){var n=document.getElementById(t.id),r=this;this._controller=new Leap.Controller({enableGestures:t.gestures||!0,tryReconnectOnDisconnect:!1}),this._controller.on("ready",function(){t.readyCallback&&t.readyCallback(r._controller),r._leapMotionReady=!0,e.info("leapmotion ready")}),this._controller.loop(this._update.bind(this))},isValid:function(){if(!this._enable)return!1;var e=this._viewer.getManipulator();if(!e)return!1;var t=e.getControllerList();return t[this._type]?!0:!1},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},_update:function(e){if(!e.valid||!this.isValid())return;var t=this.getManipulatorController();t.update&&t.update(e)}},t}),define("osgViewer/eventProxy/StandardMouseKeyboard",[],function(){var e=function(e){this._enable=!0,this._viewer=e,this._type="StandardMouseKeyboard",this._mouseEventNode=undefined,this._wheelEventNode=undefined,this._keyboardEventNode=undefined,this._eventList=["mousedown","mouseup","mousemove","dblclick"],this._mousePosition=[0,0]};return e.prototype={init:function(e){this.removeEventListeners(this._mouseEventNode,this._wheelEventNode,this._keyboardEventNode);var t=e.mouseEventNode,n=e.wheelEventNode||t,r=e.keyboardEventNode||t;this.addEventListeners(t,n,r),this._mouseEventNode=t,this._wheelEventNode=n,this._keyboardEventNode=r},addEventListeners:function(e,t,n){if(e)for(var r=0,i=this._eventList.length;r<i;r++){var s=this._eventList[r];this[s]&&e.addEventListener(s,this[s].bind(this),!1)}t&&(t.addEventListener("DOMMouseScroll",this.mousewheel.bind(this),!1),t.addEventListener("mousewheel",this.mousewheel.bind(this),!1)),n&&(n.addEventListener("keydown",this.keydown.bind(this),!1),n.addEventListener("keyup",this.keyup.bind(this),!1))},removeEventListeners:function(e,t,n){if(e)for(var r=0,i=this._eventList.length;r<i;r++){var s=this._eventList[r];this[s]&&e.removeEventListener(s,this[s])}t&&(t.removeEventListener("DOMMouseScroll",this.mousewheel),t.removeEventListener("mousewheel",this.mousewheel)),n&&(n.removeEventListener("keydown",this.keydown),n.removeEventListener("keyup",this.keyup))},isValid:function(){return this._enable&&this._viewer.getManipulator()&&this._viewer.getManipulator().getControllerList()[this._type]?!0:!1},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},keyup:function(e){if(!this.isValid())return;if(this.getManipulatorController().keyup)return this.getManipulatorController().keyup(e)},keydown:function(e){if(!this.isValid())return;if(this.getManipulatorController().keydown)return this.getManipulatorController().keydown(e)},mousedown:function(e){if(!this.isValid())return;if(this.getManipulatorController().mousedown)return this.getManipulatorController().mousedown(e)},mouseup:function(e){if(!this.isValid())return;if(this.getManipulatorController().mouseup)return this.getManipulatorController().mouseup(e)},mousemove:function(e){if(!this.isValid())return;if(this.getManipulatorController().mousemove)return this.getManipulatorController().mousemove(e)},dblclick:function(e){if(!this.isValid())return;if(this.getManipulatorController().dblclick)return this.getManipulatorController().dblclick(e)},mousewheel:function(e){if(!this.isValid())return;var t=this.getManipulatorController();if(!t.mousewheel)return;var n=e||window.event,r=[].slice.call(arguments,1),i=0,s=!0,o=0,u=0;return e.type="mousewheel",e.wheelDelta&&(i=e.wheelDelta/120),e.detail&&(i=-e.detail/3),u=i,n.axis!==undefined&&n.axis===n.HORIZONTAL_AXIS&&(u=0,o=-1*i),n.wheelDeltaY!==undefined&&(u=n.wheelDeltaY/120),n.wheelDeltaX!==undefined&&(o=-1*n.wheelDeltaX/120),r.unshift(e,i,o,u),this.getManipulatorController().mousewheel.apply(t,r)},divGlobalOffset:function(e){var t=0,n=0;t=e.offsetLeft,n=e.offsetTop;var r=document.getElementsByTagName("body")[0];while(e.offsetParent&&e!=r)t+=e.offsetParent.offsetLeft,n+=e.offsetParent.offsetTop,e=e.offsetParent;return this._mousePosition[0]=t,this._mousePosition[1]=n,this._mousePosition},getPositionRelativeToCanvas:function(e,t){var n=e.target,r,i;if(e.pageX||e.pageY)r=e.pageX,i=e.pageY;else if(e.clientX||e.clientY)r=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=e.clientY+document.body.scrollTop+document.documentElement.scrollTop;var s=this.divGlobalOffset(n);return r-=s[0],i=n.height-(i-s[1]),isNaN(r)||isNaN(i),t===undefined&&(t=this._mousePosition),t[0]=r,t[1]=i,t},update:function(){if(!this.isValid())return;this.getManipulatorController().setEventProxy(this)}},e}),define("osgViewer/eventProxy/EventProxy",["osgViewer/eventProxy/GamePad","osgViewer/eventProxy/Hammer","osgViewer/eventProxy/LeapMotion","osgViewer/eventProxy/StandardMouseKeyboard"],function(e,t,n,r){return{GamePad:e,Hammer:t,LeapMotion:n,StandardMouseKeyboard:r}}),define("osgViewer/Viewer",["osg/Notify","osg/Utils","osg/UpdateVisitor","osg/CullVisitor","osgUtil/osgUtil","osgViewer/View","osg/RenderStage","osg/StateGraph","osg/Matrix","osg/State","osgGA/OrbitManipulator","osgViewer/eventProxy/EventProxy"],function(e,t,n,r,i,s,o,u,a,f,l,c){return function(){var t=function(){var e=[],t,n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var r=0;r<n.length;r++){t=n[r].split("=");var i=t[0].toLowerCase();e.push(i);var s=t[1];s===undefined&&(s="1"),e[i]=s.toLowerCase()}return e},n=t();if(n.log!==undefined){var r=n.log.toLowerCase();switch(r){case"debug":e.setNotifyLevel(e.DEBUG);break;case"info":e.setNotifyLevel(e.INFO);break;case"notice":e.setNotifyLevel(e.NOTICE);break;case"warn":e.setNotifyLevel(e.WARN);break;case"error":e.setNotifyLevel(e.ERROR);break;case"html":(function(){var e=[],t=document.createElement("div"),n=document.createElement("pre");document.addEventListener("DOMContentLoaded",function(){document.body.appendChild(t),t.appendChild(n)});var r=function(t){e.unshift(t),n.innerHTML=e.join("\n")};t.style.overflow="hidden",t.style.position="absolute",t.style.zIndex="10000",t.style.height="100%",t.style.maxWidth="600px",n.style.overflow="scroll",n.style.width="105%",n.style.height="100%",n.style.fontSize="10px",["log","error","warn","info","debug"].forEach(function(e){window.console[e]=r})})()}}}(),Viewer=function(o,u,a){s.call(this),u===undefined&&(u={antialias:!0}),this._options=u,gl=WebGLUtils.setupWebGL(o,u,a);var f=this;o.addEventListener("webglcontextlost",function(e){f.contextLost(),e.preventDefault()},!1),o.addEventListener("webglcontextrestored",function(){f.contextRestored()},!1);if(e.reportWebGLError||u.reportWebGLError)gl=WebGLDebugUtils.makeDebugContext(gl);if(!gl)throw"No WebGL implementation found";this.setGraphicContext(gl),t.init(),this._canvas=o,this._frameRate=60,i.UpdateVisitor=n,i.CullVisitor=r,this._urlOptions=!0;var l=this._options.EventBackend||{};this._options.EventBackend=l,l.StandardMouseKeyboard=this._options.EventBackend.StandardMouseKeyboard||{};var c=l.StandardMouseKeyboard.mouseEventNode||u.mouseEventNode||o;l.StandardMouseKeyboard.mouseEventNode=c,l.StandardMouseKeyboard.keyboardEventNode=l.StandardMouseKeyboard.keyboardEventNode||document,l.Hammer=l.Hammer||{},l.Hammer.eventNode=l.Hammer.eventNode||u.mouseEventNode||o,l.GamePad=l.GamePad||{},this.setUpView(o)},Viewer.prototype=t.objectInehrit(s.prototype,{contextLost:function(){e.log("webgl context lost"),window.cancelRequestAnimFrame(this._requestID)},contextRestored:function(){e.log("webgl context restored, but not supported - reload the page")},init:function(){this._done=!1,this._state=new f;var e=this.getGraphicContext();this._state.setGraphicContext(e),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),this._updateVisitor=new i.UpdateVisitor,this._cullVisitor=new i.CullVisitor,this._renderStage=new o,this._stateGraph=new u,this._urlOptions&&this.parseOptions(),this.getCamera().setClearColor([0,0,0,0]),this._eventProxy=this.initEventProxy(this._options)},getState:function(){return this._state},parseOptions:function(){var e=function(){var e=[],t,n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var r=0;r<n.length;r++){t=n[r].split("=");var i=t[0].toLowerCase();e.push(i);var s=t[1];s===undefined&&(s="1"),e[i]=s.toLowerCase()}return e},t=e();t.stats==="1"&&this.initStats(t);var n=this.getGraphicContext();t.depth_test==="0"&&this.getGraphicContext().disable(n.DEPTH_TEST),t.blend==="0"&&this.getGraphicContext().disable(n.BLEND),t.cull_face==="0"&&this.getGraphicContext().disable(n.CULL_FACE),t.light==="0"&&this.setLightingMode(s.LightingMode.NO_LIGHT)},initStats:function(e){var t=35,n=5,r=14;e.statsMaxMS!==undefined&&(t=parseInt(e.statsMaxMS,10)),e.statsStepMS!==undefined&&(n=parseInt(e.statsStepMS,10));var i=function(e){var r=['<div id="StatsDiv" style="top: 0; position: absolute; width: 300px; height: 150px; z-index: 10;">','<div id="StatsCanvasDiv" style="position: relative;">','<canvas id="StatsCanvasGrid" width="300" height="150" style="z-index:-1; position: absolute; background: rgba(14,14,14,0.8); " ></canvas>','<canvas id="StatsCanvas" width="300" height="150" style="z-index:8; position: absolute;" ></canvas>','<canvas id="StatsCanvasText" width="300" height="150" style="z-index:9; position: absolute;" ></canvas>',"</div>","</div>"].join("\n"),i;e===undefined?i=document.body:i=document.getElementById(e);var s=document.createElement("div");s.innerHTML=r,i.appendChild(s);var o=document.getElementById("StatsCanvasGrid"),u=o.getContext("2d");u.clearRect(0,0,o.width,o.height);var a=Math.floor(t/n).toFixed(0),f=o.height/a;u.strokeStyle="rgb(70,70,70)";for(var l=0,c=a;l<c;l++)u.beginPath(),u.moveTo(0,l*f),u.lineTo(o.width,l*f),u.stroke();return{graph:document.getElementById("StatsCanvas"),text:document.getElementById("StatsCanvasText")}};if(this._canvasStats===undefined||this._canvasStats===null){var s=i();this._canvasStats=s.graph,this._canvasStatsText=s.text}this._stats=new Stats.Stats(this._canvasStats,this._canvasStatsText);var o=this;this._frameRate=1,this._frameTime=0,this._updateTime=0,this._cullTime=0,this._drawTime=0,this._stats.addLayer("#ff0fff",120,function(e){return 1e3/o._frameRate},function(e){return"FrameRate: "+e.toFixed(0)+" fps"}),this._stats.addLayer("#ffff00",t,function(e){return o._frameTime},function(e){return"FrameTime: "+e.toFixed(2)+" ms"}),this._stats.addLayer("#d07b1f",t,function(e){return o._updateTime},function(e){return"UpdateTime: "+e.toFixed(2)+" ms"}),this._stats.addLayer("#73e0ff",t,function(e){return o._cullTime},function(e){return"CullTime: "+e.toFixed(2)+" ms"}),this._stats.addLayer("#ff0000",t,function(e){return o._drawTime},function(e){return"DrawTime: "+e.toFixed(2)+" ms"}),window.performance&&window.performance.memory&&window.performance.memory.totalJSHeapSize&&this._stats.addLayer("#00ff00",window.performance.memory.totalJSHeapSize*2,function(e){return o._memSize},function(e){return"Memory : "+e.toFixed(0)+" b"})},update:function(){this.getScene().accept(this._updateVisitor)},cull:function(){this._stateGraph.clean(),this._renderStage.reset(),this._cullVisitor.reset(),this._cullVisitor.setStateGraph(this._stateGraph),this._cullVisitor.setRenderStage(this._renderStage);var e=this.getCamera();this._cullVisitor.pushStateSet(e.getStateSet()),this._cullVisitor.pushProjectionMatrix(e.getProjectionMatrix());var t=e.getBound(),n=a.makeIdentity([]);this._cullVisitor.pushModelviewMatrix(n),this._light&&this._cullVisitor.addPositionedAttribute(this._light),this._cullVisitor.pushModelviewMatrix(e.getViewMatrix()),this._cullVisitor.pushViewport(e.getViewport()),this._cullVisitor.setCullSettings(e),this._renderStage.setClearDepth(e.getClearDepth()),this._renderStage.setClearColor(e.getClearColor()),this._renderStage.setClearMask(e.getClearMask()),this._renderStage.setViewport(e.getViewport()),this.getScene().accept(this._cullVisitor),this._cullVisitor.popModelviewMatrix(),this._cullVisitor.popProjectionMatrix(),this._cullVisitor.popViewport(),this._cullVisitor.popStateSet(),this._renderStage.sort()},draw:function(){var e=this.getState();this._renderStage.draw(e),e.popAllStateSets(),e.applyWithoutProgram()},frame:function(){var e,n;e=t.performance.now(),this._lastFrameTime===undefined&&(this._lastFrameTime=0),this._frameRate=e-this._lastFrameTime,this._lastFrameTime=e,n=e;var r=this.getFrameStamp();r.getFrameNumber()===0&&(r.setReferenceTime(e/1e3),this._numberFrame=0),r.setSimulationTime(e/1e3-r.getReferenceTime()),this._updateVisitor.setFrameStamp(r),this.updateEventProxy(this._eventProxy,r),this.getManipulator()&&(this.getManipulator().update(this._updateVisitor),a.copy(this.getManipulator().getInverseMatrix(),this.getCamera().getViewMatrix())),this._stats===undefined?(this.update(),this.cull(),this.draw(),r.setFrameNumber(r.getFrameNumber()+1),this._numberFrame++,this._frameTime=t.performance.now()-n):(this._updateTime=t.performance.now(),this.update(),this._updateTime=t.performance.now()-this._updateTime,this._cullTime=t.performance.now(),this.cull(),this._cullTime=t.performance.now()-this._cullTime,this._drawTime=t.performance.now(),this.draw(),this._drawTime=t.performance.now()-this._drawTime,r.setFrameNumber(r.getFrameNumber()+1),this._numberFrame++,this._frameTime=t.performance.now()-n,window.performance&&window.performance.memory&&window.performance.memory.usedJSHeapSize&&(this._memSize=window.performance.memory.usedJSHeapSize),this._stats.update())},setDone:function(e){this._done=e},done:function(){return this._done},run:function(){var e=this,t=function(){e.done()||(e._requestID=window.requestAnimationFrame(t,e.canvas),e.frame())};t()},setupManipulator:function(t,n){t===undefined&&(t=new l),t.setNode!==undefined?t.setNode(this.getSceneData()):t.view=this,this.setManipulator(t);var r=this,i=this,s=this,o=function(t){var n=window.innerWidth,r=window.innerHeight,i=s.getCamera(),o=i.getViewport(),u=o.width(),f=o.height();s._canvas.width=n,s._canvas.height=r,s._canvas.style.width=n,s._canvas.style.height=r,e.debug("window resize "+u+"x"+f+" to "+n+"x"+r);var l=n/u,c=r/f,h=l/c;o.setViewport(o.x()*l,o.y()*c,o.width()*l,o.height()*c),h!==1&&a.preMult(i.getProjectionMatrix(),a.makeScale(1/h,1,1,[]))};window.onresize=o},initEventProxy:function(e){var t=e||{},n={},r=c,i=t.EventBackend,s=Object.keys(r);for(var o=0,u=s.length;o<u;o++){var a=s[o],f=!0,l={};i&&i[a]!==undefined&&(f=i[a].enable||!0,l=i[a]);if(f){var h=new r[a](this);h.init(l),n[a]=h}}return n},updateEventProxy:function(e,t){var n=Object.keys(e);n.forEach(function(n){var r=e[n];r.update&&r.update(t)})}}),Viewer}),define("osgViewer/osgViewer",["osgViewer/View","osgViewer/Viewer"],function(e,t){var n={};return n.View=e,n.Viewer=t,n}),define("OSG",["osg/osg","osgAnimation/osgAnimation","osgDB/osgDB","osgGA/osgGA","osgUtil/osgUtil","osgViewer/osgViewer"],function(e,t,n,r,i,s){var o={};return o.version="0.0.5",o.copyright="Cedric Pinson - cedric.pinson@plopbyte.com",o.osg=e,o.osgAnimation=t,o.osgDB=n,o.osgGA=r,o.osgUtil=i,o.osgViewer=s,o}),require(["OSG"]);var OSG = require('OSG'); var osg = OSG.osg; var osgAnimation = OSG.osgAnimation; var osgDB = OSG.osgDB; var osgGA = OSG.osgGA; var osgUtil = OSG.osgUtil; var osgViewer = OSG.osgViewer;
